/*
Created: 18/07/2019
Modified: 18/07/2019
Model: RE Oracle 11g Release 1
Database: Oracle 11g Release 1
*/

-- Create directories section -------------------------------------------------

CREATE DIRECTORY "FILES" AS '/mnt/backup/tramite'
/

CREATE DIRECTORY "EXPORT_DIR" AS '/home/oracle/export'
/

CREATE DIRECTORY "TGT_FILES" AS '/tgt/files'
/

CREATE DIRECTORY "SRC_FILES" AS '/src/files'
/

CREATE DIRECTORY "BACKUP_DMP" AS '/backup'
/

CREATE DIRECTORY "MNT_DMP" AS '/mnt/backup/dmp'
/

CREATE DIRECTORY "MNT_DMP_BCK" AS '/mnt/backup/dmp/DBA_REPORT'
/

CREATE DIRECTORY "ORACLE_OCM_CONFIG_DIR2" AS '/u01/app/oracle/product/11.2.0/db_1/ccr/state'
/

CREATE DIRECTORY "DIR_DMP" AS '/u02/dmp'
/

CREATE DIRECTORY "EXP_DMP" AS '/u01/dump'
/

CREATE DIRECTORY "QUEST_SOO_UDUMP_DIR" AS '/u01/app/oracle/diag/rdbms/incdes/incdes/trace/'
/

CREATE DIRECTORY "QUEST_SOO_BDUMP_DIR" AS '/u01/app/oracle/diag/rdbms/incdes/incdes/trace/'
/

CREATE DIRECTORY "QUEST_SOO_ADUMP_DIR" AS '/u01/app/oracle/admin/incdes/adump/'
/

CREATE DIRECTORY "XMLDIR" AS '/u01/app/oracle/product/11.2.0/db_1/rdbms/xml'
/

CREATE DIRECTORY "QUEST_SOO_CDUMP_DIR" AS '/u01/app/oracle/diag/rdbms/incdes/incdes/cdump/'
/

CREATE DIRECTORY "DATA_PUMP_DIR" AS '/u01/app/oracle/product/11.2.0/db_1/rdbms/log/'
/

CREATE DIRECTORY "ORACLE_OCM_CONFIG_DIR" AS '/u01/app/oracle/product/11.2.0/db_1/ccr/hosts/oracledesa.mcultura.gob.pe/state'
/

-- Create tables section -------------------------------------------------

-- Table MCCAS2.TM_ACCESOS

CREATE TABLE "MCCAS2"."TM_ACCESOS"(
  "NCODIGOMENU" Number CONSTRAINT "SYS_C00344993" NOT NULL,
  "NCODIGOPERFIL" Number CONSTRAINT "SYS_C00344994" NOT NULL,
  "SESTADO" Char(1 )
)
/

-- Add keys for table MCCAS2.TM_ACCESOS

ALTER TABLE "MCCAS2"."TM_ACCESOS" ADD CONSTRAINT "PK_TM_ACCESOS" PRIMARY KEY ("NCODIGOMENU","NCODIGOPERFIL")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_ACCESOS"."NCODIGOMENU" IS 'codigo de menu'
/
COMMENT ON COLUMN "MCCAS2"."TM_ACCESOS"."NCODIGOPERFIL" IS 'codigo de perfil'
/
COMMENT ON COLUMN "MCCAS2"."TM_ACCESOS"."SESTADO" IS 'estado de registro'
/

-- Table MCCAS2.TM_CONVOCATORIA

CREATE TABLE "MCCAS2"."TM_CONVOCATORIA"(
  "NIDCONVOCATORIA" Number,
  "IDUEJECOD" Varchar2(3 ),
  "DCONVOCATORIA" Varchar2(300 ),
  "SCONVOCATORIA" Varchar2(300 ),
  "NANIO" Number,
  "NTIPO" Number,
  "DFECHAINI" Date,
  "DFECHAFIN" Date,
  "BACTIVO" Number,
  "DFECHACREACION" Date,
  "NIDUSUCREACION" Number,
  "DFECHAEDICION" Date,
  "NIDUSUEDICION" Number,
  "NEVALUACION" Number DEFAULT 0,
  "NASISTENCIA" Number DEFAULT 0
)
/

-- Table MCCAS2.TM_ESTADOCIVIL

CREATE TABLE "MCCAS2"."TM_ESTADOCIVIL"(
  "NIDESTADOCIVIL" Number CONSTRAINT "SYS_C0067874" NOT NULL,
  "SDESCRIPCION" Varchar2(100 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date
)
/

-- Add keys for table MCCAS2.TM_ESTADOCIVIL

ALTER TABLE "MCCAS2"."TM_ESTADOCIVIL" ADD CONSTRAINT "PK_ESTADOCIVIL" PRIMARY KEY ("NIDESTADOCIVIL")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_ESTADOCIVIL"."NIDESTADOCIVIL" IS 'IDENTIFICADOR ESTADO CIVIL'
/
COMMENT ON COLUMN "MCCAS2"."TM_ESTADOCIVIL"."SDESCRIPCION" IS 'DESCRIPCIÓN DEL ESTADO CIVIL'
/
COMMENT ON COLUMN "MCCAS2"."TM_ESTADOCIVIL"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TM_ESTADOCIVIL"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_ESTADOCIVIL"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_ESTADOCIVIL"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_ESTADOCIVIL"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/

-- Table MCCAS2.TM_GENPERSONA

CREATE TABLE "MCCAS2"."TM_GENPERSONA"(
  "NCODIGOPERSONA" Number CONSTRAINT "SYS_C00345004" NOT NULL,
  "SPATERNO" Varchar2(40 ) CONSTRAINT "SYS_C00345005" NOT NULL,
  "SMATERNO" Varchar2(40 ),
  "SNOMBRE" Varchar2(40 ) CONSTRAINT "SYS_C00345006" NOT NULL,
  "DFECHANACIMIENTO" Date,
  "DFECHACREACION" Date DEFAULT SYSDATE CONSTRAINT "SYS_C00345007" NOT NULL,
  "DFECHAEDICION" Date,
  "NSESIONCREACION" Number DEFAULT 0 CONSTRAINT "SYS_C00345008" NOT NULL,
  "NSESIONEDICION" Number,
  "SSEXO" Char(1 ),
  "SSISTEMAORIGEN" Varchar2(10 ),
  "SCODIGOANTERIOR" Varchar2(10 ),
  "NCODIGOEMPRESA" Number,
  "STIPODOCUMENTO" Char(3 ),
  "SNUMERODOCUMENTO" Varchar2(20 ),
  "SCODIGOLUGARNACIMIENTO" Varchar2(6 )
)
/

-- Table MCCAS2.TM_GENUBIGEO

CREATE TABLE "MCCAS2"."TM_GENUBIGEO"(
  "SNOMBRE" Varchar2(60 ) CONSTRAINT "SYS_C00344997" NOT NULL,
  "SCODIGOUBIGEO" Char(6 ) CONSTRAINT "SYS_C00344998" NOT NULL,
  "DFECHACREACION" Date DEFAULT SYSDATE CONSTRAINT "SYS_C00344999" NOT NULL,
  "BACTIVO" Integer DEFAULT 1 CONSTRAINT "SYS_C00345000" NOT NULL,
  "DFECHAEDICION" Date,
  "NSESIONCREACION" Integer CONSTRAINT "SYS_C00345001" NOT NULL,
  "NSESIONEDICION" Number,
  "SCOBERTURANOT" Char(1 ) DEFAULT 'P' CONSTRAINT "SYS_C00345002" NOT NULL,
  "SCODIGOPOSTAL" Varchar2(25 )
)
/

-- Add keys for table MCCAS2.TM_GENUBIGEO

ALTER TABLE "MCCAS2"."TM_GENUBIGEO" ADD CONSTRAINT "PK_UBIGEO" PRIMARY KEY ("SCODIGOUBIGEO")
/

-- Table and Columns comments section
  
COMMENT ON TABLE "MCCAS2"."TM_GENUBIGEO" IS 'Tabla Maestra de Ubicaciones Geográficas.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."SNOMBRE" IS 'Nombre de Ubicación Geográfica.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."SCODIGOUBIGEO" IS 'Código Ubicación Geográfica INEI 2010.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."DFECHACREACION" IS 'Fecha de Creación.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."BACTIVO" IS '1 = Registro Activo.0 = Registro Eliminado.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."DFECHAEDICION" IS 'Fecha de Edición.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."NSESIONCREACION" IS 'Sesión de Creación.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."NSESIONEDICION" IS 'Sesión de Edición.'
/
COMMENT ON COLUMN "MCCAS2"."TM_GENUBIGEO"."SCOBERTURANOT" IS 'Ambito de Cobertura para Notificaciones:
L = Lima (local).
N = Nacional.
P = Pendiente.'
/

-- Table MCCAS2.TM_INST_EDUCATIVA

CREATE TABLE "MCCAS2"."TM_INST_EDUCATIVA"(
  "COD_REGIMEN" Number,
  "COD_TIPO_INST" Number,
  "COD_INSTITUCION" Number,
  "DESC_INSTITUCION" Varchar2(200 )
)
/

-- Table MCCAS2.TM_MENU

CREATE TABLE "MCCAS2"."TM_MENU"(
  "NCODIGOMENU" Number CONSTRAINT "SYS_C0067865" NOT NULL,
  "SDESCRIPCION" Varchar2(100 ),
  "SICONCLASS" Varchar2(100 ),
  "SURL" Varchar2(200 ),
  "NCODIGOPADRE" Number,
  "SMODULO" Char(1 ),
  "SESTADO" Char(1 ),
  "NORDEN" Number,
  "LISCLASS" Varchar2(100 )
)
/

-- Add keys for table MCCAS2.TM_MENU

ALTER TABLE "MCCAS2"."TM_MENU" ADD CONSTRAINT "PK_TM_MENU" PRIMARY KEY ("NCODIGOMENU")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."NCODIGOMENU" IS 'codigo de menu'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."SDESCRIPCION" IS 'descripcion'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."SICONCLASS" IS 'class icon'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."SURL" IS 'url de formulario'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."NCODIGOPADRE" IS 'codigo padre'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."SMODULO" IS 'modulo'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."SESTADO" IS 'estado de registro'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."NORDEN" IS 'orden del menu'
/
COMMENT ON COLUMN "MCCAS2"."TM_MENU"."LISCLASS" IS 'clase para la lista: despleg o sub-menu'
/

-- Table MCCAS2.TMP_BASES

CREATE TABLE "MCCAS2"."TMP_BASES"(
  "PROCESO" Varchar2(4000 ),
  "AREA" Varchar2(4000 ),
  "PUESTO" Varchar2(4000 ),
  "OBJETO" Varchar2(4000 ),
  "FORMACION" Varchar2(4000 ),
  "E_GENERAL" Varchar2(4000 ),
  "E_ESPECIFICA" Varchar2(4000 ),
  "CURSOS" Varchar2(4000 ),
  "CONOCIMIENTOS" Varchar2(4000 ),
  "DESCRIPCION" Varchar2(4000 ),
  "LUGAR" Varchar2(4000 ),
  "DURACION" Varchar2(4000 ),
  "REMUNERACION" Varchar2(4000 ),
  "P_MINTRA" Varchar2(4000 ),
  "P_CULTURA" Varchar2(4000 ),
  "REG_DATOS_FICHA" Varchar2(4000 ),
  "EVAL_CUR" Varchar2(4000 ),
  "P_ENTREVISTA" Varchar2(4000 ),
  "ENTREVISTA_PERSONAL" Varchar2(4000 ),
  "P_RESULTADO_FINAL" Varchar2(4000 ),
  "NCONVOCATORIA" Number,
  "IDOFICODIGO" Varchar2(20 ),
  "NIDPROCESO" Number,
  "NESTADO" Number
)
/

-- Table MCCAS2.TM_PERFILUSUARIO

CREATE TABLE "MCCAS2"."TM_PERFILUSUARIO"(
  "NCODIGOUSUARIO" Number CONSTRAINT "SYS_C0067871" NOT NULL,
  "NCODIGOPERFIL" Number CONSTRAINT "SYS_C0067872" NOT NULL,
  "BHABILITADO" Number DEFAULT 1,
  "DFECHACREACION" Date,
  "NIDUSUCREACION" Number,
  "DFECHAEDICION" Date,
  "NIDUSUEDICION" Number
)
/

-- Add keys for table MCCAS2.TM_PERFILUSUARIO

ALTER TABLE "MCCAS2"."TM_PERFILUSUARIO" ADD CONSTRAINT "PK_TM_PERFILUSUARIO" PRIMARY KEY ("NCODIGOUSUARIO","NCODIGOPERFIL")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_PERFILUSUARIO"."NCODIGOUSUARIO" IS 'CÓDIGO DE USUARIO (CÓDIGO DE PERSONA)'
/
COMMENT ON COLUMN "MCCAS2"."TM_PERFILUSUARIO"."NCODIGOPERFIL" IS 'CÓDIGO DE PERFIL'
/
COMMENT ON COLUMN "MCCAS2"."TM_PERFILUSUARIO"."BHABILITADO" IS '1=HABILITADO, 0=DESHABILITADO'
/
COMMENT ON COLUMN "MCCAS2"."TM_PERFILUSUARIO"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_PERFILUSUARIO"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_PERFILUSUARIO"."DFECHAEDICION" IS 'FECHA DE EDICIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_PERFILUSUARIO"."NIDUSUEDICION" IS 'USUARIO DE EDICIÓN'
/

-- Table MCCAS2.TM_SGAUSUARIO

CREATE TABLE "MCCAS2"."TM_SGAUSUARIO"(
  "NCODIGOUSUARIO" Number CONSTRAINT "SYS_C00345009" NOT NULL,
  "SCLAVE" Varchar2(150 ) CONSTRAINT "SYS_C00345010" NOT NULL,
  "SLOGIN" Varchar2(25 ) CONSTRAINT "SYS_C00345011" NOT NULL,
  "DFECHACREACION" Date DEFAULT SYSDATE CONSTRAINT "SYS_C00345012" NOT NULL,
  "DFECHAEDICION" Date,
  "NSESIONCREACION" Number CONSTRAINT "SYS_C00345013" NOT NULL,
  "NSESIONEDICION" Number,
  "BCAMBIOCLAVE" Integer DEFAULT 1 CONSTRAINT "SYS_C00345014" NOT NULL,
  "DFECHACAMBIO" Date DEFAULT SYSDATE CONSTRAINT "SYS_C00345015" NOT NULL,
  "NVIGENCIAUSUARIO" Integer DEFAULT 0 CONSTRAINT "SYS_C00345016" NOT NULL,
  "NVIGENCIACLAVE" Integer DEFAULT 0 CONSTRAINT "SYS_C00345017" NOT NULL,
  "SOBSERVACION" Varchar2(250 ),
  "STIPOCONTROL" Char(1 ) DEFAULT 'N' CONSTRAINT "SYS_C00345018" NOT NULL,
  "BEXTERNO" Integer DEFAULT 0 CONSTRAINT "SYS_C00345019" NOT NULL,
  "BHABILITADO" Integer DEFAULT 1 CONSTRAINT "SYS_C00345020" NOT NULL,
  "BBLOQUEADO" Number DEFAULT 0 CONSTRAINT "SYS_C00345021" NOT NULL,
  "NACCESOSFALLIDOS" Number DEFAULT 0 CONSTRAINT "SYS_C00345022" NOT NULL,
  "NCODIGOORGANIGRAMA" Number,
  "IDUEJECOD" Varchar2(3 )
)
/

-- Table MCCAS2.TM_TABLA_GENERAL_C

CREATE TABLE "MCCAS2"."TM_TABLA_GENERAL_C"(
  "NIDTABLA" Number,
  "SDTABLA" Varchar2(100 ),
  "BACTIVO" Number,
  "BFECHAS" Number,
  "BPARAMETROS" Number
)
/

-- Add keys for table MCCAS2.TM_TABLA_GENERAL_C

ALTER TABLE "MCCAS2"."TM_TABLA_GENERAL_C" ADD CONSTRAINT "PK_TGC" PRIMARY KEY ("NIDTABLA")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_C"."NIDTABLA" IS 'IDENTIFICADOR DE TABLA'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_C"."SDTABLA" IS 'DESCRIPCIÓN DE LA TABLA'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_C"."BACTIVO" IS 'ESTADO DEL ÍTEM 1=ACTIVO, 0=INACTIVO'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_C"."BFECHAS" IS 'INDICA SI EL DETALLE REQUIERE DE FECHAS, 1=SÍ, 2=NO'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_C"."BPARAMETROS" IS 'INDICA SI EL DETALLE REQUIERE DE PARÁMETROS NUMÉRICOS, 1=SÍ, 2=NO'
/

-- Table MCCAS2.TM_TABLA_GENERAL_D

CREATE TABLE "MCCAS2"."TM_TABLA_GENERAL_D"(
  "NIDTABLA" Number,
  "NIDITEM" Number,
  "SDITEM" Varchar2(100 ),
  "SSITEM" Varchar2(100 ),
  "DFECHA1" Date,
  "DFECHA2" Date,
  "NPARAM1" Number,
  "NPARAM2" Number,
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date
)
/

-- Add keys for table MCCAS2.TM_TABLA_GENERAL_D

ALTER TABLE "MCCAS2"."TM_TABLA_GENERAL_D" ADD CONSTRAINT "PK_TGD" PRIMARY KEY ("NIDTABLA","NIDITEM")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."NIDTABLA" IS 'IDENTIFICADOR DE TABLA'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."NIDITEM" IS 'IDENTIFICADOR DEL ÍTEM'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."SDITEM" IS 'DESCRIPCIÓN DEL ÍTEM'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."SSITEM" IS 'SIGLA DEL ÍTEM'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."DFECHA1" IS 'PARÁMETRO FECHA 1'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."DFECHA2" IS 'PARÁMETRO FECHA 2'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."NPARAM1" IS 'PARÁMETRO NÚMERO 1'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."NPARAM2" IS 'PARÁMETRO NÚMERO 2'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."BACTIVO" IS 'ESTADO DEL ÍTEM 1=ACTIVO, 0=INACTIVO, 2=ELIMINADO'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_TABLA_GENERAL_D"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/

-- Table MCCAS2.TM_TIPOFORMACION

CREATE TABLE "MCCAS2"."TM_TIPOFORMACION"(
  "NIDTIPOFORMACION" Number CONSTRAINT "SYS_C0067883" NOT NULL,
  "SDESCRIPCION" Varchar2(50 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date
)
/

-- Add keys for table MCCAS2.TM_TIPOFORMACION

ALTER TABLE "MCCAS2"."TM_TIPOFORMACION" ADD CONSTRAINT "PK_TM_TIPOFORMACION" PRIMARY KEY ("NIDTIPOFORMACION")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_TIPOFORMACION"."NIDTIPOFORMACION" IS 'IDENTIFICADOR ESTADO CIVIL'
/
COMMENT ON COLUMN "MCCAS2"."TM_TIPOFORMACION"."SDESCRIPCION" IS 'DESCRIPCIÓN DEL ESTADO CIVIL'
/
COMMENT ON COLUMN "MCCAS2"."TM_TIPOFORMACION"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TM_TIPOFORMACION"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_TIPOFORMACION"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_TIPOFORMACION"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_TIPOFORMACION"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/

-- Table MCCAS2.TM_USUARIO

CREATE TABLE "MCCAS2"."TM_USUARIO"(
  "NCODIGOUSUARIO" Integer CONSTRAINT "SYS_C0067870" NOT NULL,
  "SCLAVE" Varchar2(150 ),
  "SLOGIN" Varchar2(25 ),
  "BHABILITADO" Number DEFAULT 1,
  "DFECHACREACION" Date,
  "NIDUSUCREACION" Number,
  "DFECHAEDICION" Date,
  "NIDUSUEDICION" Number
)
/

-- Add keys for table MCCAS2.TM_USUARIO

ALTER TABLE "MCCAS2"."TM_USUARIO" ADD CONSTRAINT "PK_TM_USUARIO" PRIMARY KEY ("NCODIGOUSUARIO")
/

ALTER TABLE "MCCAS2"."TM_USUARIO" ADD CONSTRAINT "UQ_LOGIN" UNIQUE ("SLOGIN")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."NCODIGOUSUARIO" IS 'CÓDIGO DE USUARIO (CÓDIGO DE PERSONA)'
/
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."SCLAVE" IS 'CLAVE DEL USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."SLOGIN" IS 'IDENTIFICADOR O LOGIN DEL USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."BHABILITADO" IS '1=HABILITADO, 0=DESHABILITADO'
/
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."NIDUSUCREACION" IS 'USUARIO DE CRACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."DFECHAEDICION" IS 'FECHA DE EDICIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TM_USUARIO"."NIDUSUEDICION" IS 'USUARIO DE EDICIÓN'
/

-- Table MCCAS2.TR_ACTIVIDAD

CREATE TABLE "MCCAS2"."TR_ACTIVIDAD"(
  "NIDPROCESO" Number,
  "NIDACTIVIDAD" Number,
  "IDOFICODIGO" Varchar2(5 ),
  "SNOMBRE" Varchar2(200 ),
  "SDESCRIPCION" Varchar2(1000 ),
  "SPERFIL" Varchar2(1000 ),
  "SACCIONES" Varchar2(1000 ),
  "NVACANTES" Number,
  "NESTADO" Number,
  "DFECHA" Date,
  "NIDUSUARIO" Number
)
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."NIDPROCESO" IS 'IDENTIFICADOR DEL PROCESO'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."NIDACTIVIDAD" IS 'IDENTIFICADOR DE LA ACTIVIDAD'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."IDOFICODIGO" IS 'IDENTIFICADOR DE LA OFICINA'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."SNOMBRE" IS 'NOMBRE DE LA ACTIVIDAD'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."SDESCRIPCION" IS 'DESCRIPCION DE LA ACTIVIDAD'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."SPERFIL" IS 'PERFIL A SOLICITAR'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."SACCIONES" IS 'ACCIONES QUE VA A REALIZAR EL POSTULANTE'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."NVACANTES" IS 'VACANTES DISPONIBLES'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."NESTADO" IS 'ESTADO DE LA ACTIVIDAD, 1 ACTIVO, 0 ELIMINADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."DFECHA" IS 'AUD. FECHA DE MODIFICACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_ACTIVIDAD"."NIDUSUARIO" IS 'AUD. USUARIO DE MODIFICACION'
/

-- Table MCCAS2.TR_ADJUNTO

CREATE TABLE "MCCAS2"."TR_ADJUNTO"(
  "NIDPROCESOUSU" Number,
  "NIDADJUNTO" Number,
  "NIDTIPO" Number,
  "SRUTADOC" Varchar2(200 ),
  "BACTIVO" Number,
  "NIDUSUARIO" Number,
  "DFECHACREACION" Date,
  "DFECHAULTMOD" Date
)
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO_USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."NIDADJUNTO" IS 'IDENTIFICADOR DEL REGISTRO VOLUNTARIADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."NIDTIPO" IS 'TIPO DE ADJUNTO TM_TABLA_GENERAL_D-NIDTABLA=23'
/
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."SRUTADOC" IS 'RUTA DEL ADJUNTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."BACTIVO" IS 'ESTADO DE LA ACTIVIDAD, 1 ACTIVO, 0 ELIMINADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."NIDUSUARIO" IS 'AUD. USUARIO DE MODIFICACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."DFECHACREACION" IS 'AUD. FECHA DE CERACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_ADJUNTO"."DFECHAULTMOD" IS 'AUD. USUARIO DE MODIFICACION'
/

-- Table MCCAS2.TR_ASIST_AUD

CREATE TABLE "MCCAS2"."TR_ASIST_AUD"(
  "NIDASISTENCIA" Number,
  "SIP" Varchar2(100 ),
  "DFECHA" Date,
  "NIDUSUARIO" Number,
  "SLONGITUD" Varchar2(100 ),
  "SLATITUD" Varchar2(100 ),
  "SERROR" Varchar2(100 ),
  "SEXPLORADOR" Varchar2(100 ),
  "SHORA" Varchar2(5 ),
  "NTIPO_MARCA" Number,
  "NTIPO_HORA" Number
)
/

-- Table MCCAS2.TR_ASISTENCIA

CREATE TABLE "MCCAS2"."TR_ASISTENCIA"(
  "NIDASISTENCIA" Number,
  "NIDPROCESOUSU" Number,
  "DFECHA" Date,
  "SHORA_ING" Varchar2(5 ),
  "SHORA_SAL" Varchar2(5 ),
  "NESTADO" Number,
  "DFECHA_VAL" Date,
  "IDUSER_VAL" Number
)
/

-- Table MCCAS2.TR_CAPACITACION

CREATE TABLE "MCCAS2"."TR_CAPACITACION"(
  "NIDCAPACITACION" Number CONSTRAINT "SYS_C0067884" NOT NULL,
  "NIDPROCESOUSU" Number,
  "NMESDESDE" Number,
  "NANIODESDE" Number,
  "NMESHASTA" Number,
  "NANIOHASTA" Number,
  "SCURSO" Varchar2(200 ),
  "SINTITUCION" Varchar2(200 ),
  "NHORAS" Number,
  "SFOLIO" Varchar2(50 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "SRUTADOC" Varchar2(100 ),
  "DFECHA_DESDE" Date,
  "DFECHA_HASTA" Date
)
/

-- Add keys for table MCCAS2.TR_CAPACITACION

ALTER TABLE "MCCAS2"."TR_CAPACITACION" ADD CONSTRAINT "PK_CAPACITACION" PRIMARY KEY ("NIDCAPACITACION")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NIDCAPACITACION" IS 'IDENTIFICADOR DE LA CAPACITACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NMESDESDE" IS 'MES DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NANIODESDE" IS 'AÑO DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NMESHASTA" IS 'MES HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NANIOHASTA" IS 'AÑO HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."SCURSO" IS 'CURSO-EVENTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."SINTITUCION" IS 'INSTITUCION'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NHORAS" IS 'HORAS LECTIVAS'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."SFOLIO" IS 'NUMERO DE FOLIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."SRUTADOC" IS 'RUTA DEL DOCUMENTO ADJUNTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."DFECHA_DESDE" IS 'FECHA DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_CAPACITACION"."DFECHA_HASTA" IS 'FECHA HASTA'
/

-- Table MCCAS2.TR_COLEGIATURA

CREATE TABLE "MCCAS2"."TR_COLEGIATURA"(
  "NIDCOLEGIATURA" Number CONSTRAINT "SYS_C0067876" NOT NULL,
  "NIDPROCESOUSU" Number,
  "SCOLEGIO" Varchar2(200 ),
  "SNROCOLEGIATURA" Varchar2(200 ),
  "BCONDICION" Number,
  "SFOLIO" Varchar2(50 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "SRUTADOC" Varchar2(100 )
)
/

-- Add keys for table MCCAS2.TR_COLEGIATURA

ALTER TABLE "MCCAS2"."TR_COLEGIATURA" ADD CONSTRAINT "PK_TR_COLEGIATURA" PRIMARY KEY ("NIDCOLEGIATURA")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."NIDCOLEGIATURA" IS 'IDENTIFICADOR DE LA COLEGIATURA'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."SCOLEGIO" IS 'COLEGIO PROFESIONAL'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."SNROCOLEGIATURA" IS 'NUMERO DE LA COLEGIATURA'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."BCONDICION" IS 'CONDICION A LA FECHA (0=NO HABILITADO, 1=HABILITADO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."SFOLIO" IS 'NUMERO DE FOLIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_COLEGIATURA"."SRUTADOC" IS 'RUTA DEL DOCUMENTO ADJUNTO'
/

-- Table MCCAS2.TR_CONOCIMIENTO

CREATE TABLE "MCCAS2"."TR_CONOCIMIENTO"(
  "NIDCONOCIMIENTO" Number CONSTRAINT "SYS_C0067877" NOT NULL,
  "NIDPROCESOUSU" Number,
  "SDESCRIPCION" Varchar2(2000 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "NIDTIPO" Number,
  "SRUTADOC" Varchar2(100 ),
  "NCONOCIMIENTO_B" Number
)
/

-- Add keys for table MCCAS2.TR_CONOCIMIENTO

ALTER TABLE "MCCAS2"."TR_CONOCIMIENTO" ADD CONSTRAINT "PK_CONOCIMIENTO" PRIMARY KEY ("NIDCONOCIMIENTO")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."NIDCONOCIMIENTO" IS 'IDENTIFICADOR DEL CONOCIMIENTO ESPECIALIZADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."SDESCRIPCION" IS 'CONOCIMIENTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."NIDTIPO" IS 'TIPO DE CONOCIMIENTO TM_TABLA_GENERAL_D-NIDTABLA=3'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTO"."SRUTADOC" IS 'RUTA DEL DOCUMENTO DE SUSTENTO'
/

-- Table MCCAS2.TR_CONOCIMIENTOINF

CREATE TABLE "MCCAS2"."TR_CONOCIMIENTOINF"(
  "NIDCONOCIMIENTOINF" Number CONSTRAINT "SYS_C0067866" NOT NULL,
  "NIDPROCESOUSU" Number,
  "SCONOCIMIENTO" Varchar2(2000 ),
  "BTIPO" Char(1 ),
  "SFOLIO" Varchar2(50 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "SRUTADOC" Varchar2(100 )
)
/

-- Add keys for table MCCAS2.TR_CONOCIMIENTOINF

ALTER TABLE "MCCAS2"."TR_CONOCIMIENTOINF" ADD CONSTRAINT "PK_CONOCIMIENTOINF" PRIMARY KEY ("NIDCONOCIMIENTOINF")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."NIDCONOCIMIENTOINF" IS 'IDENTIFICADOR DEL CONOCIMIENTO INFORMATICO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."SCONOCIMIENTO" IS 'CONOCIMIENTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."BTIPO" IS 'B=BASICO, I=INTERMEDIO, A=AVANZADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."SFOLIO" IS 'NUMERO DE FOLIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_CONOCIMIENTOINF"."SRUTADOC" IS 'RUTA DEL DOCUMENTO ADJUNTO'
/

-- Table MCCAS2.TR_CONTRATO

CREATE TABLE "MCCAS2"."TR_CONTRATO"(
  "NIDPROCESOUSU" Number CONSTRAINT "SYS_C0067885" NOT NULL,
  "NOMBRE_ANIO" Varchar2(200 ) CONSTRAINT "SYS_C0067886" NOT NULL,
  "NRO_CONTRATO" Number CONSTRAINT "SYS_C0067887" NOT NULL,
  "SEXO_DIR" Char(1 ) CONSTRAINT "SYS_C0067888" NOT NULL,
  "NOMBRE_DIR" Varchar2(100 ) CONSTRAINT "SYS_C0067889" NOT NULL,
  "DNI_DIR" Varchar2(10 ) CONSTRAINT "SYS_C0067890" NOT NULL,
  "DRESOLUCION" Varchar2(100 ) CONSTRAINT "SYS_C0067891" NOT NULL,
  "FECHA_RESOL" Date CONSTRAINT "SYS_C0067892" NOT NULL,
  "NOMBRE_TRAB" Varchar2(100 ) CONSTRAINT "SYS_C0067893" NOT NULL,
  "DNI_TRAB" Varchar2(10 ) CONSTRAINT "SYS_C0067894" NOT NULL,
  "RUC_TRAB" Varchar2(20 ) CONSTRAINT "SYS_C0067895" NOT NULL,
  "SERVICIO" Varchar2(200 ) CONSTRAINT "SYS_C0067896" NOT NULL,
  "FINI_CONTRATO" Date CONSTRAINT "SYS_C0067897" NOT NULL,
  "FFIN_CONTRATO" Date CONSTRAINT "SYS_C0067898" NOT NULL,
  "NSUELDO" Number CONSTRAINT "SYS_C0067899" NOT NULL,
  "DSUELDO" Varchar2(200 ) CONSTRAINT "SYS_C0067900" NOT NULL,
  "OFICINA" Varchar2(200 ) CONSTRAINT "SYS_C0067901" NOT NULL,
  "NRO_CONVOCATORIA" Varchar2(100 ) CONSTRAINT "SYS_C0067902" NOT NULL,
  "FECHA_SUSCRIPCION" Date CONSTRAINT "SYS_C0067903" NOT NULL,
  "NIDUSUARIO_CREA" Number,
  "DFECHA_CREA" Date,
  "DFECHA_MOD" Date,
  "NIDUSUARIO_MOD" Number,
  "SDIRECCION" Varchar2(200 )
)
/

-- Table MCCAS2.TR_DATOSACADEMICOS

CREATE TABLE "MCCAS2"."TR_DATOSACADEMICOS"(
  "NIDPROCESOUSU" Number,
  "NIDACADEMICO" Number,
  "NTIPO_FORMACION" Number,
  "NGRADO_ACADEMICO" Number,
  "NIDINSTITUCION" Number,
  "DCARRERA" Varchar2(200 ),
  "NCICLO" Number,
  "BACTIVO" Number,
  "NIDUSUARIO" Number,
  "DFECHACREACION" Date,
  "DFECHAULTMOD" Date
)
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO_USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."NIDACADEMICO" IS 'IDENTIFICADOR DEL REGISTRO ACADEMICO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."NTIPO_FORMACION" IS 'TIPO DE FORMACIÓN TM_TABLA_GENERAL_D-NIDTABLA=1'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."NGRADO_ACADEMICO" IS 'GRADO ACADEMICO TM_TABLA_GENERAL_D-NIDTABLA=2'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."NIDINSTITUCION" IS 'INSTITUCION TM_TABLA_GENERAL_D-NIDTABLA=20'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."DCARRERA" IS 'NOMBRE DE LA CARRERA'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."NCICLO" IS 'CICLO DE ESTUDIOS'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."BACTIVO" IS 'ESTADO DE LA ACTIVIDAD, 1 ACTIVO, 0 ELIMINADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."NIDUSUARIO" IS 'AUD. USUARIO DE MODIFICACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."DFECHACREACION" IS 'AUD. FECHA DE CERACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSACADEMICOS"."DFECHAULTMOD" IS 'AUD. USUARIO DE MODIFICACION'
/

-- Table MCCAS2.TR_DATOSADICIONALES

CREATE TABLE "MCCAS2"."TR_DATOSADICIONALES"(
  "NIDDATOSADIC" Number CONSTRAINT "SYS_C0067878" NOT NULL,
  "NIDPROCESOUSU" Number,
  "BFAMILIADIRECTA" Number,
  "SFAMILIADIRECTA" Varchar2(1000 ),
  "BDISCAPACIDAD" Number,
  "STIPO" Varchar2(500 ),
  "SFOLIO" Varchar2(50 ),
  "BDEUDOR" Number,
  "BANTECEDENTES" Number,
  "SANTECEDENTES" Varchar2(2000 ),
  "BFUERZAARMADA" Number,
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "BTERM_COND" Number,
  "SRUTADOC_DIS" Varchar2(100 ),
  "SRUTADOC_LFA" Varchar2(100 ),
  "BINHAB_ESTADO" Number,
  "BINCOMP_ESTADO" Number,
  "BPENSIONISTA" Number,
  "BTIPO_PENSION" Number,
  "BPENSION_SUSP" Number,
  "BPARENTESCO" Number,
  "SRUTADOC_OCI" Varchar2(100 ),
  "SRUTADOC_A3B" Varchar2(100 ),
  "SRUTADOC_DEP" Varchar2(200 ),
  "BDEPORTISTA" Number
)
/

-- Add keys for table MCCAS2.TR_DATOSADICIONALES

ALTER TABLE "MCCAS2"."TR_DATOSADICIONALES" ADD CONSTRAINT "PK_DATOSADIC" PRIMARY KEY ("NIDDATOSADIC")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."NIDDATOSADIC" IS 'IDENTIFICADOR DE DATOS ADICIONALES'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BFAMILIADIRECTA" IS 'TIENE FAMILIA DIRECTA? 1=SI, 0=NO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."SFAMILIADIRECTA" IS 'DESCRIPCION EN CASO BFAMILIADIRECTA=0'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BDISCAPACIDAD" IS 'TIENE DISCAPACIDAD? 1=SI, 0=NO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."STIPO" IS 'TIPO DE DISCAPACIDAD'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."SFOLIO" IS 'NUMERO DE FOLIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BDEUDOR" IS 'ESTA EN EL REGISTRO DE DEUDORES? 1=SI, 0=NO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BANTECEDENTES" IS 'TIENE ANTECEDENTES? 1=SI, 0=NO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."SANTECEDENTES" IS 'ESPECIFICACIÓN DE ANTECEDENTES'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BFUERZAARMADA" IS 'PERTENECE A LAS FUERZAS ARMADAS? 1=SI, 0=NO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BTERM_COND" IS 'INDICADOR ACEPTACIÓN DE LAS BASES DEL PROCESO(1 = SÍ, 0= NO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BINHAB_ESTADO" IS 'INDICA SI ESTÁ INHABILITADO PARA TRABAJAR CON EL ESTADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BINCOMP_ESTADO" IS 'INDICA SI TIENE INCOMPATIBILIDAD PARA TRABAJAR CON EL ESTADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BPENSIONISTA" IS 'INDICA SI ES PENSIONISTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BTIPO_PENSION" IS 'INDICA TIPO DE PENSIONISTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BPENSION_SUSP" IS 'INDICA SI SUSPENDIÓ SU PENSION'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSADICIONALES"."BPARENTESCO" IS 'INDICA EL TIPO DE PARENTESCO'
/

-- Table MCCAS2.TR_DATOSPERSONALES

CREATE TABLE "MCCAS2"."TR_DATOSPERSONALES"(
  "NIDCODIGOUSUARIO" Number CONSTRAINT "SYS_C0067879" NOT NULL,
  "SAPATERNO" Varchar2(500 ),
  "SAMATERNO" Varchar2(500 ),
  "SNOMBRES" Varchar2(500 ),
  "NEDAD" Number,
  "NIDESTADOCIVIL" Number,
  "SUBIGEONAC" Varchar2(6 ),
  "DFECHANAC" Date,
  "SSEXO" Char(1 ),
  "SDNI" Varchar2(20 ),
  "SRUC" Char(11 ),
  "SBREVETE" Varchar2(11 ),
  "SCATBREVETE" Varchar2(30 ),
  "SDIRECCION" Varchar2(200 ),
  "SUBIGEODIR" Varchar2(6 ),
  "SNROLOTE" Varchar2(30 ),
  "STELEFONOFIJO" Varchar2(30 ),
  "SCELULAR" Varchar2(30 ),
  "SCORREO" Varchar2(300 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "SRUTADOC" Varchar2(100 ),
  "NTIPODOC" Number,
  "DNACIONALIDAD" Number,
  "SNOMBRE_C" Varchar2(100 ),
  "STELEFONO" Varchar2(100 ),
  "SPARENTESCO" Varchar2(100 ),
  "SRUTADOC_NAC" Varchar2(100 ),
  "SPAIS_NAC" Varchar2(100 ),
  "NEXCLUIDO_FFAA" Number DEFAULT 0
)
/

-- Add keys for table MCCAS2.TR_DATOSPERSONALES

ALTER TABLE "MCCAS2"."TR_DATOSPERSONALES" ADD CONSTRAINT "PK_TR_DATOSPERSONALES" PRIMARY KEY ("NIDCODIGOUSUARIO")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."NIDCODIGOUSUARIO" IS 'IDENTIFICADOR DEL USUARIO/PERSONA'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SAPATERNO" IS 'APELLIDO PATERNO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SAMATERNO" IS 'APELLIDO MATERNO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SNOMBRES" IS 'NOMBRES'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."NEDAD" IS 'EDAD'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."NIDESTADOCIVIL" IS 'IDENTIFICADOR DEL ESTADO CIVIL'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SUBIGEONAC" IS 'UBIGEO DE NACIMIENTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."DFECHANAC" IS 'FECHA DE NACIMIENTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SSEXO" IS 'F=FEMENINO, M=MASCULINO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SDNI" IS 'DNI'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SRUC" IS 'RUC'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SBREVETE" IS 'BREVETE'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SCATBREVETE" IS 'CATEGORIA BREVETE'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SDIRECCION" IS 'DIRECCIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SUBIGEODIR" IS 'UBIGEO DIRECCION'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SNROLOTE" IS 'NRO/LOTE'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."STELEFONOFIJO" IS 'TELEFONO FIJO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SCELULAR" IS 'CELULAR'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SCORREO" IS 'CORREO'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_DATOSPERSONALES"."SRUTADOC" IS 'RUTA DEL DOCUMENTO DE SUSTENTO'
/

-- Table MCCAS2.TREG_IE_CARRERAS

CREATE TABLE "MCCAS2"."TREG_IE_CARRERAS"(
  "COD_REGIMEN" Varchar2(20 ),
  "DESC_REGIMEN" Varchar2(200 ),
  "COD_TIPO_INST" Varchar2(20 ),
  "DESC_TIPO_INST" Varchar2(200 ),
  "COD_INSTITUCION" Varchar2(20 ),
  "DESC_INSTITUCION" Varchar2(200 ),
  "COD_CARRERA" Varchar2(20 ),
  "DESC_CARRERA" Varchar2(200 )
)
/

-- Table MCCAS2.TR_ESTADO_EVAL

CREATE TABLE "MCCAS2"."TR_ESTADO_EVAL"(
  "NIDCONVOCATORIA" Number,
  "NIDESTADO" Number,
  "DFECHAINI" Date,
  "DFECHAFIN" Date,
  "NIDUSUINI" Number,
  "NIDUSUFIN" Number,
  "SOBSERVACION" Varchar2(1000 )
)
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_ESTADO_EVAL"."NIDCONVOCATORIA" IS 'ID DE LA CONVOCATORIA'
/
COMMENT ON COLUMN "MCCAS2"."TR_ESTADO_EVAL"."NIDESTADO" IS 'ID DEL ESTADO, TG:6'
/
COMMENT ON COLUMN "MCCAS2"."TR_ESTADO_EVAL"."DFECHAINI" IS 'FECHA EN LA QUE INICIO LA EVALUACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_ESTADO_EVAL"."DFECHAFIN" IS 'FECHA EN LA QUE FIALIZO LA EVALUACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_ESTADO_EVAL"."NIDUSUINI" IS 'ID DEL USUARIO QUE INICIO LA EVALUACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_ESTADO_EVAL"."NIDUSUFIN" IS 'ID DEL USUARIO QUE FINALIZO LA EVALUACION'
/
COMMENT ON COLUMN "MCCAS2"."TR_ESTADO_EVAL"."SOBSERVACION" IS 'OBSERVACION DEL CAMBIO DE ESTADO'
/

-- Table MCCAS2.TR_EXPERIENCIA

CREATE TABLE "MCCAS2"."TR_EXPERIENCIA"(
  "NIDEXPERIENCIA" Number CONSTRAINT "SYS_C0067880" NOT NULL,
  "NIDPROCESOUSU" Number,
  "SENTIDAD" Varchar2(1000 ),
  "SAREA" Varchar2(1000 ),
  "SCARGO" Varchar2(1000 ),
  "SFUNCIONES" Varchar2(3000 ),
  "SMODALIDAD" Varchar2(1000 ),
  "SMOTIVORETIRO" Varchar2(1000 ),
  "SNOMBRECARGOJEFE" Varchar2(1000 ),
  "NTIEMPOSERVICIO" Number,
  "NMESDESDE" Number,
  "NANIODESDE" Number,
  "NMESHASTA" Number,
  "NANIOHASTA" Number,
  "NREMUNERACION" Number,
  "STELEFONO" Varchar2(50 ),
  "SFOLIO" Varchar2(100 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "BESPECIFICA" Number,
  "BSECTOR" Number,
  "DFECHA_DESDE" Date,
  "DFECHA_HASTA" Date,
  "NPRESENTACIONES" Number,
  "SRUTADOC" Varchar2(100 )
)
/

-- Add keys for table MCCAS2.TR_EXPERIENCIA

ALTER TABLE "MCCAS2"."TR_EXPERIENCIA" ADD CONSTRAINT "PK_EXPERIENCIA" PRIMARY KEY ("NIDEXPERIENCIA")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NIDEXPERIENCIA" IS 'IDENTIFICADOR DE LA EXPERIENCIA LABORAL'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SENTIDAD" IS 'NOMBRE DE LA ENTIDAD'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SAREA" IS 'AREA'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SCARGO" IS 'CARGO'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SFUNCIONES" IS 'FUNCIONES PRINCIPALES'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SMODALIDAD" IS 'MODALIDAD DE CONTRATO'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SMOTIVORETIRO" IS 'MOTIVO DE RETIRO'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SNOMBRECARGOJEFE" IS 'NOMBRE Y CARGO DEL JEFE DIRECTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NTIEMPOSERVICIO" IS 'TIEMPO DE SERVICIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NMESDESDE" IS 'MES DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NANIODESDE" IS 'AÑO DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NMESHASTA" IS 'MES HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NANIOHASTA" IS 'AÑO HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NREMUNERACION" IS 'REMUNERACION O RETRIBUCION'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."STELEFONO" IS 'TELEFONO ED LA OFICINA'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SFOLIO" IS 'NUMERO DE FOLIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."BESPECIFICA" IS 'INDICA SI LA EXPERIENCIA LABORAL ES ESPECÍFICA (1=SÍ, 0=NO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."BSECTOR" IS 'SECTOR LABORAL (1=PÚBLICO, 2=PRIVADO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."DFECHA_DESDE" IS 'FECHA DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."DFECHA_HASTA" IS 'FECHA HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."NPRESENTACIONES" IS 'NÚMERO DE PRESENTACIONES'
/
COMMENT ON COLUMN "MCCAS2"."TR_EXPERIENCIA"."SRUTADOC" IS 'RUTA DEL DOCUMENTO ADJUNTO'
/

-- Table MCCAS2.TR_FORMACIONAC

CREATE TABLE "MCCAS2"."TR_FORMACIONAC"(
  "NIDFACADEMICA" Number CONSTRAINT "SYS_C0067873" NOT NULL,
  "NIDPROCESOUSU" Number,
  "NIDTIPOFORMACION" Number,
  "SINSTITUCION" Varchar2(200 ),
  "SGRADOACADEMICO" Varchar2(200 ),
  "SPROFESION" Varchar2(200 ),
  "NMESDESDE" Number,
  "NANIODESDE" Number,
  "NMESHASTA" Number,
  "NANIOHASTA" Number,
  "NANIOSESTUDIO" Number,
  "SFOLIO" Varchar2(50 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "DFECHA_DESDE" Date,
  "DFECHA_HASTA" Date,
  "NIDGRADOACADEMICO" Number,
  "SRUTADOC" Varchar2(100 ),
  "COD_INSTITUCION" Number,
  "COD_CARRERA" Varchar2(20 )
)
/

-- Add keys for table MCCAS2.TR_FORMACIONAC

ALTER TABLE "MCCAS2"."TR_FORMACIONAC" ADD CONSTRAINT "PK_TR_FORMACIONAC" PRIMARY KEY ("NIDFACADEMICA")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NIDFACADEMICA" IS 'IDENTIFICADOR DE FORMACION ACADEMICA'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NIDTIPOFORMACION" IS 'TIPO DE FORMACIÓN TM_TABLA_GENERAL_D-NIDTABLA=1'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."SINSTITUCION" IS 'NOMBRE DE LA INSTITUCION'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."SGRADOACADEMICO" IS 'GRADO ACADEMICO'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."SPROFESION" IS 'PROFESION O ESPECIALIDAD'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NMESDESDE" IS 'MES DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NANIODESDE" IS 'AÑO DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NMESHASTA" IS 'MES HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NANIOHASTA" IS 'AÑO HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NANIOSESTUDIO" IS 'AÑOS DE ESTUDIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."SFOLIO" IS 'NUMERO DE FOLIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."DFECHA_DESDE" IS 'FECHA DESDE'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."DFECHA_HASTA" IS 'FECHA HASTA'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."NIDGRADOACADEMICO" IS 'GRADO ACADÉMICO TM_TABLA_GENERAL_D-NIDTABLA=2'
/
COMMENT ON COLUMN "MCCAS2"."TR_FORMACIONAC"."SRUTADOC" IS 'RUTA DEL DOCUMENTO ADJUNTO'
/

-- Table MCCAS2.TR_IDIOMA

CREATE TABLE "MCCAS2"."TR_IDIOMA"(
  "NIDIDIOMA" Number CONSTRAINT "SYS_C0067869" NOT NULL,
  "NIDPROCESOUSU" Number,
  "SIDIOMA" Varchar2(2000 ),
  "BTIPO" Char(1 ),
  "SFOLIO" Varchar2(50 ),
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "SRUTADOC" Varchar2(100 )
)
/

-- Add keys for table MCCAS2.TR_IDIOMA

ALTER TABLE "MCCAS2"."TR_IDIOMA" ADD CONSTRAINT "PK_IDIOMA" PRIMARY KEY ("NIDIDIOMA")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."NIDIDIOMA" IS 'IDENTIFICADOR DEL IDIOMA'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO POR USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."SIDIOMA" IS 'IDIOMA'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."BTIPO" IS 'B=BASICO, I=INTERMEDIO, A=AVANZADO'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."SFOLIO" IS 'NUMERO DE FOLIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_IDIOMA"."SRUTADOC" IS 'RUTA DEL DOCUMENTO ADJUNTO'
/

-- Table MCCAS2.TR_MSG_VALIDACION

CREATE TABLE "MCCAS2"."TR_MSG_VALIDACION"(
  "NIDPROCESOUSU" Number,
  "MENSAJE" Varchar2(4000 ),
  "FECHA_MSG" Date,
  "NTIPO" Number
)
/

-- Table MCCAS2.TR_PROCESO

CREATE TABLE "MCCAS2"."TR_PROCESO"(
  "NIDPROCESO" Number CONSTRAINT "SYS_C0067867" NOT NULL,
  "SSERVICIO" Varchar2(1000 ),
  "SPROCESO" Varchar2(500 ),
  "NPROCESO" Number,
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "BESTADO" Number,
  "NEXP_GEN" Number,
  "NEXP_ESP" Number,
  "NCOLEG_OBLIG" Number,
  "NIDCONVOCATORIA" Number,
  "SIDSFORMACIONACAD" Varchar2(100 ),
  "SIDSGRADOSACAD" Varchar2(100 ),
  "NELENCO" Number,
  "NPLAZAS" Number,
  "SRUTADOC" Varchar2(100 ),
  "NEVALTEC" Number,
  "NRESULTADO" Number,
  "IDOFICODIGO" Varchar2(4 ),
  "NSUELDO" Number,
  "SMOTIVO" Varchar2(4000 ),
  "SPLAZA_AIRHSP" Varchar2(10 ),
  "IDFTECODIGO" Varchar2(3 ),
  "SIAF" Varchar2(4 ),
  "SACTIVIDADES" Varchar2(4000 ),
  "DPUESTO" Varchar2(200 ),
  "DOBJETO" Varchar2(1000 ),
  "DLUGAR" Varchar2(500 ),
  "SDURACION" Varchar2(500 ),
  "NOBLIG_BREVETE" Number,
  "NRNA_OBLIG" Number,
  "NCOLEGHAB_OBLIG" Number,
  "NANIO" Number,
  "NTIPO" Number,
  "FLIMITE_VOL" Date,
  "FFIN_VOL" Date,
  "NOBLIG_DJ" Number,
  "NOCI" Number DEFAULT 0,
  "NMESES" Number DEFAULT 0,
  "NTIPOBASE" Number,
  "IDSERCASCODIGO" Varchar2(6 )
)
/

-- Add keys for table MCCAS2.TR_PROCESO

ALTER TABLE "MCCAS2"."TR_PROCESO" ADD CONSTRAINT "PK_TM_PROCESO" PRIMARY KEY ("NIDPROCESO")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NIDPROCESO" IS 'IDENTIFICADOR DEL PROCESO CAS'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."SSERVICIO" IS 'SERVICIO AL QUE POSTULA'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."SPROCESO" IS 'NOMBRE DEL PROCESO CAS'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NPROCESO" IS 'NUMERO DE PROCESO CAS'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."BESTADO" IS 'ESTADO DEL PROCESO (1=EN CURSO, 2=CONCLUIDO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NEXP_GEN" IS 'CANTIDAD EN AÑOS DE EXPERIENCIA LABORAL GENERAL'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NEXP_ESP" IS 'CANTIDAD EN AÑOS DE EXPERIENCIA LABORAL ESPECÍFICA'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NCOLEG_OBLIG" IS 'INDICA SI SE DEBE VALIDAR EL INGRESO DE LA COLEGIATURA (1 = SÍ, 0= NO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NIDCONVOCATORIA" IS 'CONVOCATORIA TM_TABLA_GENERAL_D-NIDTABLA=4'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."SIDSFORMACIONACAD" IS 'IDS DE FORMACIÓN ACADÉMICA PERMITIDAS TM_TABLA_GENERAL_D-NIDTABLA=1'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."SIDSGRADOSACAD" IS 'IDS DE GRADOS ACADÉMICOS PERMITIDOS TM_TABLA_GENERAL_D-NIDTABLA=2'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NELENCO" IS 'INDICADOR SI ES UN PROCESO DE ELENCOS'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NPLAZAS" IS 'NUMERO DE PLAZAS DEL PROCESO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."SRUTADOC" IS 'RUTA DEL DOCUMENTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NEVALTEC" IS 'INDICADOR SI REQUIERE EVALUACION TECNICA'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NRESULTADO" IS 'RESULTADO DEL PROCESO, TG:7'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NOBLIG_BREVETE" IS 'INDICA SI ES OBLICATORIO EL REGISTRO DEL BREVETE'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NRNA_OBLIG" IS 'INDICA SI ES OBLICATORIO EL REGISTRO DEL RNA'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESO"."NCOLEGHAB_OBLIG" IS 'INDICA SI ES OBLICATORIO EL REGISTRO DE LA COLEGIATURA HABILITADA'
/

-- Table MCCAS2.TR_PROCESO_BASES

CREATE TABLE "MCCAS2"."TR_PROCESO_BASES"(
  "NIDPROCESO" Number,
  "NIDTIPO_BASE" Number,
  "NIDREGISTRO" Number,
  "SDESCRIPCION" Varchar2(2000 ),
  "BACTIVO" Number,
  "NPRIORIDAD" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date
)
/

-- Table MCCAS2.TR_PROCESOCOMITE

CREATE TABLE "MCCAS2"."TR_PROCESOCOMITE"(
  "NIDCOMITE" Number CONSTRAINT "SYS_C0067868" NOT NULL,
  "NIDPERSONAL" Number,
  "NIDPROCESO" Number,
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "NTIPO_EVALUADOR" Number,
  "NMODIFICA" Number,
  "NPRINCIPAL" Number,
  "NREEMPLAZO" Number,
  "DSUSTENTOR" Varchar2(1000 ),
  "NRENTREVISTA" Number,
  "NREVALTEC" Number,
  "NREVALCUR" Number,
  "NIDACTIVIDAD" Number DEFAULT 0
)
/

-- Add keys for table MCCAS2.TR_PROCESOCOMITE

ALTER TABLE "MCCAS2"."TR_PROCESOCOMITE" ADD CONSTRAINT "PK_COMITE" PRIMARY KEY ("NIDCOMITE")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."NIDCOMITE" IS 'IDENTIFICADOR DEL MIEMBRO DEL COMITE'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."NIDPERSONAL" IS 'IDENTIFICADOR DEL PERSONAL (CODIGO USUARIO) DEL MODULO DE PERSONAL'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."NIDPROCESO" IS 'IDENTIFICADOR DEL PROCESO DE CONVOCATORIA CAS'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."NTIPO_EVALUADOR" IS 'INDICADOR TIPO DE EVALUADOR, TG:5'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOCOMITE"."NMODIFICA" IS 'INDICADOR DE HABILITACION DE MODIFICACION DE CALIFICACIONES'
/

-- Table MCCAS2.TR_PROCESO_CRONOGRAMA

CREATE TABLE "MCCAS2"."TR_PROCESO_CRONOGRAMA"(
  "NIDPROCESO" Number,
  "NIDTIPO_FECHA" Number,
  "NIDREGISTRO" Number,
  "DFECHAINI" Date,
  "DFECHAFIN" Date,
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date
)
/

-- Table MCCAS2.TR_PROCESOUSUARIO

CREATE TABLE "MCCAS2"."TR_PROCESOUSUARIO"(
  "NIDPROCESOUSU" Number CONSTRAINT "SYS_C0067875" NOT NULL,
  "NIDCODIGOUSUARIO" Number,
  "NIDPROCESO" Number,
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "BESTADO" Number DEFAULT 1,
  "NGANADOR" Number,
  "NPUNTAJE" Number,
  "NADIC_DISC" Number,
  "NADIC_FFAA" Number,
  "NACTIVIDAD" Number,
  "NENFERMEDAD" Number,
  "SENFERMEDAD" Varchar2(1000 ),
  "NSEGURO" Number,
  "SSEGURO" Varchar2(1000 ),
  "BCERRADO" Number DEFAULT 0,
  "DFECHA_FIRMA" Date,
  "NFIRMA" Number DEFAULT 0
)
/

-- Add keys for table MCCAS2.TR_PROCESOUSUARIO

ALTER TABLE "MCCAS2"."TR_PROCESOUSUARIO" ADD CONSTRAINT "PK_TR_USUARIOPR" PRIMARY KEY ("NIDPROCESOUSU")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO Y USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."NIDCODIGOUSUARIO" IS 'IDENTIFICADOR DEL USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."NIDPROCESO" IS 'IDENTIFICADOR DEL PROCESO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."BACTIVO" IS 'ESTADO DEL REGISTRO (0=INACTIVO, 1=ACTIVO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."BESTADO" IS 'ESTADO DEL PROCESO (1=EN EDICIÓN, 2=ENVIADO)'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."NGANADOR" IS 'INDICA SI EL POSTULANTE ES GANADOR'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO"."NPUNTAJE" IS 'INDICA EL PUNTAJE OBTENIDO DEL POSTULANTE EN EL PROCESO'
/

-- Table MCCAS2.TR_PROCESOUSUARIO_EVAL

CREATE TABLE "MCCAS2"."TR_PROCESOUSUARIO_EVAL"(
  "NIDPROCESOUSU" Number,
  "NIDPERSONAL" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date,
  "NPUNTAJE" Number,
  "NEVAL_CUR" Number,
  "NIDPROCESO" Number,
  "NEVAL_TECNICA" Number,
  "NASISTENCIA" Number,
  "NTIPO_EVAL" Number,
  "NCALIFICACION" Number,
  "NTIPO_EVALUADOR" Number
)
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NIDPROCESOUSU" IS 'IDENTIFICADOR DEL PROCESO_USUARIO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NIDPERSONAL" IS 'IDENTIFICADOR DEL PERSONAL EVALUADOR'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NPUNTAJE" IS 'PUNTAJE'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NEVAL_CUR" IS 'INDICA EL RESULTADO DE LA EVALUACION CURRICULAR, 1:APTO, 2:NO APTO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NIDPROCESO" IS 'IDENTIFICADOR DEL PROCESO CAS'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NEVAL_TECNICA" IS 'INDICA EL RESULTADO DE LA EVALUACION TECNICA'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NASISTENCIA" IS 'INDICA SI EL POSTULANTE SE PRESENTO A LA EVALUACION, 1:SI, 0:NO'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NTIPO_EVAL" IS 'INDICA EL TIPO DE EVALUACION, TG:6'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NCALIFICACION" IS 'INDICA LA CALIFICACION DEL POSTULANTE'
/
COMMENT ON COLUMN "MCCAS2"."TR_PROCESOUSUARIO_EVAL"."NTIPO_EVALUADOR" IS 'INDICA EL TIPO DE EVALUADOR, TG:5'
/

-- Table MCCAS2.TR_RNA

CREATE TABLE "MCCAS2"."TR_RNA"(
  "NIDPROCESOUSU" Number,
  "NIDRNA" Number,
  "SCODIGO_INS" Varchar2(20 ),
  "DFECHA_REG" Date,
  "BACTIVO" Number,
  "NIDUSUCREACION" Number,
  "DFECHACREACION" Date,
  "NIDUSUEDICION" Number,
  "DFECHAEDICION" Date
)
/

-- Add keys for table MCCAS2.TR_RNA

ALTER TABLE "MCCAS2"."TR_RNA" ADD CONSTRAINT "PK_RNA" PRIMARY KEY ("NIDRNA")
/

-- Table and Columns comments section
  
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."NIDPROCESOUSU" IS 'IDENTIFICADOR PROCESO_USU'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."NIDRNA" IS 'IDENTIFICADOR RNA'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."SCODIGO_INS" IS 'CÓDIGO DE INSCRIPCIÓN RNA'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."DFECHA_REG" IS 'FECHA DE REGISTRO RNA'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."BACTIVO" IS 'ESTADO DEL ÍTEM 1=ACTIVO, 0=INACTIVO'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."NIDUSUCREACION" IS 'USUARIO DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."DFECHACREACION" IS 'FECHA DE CREACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."NIDUSUEDICION" IS 'USUARIO DE ULTIMA MODIFICACIÓN'
/
COMMENT ON COLUMN "MCCAS2"."TR_RNA"."DFECHAEDICION" IS 'FECHA DE ULTIMA MODIFICACIÓN'
/

-- Create procedures section -------------------------------------------------

CREATE PROCEDURE "MCCAS2"."USP_GENERA_ACTA"(P_NOPT                  NUMBER,
   P_NIDPROCESO            NUMBER,
   P_NIDCONVOCATORIA       NUMBER,
   P_SDATO                 VARCHAR2,
   C_DATA              OUT SYS_REFCURSOR)
AS
   V_HTML         CLOB;
   V_FILAS        CLOB;
   V_COLUMNAS     CLOB;
   V_FIRMAS       CLOB;
   V_TITULO       CLOB;
   V_TABLA        CLOB;
   V_TABLA_TIT    CLOB;
   V_HTML_1       CLOB;
   V_HTML_2       CLOB;
   V_HTML_3       CLOB;
   V_HTML_4       CLOB;
   V_CONTADOR     NUMBER := 0;
   V_CANTIDAD     NUMBER := 0;
   V_NIDPROCESO   NUMBER := 0;
   V_NELENCO   NUMBER := 0;
   V_NIUSUARIO  NUMBER := 0;
   V_DCONVOCATORIA VARCHAR2(400);
   V_SPROCESO  VARCHAR2(400);
   V_SSERVICIO VARCHAR2(400);
   V_SPOSTULANTE VARCHAR2(400);
   V_FOGA VARCHAR2(400);
   V_FRH  VARCHAR2(400);
   V_FAU  VARCHAR2(400);
   V_FECHA1 VARCHAR2(20);
   V_GANADOR VARCHAR2(1000);
   V_DATOS TR_DATOSPERSONALES%ROWTYPE;
   V_DIRECCION VARCHAR2(400);
   V_formacionAcademica  CLOB;
   V_experienciaGeneral  CLOB;
   V_experienciaEspecifica  CLOB;
   V_cursos  CLOB;
   V_conocimientos  CLOB;
   V_funciones  CLOB;
   V_otros CLOB;
   V_fechaEmpleo CLOB;
   V_fechaConvocatoria CLOB;
   V_fechaSelecicon CLOB;
   V_IDUEJECOD VARCHAR2(4);
    V_FOOTER CLOB;
    V_TIPO VARCHAR2(10) := 'PDF';
    V_DICA VARCHAR2(1000);
    V_FFAA VARCHAR2(1000);
    V_NAME VARCHAR2(1000);
    V_CAB VARCHAR2(1000);
BEGIN

    CASE P_NOPT WHEN 1 THEN
    
        FOR c in (  SELECT pr.nidproceso, PU.NIDPROCESOUSU, sproceso, sservicio,
                       DECODE (DP.NIDCODIGOUSUARIO, NULL, '', UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES))
                          POSTULANTE,
                       DECODE (f_getCalificacion (PU.NIDPROCESOUSU, 2), 1, '<td></td><td></td>', '<td colspan=''2'' style=''text-align:center''>NO APTO</td>')
                          NEVAL_CUR, T.DCONVOCATORIA CONVOCATORIA
                  FROM TR_PROCESO PR
                       INNER JOIN TR_PROCESOUSUARIO PU ON PR.NIDPROCESO = PU.NIDPROCESO
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                       INNER JOIN TM_CONVOCATORIA T ON T.NTIPO = PR.NTIPO AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
                 WHERE     PR.NIDCONVOCATORIA = P_NIDCONVOCATORIA AND PU.BACTIVO = 1 AND PU.BESTADO = 2 --and (pr.nelenco = 0 or f_getCalificacion (PU.NIDPROCESOUSU, 3)>20)
                 AND NRESULTADO <> 4
              ORDER BY sproceso, POSTULANTE)
        LOOP
          V_FILAS :=  V_FILAS || '<tr>';
          IF V_NIDPROCESO <> C.NIDPROCESO THEN
             V_DCONVOCATORIA := C.CONVOCATORIA;
             V_NIDPROCESO := C.NIDPROCESO;
             V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
             V_CONTADOR := 0;
             V_HTML_3 := V_HTML_3 || V_FILAS ;
             V_FILAS :=  '<td rowspan = NROROWSPAN><b>' || C.SPROCESO || '</b></td><td rowspan = NROROWSPAN>' || C.SSERVICIO || '</td>';
          END IF;
          V_CONTADOR := V_CONTADOR + 1;
          V_FILAS := V_FILAS || '<td STYLE=''height:30px;''>'|| C.POSTULANTE || '</td>' || C.NEVAL_CUR || '</tr>';
         -- V_HTML_2 := V_HTML_2 || V_FILAS || V_HTML_3;
        END LOOP;
        V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
        V_HTML_3 := V_HTML_3 || V_FILAS ;
        V_HTML := '<html><HEAD><style type=''text/css''>td { border: 1px solid black;vertical-align:middle;font-size:12px;text-align:center}</style></HEAD><body>';
        V_HTML := V_HTML  || '<TABLE style=''font-family:Arial;''><tr><td colspan = ''5'' style=''border: 0px;height:60px''><img  height=''55'' width= ''300'' src=''http://plataformamincu.cultura.gob.pe/POST_CAST/images/logo_ministerio.jpg''/></td></tr>'
          || '<TR><TD COLSPAN=''5'' style=''text-align:center;font-weight: bold;border: 0px;font-size:13px; ''>PUBLICACIÓN DE RESULTADOS DE LA EVALUACIÓN CURRICULAR DE LA '||V_DCONVOCATORIA||'   <BR/></td></tr><tr><TD COLSPAN=''5'' style=''text-align:center;font-weight: bold;border: 0px;font-size:13px;height:55px''>ENTREVISTA PERSONAL: Se llevará a cabo en en la Sede Central del MINCU: Av Javier Prado Este 2465 San Borja. En el caso de los Procesos de las Direcciones Desconcentradas de Cultura, se realizará en la misma sede. Los Postulantes deberán portar Documento de Identidad.</TD></TR>'
          || '<TR style=''text-align:center;font-weight: bold;''><td style=''width:200px;background-color: rgb(192,192,192)''>PROCESO DE CONTRATACIÓN ADMINISTRATIVA DE SERVICIOS - CAS </td><td style=''width:260px;background-color: rgb(192,192,192)''>   SERVICIO  </td><td style=''width:290px;background-color: rgb(192,192,192)''>  NOMBRE DEL POSTULANTE (S)  </td><td style=''width:100px;background-color: rgb(192,192,192)''>  FECHA DE ENTREVISTA </td><td style=''width:100px;background-color: rgb(192,192,192)''>   HORA DE ENTREVISTA </td></tr>';
       
        V_HTML := V_HTML || V_HTML_3;
        V_HTML := V_HTML
          || '<TR><TD COLSPAN=''5'' style=''text-align:center;font-weight: bold;border: 0px ''>ASPECTOS A CONSIDERAR POR LOS POSTULANTES APTOS </TD></TR>'
          || '<TR><TD COLSPAN=''5'' style=''text-align:center;border: 0px ''>Según lo consignado en las Bases de Postulación, se les recuerda lo siguiente: <br/>El postulante que tenga la condición APTO deberá presentarse a la Entrevista con el ANEXO 03-B "FORMATO DE DECLARACION JURADA DEL POSTULANTE" con la información requerida en el mismo y firmado.</TD></TR>'
          || '<TR><TD COLSPAN=''3'' style=''border: 0px ''></TD><TD COLSPAN=''2'' style=''text-align:center;font-weight: bold;border: 1px ''>COMITÉ DE SELECCIÓN </TD></TR></TABLE></body></html>';
    
    WHEN  2 THEN
    
        FOR C IN ( SELECT pr.nidproceso,PU.NIDPROCESOUSU,sproceso,sservicio, DECODE(DP.NIDCODIGOUSUARIO,NULL,'',UPPER(DP.SAPATERNO ||' '||DP.SAMATERNO||', '|| DP.SNOMBRES)) POSTULANTE,
                         Decode(DP.SNOMBRES,NULL,'___',decode(f_getCalificacion(PU.NIDPROCESOUSU, 2),1,DECODE(nvl(pr.NELENCO,0),1,30,50),0)) NEVAL_CUR,
                         DECODE(f_getCalificacion(PU.NIDPROCESOUSU, 3),0,'___',f_getCalificacion(PU.NIDPROCESOUSU, 3)) NEVAL_TECNICA,
                          Decode(DP.SNOMBRES,NULL,'___',DECODE(f_getCalificacion(PU.NIDPROCESOUSU, 4),0,'NSP',f_getCalificacion(PU.NIDPROCESOUSU, 4))) NENTREVISTA,
                          DECODE(NVL(PU.NADIC_DISC,0),0,'___',PU.NADIC_DISC)  NDISCAPACIDAD,
                          DECODE(NVL(PU.NADIC_FFAA,0),0,'___',PU.NADIC_FFAA)  BFUERZAARMADA,
                          PU.NPUNTAJE NPUNTAJE_TOTAL, T.DCONVOCATORIA CONVOCATORIA,
                          decode(pr.nresultado,3,'DESIERTO',5,'RESTRUCTURACIÓN',decode(NVL(NGANADOR,0),1,'GANADOR',2,'2do Puesto',3,'3er Puesto',99,'Descalificado','___')) NGANADOR
                    FROM TR_PROCESO PR INNER JOIN (TR_PROCESOUSUARIO PU
                        INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO)
                        on PR.NIDPROCESO = PU.NIDPROCESO AND PU.BACTIVO = 1 AND PU.BESTADO = 2 AND f_getCalificacion(PU.NIDPROCESOUSU, 2) = 1
                       INNER JOIN TM_CONVOCATORIA T ON T.NTIPO = PR.NTIPO AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
                    WHERE PR.NIDCONVOCATORIA = P_NIDCONVOCATORIA AND PR.BACTIVO = 1 AND PR.BESTADO = 1
                         order by sproceso,POSTULANTE) 
         LOOP
            V_FILAS := V_FILAS || '<tr>';

            IF V_NIDPROCESO <> C.NIDPROCESO THEN
                V_DCONVOCATORIA := C.CONVOCATORIA;
                V_NIDPROCESO := C.NIDPROCESO;
                V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
                V_HTML_3 := V_HTML_3 || V_FILAS;
                V_CONTADOR := 0;
                V_FILAS := '<td rowspan = NROROWSPAN><b>' || C.SPROCESO || '</b></td><td rowspan = NROROWSPAN>' || C.SSERVICIO || '</td>';
            END IF;
            V_CONTADOR := V_CONTADOR + 1;
            V_FILAS := V_FILAS || '<td STYLE=''height:50px;''>'|| C.POSTULANTE || '</td><td>' || C.NEVAL_CUR || 
                    '</td><td>' ||  C.NENTREVISTA || '</td><td>' || C.NEVAL_TECNICA || '</td><td>' ||  C.NDISCAPACIDAD  || '</td><td>' || 
                    C.BFUERZAARMADA  || '</td><td>' ||  C.NPUNTAJE_TOTAL  || '</td><td><b>' ||  C.NGANADOR  || '</b></td></tr>';

        END LOOP;
            V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
            V_HTML_3 := V_HTML_3 || V_FILAS;
            V_HTML := '<html><HEAD><style type=''text/css''>td { border: 1px solid black;vertical-align:middle;font-size:12px;text-align:center}</style></HEAD><body>';
            V_HTML := V_HTML  || '<TABLE style=''font-family:Arial;''><tr><td colspan = ''5'' style=''border: 0px;height:60px''><img  height=''55'' width= ''300'' src=''http://plataformamincu.cultura.gob.pe/POST_CAST/images/logo_ministerio.jpg''/></td></tr>' 
            || '<tr><td colspan=10 style=''font-size:16px;font-weight: bold''>PUBLICACIÓN DE RESULTADOS FINALES <br/>' || V_DCONVOCATORIA  || '</td></tr>'
            || '<tr ><td style=''width:200px;background-color: rgb(192,192,192)'' >PROCESO DE CONTRATACION ADMINISTRATIVA DE SERVICIOS - CAS</td><td  style=''width:280px;background-color: rgb(192,192,192)''>SERVICIO</td><td  style=''width:300px;background-color: rgb(192,192,192)''>NOMBRE DEL POSTULANTE (S)</td>'
            || '<td  style=''width:90px;background-color: rgb(192,192,192)''>EVALUACIÓN CURRICULAR PUNTAJE TOTAL</td><td  style=''width:90px;background-color: rgb(192,192,192)''>ENTREVISTA PUNTAJE TOTAL</td><td  style=''width:90px;background-color: rgb(192,192,192)''>EVALUACIÓN TÉCNICA</td><td  style=''width:90px;background-color: rgb(192,192,192)''>BONFICACION POR DISCAPACIDAD (15%)</td>'
            || '<td  style=''width:90px;background-color: rgb(192,192,192)''>BONIFICACION POR SER LICENCIADO DE LAS FUERZAS ARMADAS(10%)</td><td  style=''width:90px;background-color: rgb(192,192,192)''>PUNTAJE FINAL</td><td  style=''width:90px;background-color: rgb(192,192,192)''>ESTADO</td></tr>'; 
             
            V_HTML_2 := '<tr><td colspan = 10 >LOS POSTULANTES GANADORES DEBERAN PRESENTARSE A LA OFICINA GENERAL DE RECURSOS HUMANOS DEL MINISTERIO DE CULTURA DENTRO DE LOS 5 DÍAS HÁBILES SIGUIENTES A LA PUBLICACIÓN DE LOS RESULTADOS FINALES, CASO CONTRARIO SE DECLARARÁ SELECCIONADA A LA PERSONA QUE OCUPA EL ORDEN DE MÉRITO INMEDIATAMENTE SIGUIENTE PARA QUE PROCEDA A LA SUSCRIPCIÓN DEL RESPECTIVO CONTRATO DENTRO DEL MISMO PLAZO DE LEY, O SE DECLARARÁ DESIERTO. EL POSTULANTE DEBERÁ PORTAR OBLIGATORIAMENTE LOS SIGUIENTES DOCUMENTOS INDISPENSABLES PARA LA SUSCRIPCIÓN DEL CONTRATO E INICIO DE LABORES:';
            V_HTML_2 := V_HTML_2 || '<ul><li>Una foto tamaño carnet o pasaporte (fondo blanco)</li><li>Curriculum vitae documentado (en original) para ser autenticado o fedateado en el Ministerio de Cultura (deben ser los mismos documentos presentados al momento de la postulación). </li>'
            || '<li>Ficha de Postulación y Anexos visados en cada hoja y firmados al final (originales)   </li><li>Contar con RUC (Registro único de Contribuyentes)    </li>   <ul>   <br/>' 
            || 'Los documentos solicitados deberán ser remitidos a la Av. Javier Prado Este N° 2465 - San Borja. En el caso de los postulantes ganadores en las direcciones desconcentradas de cultura,  deberán coordinar en las respectivas sedes.'
            || '</td></tr><TR><TD COLSPAN=''8'' style=''border: 0px ''></TD><TD COLSPAN=''2'' style=''text-align:center;font-weight: bold;border: 1px ''>COMITÉ DE SELECCIÓN </TD></TR></TABLE></body></html>';
            V_HTML := V_HTML || V_HTML_3 || V_HTML_2;
    WHEN 3 THEN
        SELECT COUNT(1),MAX(sproceso),MAX(sservicio),max(nelenco) INTO V_CANTIDAD,V_SPROCESO,V_SSERVICIO,V_NELENCO
        FROM TR_PROCESO PR
                       INNER JOIN TR_PROCESOUSUARIO PU ON PR.NIDPROCESO = PU.NIDPROCESO
        WHERE PR.NIDPROCESO = P_NIDPROCESO AND PU.BACTIVO = 1 AND PU.BESTADO = 2 AND f_getCalificacion (PU.NIDPROCESOUSU, 2) = 1;
        
        IF V_CANTIDAD > 18 THEN
            V_CANTIDAD := 6;
        ELSIF V_CANTIDAD > 12 THEN
            V_CANTIDAD := CEIL(V_CANTIDAD/3);
        elsif  V_CANTIDAD > 6 THEN
            V_CANTIDAD := CEIL(V_CANTIDAD/2);
        END IF;
        SELECT IDUEJECOD INTO V_IDUEJECOD
        FROM TM_CONVOCATORIA C INNER JOIN TR_PROCESO P ON P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
        WHERE P.NIDPROCESO = P_NIDPROCESO;
        CASE V_IDUEJECOD 
        WHEN '009' THEN V_HTML_4 := '<P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Trujillo, _____ de ___________ del 201__</P>';
        WHEN '005' THEN V_HTML_4 := '<P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Chiclayo, _____ de ___________ del 201__</P>';
        WHEN '007' THEN V_HTML_4 := '<P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Huamachuco, _____ de ___________ del 201__</P>';
        WHEN '002' THEN V_HTML_4 := '<P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Cusco, _____ de ___________ del 201__</P>';
        ELSE V_HTML_4 := '<P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">San Borja, _____ de ___________ del 201__</P>';
        END CASE;
       -- V_HTML_4 := '<P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">San Borja, _____ de ___________ del 201__</P>';
        if v_cantidad <> 6 then
            V_HTML_4 := '<BR/><BR/>' || V_HTML_4;
        end if;
        IF V_NELENCO = 1 THEN
            V_NELENCO := 6;
        ELSE
            V_NELENCO := 10;
        END IF;
        
        V_HTML :='<html><HEAD></HEAD>';
        V_HTML := V_HTML || '<body STYLE="text-align:center;font-family:Arial Narrow;font-size: 14px">';
        V_TITULO := '<p style="font-size:16px;font-weight:bold;text-decoration:underline"> ENTREVISTA PERSONAL<br/>'|| V_SPROCESO ||'<br/> '|| V_SSERVICIO ||'</p>';
        
       
       V_TITULO := V_TITULO || '<TABLE align="center" border="1" style="width:30%"><tr style="background-color: rgb(192,192,192)"><td colspan="3"> NIVELES</td></tr><tr style="background-color: rgb(192,192,192)"><td style="width:30%"> BAJO<BR/>1-3</td ><td style="width:30%"> PROMEDIO<BR/>4-7</td><td style="width:30%"> ALTO<BR/>8-10</td></tr></TABLE>';
       V_FOGA := '<td  style="font-size:14px;text-align:center;width:30%">_______________________<BR/><b>'|| F_GET_DATO('EV',P_NIDPROCESO,2,3) || '</b><BR/>Director(a) General de la Oficina de <br/>Administración o su representante</td>';
        V_FRH := '<td  style=''font-size:14px;text-align:center;width:30%''>_______________________<BR/><b>'|| F_GET_DATO('EV',P_NIDPROCESO,1,3) ||'</b><BR/>Director(a) General de la Oficina General de <br/>Recursos Humanos o su representante</td>';
        V_FAU := '<td  style=''font-size:14px;vertical-align:top;text-align:center;width:30%''>_______________________<b><BR/>'|| F_GET_DATO('EV',P_NIDPROCESO,3,3) ||'</b><BR/>Representante del Área Usuaria</td>';    
        V_FIRMAS := '<br/><br/><br/><br/><br/><br/><TABLE align="center"><tr >'||V_FOGA  || V_FAU  || V_FRH  ||'</tr></TABLE><br/><br/><br/><br/><br/>';
       IF LENGTH(V_SSERVICIO)< 80 THEN
            V_HTML_4 := '<BR/>' || V_HTML_4;
            V_FIRMAS := V_FIRMAS || '<br/><br/>';
        END IF;
       
        V_TABLA := '<TABLE align="center" border="1" style="width:100%"><tr style="background-color: rgb(192,192,192)"><td  style=''width:200px;padding-left:10px''>Criterios de la Entrevista Personal</td><td style=''width:60px''>Puntaje Máximo ('||(V_NELENCO*5)||')</td>V_COLUMNAS</tr>';
        V_TABLA :=  V_TABLA || '<tr><td style="text-align:left">Conocimientos técnicos del puesto</td><td>'|| V_NELENCO||'</td>V_FILAS</tr>'
                    || '<tr><td style="text-align:left">Iniciativa y energía para el trabajo</td><td>'|| V_NELENCO||'</td>V_FILAS</tr>'
                    || '<tr><td style="text-align:left">Capacidad de análisis y síntesis</td><td>'|| V_NELENCO||'</td>V_FILAS</tr>'
                    || '<tr><td style="text-align:left">Actitud personal</td><td>'|| V_NELENCO||'</td>V_FILAS</tr>'
                    || '<tr><td style="text-align:left">Competencias específicas para el puesto</td><td>'|| V_NELENCO||'</td>V_FILAS</tr>'
                    || '<tr style="background-color: rgb(192,192,192)"><td COLSPAN="2">PUNTAJE TOTAL DEL CANDIDATO</td>V_FILAS</tr></TABLE>';
        FOR C IN (SELECT upper ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES) POSTULANTE
                    FROM TR_PROCESOUSUARIO PU 
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                    WHERE PU.NIDPROCESO = P_NIDPROCESO AND PU.BACTIVO = 1 AND PU.BESTADO = 2 AND f_getCalificacion (PU.NIDPROCESOUSU, 2) = 1
                    AND ((V_NELENCO = 6 AND f_getCalificacion (PU.NIDPROCESOUSU, 3)>20)or V_NELENCO=10)
                    order by postulante)
        LOOP
            IF V_CONTADOR = V_CANTIDAD THEN
                V_TABLA_TIT := V_TITULO || REPLACE(REPLACE(V_TABLA,'V_COLUMNAS',V_COLUMNAS),'V_FILAS',V_FILAS);
                V_HTML := V_HTML || V_TABLA_TIT || V_FIRMAS || V_HTML_4;
                V_HTML_1 := V_HTML_1 || V_TABLA_TIT || '<br/><br/><br/><br/><br/><br/><table align="center"><tr>'|| V_FOGA || '</tr></table><br/><br/><br/><br/><br/>' || V_HTML_4 ;
                V_HTML_2 := V_HTML_2 || V_TABLA_TIT || '<br/><br/><br/><br/><br/><br/><table align="center"><tr>'|| V_FRH || '</tr></table><br/><br/><br/><br/><br/>'|| V_HTML_4 ;
                V_HTML_3 := V_HTML_3 || V_TABLA_TIT || '<br/><br/><br/><br/><br/><br/><table align="center"><tr>'|| V_FAU || '</tr></table><br/><br/><br/><br/><br/><br/>' || V_HTML_4;
                V_COLUMNAS := NULL;
                V_FILAS := NULL;
                V_CONTADOR := 0;
            END IF;
            IF LENGTH(C.POSTULANTE) > 35 THEN
                V_COLUMNAS := V_COLUMNAS || '<td style="width:125px;font-size:14px;">'|| C.POSTULANTE ||'</td>';
            ELSE
                V_COLUMNAS := V_COLUMNAS || '<td style="width:75px;font-size:14px;">'|| C.POSTULANTE ||'</td>';
            END IF;
            V_FILAS := V_FILAS || '<td> </td>';            
            V_CONTADOR := V_CONTADOR + 1;
        END LOOP;
        V_TABLA_TIT := V_TITULO || REPLACE(REPLACE(V_TABLA,'V_COLUMNAS',V_COLUMNAS),'V_FILAS',V_FILAS);
        V_HTML := V_HTML || V_TABLA_TIT || V_FIRMAS  || V_HTML_4
                || V_HTML_1 || V_TABLA_TIT || '<br/><br/><br/><br/><br/><br/><table align="center"><tr>'|| V_FOGA || '</tr></table><br/><br/><br/><br/><br/>' || V_HTML_4
                || V_HTML_2 || V_TABLA_TIT || '<br/><br/><br/><br/><br/><br/><table align="center"><tr>'|| V_FRH || '</tr></table><br/><br/><br/><br/><br/>' || V_HTML_4
                || V_HTML_3 || V_TABLA_TIT || '<br/><br/><br/><br/><br/><br/><table align="center"><tr>'|| V_FAU || '</tr> </table><br/><br/><br/><br/><br/><br/>'|| V_HTML_4
                || '</body></html>';
        V_TIPO :='DOC';
    WHEN 4 THEN
       
        --V_TABLA_TIT := '<BR/><BR/><BR/><P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">San Borja, _____ de ___________ del 201__</P>';
        SELECT PR.NIDPROCESO, sproceso, sservicio, UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES), 'EC_'||UPPER ( DP.SAPATERNO || '_' || DP.SAMATERNO)
          INTO V_NIDPROCESO, V_SPROCESO, V_SSERVICIO, V_SPOSTULANTE , V_NAME
        FROM TR_PROCESO PR
                       INNER JOIN TR_PROCESOUSUARIO PU ON PR.NIDPROCESO = PU.NIDPROCESO
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
        WHERE PU.NIDPROCESOUSU = P_NIDPROCESO AND PU.BACTIVO = 1 AND PU.BESTADO = 2 ;
        
        select decode(nvl(max(bdiscapacidad),0),1,'<p style="font-weight:bold;padding-top:2px;margin-bottom:2px;">X</p></td><td><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">&nbsp;</p>','<p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">&nbsp;</p></td><td><p style="font-weight:bold;padding-top:2px;margin-bottom:2px;">X</p>') INTO V_DICA   
        from TR_DATOSADICIONALES where nidprocesousu = P_NIDPROCESO;

        select decode(nvl(max(bfuerzaarmada),0),1,'<p style="font-weight:bold;padding-top:2px;margin-bottom:2px;">X</p></td><td><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">&nbsp;</p>','<p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">&nbsp;</p></td><td><p style="font-weight:bold;padding-top:2px;margin-bottom:2px;">X</p>') INTO V_FFAA
        from TR_DATOSADICIONALES where nidprocesousu = P_NIDPROCESO;
        
        SELECT IDUEJECOD INTO V_IDUEJECOD
        FROM TM_CONVOCATORIA C INNER JOIN TR_PROCESO P ON P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
        WHERE P.NIDPROCESO = V_NIDPROCESO;
        
         CASE V_IDUEJECOD 
        WHEN '009' THEN V_TABLA_TIT := '<BR/><BR/><BR/><P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Trujillo, _____ de ___________ del 201__</P>';
        WHEN '005' THEN V_TABLA_TIT := '<BR/><BR/><BR/><P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Chiclayo, _____ de ___________ del 201__</P>';
        WHEN '007' THEN V_TABLA_TIT := '<BR/><BR/><BR/><P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Huamachuco, _____ de ___________ del 201__</P>';
        WHEN '002' THEN V_TABLA_TIT := '<BR/><BR/><BR/><P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">Cusco, _____ de ___________ del 201__</P>';
        ELSE V_TABLA_TIT := '<BR/><BR/><BR/><P STYLE="TEXT-ALIGN:RIGHT;WIDTH:100%">San Borja, _____ de ___________ del 201__</P>';
        END CASE;
        
        V_HTML :='<html><HEAD></HEAD>';
        V_HTML := V_HTML || '<body STYLE="text-align:center;font-family:Arial Narrow;font-size: 14px;text-align:center">';
        V_TITULO := '<p style=''font-size:16px;font-weight:bold;text-decoration:underline''> FORMATO DE EVALUACIÓN CURRICULAR DE LA CARPETA DEL POSTULANTE<br/><span style=''font-size:14px;font-weight:bold;text-decoration:underline''> '|| V_SPROCESO ||'</span><br/><span  style=''font-size:14px;font-weight:bold;''> '|| V_SSERVICIO ||'</span></p><p  style=''text-align:left;padding-top:10px;font-size:14px;font-weight:bold;''> POSTULANTE: '|| V_SPOSTULANTE ||'</p>';
        V_FOGA := '<td  style="font-size:14px;text-align:center;width:30%">______________________<BR/><b>'|| F_GET_DATO('EV',V_NIDPROCESO,2,1) || '</b><BR/>Miembro del Comité</td>';
        V_FRH := '<td  style=''font-size:14px;text-align:center;width:30%''>______________________<BR/><b>'|| F_GET_DATO('EV',V_NIDPROCESO,1,1) ||'</b><BR/>Miembro del Comité</td>';
        V_FAU := '<td  style=''font-size:14px;vertical-align:top;text-align:center;width:30%''>______________________<b><BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,3,1) ||'</b><BR/>Miembro del Comité</td>';    
        V_FIRMAS := '<br/><br/><br/><TABLE width="100%"><tr >'||V_FOGA  || V_FAU  || V_FRH  ||'</tr></TABLE>';
        FOR C IN (SELECT NIDPROCESO, NIDREGISTRO, SDESCRIPCION , T.SDITEM SECCION, A.NPRIORIDAD, T.NPARAM1 ORDEN, T.NIDITEM
            FROM TR_PROCESO_BASES A
            LEFT JOIN TM_TABLA_GENERAL_D T ON T.NIDTABLA = 8 AND A.NIDTIPO_BASE = T.NIDITEM AND T.NPARAM2 = 1
            WHERE NIDPROCESO = V_NIDPROCESO AND A.BACTIVO = 1 and t.niditem in (1,2,3,13,4)
            ORDER BY T.NPARAM1,A.NPRIORIDAD)
        LOOP
            IF C.NIDITEM IN (2,3) THEN
                V_HTML_1 := V_HTML_1 || '<UL><li style="text-align:left;padding-bottom:5px">'|| c.SDESCRIPCION ||'</li></UL>'; 
            END IF;
            IF C.NIDITEM = 1 THEN
                V_HTML_2 := V_HTML_2 || '<UL><li style="text-align:left;padding-bottom:5px">'|| c.SDESCRIPCION ||'</li></UL>'; 
            END IF;
            IF C.NIDITEM = 13 THEN
                V_HTML_3 := V_HTML_3 || '<UL><li style="text-align:left;padding-bottom:5px">'|| c.SDESCRIPCION ||'</li></UL>'; 
            END IF;
            IF C.NIDITEM = 4 THEN
                V_HTML_4 := V_HTML_4 || '<UL><li style="text-align:left;padding-bottom:5px">'|| c.SDESCRIPCION ||'</li></UL>'; 
            END IF;
        END LOOP;
        V_HTML := V_HTML || V_TITULO || '<TABLE border="1" style="text-align:center;width:100%"><tr ><td style="width:70%;margin-top:2px;font-weight:bold">FACTORES DE EVALUACIÓN</td><td style="width:8%;margin-top:2px;font-weight:bold">CUMPLE</td><td style="width:12%;margin-top:2px;font-weight:bold">NO CUMPLE</td><td style="width:10%;margin-top:2px;font-weight:bold">OBS.</td></tr>'
            || '<tr><td COLSPAN=''4'' style="text-align:left"><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">EXPERIENCIA LABORAL</p></td></tr>'
            || '<tr><td style="text-align:left;font-size:14px;padding-left:30px;">'|| V_HTML_1||'</td><td></td><td></td><td></td></tr>'
            || '<tr><td COLSPAN=''4'' style="text-align:left"><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">FORMACIÓN ACADÉMICA</p></td></tr>'
            || '<tr><td style="text-align:left;font-size:14px;padding-left:30px;">'|| V_HTML_2||'</td><td></td><td></td><td></td></tr>';
       
        IF LENGTH(V_HTML_4) > 0 THEN
            V_HTML := V_HTML || '<tr><td COLSPAN="4" style="text-align:left"><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;text-align:left">MAESTRÍAS, DIPLOMADOS, CURSOS Y/O PROGRAMA DE ESPECIALIZACIÓN</p></td></tr><tr><td style="text-align:left;font-size:14px;padding-left:30px;">'|| V_HTML_4||'</td><td></td><td></td><td></td></tr>';
        END IF;
        IF LENGTH(V_HTML_3) > 0 THEN
            V_HTML := V_HTML || '<tr><td COLSPAN="4" style="text-align:left"><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">CAPACITACIÓN Y/O CONOCIMIENTOS</p></td></tr><tr><td style="text-align:left;font-size:14px;padding-left:30px;">'|| V_HTML_3||'</td><td></td><td></td><td></td></tr>';
        END IF;
        V_HTML := V_HTML    || '</TABLE><br/><span>RESULTADO: APLICA__________ </span><span style="padding-left:100px">NO APLICA__________</span>'
                || '<TABLE align="center" style="font-weight:bold;font-size:11px;width:30%" border="1"><tr ><td style="width:70%"><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">POSTULANTE</p></td><td style="width:15%"><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">SÍ</p></td><td style="width:15%"><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">NO</p></td></tr>'
                || '<tr ><td ><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">CON DISCAPACIDAD</p></td><td>'|| V_DICA||'</td></TR>'
                ||'<tr ><td><p style="font-weight:bold;margin-top:2px;margin-bottom:2px;">LICENCIADO F.F.A.A.</p></td><td>'|| V_FFAA||'</td></TR>'
                ||'</TABLE>'|| V_FIRMAS ||V_TABLA_TIT||'</body></html>';
       V_TIPO :='DOC';
    WHEN 5 THEN
        SELECT PR.NIDPROCESO, sproceso, sservicio,T.dconvocatoria, TO_CHAR(cr.DFECHAFIN,'DD/MM/YYYY'), T.IDUEJECOD INTO V_NIDPROCESO, V_SPROCESO, V_SSERVICIO , V_DCONVOCATORIA, V_FECHA1,V_IDUEJECOD
        FROM TR_PROCESO PR
                       INNER JOIN TM_convocatoria T ON T.ntipo = pr.ntipo AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
                       LEFT JOIN TR_PROCESO_CRONOGRAMA CR ON PR.NIDPROCESO = CR.NIDPROCESO AND NIDTIPO_FECHA = 9 AND CR.BACTIVO = 1
        WHERE PR.NIDPROCESO = P_NIDPROCESO;
         FOR c in (  SELECT UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES) POSTULANTE,
                       f_getCalificacion (PU.NIDPROCESOUSU, 2) NEVAL_CUR
                  FROM  TR_PROCESOUSUARIO PU 
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                 WHERE     PU.NIDPROCESO = P_NIDPROCESO AND PU.BACTIVO = 1 AND PU.BESTADO = 2
              ORDER BY POSTULANTE)
        LOOP
            V_HTML_1 := V_HTML_1 || '<li><b>' || C.POSTULANTE || '</b></li>';
            IF C.NEVAL_CUR = 1 THEN
                V_HTML_2 := V_HTML_2 || '<li><b>' || C.POSTULANTE || '</b></li>';
            ELSE
                V_HTML_3 := V_HTML_3 || '<li><b>' || C.POSTULANTE || '</b></li>';
            END IF;
            V_CONTADOR := V_CONTADOR + 1;
        END LOOP;
        IF V_CONTADOR > 16 THEN
            V_HTML_4 := '<BR/>';
        END IF;
      V_FOGA := '<td  style=''border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,2,1) || '<BR/>Director(a) General de la Oficina de<BR/>Administración o su representante</td>';
        V_FRH := '<td  style=''padding-left:50px;border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,1,1) ||'<BR/>Director(a) General de la Oficina General<BR/>de Recursos Humanos o su representante</td>';
        V_FAU := '<td  style=''padding-left:50px;border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,3,1) ||'<BR/>Representante del Área Usuaria</td>';    
        V_FIRMAS := '<TABLE style="margin-top:80px;"><tr >'||V_FOGA  || V_FAU  || V_FRH  ||'</tr></TABLE>';
        V_HTML :='<html><HEAD><style type=''text/css''>.table{border-collapse:collapse;border: 1px solid black;} td { padding-left:5px;height:30px;vertical-align:middle;font-size:18px;text-align:center}</style></HEAD>';
        V_HTML := V_HTML || '<body STYLE="font-family:Arial Narrow;font-size:18px;WIDTH:100%">';
        V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;PADDING-BOTTOM:10PX">"Año del Diálogo y la Reconciliación Nacional"</DIV>';
        V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;font-weight:bold">ACTA DE EVALUACIÓN CURRICULAR DEL PROCESO DE SELECCIÓN CAS'|| V_HTML_4||' <BR/>'||V_SPROCESO ||'<BR/>'||V_DCONVOCATORIA ||'<BR/>'|| V_HTML_4||'CONVOCATORIA PARA LA CONTRATACIÓN ADMINISTRATIVA DE '||V_SSERVICIO ||'</DIV>';
        IF V_HTML_1 IS NOT  NULL THEN 
            V_HTML := V_HTML || '<P STYLE="TEXT-ALIGN:JUSTIFY">Siendo las 09:00 horas del día '|| V_FECHA1 ||', en aplicación del Artículo 3º del Decreto Legislativo Nº 1057, modificado mediante Ley 29849 que regula el Régimen Especial de Contratación Administrativa de Servicios, se reunieron en la Oficina General de General de Recursos Humanos, los miembros integrantes del Comité encargado de llevar a cabo el Proceso de Selección Nº '|| SUBSTR(V_SPROCESO,INSTR(V_SPROCESO,'°')+1) ||' con la finalidad de evaluar los currículos presentados para la contratación de una persona natural mediante Contrato Administrativo de Servicios.</P>';
            V_HTML := V_HTML || '<OL TYPE="A"><li><b>CURRICULOS PRESENTADOS</b><br/>'|| V_HTML_4||' Se presentaron los currículos  de los siguientes  postulantes:</li><BR/>'|| V_HTML_4||'<UL>'||V_HTML_1|| '</UL><BR/>';
            V_HTML := V_HTML || '<li><b>EVALUACIÓN CURRICULAR</b>'|| V_HTML_4||'<br/>De acuerdo a la revisión de los currículos presentados por los postulantes anteriormente mencionados, para la contratación de una persona natural mediante Contrato Administrativo de servicios, se ha obtenido los siguientes resultados:<br/>';
            IF V_HTML_3 IS NOT NULL THEN
                V_HTML := V_HTML || V_HTML_4|| 'Los currículos presentado por los postulantes:<BR/>'|| V_HTML_4||'<UL>'||V_HTML_3|| '</UL>';
                V_HTML := V_HTML || 'No cumplen con lo solicitado con el perfil del puesto, por lo cual el Comité lo da no admitido.<br/>';
            END IF;
            IF V_HTML_2 IS NOT NULL THEN   
                V_HTML := V_HTML || V_HTML_4||'Los currículos presentado por los postulantes:<BR/>'|| V_HTML_4;
                V_HTML := V_HTML || '<UL>'||V_HTML_2|| '</UL>Cumplen con lo solicitado en el perfil de puesto, por lo cual el Comité los admite, encontrándose aptos para la entrevista personal.<br/></li></ol>';
            ELSE
                V_HTML := V_HTML || '</li></ol>En consecuencia al no haber postulantes <B>APTOS</B>, se declara <B>DESIERTO</B> el presente Proceso de Selección. <br/>';
            END IF;
            V_HTML := V_HTML || 'Siendo las 16:00 horas del mismo día se dió por concluida la sesión, suscribiendo la presente en señal de conformidad.';
        ELSE
            V_HTML := V_HTML || '<P STYLE="TEXT-ALIGN:JUSTIFY">En Lima, siendo las 14:00 horas del '|| V_FECHA1 ||',se reunió el Comité encargado de llevar a cabo los Procesos de Contratación en las instalaciones del Ministerio de Cultura, se deja constancia que al no presentarse propuestas para el <B>Proceso CAS Nº '|| SUBSTR(V_SPROCESO,INSTR(V_SPROCESO,'°')+1) ||'</B>, se ha determinado declarar <B>DESIERTO</B> el citado proceso de selección.</B>';
            V_HTML := V_HTML || '<P>En señal de conformidad de la presente Acta, los miembros del Comité proceden a suscribirla en señal de conformidad,</P><BR/><BR/><BR/><BR/><BR/><BR/>';
        END IF;
        V_HTML := V_HTML || V_FIRMAS || '</body></html>';
    WHEN 6 THEN
    
        SELECT distinct PR.NIDPROCESO, sproceso, sservicio,T.DCONVOCATORIA, CR.DFECHAINI, T.IDUEJECOD INTO V_NIDPROCESO, V_SPROCESO, V_SSERVICIO , V_DCONVOCATORIA, V_FECHA1, V_IDUEJECOD
        FROM TR_PROCESO PR
                       INNER JOIN TM_CONVOCATORIA T ON T.NTIPO = PR.NTIPO AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
                       LEFT JOIN TR_PROCESO_CRONOGRAMA CR ON PR.NIDPROCESO = CR.NIDPROCESO AND NIDTIPO_FECHA = 11 and cr.bactivo = 1
        WHERE PR.NIDPROCESO = P_NIDPROCESO;
         FOR c in (  SELECT UPPER(DP.SAPATERNO ||' '||DP.SAMATERNO||', '|| DP.SNOMBRES) || DECODE(NFIRMA,2,' (NSP)','')POSTULANTE,
                         decode(f_getCalificacion(PU.NIDPROCESOUSU, 2),1,DECODE(nvl(pr.NELENCO,0),1,30,50)) NEVAL_CUR,
                         DECODE(f_getCalificacion(PU.NIDPROCESOUSU, 3),0,'--',f_getCalificacion(PU.NIDPROCESOUSU, 3)) NEVAL_TECNICA,
                          DECODE(f_getCalificacion(PU.NIDPROCESOUSU, 4),0,decode(pr.nelenco,0,'NSP','--'),f_getCalificacion(PU.NIDPROCESOUSU, 4)) NENTREVISTA,
                          DECODE(NVL(PU.NADIC_DISC,0),0,'--',PU.NADIC_DISC)  NDISCAPACIDAD,
                          DECODE(NVL(PU.NADIC_FFAA,0),0,'--',PU.NADIC_FFAA)  BFUERZAARMADA,
                          PU.NPUNTAJE ,DECODE(PU.NGANADOR,0,'&nbsp;',PU.NGANADOR) MERITO, decode(DP.SSEXO,'M', 'al Sr. ','a la Sta.') dsexo, nfirma
                    FROM TR_PROCESO PR INNER JOIN TR_PROCESOUSUARIO PU on PR.NIDPROCESO = PU.NIDPROCESO 
                        INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                        AND PU.BACTIVO = 1 AND PU.BESTADO = 2 AND f_getCalificacion(PU.NIDPROCESOUSU, 2) = 1
                    WHERE PR.NIDPROCESO = P_NIDPROCESO
                         order by PU.NPUNTAJE DESC,POSTULANTE)
        LOOP
            IF C.MERITO = '1' and c.NFIRMA <> 2 THEN
                V_GANADOR := V_GANADOR ||' y ' || c.dsexo||'<b>' ||C.POSTULANTE || '</b>';
            END IF;
            
            V_HTML_1 := V_HTML_1 || '<TR><TD>' || C.MERITO || '</TD><TD style="text-align:left">' || C.POSTULANTE || '</TD><TD>' || C.NEVAL_CUR || '</TD><TD>' || C.NDISCAPACIDAD || '</TD><TD>' || C.BFUERZAARMADA || '</TD><TD>' ||  C.NENTREVISTA  || '</TD><TD>' ||C.NEVAL_TECNICA|| '</TD><TD>' || C.NPUNTAJE || '</TD></TR>';

        END LOOP;

      V_FOGA := '<td  style=''padding-top:75px;border:0px;font-size:18px;''>_____________________________<BR/>'|| F_GET_DATO('EV',P_NIDPROCESO,2,3) || '<BR/>Director(a) General de la Oficina de<BR/>Administración o su representante</td>';
        V_FRH := '<td  style=''padding-top:75px;padding-left:70px;border:0px;font-size:18px;''>_____________________________<BR/>'|| F_GET_DATO('EV',P_NIDPROCESO,1,3) ||'<BR/>Director(a) General de la Oficina General<BR/>de Recursos Humanos o su representante</td>';
        V_FAU := '<td  style=''padding-top:75px;padding-left:70px;border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',P_NIDPROCESO,3,3)||'<BR/>Representante del Área Usuaria</td>';    
        V_FIRMAS := '<TABLE style="padding-bottom:0px"><tr >'||V_FOGA  || V_FAU  || V_FRH  ||'</tr></TABLE>';
        V_HTML :='<html><HEAD><style type=''text/css''>.table{border-collapse:collapse;border: 1px solid black;} td { border: 1px solid black;padding-left:5px;height:30px;padding-right:5px;vertical-align:middle;font-size:16px;text-align:center}</style></HEAD>';
        V_HTML := V_HTML || '<body STYLE="font-family:Arial Narrow;font-size:20px;WIDTH:100%">';
        V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;PADDING-BOTTOM:10PX">"Año del Diálogo y la Reconciliación Nacional"</DIV>';
        V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;font-weight:bold">ACTA DE EVALUACIÓN FINAL - CAS <BR/>'||V_SPROCESO ||'<BR/>'||V_DCONVOCATORIA ||'<BR/>CONVOCATORIA PARA LA CONTRATACIÓN ADMINISTRATIVA DE '||V_SSERVICIO ||'</DIV>';
        V_HTML := V_HTML || '<P STYLE="TEXT-ALIGN:JUSTIFY">De acuerdo a lo revisado en los formatos de Verificación de Evaluación Curricular, y Entrevista Personal se obtiene el siguiente resultado: </P><b>PUNTAJE TOTAL:</b>';
        
        
        V_HTML := V_HTML  || '<TABLE STYLE="width: 100%; border-collapse:collapse;border: 1px solid black;">' 
            || '<tr ><td style=''font-size:18px;width:50px;background-color: rgb(153,204,255)'' >Orden de Mérito</td><td  style=''font-size:18px;width:280px;background-color: rgb(153,204,255)''>Postulante</td><td  style=''font-size:18px;width:80px;background-color: rgb(153,204,255)''>Puntaje de Evaluación Curricular</td>'
            || '<td  style=''font-size:18px;width:90px;background-color: rgb(153,204,255)''>Bonificación Por discapacidad (15%)</td><td  style=''font-size:18px;width:110px;background-color: rgb(153,204,255)''>Bonificación por ser Licenciado de las Fuerzas armadas (10%)</td><td  style=''font-size:18px;width:80px;background-color: rgb(153,204,255)''>Puntaje de Entrevista Personal</td><td  style=''font-size:18px;width:70px;background-color: rgb(153,204,255)''>Evaluación Técnica</td>'
            || '<td  style=''font-size:18px;width:50px;background-color: rgb(153,204,255)''>Puntaje Total</td></tr>'|| V_HTML_1||'</table>' ;
        
        V_HTML := V_HTML || '<P style="text-align:justify">El Comité encargado de llevar a cabo el Proceso de Selección Nº '|| SUBSTR(V_SPROCESO,INSTR(V_SPROCESO,'°')+1) ||', en aplicación del Artículo 3º del Decreto Legislativo Nº 1057, ';
        IF V_GANADOR IS NULL THEN
            V_HTML := V_HTML || 'al no haber postulantes que obtuviesen el puntaje mínimo de ochenta (80) para declararse como GANADOR/A procede a declarar <b>DESIERTO</b>';
        ELSE
            V_HTML := V_HTML || 'que regula el régimen especial de Contratación Administrativa de Servicios, procede a declarar <B>GANADOR</B> '|| substr(V_GANADOR,4) ||' para ';
        END IF;
        V_HTML := V_HTML || ' el <B>'|| V_SSERVICIO ||'</B>.</P>';

        V_HTML := V_HTML || '<P>Siendo las 16:00 horas del día '|| V_FECHA1 || ', se dio por concluida la sesión, suscribiendo la presente en señal de conformidad.</P>';
        V_HTML := V_HTML || V_FIRMAS ||'</body></html>';
    WHEN 7 THEN
        SELECT PR.NIDPROCESO, sproceso, sservicio,T.DCONVOCATORIA, to_char(CR.DFECHAINI,'dd/mm/yyyy'), T.IDUEJECOD INTO V_NIDPROCESO, V_SPROCESO, V_SSERVICIO , V_DCONVOCATORIA, V_FECHA1, V_IDUEJECOD
        FROM TR_PROCESO PR
                       INNER JOIN TM_CONVOCATORIA T ON T.NTIPO = PR.NTIPO AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
                       LEFT JOIN TR_PROCESO_CRONOGRAMA CR ON PR.NIDPROCESO = CR.NIDPROCESO AND NIDTIPO_FECHA = 16 AND CR.BACTIVO = 1
        WHERE PR.NIDPROCESO = P_NIDPROCESO AND NVL(PR.NELENCO,0) = 1;
        
         FOR c in (  SELECT UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES) POSTULANTE,
                       f_getCalificacion (PU.NIDPROCESOUSU, 3) NEVAL_TEC
                  FROM  TR_PROCESOUSUARIO PU 
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                 WHERE     PU.NIDPROCESO = P_NIDPROCESO AND PU.BACTIVO = 1 AND PU.BESTADO = 2 AND f_getCalificacion(PU.NIDPROCESOUSU, 2) = 1
              ORDER BY POSTULANTE)
        LOOP
            V_HTML_1 := V_HTML_1 || '<li><b>' || C.POSTULANTE || '</b></li>';
            IF NVL(C.NEVAL_TEC,0) < 30 THEN
                V_HTML_2 := V_HTML_2 || '<li><b>' || C.POSTULANTE || '</b></li>';
            ELSE
                V_HTML_3 := V_HTML_3 || '<li><b>' || C.POSTULANTE || '</b></li>';
            END IF;
        END LOOP;
      V_FOGA := '<td  style=''padding-top:100px;border:0px;font-size:18px;''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,2,2) || '<BR/>Director(a) General de la Oficina de<BR/>Administración o su representante</td>';
        V_FRH := '<td  style=''padding-top:100px;padding-left:50px;border:0px;font-size:18px;''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,1,2) ||'<BR/>Director(a) General de la Oficina General<BR/>de Recursos Humanos o su representante</td>';
        V_FAU := '<td  style=''padding-top:100px;padding-left:50px;border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,3,2) ||'<BR/>Representante del Área Usuaria</td>';    
        V_FIRMAS := '<TABLE ><tr >'||V_FOGA || V_FAU|| V_FRH  || '</tr></TABLE>';
        V_HTML :='<html><HEAD><style type=''text/css''>.table{border-collapse:collapse;border: 1px solid black;} td { border: 1px solid black;padding-left:5px;height:30px;padding-right:5px;vertical-align:middle;font-size:18px;text-align:center}</style></HEAD>';
        V_HTML := V_HTML || '<body STYLE="font-family:Arial Narrow;font-size:22px;WIDTH:100%">';
        V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;PADDING-BOTTOM:10PX">"Año del Diálogo y la Reconciliación Nacional"</DIV>';
        V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;font-weight:bold">ACTA DE EVALUACIÓN TÉCNICA DEL PROCESO DE SELECCIÓN CAS<BR/>'||V_SPROCESO ||'<BR/>'||V_DCONVOCATORIA ||'<BR/>CONVOCATORIA PARA LA CONTRATACIÓN ADMINISTRATIVA DE '||V_SSERVICIO ||'</DIV>';
        V_HTML := V_HTML || '<P STYLE="TEXT-ALIGN:JUSTIFY">Siendo las 09:00 horas del día '|| V_FECHA1 ||', en aplicación del Artículo 3º del Decreto Legislativo Nº 1057, modificado mediante Ley 29849 que regula el Régimen Especial de Contratación Administrativa de Servicios, se reunieron en la Oficina General de General de Recursos Humanos, los miembros integrantes del Comité encargado de llevar a cabo el Proceso de Selección Nº '|| SUBSTR(V_SPROCESO,INSTR(V_SPROCESO,'°')+1) ||' con la finalidad de evaluar los currículos presentados para la contratación de una persona natural mediante Contrato Administrativo de Servicios.</P>';
        V_HTML := V_HTML || '<OL TYPE="A"><li><b>POSTULANTES APTOS PARA LA EVALUACIÓN TÉCNICA</b><br/> Se presentaron a la evaluación técnica los siguientes postulantes:</li><UL>'||V_HTML_1|| '</UL>';
        V_HTML := V_HTML || '<li><b>EVALUACIÓN TÉCNICA</b><br/>De acuerdo a la evaluación técnica presentada por los postulantes anteriormente mencionados, se ha obtenido el siguiente resultado:<br/>';
        IF V_HTML_3 IS NOT NULL THEN
            V_HTML := V_HTML || 'La evaluación técnica  presentada por los postulantes:<UL>'||V_HTML_3|| '</UL>';
            V_HTML := V_HTML || 'Cumplen con lo establecido en la calificación técnica respectiva, por lo cual el Comité los  admite, encontrándolos aptos para la Entrevista Personal.<br/>';
        END IF;
        V_HTML := V_HTML || '<P>Siendo las 16:00 horas del mismo día se dio por concluida la sesión, suscribiendo la presente en señal de conformidad.</P>';
        V_HTML := V_HTML || V_FIRMAS ||'</body></html>';
    WHEN 8 THEN
        SELECT PR.NIDPROCESO, sproceso, sservicio, UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES) INTO V_NIDPROCESO, V_SPROCESO, V_SSERVICIO, V_SPOSTULANTE
        FROM TR_PROCESO PR
                       INNER JOIN TR_PROCESOUSUARIO PU ON PR.NIDPROCESO = PU.NIDPROCESO
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
        WHERE PU.NIDPROCESOUSU = P_NIDPROCESO AND PU.BACTIVO = 1;
        
        SELECT IDUEJECOD INTO V_IDUEJECOD
        FROM TM_CONVOCATORIA C INNER JOIN TR_PROCESO P ON P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
        WHERE P.NIDPROCESO = V_NIDPROCESO;
        
        V_HTML :='<html><HEAD><style type=''text/css''>.table{border-collapse:collapse;border: 1px solid black;} td { border: 1px solid black;padding-left:10px;height:80px;padding-right:10px;vertical-align:middle;font-size:18px;text-align:center} .left{text-align:left}.bold{font-weight:bold}.color{background-color: rgb(192,192,192)}</style></HEAD>';
        V_HTML := V_HTML || '<body STYLE=''font-family:Arial Narrow;font-size: 22px;WIDTH:100%''><center>';
         V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;PADDING-BOTTOM:10PX">"Año del Diálogo y la Reconciliación Nacional"</DIV>';
        V_HTML := V_HTML || '<DIV STYLE="TEXT-ALIGN:CENTER;font-weight:bold;PADDING-BOTTOM:10PX">EVALUACIÓN TÉCNICA<BR/>'||V_SPROCESO ||'<BR/>'||V_SSERVICIO ||'<BR/></DIV>';
        V_FOGA := '<td style=''padding-top:100px;padding-left:50px;border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,2,2) || '<BR/>Director(a) General de la Oficina de<BR/>Administración o su representante</td>';
        V_FRH := '<td style=''padding-top:100px;padding-left:50px;border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,1,2) ||'<BR/>Director(a) General de la Oficina General de <BR/>Recursos Humanos o su representante</td>';
        V_FAU := '<td style=''padding-top:100px;padding-left:50px;border:0px;font-size:18px;vertical-align:top''>_____________________________<BR/>'|| F_GET_DATO('EV',V_NIDPROCESO,3,2) ||'<BR/>Representante del Área Usuaria</td>';    
        V_FIRMAS := '<TABLE ><tr >' || V_FAU  ||  '</tr></TABLE><BR/>';
        IF LENGTH(V_SSERVICIO)< 105 THEN
            V_FIRMAS:= V_FIRMAS || '<BR/><BR/>';
        END IF; 
        V_HTML := V_HTML || '<TABLE class=''table''><tr class=''bold color''><td  style=''width:300px;padding-left:20px''>CRITERIOS PARA LA EVALUACIÓN TÉCNICA</td><td style=''width:200px''>PUNTAJE MÁXIMO <BR/>(40) </td style=''width:300px''><TD>'||V_SPOSTULANTE ||'</TD></tr>';
        V_HTML :=  V_HTML || '<tr><td class=''left''></td><td></td><td> </td></tr>'
                    || '<tr><td class=''left''></td><td></td><td> </td></tr>'
                    || '<tr><td class=''left''></td><td></td><td> </td></tr>'
                    || '<tr><td class=''left''></td><td></td><td> </td></tr>'
                    || '<tr class=''bold color''><td class=''left''>PUNTAJE TOTAL </td><td> 40</td><td> </td></tr></TABLE>'
                    ||'</tr></table><p style="text-align:left;font-size:18px">Puntaje mínimo: 30 puntos</p>'||V_FIRMAS
                || '</center></body></html>';
    
    
    WHEN 20 THEN
    V_CONTADOR := 0;
    V_HTML_1 :=' ';
    V_HTML_2 :=' ';
    V_HTML_3 :=' ';
    V_HTML_4 :=' ';
    V_HTML := '<html><HEAD><style type=''text/css''>td { border: 1px solid black;vertical-align:middle;font-size:12px;text-align:center}</style></HEAD><body>';
            V_HTML := V_HTML  || '<TABLE style=''font-family:Arial;''>' 
            || '<tr><td colspan=10 style=''font-size:16px;font-weight: bold''>LISTADO DEL PROCESO DE VOLUNTARIADO</td></tr>'
            || '<tr ><td  style=''width:200px;background-color: rgb(192,192,192)''>SPROCESO</td>    <td  style=''width:150px;background-color: rgb(192,192,192)''>POSTULANTE</td>    <td  style=''width:200px;background-color: rgb(192,192,192)''>SSERVICIO</td>    <td  style=''width:100px;background-color: rgb(192,192,192)''>F_NACIMIENTO</td>    <td  style=''width:50px;background-color: rgb(192,192,192)''>EDAD</td>    <td  style=''width:50px;background-color: rgb(192,192,192)''>SEXO</td>    <td  style=''width:100px;background-color: rgb(192,192,192)''>DOCUMENTO</td>    <td  style=''width:100px;background-color: rgb(192,192,192)''>RUC</td>    <td  style=''width:150px;background-color: rgb(192,192,192)''>LUGAR_NAC</td>    <td  style=''width:150px;background-color: rgb(192,192,192)''>LUGAR_DIR</td>    <td  style=''width:150px;background-color: rgb(192,192,192)''>DIRECCION</td><td  style=''width:100px;background-color: rgb(192,192,192)''>TELÉFONO</td>    <td  style=''width:150px;background-color: rgb(192,192,192)''>CORREO</td>    <td  style=''width:100px;background-color: rgb(192,192,192)''>SIGLAS OFI</td><td  style=''width:250px;background-color: rgb(192,192,192)''>INSTITUCION</td><td  style=''width:250px;background-color: rgb(192,192,192)''>CARRERA</td><td  style=''width:250px;background-color: rgb(192,192,192)''>CICLO</td><td  style=''width:90px;background-color: rgb(192,192,192)''>GRADOS</td>    <td  style=''width:90px;background-color: rgb(192,192,192)''>SEGURO</td>    <td  style=''width:250px;background-color: rgb(192,192,192)''>DISPONIBILIDAD</td>    <td  style=''width:250px;background-color: rgb(192,192,192)''>IDIOMAS</td>    <td  style=''width:250px;background-color: rgb(192,192,192)''>HERRAMIENTAS_INF</td>    <td  style=''width:250px;background-color: rgb(192,192,192)''>INF_ADICIONAL</td>    <td  style=''width:250px;background-color: rgb(192,192,192)''>HOBBIE</td>    <td  style=''width:110px;background-color: rgb(192,192,192)''>FECHA_INSC</td>    <td  style=''width:110px;background-color: rgb(192,192,192)''>FECHA_ENVIO</td>    <td  style=''width:80px;background-color: rgb(192,192,192)''>ESTADO</td></tr>';
        FOR C IN ( SELECT PU.NIDPROCESOUSU,F_GET_DATO('TGC', 15, P.NIDCONVOCATORIA,NULL) CONVOCATORIA,P.SSERVICIO sproceso, UPPER(DP.SAPATERNO ||' '|| DP.SAMATERNO ||', '|| DP.SNOMBRES) POSTULANTE,
             F_GET_DATO('OFI', NULL, NULL,AC.IDOFICODIGO) || ' - '|| AC.SNOMBRE  SSERVICIO
             , TO_CHAR(DP.DFECHANAC,'DD/MM/YYYY') F_NACIMIENTO, TRUNC((TRUNC(SYSDATE) - DFECHANAC)/365) EDAD, SSEXO DSEXO,DP.SDNI,
             DP.SRUC,NAC.COMPLETO LUGAR_NAC,DIR.COMPLETO LUGAR_DIR, UPPER(DP.SDIRECCION || ' ' || SNROLOTE) DIRECCION, NVL(DP.SCELULAR,DP.STELEFONOFIJO)SCELULAR ,DP.SCORREO,
             F_CONCATENA_DATOS('OFI',P.IDOFICODIGO, NULL) SIGLAS, F_GET_DATO('OFI', NULL, NULL,P.IDOFICODIGO) OFICINA,
             F_GET_DATO('ACV',PU.NIDPROCESOUSU,0,'INS') INSTITUCION,F_GET_DATO('ACV',PU.NIDPROCESOUSU,0,'CAR') CARRERA, F_GET_DATO('ACV',PU.NIDPROCESOUSU,0,'CIL') ciclo, F_GET_DATO('ACV',PU.NIDPROCESOUSU,0,'GRA') GRADOS,
             DECODE(PU.NSEGURO,1,'SÍ','NO') ||DECODE(PU.NSEGURO,1,' - '||PU.SSEGURO) SEGURO,
             F_GET_DATO('VOL',PU.NIDPROCESOUSU,1,'DI') DISPONIBILIDAD,F_GET_DATO('VOL',PU.NIDPROCESOUSU,2,'II') IDIOMAS,F_GET_DATO('VOL',PU.NIDPROCESOUSU,3,'II') HERRAMIENTAS_INF,
             F_GET_DATO('VOL',PU.NIDPROCESOUSU,4,'IA') INF_ADICIONAL, F_GET_DATO('VOL',PU.NIDPROCESOUSU,5,'IA') HOBBIE, 
             TO_CHAR(PU.DFECHACREACION,'DD/MM/YYYY HH24:MI') FECHA_INSC ,TO_CHAR(PU.DFECHAEDICION,'DD/MM/YYYY HH24:MI')  FECHA_ENVIO, DECODE(PU.BESTADO,2,'ENVIADO','INSCRITO') ESTADO
         FROM TR_PROCESO P
         INNER JOIN TR_ACTIVIDAD AC ON AC.NIDPROCESO = P.NIDPROCESO
         INNER JOIN TR_PROCESOUSUARIO PU ON PU.NIDPROCESO = P.NIDPROCESO AND AC.NIDACTIVIDAD = PU.NACTIVIDAD
         LEFT JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
         LEFT JOIN VW_DISTRITOS NAC ON NAC.NDISTRITO = DP.SUBIGEONAC
         LEFT JOIN VW_DISTRITOS DIR ON DIR.NDISTRITO = DP.SUBIGEODIR
       where  P.NTIPO = 2 AND PU.BACTIVO = 1 AND DECODE(P_SDATO,1,2,PU.BESTADO) = PU.BESTADO
        AND P.NIDPROCESO = DECODE(P_NIDPROCESO,0,P.NIDPROCESO,P_NIDPROCESO)
                    AND P.NIDCONVOCATORIA = DECODE(P_NIDCONVOCATORIA,0,P.NIDCONVOCATORIA,P_NIDCONVOCATORIA)
            order by 1, sproceso,SSERVICIO,POSTULANTE)
         LOOP
         V_FILAS := '<tr><td>'|| C.SPROCESO|| '</td><td>'|| C.POSTULANTE|| '</td><td>'|| C.SSERVICIO|| '</td><td>'|| C.F_NACIMIENTO|| '</td><td>'|| C.EDAD|| '</td><td>'|| C.DSEXO|| '</td><td>'|| C.SDNI|| '</td><td>'|| C.SRUC|| '</td><td>'|| C.LUGAR_NAC|| '</td><td>'|| C.LUGAR_DIR|| '</td><td>'|| C.DIRECCION|| '</td><td>'|| C.SCELULAR|| '</td><td>'|| C.SCORREO|| '</td><td>'|| C.SIGLAS|| '</td><td>'|| C.INSTITUCION|| '</td><td>'|| C.CARRERA|| '</td><td>'|| C.CICLO|| '</td><td>'|| C.GRADOS|| '</td><td>'|| C.SEGURO|| '</td><td>'|| C.DISPONIBILIDAD|| '</td><td>'|| C.IDIOMAS|| '</td><td>'|| C.HERRAMIENTAS_INF|| '</td><td>'|| C.INF_ADICIONAL|| '</td><td>'|| C.HOBBIE|| '</td><td>'|| C.FECHA_INSC|| '</td><td>'|| C.FECHA_ENVIO|| '</td><td>'|| C.ESTADO|| '</td></tr>';
         V_CONTADOR := V_CONTADOR + LENGTH(V_FILAS);
         IF V_CONTADOR < 200000 THEN
            V_HTML := V_HTML || V_FILAS;
         ELSIF V_CONTADOR < 500000 THEN
               V_HTML_1 := V_HTML_1 || V_FILAS;
         ELSIF V_CONTADOR < 1000000 THEN
               V_HTML_2 := V_HTML_2 || V_FILAS;
         ELSIF V_CONTADOR < 1500000 THEN
               V_HTML_3 := V_HTML_3 || V_FILAS;
         ELSIF V_CONTADOR < 2000000 THEN
               V_HTML_4 := V_HTML_4 || V_FILAS;
         END IF;
        END LOOP;
        OPEN C_DATA FOR
        SELECT V_HTML || V_HTML_1 || V_HTML_2 || V_HTML_3|| V_HTML_4 || '</TABLE></body></html>' HTML, 'ListadoVoluntariado' NAME_ FROM DUAL; 
        RETURN;  
    WHEN 30 THEN -- bases
       /* SELECT COUNT(1), MAX(INITCAP(MOFIDESCRI)) INTO V_CONTADOR, V_DIRECCION
          FROM TR_PROCESO P
               --- INNER JOIN ADMINMC.OFICINAS O
                  --      ON O.IDOFICODIGO = P.IDOFICODIGO
          WHERE P.NIDPROCESO = P_NIDPROCESO AND O.MOFIDESCRI LIKE 'DIRECCION DESCONCENTRADA DE CULTURA%';
          IF V_CONTADOR = 0 THEN*/
            V_DIRECCION := 'Ministerio de Cultura: Av Javier Prado Este 2465 San Borja';
          --END IF;
        
        SELECT IDUEJECOD INTO V_IDUEJECOD
        FROM TM_CONVOCATORIA C INNER JOIN TR_PROCESO P ON P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
        WHERE P.NIDPROCESO = P_NIDPROCESO;
        
        CASE V_IDUEJECOD 
            WHEN '009' THEN V_DIRECCION:= 'Jr. Independencia N° 572 Trujillo - La Libertad';
            WHEN '005' THEN V_DIRECCION:= 'Calle Pimentel N° 165, Urb. Santa Victoria, Chiclayo.';
            WHEN '007' THEN V_DIRECCION:= 'Jr. Sucre N° 333-335-337 Huamachuco - La Libertad.';
            WHEN '002' THEN V_DIRECCION:= 'Calle Maruri s/n, Cusco. Local Cusicancha - Cusco.';
            ELSE NULL;
        END CASE;
         
        for c in (   SELECT NIDPROCESO, NIDREGISTRO, SDESCRIPCION , T.SDITEM SECCION, A.NPRIORIDAD, T.NPARAM1 ORDEN, T.NIDITEM
                    FROM TR_PROCESO_BASES A
                    LEFT JOIN TM_TABLA_GENERAL_D T ON T.NIDTABLA = 8 AND A.NIDTIPO_BASE = T.NIDITEM AND T.NPARAM2 = 1
                    WHERE NIDPROCESO = P_NIDPROCESO AND A.BACTIVO = 1
                    ORDER BY T.NPARAM1,A.NPRIORIDAD
         )LOOP
             CASE C.NIDITEM
                WHEN 1 THEN V_formacionAcademica := V_formacionAcademica || '<li>' || C.SDESCRIPCION || '</li>';
                WHEN 2 THEN V_experienciaGeneral := V_experienciaGeneral || '<li>' || C.SDESCRIPCION || '</li>';
                WHEN 3 THEN V_experienciaEspecifica := V_experienciaEspecifica || '<li>' || C.SDESCRIPCION || '</li>';
                WHEN 4 THEN V_cursos := V_cursos || '<li>' || C.SDESCRIPCION || '</li>';
                WHEN 13 THEN V_conocimientos := V_conocimientos || '<li>' || C.SDESCRIPCION || '</li>';
                WHEN 5 THEN V_funciones := V_funciones || '<li>' || C.SDESCRIPCION || '</li>';
                WHEN 15 THEN V_otros := V_otros || '<li>' || C.SDESCRIPCION || '</li>';
             END CASE;
         END LOOP;
         for c in (
            SELECT NIDPROCESO, NIDREGISTRO, to_char(dfechaini,'dd/mm/yyyy') dfechaini ,to_char(dfechaFIN,'dd/mm/yyyy')  dfechaFIN, T.SDITEM || DECODE(T.NIDITEM,11,'<br/>'|| V_DIRECCION) SECCION, T.NIDITEM,
            to_char(dfechaini,'dd/mm/yyyy') || DECODE(dfechaFIN,NULL,'',' al '||to_char(dfechaFIN,'dd/mm/yyyy'))SDESCRIPCION, T.NPARAM1 ORDENA
            FROM tr_proceso_cronograma A
            LEFT JOIN TM_TABLA_GENERAL_D T ON T.NIDTABLA = 8 AND A.nidtipo_fecha = T.NIDITEM AND T.NPARAM2 = 2
            WHERE NIDPROCESO = P_NIDPROCESO AND A.BACTIVO = 1
            ORDER BY T.NPARAM1
         )LOOP
             CASE C.NIDITEM
                WHEN 6 THEN V_fechaEmpleo := V_fechaEmpleo || '<tr><td class="titulo">' || C.SECCION || '</td><td class="size11 center">' || C.SDESCRIPCION || '</td></tr>';
                WHEN 8 THEN V_fechaConvocatoria := V_fechaConvocatoria || '<tr><td class="titulo">' || C.SECCION || '</td><td class="size11 center">' || C.SDESCRIPCION;
                            if  V_IDUEJECOD = '002' then
                                V_fechaConvocatoria := V_fechaConvocatoria || ' (Desde las 7:00 a.m. hasta las 16:00 p.m.) </td></tr>';
                            else
                                V_fechaConvocatoria := V_fechaConvocatoria || ' (Desde las 8:30 a.m. hasta las 16:30 p.m.) </td></tr>';
                            end if;
                WHEN 7 THEN V_fechaConvocatoria := V_fechaConvocatoria || '<tr><td class="titulo">' || C.SECCION || '</td><td class="size11 center">' || C.SDESCRIPCION || '</td></tr>';
                ELSE V_fechaSelecicon := V_fechaSelecicon || '<tr><td class="titulo">' || C.SECCION || '</td><td class="size11 center">' || C.SDESCRIPCION || '</td></tr>';
             END CASE;
         END LOOP;
         
         for c in ( 
              SELECT NIDPROCESO,BESTADO,NEXP_GEN,NEXP_ESP,NCOLEG_OBLIG,SSERVICIO,SPROCESO,NPROCESO,BACTIVO,NIDCONVOCATORIA, SIDSGRADOSACAD,SIDSFORMACIONACAD,
              PKG_CAS_READ.F_CONCATENA_ITEMS(1,SIDSFORMACIONACAD) LISTA_FA,PKG_CAS_READ.F_CONCATENA_ITEMS(2,SIDSGRADOSACAD) LISTA_GA, NELENCO, NPLAZAS, SRUTADOC,
              'DOFICINA' DOFICINA, DPUESTO, DOBJETO, DLUGAR,SDURACION, 'S/' || TO_CHAR(NSUELDO,'99,999') || ' ('|| initcap(Numero_a_Texto ( NSUELDO, 2)) ||'y 00/100 Soles)' SREMUNERACION
              ,p.idoficodigo, NSUELDO, NOBLIG_BREVETE, ncolegHab_oblig, nrna_oblig,NRESULTADO,nvl(noblig_dj,0) dj, nvl(p.nanio,extract(year from sysdate)) anio
              FROM TR_PROCESO p
              WHERE NIDPROCESO = P_NIDPROCESO
         ) loop
              v_html := v_html || '<html><head><style type="text/css">.tableBorder { width: 100%; border-collapse:collapse;border: 1px solid black;}td { padding-left:10px;padding-right:10px;border: 1px solid black}' ||
             '.titulo {font-size:22px; font-weight: bold;}.center {text-align:center}.size11 {font-size:22px;}.size9 {font-size:16px;text-align:justify}.size7 {font-size:14px;}' ||
             '</style></head><body style="font-family:Arial Narrow;"><p  class="size11" style="text-align:center;font-weight: bold;text-decoration:underline">' || c.SPROCESO ||
             '</p><p class="size11 center" width="100%" style="padding-top:10px;padding-bottom:15px;font-weight: bold;">' ||c.SSERVICIO ||
             '</p><table class="tableBorder"><tr><td width="30%" class="titulo">ÁREA USUARIA</td><td width="70%" class="size11">' || c.DOFICINA ||
             '</td></tr><tr><td class="titulo">PUESTO</td><td class="size11">' || c.DPUESTO || 
             '</td></tr></table><p class="titulo">I.    OBJETO DE LA CONTRATACIÓN: </p><table class="tableBorder"><tr><td class="size11">' || c.DOBJETO ||
             '</td></tr></table><br/><table class="tableBorder" ><tr><td class="size11" style="padding-top:10px">BASE LEGAL:<ul>';
             case c.anio
             when 2017 then
                 v_html := v_html   || '<li>  Ley N º 29849 que establece la eliminación progresiva del régimen especial del Decreto Legislativo N º 1057 y otorga derechos laborales.</li>' ||
                 '<li>    Ley N º 30518 Ley de Presupuesto del Sector Público para el Año Fiscal 2017.</li>' ||
                 '<li>    Ley N º 27444, Ley del Procedimiento Administrativo General.</li>' ||
                 '<li>    Decreto Legislativo Nº 1272 que modifica la Ley N° 27444, Ley del Procedimiento Administrativo General y deroga la Ley N° 29060, Ley del Silencio Administrativo.</li>' ||
                 '<li>    Decreto Legislativo Nº 1057 que regula el régimen especial de contratación administrativa de servicios. </li>' ||
                 '<li>    Reglamento del Decreto Legislativo N º 1057, aprobado por Decreto Supremo N º 075 - 2008 PCM y modificatorias aprobadas por Decreto Supremo N º 065-2011 PCM.</li>' ||
                 '<li>    Directiva N° 004-2014-SG/MC: Procedimiento que regula la contratación, asistencia y permanencia del personal bajo el Régimen Especial de Contratación Administrativa de Servicios CAS - del Ministerio de Cultura, aprobada mediante Resolución de Secretaría General N° 053-2014-SG/MC.</li>' ||
                 '<li>    Resolución de Presidencia Ejecutiva N° 052-2016-SERVIR-PE.</li>';
                 v_html_1 :='<tr>    <td>    <div class="size11">Maestrías, Diplomados, Cursos y/o Programa de Especialización</div><div class="size9">*(Se deben acreditar mediante certificado, constancia u otro medio probatorio, con no menos de 12 horas de duración, no son acumulativas. Se podrán considerar capacitaciones menores a 12 horas siempre que sean mayores a 8 horas y organizadas por un ente rector Los Programas de Especialización son mínimos de 90 horas. Pueden tener una duración menor a 90 horas siempre que sean mayor a 80 horas y organizadas por disposición de un ente rector.)1';
                v_html_2 := '   1 Guía Metodológica para el Diseño de Perfiles de Puestos para entidades públicas, aplicables a regímenes distintos a la Ley N° 30057, Ley del Servicio Civil, Directiva N° 0004-2017-SERVIR/GDSRH Normas para la Gestión del Proceso de Diseño de Puestos y Formulación del Manual de Perfiles de Puestos-MPP, aprobada por Resolución de Presidencia Ejecutiva N° 312-2017-SERVIR-PE.';
             when 2018 then
                v_html := v_html  || '<li>Ley N º 29849 que establece la eliminación progresiva del régimen especial del Decreto Legislativo N º 1057 y otorga derechos laborales.</li>' ||
                '<li>Ley N º 30693 Ley de Presupuesto del Sector Público para el Año Fiscal 2018.</li>' ||
                '<li>Ley N º 27444, Ley del Procedimiento Administrativo General.</li>' ||
                '<li>Decreto Legislativo Nº 1272 que modifica la Ley N° 27444, Ley del Procedimiento Administrativo General y deroga la Ley N° 29060, Ley del Silencio Administrativo.</li>' ||
                '<li>Decreto Legislativo Nº 1057 que regula el régimen especial de contratación administrativa de servicios.</li>' ||
                '<li>Reglamento del Decreto Legislativo N º 1057, aprobado por Decreto Supremo N º 075 - 2008 PCM y modificatorias aprobadas por Decreto Supremo N º 065-2011 PCM.</li>' ||
                '<li>Resolución de Presidencia Ejecutiva N° 312-2017-SERVIR-PE.</li>' ||
                '<li>Resolución de Presidencia Ejecutiva N° 313-2017-SERVIR-PE.</li>' ||
                '<li>Directiva N° 004-2018-SG/MC Directiva que establece el procedimiento de selección, contratación, asistencia y permanencia de personal bajo el Régimen Especial de Contratación Administrativa de Servicios del Ministerio de Cultura, aprobada mediante Resolución de Secretaría General N° 065-2018-SG/MC.</li>';
                v_html_1 :='<tr>    <td>    <div class="size11">Maestrías, Diplomados, Cursos y/o Programa de Especialización</div><div class="size9">*(Se deben acreditar mediante certificado, constancia u otro medio probatorio, con no menos de 12 horas de duración, no son acumulativas. Se podrán considerar capacitaciones menores a 12 horas siempre que sean mayores a 8 horas y organizadas por un ente rector Los Programas de Especialización son mínimos de 90 horas. Pueden tener una duración menor a 90 horas siempre que sean mayor a 80 horas y organizadas por disposición de un ente rector.)1';
                v_html_2 := '   1 Guía Metodológica para el Diseño de Perfiles de Puestos para entidades públicas, aplicables a regímenes distintos a la Ley N° 30057, Ley del Servicio Civil, Directiva N° 0004-2017-SERVIR/GDSRH Normas para la Gestión del Proceso de Diseño de Puestos y Formulación del Manual de Perfiles de Puestos-MPP, aprobada por Resolución de Presidencia Ejecutiva N° 312-2017-SERVIR-PE.';
             when 2019 then
                v_html := v_html  || '<li>Ley N º 29849 que establece la eliminación progresiva del régimen especial del Decreto Legislativo N º 1057 y otorga derechos laborales.</li>' ||
                '<li>Ley N º 30879 Ley de Presupuesto del Sector Público para el Año Fiscal 2019.</li>' ||
                '<li>Ley N º 27444, Ley del Procedimiento Administrativo General.</li>' ||
                '<li>Decreto Legislativo Nº 1272 que modifica la Ley N° 27444, Ley del Procedimiento Administrativo General y deroga la Ley N° 29060, Ley del Silencio Administrativo.</li>' ||
                '<li>Decreto Legislativo Nº 1057 que regula el régimen especial de contratación administrativa de servicios.</li>' ||
                '<li>Reglamento del Decreto Legislativo N º 1057, aprobado por Decreto Supremo N º 075 - 2008 PCM y modificatorias aprobadas por Decreto Supremo N º 065-2011 PCM.</li>';
                v_html_1 :='<tr>    <td>    <div class="size11">Cursos y/o Programa de Especialización o Diplomados</div><div class="size9">Los cursos, talleres, seminarios o conferencias, se deben acreditar mediante un certificado, constancia u otro medio probatorio. Los Programas de Especialización y/o Diplomados son mínimos de 90 horas. Deben acreditarse mediante un certificado, diploma u otro medio probatorio que dé cuenta de la aprobación del mismo. Los Programas de Especialización pueden ser desde 80 horas, si son organizadas por disposición de un ente rector, en el marco de sus atribuciones normativas.1';
                v_html_2 := '   1 ANEXO 1 Guía Metodológica para el Diseño de Perfiles de Puestos para entidades públicas, aplicables a regímenes distintos a la Ley N° 30057, Ley del Servicio Civil, aprobada por Resolución de Presidencia Ejecutiva N° 313-2017-SERVIR-PE, de fecha 29 de diciembre del 2017.';
             else 
                NULL;
             end case;
             
             
             v_html := v_html ||'<ul></td></tr></table><p class="titulo">II.    PERFIL Y/O REQUISITOS MÍNIMOS: </p>' ||
             '<table class="tableBorder"><tr><td width="50%" class="titulo">REQUISITOS</td><td></td></tr><tr class="size11"><td >Formación Académica</td><td style="padding-top:10px"><ul>' ||
             v_formacionAcademica || '</ul></td>    </tr>    <tr>    <td><div class="size11">Experiencia General</div>' ||
             '<div class="size9">*Para aquellos casos donde se requiere formación técnica o universitaria, el tiempo de experiencia se contará desde el momento de egreso de la formación correspondiente, lo que incluye también las prácticas profesionales.1 <br/>' ||
             '*Para aquellos casos donde no se requiere formación técnica y/o profesional (sólo primaria o secundaria, se contará cualquier experiencia laboral) 1' ||
             '</div></td>    <td style="padding-top:10px;"  class="size11">    <ul>' || v_experienciaGeneral ||
             '</ul>    </td></tr><tr>    <td class="size11">    Experiencia Específica para el puesto convocado    </td>    <td style="padding-top:10px;" class="size11">    <ul>' ||
             v_experienciaEspecifica ||'</ul>    </td></tr>';
             if v_cursos is not null then
                 v_html := v_html || v_html_1 || '</div>    </td>    <td class="size11">    <ul>' || v_cursos || '</ul>    </td></tr>'; 
             end if;
             if v_conocimientos is not null then
             v_html := v_html || '<tr class="size11"> <td >Conocimientos Relacionados al servicio'|| case c.dj when 1 then ' (acreditar con Declaración Jurada)' end ||'</td><td style="padding-top:10px"><ul>' || v_conocimientos || '</ul></td>    </tr>';
             end if;   
             if v_otros is not null then
                 v_html := v_html || '<tr class="size11">    <td>Otros </td>    <td>    <ul>' || v_otros ||'</ul>    </td></tr>'; 
             end if;
             v_html := v_html || '</table><p class="size9">' || v_html_2 || '</p><p class="titulo">III.    DESCRIPCIÓN DEL SERVICIO A REALIZAR: </p>' ||
              '<p class="size11" style="padding-left:15px;">    Principales funciones a desarrollar: (Describir las funciones y actividades a realizar en el puesto y/o cargo a convocar) </p>' ||
              '<table class="tableBorder" ><tr><td class="size11" style="padding-top:10px"><ul>' || v_funciones || '<ul></td></tr></table>' ||
              '<p class="titulo">IV.    CONDICIONES ESENCIALES DEL CONTRATO: </p><table class="tableBorder"><tr>    <td width="40%" class="titulo">LUGAR DE PRESTACIÓN</td><td width="60%" class="size11">' ||
              c.DLUGAR || '</td></tr><tr><td class="titulo">DURACIÓN</td><td class="size11">' || c.SDURACION || '</td></tr><tr><td class="titulo">REMUNERACIÓN MENSUAL</td>    <td class="size11">' ||
              c.SREMUNERACION || '</td></tr></table><p class="titulo">V.    CRONOGRAMA  Y  ETAPAS DEL PROCESO</p><table class="tableBorder"><tr>' ||
              '<td width="50%" class="titulo center" >ETAPAS DEL PROCESO</td><td width="50%" class="titulo center" >FECHA DE DESARROLLO DEL PROCESO</td></tr>' ||
              v_fechaEmpleo || '<tr>    <td colspan=2 class="titulo" style="text-align:center">CONVOCATORIA </td></tr>' || v_fechaConvocatoria ||
              '<tr>    <td colspan=2 class="titulo center" >SELECCIÓN </td></tr>' || v_fechaSelecicon ||'</table></body></html>';
         end loop;
    WHEN 9 THEN
    
        FOR c in (  SELECT pr.nidproceso, PU.NIDPROCESOUSU, sproceso, sservicio,
                       DECODE (DP.NIDCODIGOUSUARIO, NULL, '', UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES))
                          POSTULANTE,
                       DECODE (f_getCalificacion (PU.NIDPROCESOUSU, 2), 1, '<td></td><td></td>', '<td colspan=''2'' style=''text-align:center''>NO APTO</td>')
                          NEVAL_CUR, T.DCONVOCATORIA CONVOCATORIA
                  FROM TR_PROCESO PR
                       INNER JOIN TR_PROCESOUSUARIO PU ON PR.NIDPROCESO = PU.NIDPROCESO
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                       INNER JOIN TM_CONVOCATORIA T ON T.NTIPO = PR.NTIPO AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
                 WHERE     PR.NIDCONVOCATORIA = P_NIDCONVOCATORIA AND PU.BACTIVO = 1 AND pr.nelenco = 1 and pu.bestado = 2
              ORDER BY sproceso, POSTULANTE)
        LOOP
          V_FILAS :=  V_FILAS || '<tr>';
          IF V_NIDPROCESO <> C.NIDPROCESO THEN
             V_DCONVOCATORIA := C.CONVOCATORIA;
             V_NIDPROCESO := C.NIDPROCESO;
             V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
             V_CONTADOR := 0;
             V_HTML_3 := V_HTML_3 || V_FILAS ;
             V_FILAS :=  '<td rowspan = NROROWSPAN><b>' || C.SPROCESO || '</b></td><td rowspan = NROROWSPAN>' || C.SSERVICIO || '</td>';
          END IF;
          V_CONTADOR := V_CONTADOR + 1;
          V_FILAS := V_FILAS || '<td STYLE=''height:30px;''>'|| C.POSTULANTE || '</td>' || C.NEVAL_CUR || '</tr>';
         -- V_HTML_2 := V_HTML_2 || V_FILAS || V_HTML_3;
        END LOOP;
        V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
        V_HTML_3 := V_HTML_3 || V_FILAS ;
        V_HTML := '<html><HEAD><style type=''text/css''>td { border: 1px solid black;vertical-align:middle;font-size:12px;text-align:center}</style></HEAD><body>';
        V_HTML := V_HTML  || '<TABLE style=''font-family:Arial;''><tr><td colspan = ''5'' style=''border: 0px;height:60px''><img  height=''55'' width= ''300'' src=''http://plataformamincu.cultura.gob.pe/POST_CAST/images/logo_ministerio.jpg''/></td></tr>'
          || '<TR><TD COLSPAN=''5'' style=''text-align:center;font-weight: bold;border: 0px;font-size:13px; ''>PUBLICACIÓN DE RESULTADOS DE LA EVALUACIÓN CURRICULAR DE LA '||V_DCONVOCATORIA||'   <BR/></td></tr><tr><TD COLSPAN=''5'' style=''text-align:center;font-weight: bold;border: 0px;font-size:13px;height:55px''>EVALUACIÓN TÉCNICA: Se llevará a cabo en en la Sede Central del MINCU: Av Javier Prado Este 2465 San Borja. En el caso de los Procesos de las Direcciones Desconcentradas de Cultura, se realizará en la misma sede. Los Postulantes deberán portar Documento de Identidad.</TD></TR>'
          || '<TR style=''text-align:center;font-weight: bold;''><td style=''width:200px;background-color: rgb(192,192,192)''>PROCESO DE CONTRATACIÓN ADMINISTRATIVA DE SERVICIOS - CAS </td><td style=''width:260px;background-color: rgb(192,192,192)''>   SERVICIO  </td><td style=''width:290px;background-color: rgb(192,192,192)''>  NOMBRE DEL POSTULANTE (S)  </td><td style=''width:100px;background-color: rgb(192,192,192)''>  FECHA DE EVALUACIÓN </td><td style=''width:100px;background-color: rgb(192,192,192)''>   HORA DE EVALUACIÓN </td></tr>';
       
        V_HTML := V_HTML || V_HTML_3;
        V_HTML := V_HTML
          || '<TR><TD COLSPAN=''3'' style=''border: 0px ''></TD><TD COLSPAN=''2'' style=''text-align:center;font-weight: bold;border: 1px ''>COMITÉ DE SELECCIÓN </TD></TR></TABLE></body></html>';
    WHEN 21 THEN
        FOR c in (  SELECT DCONVOCATORIA CONVOCATORIA,PR.NIDPROCESO,PR.SPROCESO,SSERVICIO, UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES) POSTULANTE, DECODE(DA.BFUERZAARMADA,1,'X') FFAA, DECODE(DA.bdiscapacidad,1,'X') DISCA,STIPO,
        DECODE (f_getCalificacion (PU.NIDPROCESOUSU, 2), 1, 'APTO', 'NO APTO') resultado 
        FROM TR_DATOSADICIONALES DA 
        INNER JOIN TR_PROCESOUSUARIO PU ON DA.NIDPROCESOUSU = PU.NIDPROCESOUSU AND PU.BESTADO =2
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                       INNER JOIN TR_PROCESO PR ON PR.NIDPROCESO = PU.NIDPROCESO
                       INNER JOIN TM_CONVOCATORIA T ON T.NTIPO = PR.NTIPO AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
        WHERE (DA.bdiscapacidad = 1 OR DA.BFUERZAARMADA = 1) AND PR.NIDCONVOCATORIA = P_NIDCONVOCATORIA
        ORDER BY 2,3)
        LOOP
          V_FILAS :=  V_FILAS || '<tr>';
          IF V_NIDPROCESO <> C.NIDPROCESO THEN
             V_DCONVOCATORIA := C.CONVOCATORIA;
             V_NIDPROCESO := C.NIDPROCESO;
             V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
             V_CONTADOR := 0;
             V_HTML_3 := V_HTML_3 || V_FILAS ;
             V_FILAS :=  '<td rowspan = NROROWSPAN><b>' || C.SPROCESO || '</b></td><td rowspan = NROROWSPAN style="text-align:left">' || C.SSERVICIO || '</td>';
          END IF;
          V_CONTADOR := V_CONTADOR + 1;
          V_FILAS := V_FILAS || '<td STYLE=''height:30px;text-align:left''>'|| C.POSTULANTE || '</td><td STYLE=''height:30px;''>' || C.FFAA ||'</td><td STYLE=''height:30px;''>'|| C.DISCA|| '</TD></td><td STYLE=''height:30px;''>'|| C.STIPO|| '</TD><td STYLE=''height:30px;''>'|| C.RESULTADO|| '</TD></tr>';
        END LOOP;
        V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
        V_HTML_3 := V_HTML_3 || V_FILAS ;
        V_HTML := '<html><HEAD><style type=''text/css''>td { border: 1px solid black;vertical-align:middle;font-size:12px;text-align:center}</style></HEAD><body>';
        V_HTML := V_HTML  || '<TABLE style=''font-family:Arial;''>'
          || '<TR><TD COLSPAN=''6'' style=''text-align:center;font-weight: bold;border: 0px;font-size:13px; ''>LISTADO DE LICENCIADOS FFAA Y DISCAPACITADOS '||V_DCONVOCATORIA||'   <BR/></td></tr>'
          || '<TR style=''text-align:center;font-weight: bold;''><td style=''width:200px;background-color: rgb(192,192,192)''>PROCESO DE CONTRATACIÓN ADMINISTRATIVA DE SERVICIOS - CAS </td><td style=''width:260px;background-color: rgb(192,192,192)''>   SERVICIO  </td><td style=''width:290px;background-color: rgb(192,192,192)''>  NOMBRE DEL POSTULANTE  </td><td style=''width:100px;background-color: rgb(192,192,192)''>  LIC. FFAA </td><td style=''width:100px;background-color: rgb(192,192,192)''>   DISCAPACIDAD </td><td style=''width:100px;background-color: rgb(192,192,192)''>   TIPO DISCAPACIDAD </td><td style=''width:100px;background-color: rgb(192,192,192)''>  RESULTADO </td></tr>';
       
        V_HTML := V_HTML || V_HTML_3;
        V_HTML := V_HTML
          || '</TABLE></body></html>';
    WHEN 22 THEN
        FOR c in (   SELECT DCONVOCATORIA CONVOCATORIA,PR.NIDPROCESO,PR.SPROCESO,SSERVICIO, UPPER ( DP.SAPATERNO || ' ' || DP.SAMATERNO || ', ' || DP.SNOMBRES) POSTULANTE, 
        sfamiliadirecta || decode(nvl(bparentesco,0),0,null,' - '||(select sditem from TM_TABLA_GENERAL_D where nidtabla = 10 and niditem = bparentesco) ) sfamiliar,
        DECODE (f_getCalificacion (PU.NIDPROCESOUSU, 2), 1, 'APTO', 'NO APTO') resultado 
        FROM TR_DATOSADICIONALES DA 
        INNER JOIN TR_PROCESOUSUARIO PU ON DA.NIDPROCESOUSU = PU.NIDPROCESOUSU AND PU.BESTADO =2
                       INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
                       INNER JOIN TR_PROCESO PR ON PR.NIDPROCESO = PU.NIDPROCESO
                       INNER JOIN TM_CONVOCATORIA T ON T.NTIPO = PR.NTIPO AND T.NIDCONVOCATORIA = PR.NIDCONVOCATORIA
        WHERE bfamiliadirecta > 0 AND PR.NIDCONVOCATORIA = P_NIDCONVOCATORIA
        ORDER BY 2,3)
        LOOP
          V_FILAS :=  V_FILAS || '<tr>';
          IF V_NIDPROCESO <> C.NIDPROCESO THEN
             V_DCONVOCATORIA := C.CONVOCATORIA;
             V_NIDPROCESO := C.NIDPROCESO;
             V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
             V_CONTADOR := 0;
             V_HTML_3 := V_HTML_3 || V_FILAS ;
             V_FILAS :=  '<td rowspan = NROROWSPAN><b>' || C.SPROCESO || '</b></td><td rowspan = NROROWSPAN style="text-align:left">' || C.SSERVICIO || '</td>';
          END IF;
          V_CONTADOR := V_CONTADOR + 1;
          V_FILAS := V_FILAS || '<td STYLE=''height:30px;text-align:left''>'|| C.POSTULANTE || '</td><td STYLE=''height:30px;text-align:left''>' || C.sfamiliar ||'</td><td STYLE=''height:30px;''>'|| C.RESULTADO|| '</TD></tr>';
        END LOOP;
        V_FILAS := REPLACE (V_FILAS, 'NROROWSPAN', V_CONTADOR);
        V_HTML_3 := V_HTML_3 || V_FILAS ;
        V_HTML := '<html><HEAD><style type=''text/css''>td { border: 1px solid black;vertical-align:middle;font-size:12px;text-align:center}</style></HEAD><body>';
        V_HTML := V_HTML  || '<TABLE style=''font-family:Arial;''>'
          || '<TR><TD COLSPAN=''5'' style=''text-align:center;font-weight: bold;border: 0px;font-size:13px; ''>LISTADO DE PARENTESCO - '||V_DCONVOCATORIA||'   <BR/></td></tr>'
          || '<TR style=''text-align:center;font-weight: bold;''><td style=''width:200px;background-color: rgb(192,192,192)''>PROCESO DE CONTRATACIÓN ADMINISTRATIVA DE SERVICIOS - CAS </td><td style=''width:300px;background-color: rgb(192,192,192)''>   SERVICIO  </td><td style=''width:300px;background-color: rgb(192,192,192)''>  NOMBRE DEL POSTULANTE  </td><td style=''width:300px;background-color: rgb(192,192,192)''>   NOMBRE DEL FAMILIAR </td><td style=''width:100px;background-color: rgb(192,192,192)''>  RESULTADO </td></tr>';
       
        V_HTML := V_HTML || V_HTML_3;
        V_HTML := V_HTML
          || '</TABLE></body></html>';
        V_NAME:= 'ListadoParentesco';
    ELSE
        V_HTML := 'NO HAY DATA'||P_NIDPROCESO||P_NIDCONVOCATORIA;
    END CASE;   
    
    CASE V_IDUEJECOD 
        WHEN '009' THEN V_FOOTER := '<html><HEAD></head><body style="text-align:center;font-size:12px"><p style="text-align:center">Jr. Independencia N° 572 Trujillo, La Libertad - Perú  <br/>  www.cultura.gob.pe</p></body></html>';
        WHEN '005' THEN V_FOOTER := '<html><HEAD></head><body style="text-align:center;font-size:12px"><p style="text-align:center">Calle Pimentel N° 165, Urb. Santa Victoria, Chiclayo. - Perú  <br/> www.cultura.gob.pe</p></body></html>';
        WHEN '007' THEN V_FOOTER := '<html><HEAD></head><body style="text-align:center;font-size:12px"><p style="text-align:center">Jr. Sucre N° 333-335-337 Huamachuco - La Libertad. - Perú  <br/> www.cultura.gob.pe</p></body></html>';
        WHEN '002' THEN V_FOOTER := '<html><HEAD></head><body style="text-align:center;font-size:12px"><p style="text-align:center">Calle Maruri s/n, Cusco. Local Cusicancha - Cusco. - Perú  <br/> www.cultura.gob.pe</p></body></html>';
        ELSE V_FOOTER := '<html><HEAD></head><body style="text-align:center;font-size:12px"><p style="text-align:center">Av. Javier Prado Este 2465, San Borja, Lima - Perú  <br/> Telf: (511) 6189393 / www.cultura.gob.pe</p></body></html>';
    END CASE;
    
    OPEN C_DATA FOR
    SELECT V_HTML HTML, V_FOOTER FOOTER, V_TIPO TIPODOC, V_NAME NAME_, V_CAB CAB_ FROM DUAL;
EXCEPTION WHEN OTHERS THEN
    V_FILAS := SQLERRM || DBMS_UTILITY.format_error_backtrace;
    OPEN C_DATA FOR
    SELECT 'NO HAY INFORMACIÓN PARA ESTE PROCESO - '|| P_NIDCONVOCATORIA ||' - '||V_FILAS HTML,V_FOOTER FOOTER,V_TIPO TIPODOC, V_NAME NAME_, V_CAB CAB_ FROM DUAL;
END;
/

CREATE PROCEDURE "MCCAS2"."SP_MAIL_SEND"(pSender in varchar2,
                        pRecipient in varchar2,
                        pSubject in varchar2,
                        pMessage in VARCHAR2,
                        pCc IN VARCHAR2,
                        pBcc IN VARCHAR2,
                        pMime_type IN VARCHAR2)
AS
BEGIN
    utl_mail.send(
      sender => pSender,
      recipients => pRecipient,
      cc => pCc,
      bcc => pBcc,
      subject => pSubject,
      message => pMessage,
      mime_type => pMime_type
      );
END SP_MAIL_SEND;
/

CREATE PROCEDURE "MCCAS2"."SP_CONSULTA_GENERAL"(PI_WHERE VARCHAR2,PI_GRUPO VARCHAR2, C_DATA OUT sys_refcursor,PI_IDUSUARIO NUMBER)
AS
    SSQL VARCHAR2(4000);
    SORDER VARCHAR2(500);
    V_UEJECOD VARCHAR(3);
BEGIN
   /* begin
        SELECT IDUEJECOD INTO V_UEJECOD 
        FROM MCSGAGEN.TM_SGAUSUARIO WHERE NCODIGOUSUARIO = PI_IDUSUARIO;
    exception when others then*/
        V_UEJECOD := '001';
  --  end;
   SSQL :='SELECT DCONVOCATORIA CONVOCATORIA,DECODE(C.BACTIVO,1,''Activo'',''Inactivo'') Estado_conv,SSERVICIO,sproceso,R.SDITEM RESULTADO, UPPER(DP.SAPATERNO ||'' ''|| DP.SAMATERNO ||'', ''|| DP.SNOMBRES) POSTULANTE,
         DECODE(PU.BESTADO,1,''Inscrito'',''Enviado'') Estado_ficha,PU.NIDPROCESOUSU,P.NIDPROCESO,P.NIDCONVOCATORIA,C.BACTIVO, TO_CHAR(PU.DFECHACREACION,''DD/MM/YYYY'') F_INSC_FICHA,PU.DFECHACREACION
         , TO_CHAR(DP.DFECHANAC,''DD/MM/YYYY'') F_NACIMIENTO,DP.DFECHANAC, TRUNC((TRUNC(SYSDATE) - DFECHANAC)/365) EDAD, DECODE(SSEXO,''M'',''MASCULINO'',''F'',''FEMENINO'') DSEXO, DP.SSEXO,DP.SDNI,
         DP.SRUC, DP.SBREVETE|| '' ''||DP.SCATBREVETE BREVETE,NAC.COMPLETO LUGAR_NAC,DIR.COMPLETO LUGAR_DIR, UPPER(DP.SDIRECCION || '' '' || SNROLOTE) DIRECCION, DP.STELEFONOFIJO, DP.SCELULAR,DP.SCORREO,'||
         CASE SUBSTR(PI_GRUPO,1,1) WHEN 'S' THEN 'F_CONCATENA_DATOS(''EXP'',NULL, PU.NIDPROCESOUSU)' ELSE '''''' END
         ||' LUG_TRAB,F_CONCATENA_DATOS(''OFI'',P.IDOFICODIGO, NULL) SIGLAS, ''O.MOFIDESCRI'' OFICINA 
         FROM TR_PROCESO P 
         INNER JOIN TM_CONVOCATORIA C ON C.NTIPO = P.NTIPO AND C.BACTIVO <> 2 and P.NIDCONVOCATORIA = C.NIDCONVOCATORIA AND C.IDUEJECOD = '''|| V_UEJECOD ||'''   
         LEFT join TM_TABLA_GENERAL_D R ON R.NIDTABLA = 7 AND R.NIDITEM = P.NRESULTADO
         LEFT JOIN TR_PROCESOUSUARIO PU ON PU.NIDPROCESO = P.NIDPROCESO and PU.BACTIVO =1
         LEFT JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
         LEFT JOIN VW_DISTRITOS NAC ON NAC.NDISTRITO = DP.SUBIGEONAC
         LEFT JOIN VW_DISTRITOS DIR ON DIR.NDISTRITO = DP.SUBIGEODIR
         WHERE  P.BACTIVO = 1';
   SORDER := ' ORDER BY NIDCONVOCATORIA,NIDPROCESO,postulante';
   SSQL := 'SELECT * FROM ('||SSQL||') WHERE 1=1 '|| PI_WHERE || SORDER; 
 OPEN C_DATA FOR SSQL; 
END;
/

CREATE PROCEDURE "MCCAS2"."USP_RESETEA_CLAVE"(sdni varchar2, sresultado out varchar2)
as
v_id number;
begin
    sresultado := 'OK';
    select ncodigousuario into v_id 
    from tm_usuario
    where slogin =  sdni;
    update tm_usuario 
    set sclave = 'NUEVA CLAVE ENCRIPTADA'--fnc_getPasswordHash_Sha1(slogin)
    where ncodigousuario = v_id;
exception when others then
    sresultado:= 'No se encontró el DNI ingresado';
end;
/

-- Create functions section -------------------------------------------------

CREATE FUNCTION "MCCAS2"."FNC_GETPASSWORDHASH_SHA1"(pw IN VARCHAR2)
RETURN VARCHAR2
AS BEGIN
         RETURN lower(sys.dbms_crypto.hash(UTL_I18N.STRING_TO_RAW (pw,'AL32UTF8'),sys.dbms_crypto.hash_sh1));
END;
/

CREATE FUNCTION "MCCAS2"."NUMERO_A_TEXTO"(Imp Number, NumDec Number Default 2 )
RETURN VarChar2
IS
Es_Un_Numero Number;
imp_let VarChar2(150);
imp_char VarChar2(12);
impd_char VarChar2(2);
importe_let varchar2(100);

BEGIN
-- Se pasa a cadena
imp_char := To_Char(Trunc(Imp));
impd_char:= Substr(Ltrim(Ltrim(To_Char(Imp - Trunc(Imp)),'.'),','), 1, NumDec);

SELECT

--Centenas de miles de millones.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),1,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,2),'00','CIEN ','CIENTO '),
2,'DOSCIENTOS ',
3,'TRESCIENTOS ',
4,'CUATROCIENTOS ',
5,'QUINIENTOS ',
6,'SEISCIENTOS ',
7,'SETECIENTOS ',
8,'OCHOCIENTOS ',
9,'NOVECIENTOS ',
0,'')

||
--Decenas miles de millones.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),2,1),
1,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1),
0,'DIEZ ',
1,'ONCE MIL ',
2,'DOCE MIL ',
3,'TRECE MIL ',
4,'CATORCE MIL ',
5,'QUINCE MIL ',
6,'DICISEIS MIL ',
7,'DIECISIETE MIL ',
8,'DIECIOCHO MIL ',
9,'DIECINUEVE MIL '),
2,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'VEINTE ','VEINTI'),
3,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'TREINTA ','TREINTA Y '),
4,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'CUARENTA ','CUARENTA Y '),
5,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'CINCUENTA ','CINCUENTA Y '),
6,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'SESENTA ','SESENTA Y '),
7,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'SETENTA ','SETENTA Y '),
8,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'OCHENTA ','OCHENTA Y '),
9,DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1), 0,'NOVENTA ','NOVENTA Y '),
0,'')

||
--Unidades de milles de millones
DECODE (SUBSTR(LPAD(imp_char,12,'0'),3,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),'1','',
DECODE(SUBSTR(LPAD(imp_char,12,'0'),1,3),'001','MIL ','UN MIL ' ) ),
2,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','DOS MIL '),
3,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','TRES MIL '),
4,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','CUATRO MIL '),
5,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','CINCO MIL '),
6,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','SEIS MIL '),
7,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','SIETE MIL '),
8,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','OCHO MIL '),
9,DECODE(SUBSTR(LPAD(imp_char,12,'0'),2,1),1,'','NUEVE MIL '),
0,DECODE(SUBSTR(LPAD(imp_char,12,'0'),1,3),'000','','MIL '))

||
--Centenas de millon.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),4,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,2),'00','CIEN ','CIENTO '),
2,'DOSCIENTOS ',
3,'TRESCIENTOS ',
4,'CUATROCIENTOS ',
5,'QUINIENTOS ',
6,'SEISCIENTOS ',
7,'SETECIENTOS ',
8,'OCHOCIENTOS ',
9,'NOVECIENTOS ',
0,'')

||
--Decenas de millon.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),5,1),
1,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1),
0,'DIEZ ',
1,'ONCE MILLONES ',
2,'DOCE MILLONES ',
3,'TRECE MILLONES ',
4,'CATORCE MILLONES ',
5,'QUINCE MILLONES ',
6,'DICISEIS MILLONES ',
7,'DIECISIETE MILLONES ',
8,'DIECIOCHO MILLONES ',
9,'DIECINUEVE MILLONES '),
2,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'VEINTE ','VEINTI'),
3,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'TREINTA ','TREINTA Y '),
4,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'CUARENTA ','CUARENTA Y '),
5,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'CINCUENTA ','CINCUENTA Y '),
6,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'SESENTA ','SESENTA Y '),
7,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'SETENTA ','SETENTA Y '),
8,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'OCHENTA ','OCHENTA Y '),
9,DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1), 0,'NOVENTA ','NOVENTA Y '),
0,'')

||
--Unidades de millon.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),6,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),'1','',
DECODE(SUBSTR(LPAD(imp_char,12,'0'),3,2),'00','UN MILLON ','UN MILLONES ') ),
2,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','DOS MILLONES '),
3,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','TRES MILLONES '),
4,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','CUATRO MILLONES '),
5,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','CINCO MILLONES '),
6,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','SEIS MILLONES '),
7,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','SIETE MILLONES '),
8,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','OCHO MILLONES '),
9,DECODE(SUBSTR(LPAD(imp_char,12,'0'),5,1),1,'','NUEVE MILLONES '),
0,DECODE(SUBSTR(LPAD(imp_char,12,'0'),3,3),'000','','MILLONES '))

||
--Centenas de millar.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),7,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,2),'00','CIEN ','CIENTO '),
2,'DOSCIENTOS ',
3,'TRESCIENTOS ',
4,'CUATROCIENTOS ',
5,'QUINIENTOS ',
6,'SEISCIENTOS ',
7,'SETECIENTOS ',
8,'OCHOCIENTOS ',
9,'NOVECIENTOS ',
0,'')

||
--Decenas de millar.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),8,1),
1,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1),
0,'DIEZ ',
1,'ONCE MIL ',
2,'DOCE MIL ',
3,'TRECE MIL ',
4,'CATORCE MIL ',
5,'QUINCE MIL ',
6,'DICISEIS MIL ',
7,'DIECISIETE MIL ',
8,'DIECIOCHO MIL ',
9,'DIECINUEVE MIL '),
2,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'VEINTE ','VEINTI'),
3,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'TREINTA ','TREINTA Y '),
4,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'CUARENTA ','CUARENTA Y '),
5,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'CINCUENTA ','CINCUENTA Y '),
6,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'SESENTA ','SESENTA Y '),
7,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'SETENTA ','SETENTA Y '),
8,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'OCHENTA ','OCHENTA Y '),
9,DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1), 0,'NOVENTA ','NOVENTA Y '),
0,'')

||
--Unidades de millar
DECODE (SUBSTR(LPAD(imp_char,12,'0'),9,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),'1','',
DECODE(SUBSTR(LPAD(imp_char,12,'0'),7,3),'001','MIL ','UN MIL ' ) ),
2,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','DOS MIL '),
3,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','TRES MIL '),
4,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','CUATRO MIL '),
5,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','CINCO MIL '),
6,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','SEIS MIL '),
7,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','SIETE MIL '),
8,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','OCHO MIL '),
9,DECODE(SUBSTR(LPAD(imp_char,12,'0'),8,1),1,'','NUEVE MIL '),
0,DECODE(SUBSTR(LPAD(imp_char,12,'0'),7,3),'000','','MIL '))

||
--Centenas.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),10,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,2),'00','CIEN','CIENTO '),
2,'DOSCIENTOS ',
3,'TRESCIENTOS ',
4,'CUATROCIENTOS ',
5,'QUINIENTOS ',
6,'SEISCIENTOS ',
7,'SETECIENTOS ',
8,'OCHOCIENTOS ',
9,'NOVECIENTOS ',
0,'')

||
--Decenas.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),11,1),
1,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12),
0,'DIEZ ',
1,'ONCE ',
2,'DOCE ',
3,'TRECE ',
4,'CATORCE ',
5,'QUINCE ',
6,'DICISEIS ',
7,'DIECISIETE ',
8,'DIECIOCHO ',
9,'DIECINUEVE '),
2,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'VEINTE ','VEINTI'),
3,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'TREINTA ','TREINTA Y '),
4,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'CUARENTA ','CUARENTA Y '),
5,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'CINCUENTA ','CINCUENTA Y '),
6,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'SESENTA ','SESENTA Y '),
7,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'SETENTA ','SETENTA Y '),
8,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'OCHENTA ','OCHENTA Y '),
9,DECODE (SUBSTR(LPAD(imp_char,12,'0'),12), 0,'NOVENTA ','NOVENTA Y '),
0,'')

||
--Unidades.
DECODE (SUBSTR(LPAD(imp_char,12,'0'),12,1),
1,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','UN '),
2,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','DOS '),
3,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','TRES '),
4,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','CUATRO '),
5,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','CINCO '),
6,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','SEIS '),
7,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','SIETE '),
8,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','OCHO '),
9,DECODE(SUBSTR(LPAD(imp_char,12,'0'),11,1),1,'','NUEVE '),
0,DECODE(SUBSTR(LPAD(imp_char,12,'0'),1,12),'000000000000','CERO ','') )
||
DECODE(LPAD(impd_char,2,'0'),'00','','CON ')||
--Decimales
--Decenas.
DECODE (SUBSTR(LPAD(impd_char,2,'0'),1,1),
0,DECODE(SUBSTR(LPAD(impd_char,2,'0'),2),
1,'UNO ',
2,'DOS ',
3,'TRES ',
4,'CUATRO ',
5,'CINCO ',
6,'SEIS ',
7,'SIETE ',
8,'OCHO ',
9,'NUEVE '),
1,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2),
0,'DIEZ ',
1,'ONCE ',
2,'DOCE ',
3,'TRECE ',
4,'CATORCE ',
5,'QUINCE ',
6,'DICISEIS ',
7,'DIECISIETE ',
8,'DIECIOCHO ',
9,'DIECINUEVE '),
2,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'VEINTE ','VEINTI'),
3,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'TREINTA ','TREINTA Y '),
4,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'CUARENTA ','CUARENTA Y '),
5,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'CINCUENTA ','CINCUENTA Y '),
6,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'SESENTA ','SESENTA Y '),
7,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'SETENTA ','SETENTA Y '),
8,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'OCHENTA ','OCHENTA Y '),
9,DECODE (SUBSTR(LPAD(impd_char,2,'0'),2), 0,'NOVENTA ','NOVENTA Y '),
0,'')
||
--Unidades.
DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),0,'',
DECODE (SUBSTR(LPAD(impd_char,2,'0'),2,1),
1,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','UN '),
2,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','DOS '),
3,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','TRES '),
4,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','CUATRO '),
5,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','CINCO '),
6,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','SEIS '),
7,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','SIETE '),
8,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','OCHO '),
9,DECODE(SUBSTR(LPAD(impd_char,2,'0'),1,1),1,'','NUEVE ')))
INTO importe_let
FROM DUAL;

RETURN (importe_let);

END Numero_a_Texto;
/

CREATE FUNCTION "MCCAS2"."F_CONCATENA_DATOS"(P_TABLA VARCHAR2,P_DATO VARCHAR2, P_NIDPROCESOUSU NUMBER)
RETURN VARCHAR2
IS
V_SCONCATENA VARCHAR2(4000);
BEGIN
    IF P_TABLA = 'EXP' THEN
        FOR C IN (SELECT DISTINCT UPPER(TRIM(SENTIDAD)) DATO FROM TR_EXPERIENCIA WHERE NIDPROCESOUSU = P_NIDPROCESOUSU) LOOP
            V_SCONCATENA := V_SCONCATENA || ', ' || C.DATO;
        END LOOP;
        V_SCONCATENA := SUBSTR(V_SCONCATENA,3);
    ELSIF P_TABLA = 'OFI' THEN 
        /*SELECT DECODE(A.MARESIGLA,DECODE(D.IDDEPCODIGO,'04','SG','01','SG','02','DVMI','03','DVMPCIC'),'',DECODE(D.IDDEPCODIGO,'04','SG','01','SG','02','DVMI','03','DVMPCIC') || ' - ')
         || DECODE(A.MARESIGLA,O.MOFISIGLA, A.MARESIGLA,DECODE(SUBSTR(A.MARESIGLA,1,3),'DDC', O.MOFISIGLA, A.MARESIGLA  || DECODE(O.MOFISIGLA,NULL,'',' - ' || O.MOFISIGLA))) INTO V_SCONCATENA
        FROM ADMINMC.S_OFICINAS O 
        LEFT JOIN ADMINMC.AREAS A ON A.IDARECODIGO = O.IDARECODIGO 
        LEFT JOIN ADMINMC.DEPENDENCIAS D ON D.IDDEPCODIGO = A.IDDEPCODIGO
        WHERE O.IDOFICODIGO = P_DATO;*/
        V_SCONCATENA := 'oficina- siglas';
    ELSIF P_TABLA = 'FUN' THEN
        FOR C IN  ( SELECT  SDESCRIPCION
                    FROM TR_PROCESO_BASES A 
                    WHERE A.NIDPROCESO =P_NIDPROCESOUSU  AND A.BACTIVO = 1 AND A.NIDTIPO_BASE  = 5
                    ORDER BY A.NPRIORIDAD ) LOOP
            V_SCONCATENA := V_SCONCATENA || c.SDESCRIPCION|| ' - ';
        END LOOP;
    END IF;
    RETURN V_SCONCATENA;
EXCEPTION WHEN OTHERS THEN
    RETURN P_NIDPROCESOUSU ;
END;
/

CREATE FUNCTION "MCCAS2"."F_GET_DATO"(P_TABLA VARCHAR2,P_CODIGO1 NUMBER,P_CODIGO2 NUMBER,P_TIPODATO VARCHAR2)
RETURN VARCHAR2
IS
V_DATO VARCHAR2(4000);
V_ANTERIOR VARCHAR2(400):='NN';
BEGIN
    CASE P_TABLA
    WHEN 'EV' THEN
       select evaluador INTO V_DATO
       from (  SELECT INITCAP(PE.SNOMBRE || ' ' || PE.SPATERNO || ' ' || PE.SMATERNO) evaluador 
        FROM TR_PROCESOCOMITE PC INNER JOIN TM_GENPERSONA PE ON PC.NIDPERSONAL=PE.NCODIGOPERSONA
        WHERE PC.BACTIVO=1 AND PC.NIDPROCESO=P_CODIGO1 AND PC.NTIPO_EVALUADOR = P_CODIGO2 AND (DECODE(P_TIPODATO,3,NRENTREVISTA,2,NREVALTEC,1, NREVALCUR) = 1)
        order by (nvl(PC.NPRINCIPAL,0) + nvl(pc.nreemplazo,0 )) DESC) where rownum <=1;
    WHEN 'TGC' THEN
        SELECT SDITEM INTO V_DATO
        FROM TM_TABLA_GENERAL_D
        WHERE NIDTABLA = P_CODIGO1 AND NIDITEM = P_CODIGO2;
    WHEN 'TGS' THEN
        SELECT SDITEM INTO V_DATO
        FROM TM_TABLA_GENERAL_D
        WHERE NIDTABLA = P_CODIGO1 AND SSITEM = P_TIPODATO;
    WHEN 'CRS' THEN
        SELECT SDESCRIPCION INTO V_DATO
        FROM TR_PROCESO_BASES
        WHERE NIDREGISTRO = P_CODIGO1;
    WHEN 'OFI' THEN
       /* SELECT UPPER(MOFIDESCRI) INTO V_DATO
        FROM ADMINMC.S_OFICINAS
        WHERE IDOFICODIGO = P_TIPODATO and decode(P_CODIGO1,1,'001',iduejecod) = iduejecod;*/
        select 'DATO OFICINA' INTO V_DATO
        FROM DUAL;
    WHEN 'CVO' THEN
        SELECT UPPER(DCONVOCATORIA) INTO V_DATO
        FROM TM_CONVOCATORIA
        WHERE NIDCONVOCATORIA = P_CODIGO1;
    WHEN 'ACV' THEN
        FOR C IN (SELECT F_GET_DATO('TGC',20,NIDINSTITUCION,NULL) INS, DCARRERA, NCICLO,F_GET_DATO('TGC',2,NGRADO_ACADEMICO,NULL) GRADO
                    FROM TR_DATOSACADEMICOS WHERE NIDPROCESOUSU = P_CODIGO1
        )LOOP
            CASE P_TIPODATO
            WHEN 'INS' THEN
                IF V_ANTERIOR <> C.INS THEN
                    V_ANTERIOR := C.INS;
                    V_DATO := V_DATO || ' - ' || C.INS;
                END IF;
            WHEN 'CAR' THEN
                V_DATO := V_DATO || ' - ' || UPPER(C.DCARRERA);
            WHEN 'GRA' THEN
                V_DATO := V_DATO || ' - ' || C.GRADO;
            WHEN 'CIL' THEN
                V_DATO := V_DATO || CASE WHEN NVL(C.NCICLO,0)>0 THEN ' - ' || C.NCICLO ELSE '' END;
            END CASE;
        END LOOP;
        V_DATO := SUBSTR(V_DATO,4);
    END CASE;
    RETURN V_DATO;
EXCEPTION WHEN OTHERS THEN
    RETURN NULL;
END;
/

CREATE FUNCTION "MCCAS2"."F_GETCALIFICACION"(P_NIDPROCESOUSU varchar2, P_NTIPO_EVAL number)
RETURN number
is
V_CALIFICACION NUMBER;
begin 
    select NVL(max(NCALIFICACION),0) INTO V_CALIFICACION
    FROM (
        SELECT NCALIFICACION 
        FROM TR_PROCESOUSUARIO_EVAL WHERE NIDPROCESOUSU = P_NIDPROCESOUSU AND NTIPO_EVAL = P_NTIPO_EVAL
        ORDER BY NCALIFICACION) WHERE ROWNUM <=2;
    RETURN V_CALIFICACION;
end;
/

-- Create views section -------------------------------------------------

CREATE VIEW "MCCAS2"."VW_DISTRITOS"("NDISTRITO","SDISTRITO","NPROVINCIA","SPROVINCIA","NDEPARTAMENTO","SDEPARTAMENTO","COMPLETO","SCODIGOPOSTAL") AS
SELECT SUBSTR (A.SCODIGOUBIGEO, 0, 6) NDISTRITO,
            A.SNOMBRE SDISTRITO,
            SUBSTR (A.SCODIGOUBIGEO, 0, 4) || '00' NPROVINCIA,
            B.SNOMBRE SPROVINCIA,
            SUBSTR (A.SCODIGOUBIGEO, 0, 2) || '0000' NDEPARTAMENTO,
            C.SNOMBRE SDEPARTAMENTO,
            C.SNOMBRE || ' - ' || B.SNOMBRE || ' - ' || A.SNOMBRE COMPLETO,
            A.SCODIGOPOSTAL
       FROM TM_GENUBIGEO A
            INNER JOIN TM_GENUBIGEO B
               ON B.SCODIGOUBIGEO = SUBSTR (A.SCODIGOUBIGEO, 0, 4) || '00'
            INNER JOIN TM_GENUBIGEO C
               ON C.SCODIGOUBIGEO = SUBSTR (B.SCODIGOUBIGEO, 0, 2) || '0000'
      WHERE     A.BACTIVO = 1
            AND A.SCODIGOUBIGEO <> SUBSTR (A.SCODIGOUBIGEO, 0, 4) || '00'
   ORDER BY A.SCODIGOUBIGEO
/

-- Create packages section -------------------------------------------------

CREATE PACKAGE "MCCAS2"."PKG_CAS_DML"
AS

TYPE RESULTADO_CURSOR IS REF CURSOR;

PROCEDURE SP_GUARDAR_DATOSPERS (P_NIDCODIGOUSUARIO IN OUT TR_DATOSPERSONALES.NIDCODIGOUSUARIO%TYPE,
                                  P_SAPATERNO IN TR_DATOSPERSONALES.SAPATERNO%TYPE,
                                  P_SAMATERNO IN TR_DATOSPERSONALES.SAMATERNO%TYPE,
                                  P_SNOMBRES IN TR_DATOSPERSONALES.SNOMBRES%TYPE,
                                  P_NEDAD IN TR_DATOSPERSONALES.NEDAD%TYPE,
                                  P_NIDESTADOCIVIL IN TR_DATOSPERSONALES.NIDESTADOCIVIL%TYPE,
                                  P_SUBIGEONAC IN  TR_DATOSPERSONALES.SUBIGEONAC%TYPE,
                                  P_DFECHANAC IN  TR_DATOSPERSONALES.DFECHANAC%TYPE,
                                  P_SSEXO IN  TR_DATOSPERSONALES.SSEXO%TYPE,
                                  P_SDNI IN TR_DATOSPERSONALES.SDNI%TYPE,
                                  P_SRUC IN  TR_DATOSPERSONALES.SRUC%TYPE,
                                  P_SBREVETE IN  TR_DATOSPERSONALES.SBREVETE%TYPE,
                                  P_SCATBREVETE IN  TR_DATOSPERSONALES.SCATBREVETE%TYPE,
                                  P_SDIRECCION IN  TR_DATOSPERSONALES.SDIRECCION%TYPE,
                                  P_SUBIGEODIR IN  TR_DATOSPERSONALES.SUBIGEODIR%TYPE,
                                  P_SNROLOTE IN TR_DATOSPERSONALES.SNROLOTE%TYPE,
                                  P_STELEFONOFIJO IN TR_DATOSPERSONALES.STELEFONOFIJO%TYPE,
                                  P_SCELULAR IN TR_DATOSPERSONALES.SCELULAR%TYPE,
                                  P_SCORREO IN TR_DATOSPERSONALES.SCORREO%TYPE,
                                  P_NUSUARIO IN TR_DATOSPERSONALES.NIDUSUCREACION%TYPE,
                                  P_SRUTADOC IN TR_DATOSPERSONALES.SRUTADOC%TYPE,
                                  P_NTIPODOC IN TR_DATOSPERSONALES.NTIPODOC%TYPE,
                                  P_SNOMBRE_C IN TR_DATOSPERSONALES.SNOMBRE_C%TYPE,
                                  P_TELEFONO IN TR_DATOSPERSONALES.STELEFONO%TYPE,
                                  P_SPARENTESCO IN TR_DATOSPERSONALES.SPARENTESCO%TYPE,
                                  P_SRUTADOC_NAC IN TR_DATOSPERSONALES.SRUTADOC_NAC%TYPE,
                                  P_SPAIS_NAC IN TR_DATOSPERSONALES.SPAIS_NAC%TYPE) ;

  PROCEDURE SP_GUARDAR_PROCESOUSU (P_NIDPROCESOUSU IN OUT TR_PROCESOUSUARIO.NIDPROCESOUSU%TYPE,
                                   P_NIDPROCESO IN TR_PROCESOUSUARIO.NIDPROCESO%TYPE,
                                   P_NIDCODIGOUSUARIO IN TR_PROCESOUSUARIO.NIDCODIGOUSUARIO%TYPE,
                                   P_BACTIVO  IN TR_PROCESOUSUARIO.BACTIVO%TYPE,
                                   P_NUSUARIO IN TR_PROCESOUSUARIO.NIDUSUCREACION%TYPE,
                                   P_SMENSAJE OUT VARCHAR2,
                                   P_NACTIVIDAD IN TR_PROCESOUSUARIO.NACTIVIDAD%TYPE);

   PROCEDURE SP_GUARDAR_FORMACIONAC (P_NIDFACADEMICA IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_NIDTIPOFORMACION IN NUMBER,
                                    P_SINSTITUCION IN VARCHAR2,
                                    P_NIDGRADOACADEMICO IN NUMBER,
                                    P_SPROFESION IN VARCHAR2,
                                    P_NANIOSESTUDIO IN NUMBER,
                                    P_SFOLIO IN VARCHAR2,
                                    P_BACTIVO IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2,
                                    P_DFECHA_DESDE IN DATE,
                                    P_DFECHA_HASTA IN DATE,
                                    P_COD_INSTITUCION IN NUMBER, 
                                    P_COD_CARRERA IN VARCHAR2);

 PROCEDURE SP_GUARDAR_COLEGIATURA (P_NIDCOLEGIATURA  IN OUT NUMBER,
                                    P_NIDPROCESOUSU  IN NUMBER,
                                    P_SCOLEGIO IN VARCHAR2,
                                    P_SNROCOLEGIATURA IN VARCHAR2,
                                    P_BCONDICION  IN NUMBER,
                                    P_SFOLIO IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2);

 PROCEDURE SP_GUARDAR_CAPACITACION (P_NIDCAPACITACION IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_DFECHA_DESDE IN DATE,
                                    P_DFECHA_HASTA IN DATE,
                                    P_SCURSO IN VARCHAR2,
                                    P_SINTITUCION IN VARCHAR2,
                                    P_NHORAS IN NUMBER,
                                    P_SFOLIO IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2);

 PROCEDURE SP_GUARDAR_CONOCIMIENTO (P_NIDCONOCIMIENTO IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_SDESCRIPCION IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_NIDTIPO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2,
                                    P_NCONOCIMIENTO_B IN NUMBER);

 PROCEDURE SP_GUARDAR_CONOCIMIENTOINF (P_NIDCONOCIMIENTOINF IN OUT NUMBER,
                                        P_NIDPROCESOUSU IN NUMBER,
                                        P_SCONOCIMIENTO VARCHAR2,
                                        P_BTIPO  VARCHAR2,
                                        P_SFOLIO  VARCHAR2,
                                        P_BACTIVO  IN NUMBER,
                                        P_NUSUARIO IN NUMBER,
                                        P_SRUTADOC IN VARCHAR2);

 PROCEDURE SP_GUARDAR_IDIOMA (P_NIDIDIOMA IN OUT NUMBER,
                              P_NIDPROCESOUSU IN NUMBER,
                              P_SIDIOMA VARCHAR2,
                              P_BTIPO  VARCHAR2,
                              P_SFOLIO  VARCHAR2,
                              P_BACTIVO  IN NUMBER,
                              P_NUSUARIO IN NUMBER,
                              P_SRUTADOC IN VARCHAR2) ;

 PROCEDURE SP_GUARDAR_EXPERIENCIA (P_NIDEXPERIENCIA IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_SENTIDAD IN VARCHAR2,
                                    P_SAREA  IN VARCHAR2,
                                    P_SCARGO  IN VARCHAR2,
                                    P_SFUNCIONES IN  VARCHAR2,
                                    P_SMODALIDAD  IN VARCHAR2,
                                    P_SMOTIVORETIRO IN  VARCHAR2,
                                    P_SNOMBRECARGOJEFE IN  VARCHAR2,
                                    P_NREMUNERACION IN NUMBER,
                                    P_STELEFONO IN  VARCHAR2,
                                    P_SFOLIO IN  VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2,
                                    P_BESPECIFICA IN NUMBER,
                                    P_BSECTOR IN NUMBER,
                                    P_DFECHA_DESDE IN DATE,
                                    P_DFECHA_HASTA IN DATE,
                                    P_NPRESENTACIONES IN NUMBER)  ;

 PROCEDURE SP_GUARDAR_DATOSADIC (P_NIDDATOSADIC IN OUT NUMBER,
                                  P_NIDPROCESOUSU IN NUMBER,
                                  P_BFAMILIADIRECTA IN NUMBER,
                                  P_SFAMILIADIRECTA IN VARCHAR2,
                                  P_BDISCAPACIDAD IN NUMBER,
                                  P_STIPO IN VARCHAR2,
                                  P_SFOLIO IN VARCHAR2,
                                  P_BDEUDOR IN NUMBER,
                                  P_BANTECEDENTES IN NUMBER,
                                  P_SANTECEDENTES IN VARCHAR2,
                                  P_BFUERZAARMADA IN NUMBER,
                                  P_BACTIVO  IN NUMBER,
                                  P_NUSUARIO IN NUMBER,
                                  P_BTERM_COND IN NUMBER,
                                  P_SRUTADOC_DIS IN VARCHAR2,
                                  P_SRUTADOC_LFA IN VARCHAR2,
                                  P_BINHAB_ESTADO IN NUMBER,
                                  P_BINCOMP_ESTADO IN NUMBER,
                                  P_BPENSIONISTA IN NUMBER,
                                  P_BTIPO_PENSION IN NUMBER,
                                  P_BPENSION_SUSP IN NUMBER,
                                  P_BPARENTESCO IN NUMBER,
                                  P_SRUTADOC_OCI IN VARCHAR2,
                                  P_SRUTADOC_A3B IN VARCHAR2,
                                  P_BDEPORTISTA IN NUMBER,
                                  P_SRUTADOC_DEP IN VARCHAR2);

 PROCEDURE SP_GUARDAR_PROCESOCOMITE (P_NIDCOMITE IN OUT NUMBER,
                                     P_NIDPROCESO IN NUMBER,
                                     P_NIDPERSONAL IN NUMBER,
                                     P_BACTIVO  IN NUMBER,
                                     P_NUSUARIO IN NUMBER,
                                     P_NTIPO_EVALUADOR IN NUMBER,
                                     P_ALL_CONV IN NUMBER,
                                     P_SMENSAJE OUT VARCHAR2,
                                     P_NPRINCIPAL IN NUMBER,
                                     P_NREVALCUR IN NUMBER,
                                     P_NREVALTEC IN NUMBER,
                                     P_NRENTREVISTA IN NUMBER,
                                     P_DSUSTENTOR IN VARCHAR2,
                                     P_NREEMPLAZO IN NUMBER,
                                     P_NIDACTIVIDAD IN NUMBER);

 PROCEDURE SP_GUARDAR_PROCESO (P_BESTADO IN TR_PROCESO.BESTADO%TYPE,
                                P_NEXP_GEN IN TR_PROCESO.NEXP_GEN%TYPE,
                                P_NEXP_ESP IN TR_PROCESO.NEXP_ESP%TYPE,
                                P_NCOLEG_OBLIG IN TR_PROCESO.NCOLEG_OBLIG%TYPE,
                                P_SSERVICIO IN TR_PROCESO.SSERVICIO%TYPE,
                                P_SPROCESO IN TR_PROCESO.SPROCESO%TYPE,
                                P_NPROCESO IN TR_PROCESO.NPROCESO%TYPE,
                                P_BACTIVO IN TR_PROCESO.BACTIVO%TYPE,
                                P_NIDUSUARIO IN TR_PROCESO.NIDUSUCREACION%TYPE,
                                P_NIDPROCESO IN  TR_PROCESO.NIDPROCESO%TYPE,
                                P_NIDCONVOCATORIA IN TR_PROCESO.NIDCONVOCATORIA%TYPE,
                                P_SIDSFORMACIONACAD IN TR_PROCESO.SIDSFORMACIONACAD%TYPE,
                                P_SIDSGRADOSACAD IN TR_PROCESO.SIDSGRADOSACAD%TYPE,
                                P_NELENCO IN TR_PROCESO.NELENCO%TYPE,
                                P_NPLAZAS IN TR_PROCESO.NPLAZAS%TYPE,
                                P_DPUESTO IN TR_PROCESO.DPUESTO%TYPE,
                                P_DOBJETO IN TR_PROCESO.DOBJETO%TYPE, 
                                P_DLUGAR IN TR_PROCESO.DLUGAR%TYPE, 
                                P_SDURACION IN TR_PROCESO.SDURACION%TYPE, 
                                P_NSUELDO IN TR_PROCESO.NSUELDO%TYPE, 
                                P_IDOFICODIGO IN TR_PROCESO.IDOFICODIGO%TYPE, 
                                P_MENSAJE OUT VARCHAR2,
                                P_NOBLIG_BREVETE IN TR_PROCESO.NOBLIG_BREVETE%TYPE,
                                P_ncolegHab_oblig IN TR_PROCESO.ncolegHab_oblig%TYPE,
                                P_nrna_oblig IN TR_PROCESO.nrna_oblig%TYPE,
                                P_NRESULTADO IN TR_PROCESO.NRESULTADO%TYPE,
                                P_NOBLIG_DJ IN TR_PROCESO.NOBLIG_DJ%TYPE,
                                P_NOCI IN TR_PROCESO.NOCI%TYPE,
                                P_NMESES IN TR_PROCESO.NMESES%TYPE,
                                P_IDFTECODIGO IN TR_PROCESO.IDFTECODIGO%TYPE,
                                P_AIRHSP IN TR_PROCESO.SPLAZA_AIRHSP%TYPE,
                                P_SIAF IN TR_PROCESO.SIAF%TYPE,
                                P_IDSERCASCODIGO IN TR_PROCESO.IDSERCASCODIGO%TYPE,
                                P_NTIPOBASE IN TR_PROCESO.NTIPOBASE%TYPE) ;
 PROCEDURE SP_GUARDAR_PUNTAJE (P_NIDPROCESOUSU IN NUMBER,
                             P_NIDPERSONAL IN NUMBER,
                             P_NTIPO_EVAL IN NUMBER, --2:PUNTAJE, 3:EVAL_CUR, 4:EVAL_TECNICA
                             P_NCALIFICACION IN NUMBER,
                             P_NASISTENCIA IN NUMBER,
                             P_NTIPO_EVALUADOR IN NUMBER,
                             P_SMENSAJE OUT VARCHAR2);
 PROCEDURE SP_ENVIAR_FICHA (P_NIDPROCESOUSU IN NUMBER,
                             P_NUSUARIO IN NUMBER,
                             P_SMENSAJE OUT VARCHAR2);
 FUNCTION F_CALCULA_EXPERIENCIA(P_DFECHAINI DATE,
                                P_DFECHAFIN DATE,
                                P_SDATO VARCHAR2) RETURN VARCHAR2;
 PROCEDURE SP_CARGA_CV(P_NIDPROCESOUSU IN NUMBER,
                     P_NUSUARIO IN NUMBER,
                     P_SMENSAJE OUT VARCHAR2);
 FUNCTION F_CALCULA_EXP_ACUM(P_NIDPROCESOUSU IN NUMBER,
                                P_STIPO IN VARCHAR2,
                                P_SDATO IN VARCHAR2) RETURN VARCHAR2;
 PROCEDURE SP_GUARDAR_RNA (P_NIDRNA IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_SCODIGO_INS IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_DFECHA_REG IN DATE);
PROCEDURE SP_GUARDAR_TGD (P_NIDITEM IN OUT NUMBER,
                                    P_NIDTABLA IN NUMBER,
                                    P_SDITEM IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SSITEM IN VARCHAR2,
                                    P_SFECHA1 IN VARCHAR2,
                                    P_SFECHA2 IN VARCHAR2);
PROCEDURE SP_GUARDAR_ESTADO_EVAL(P_NIDCONVOCATORIA NUMBER,
                                    P_NIDESTADO NUMBER,
                                    P_NIDUSU NUMBER,
                                    P_SOBSERVACION VARCHAR2,
                                    P_TIPO_EST NUMBER, -- 1 INI, 2 FIN
                                    P_RESULTADO OUT VARCHAR)   ;
PROCEDURE SP_PROCESAR_GANADORES(P_NIDCONVOCATORIA NUMBER,
                                    P_SOBSERVACION VARCHAR2,
                                    P_NIDPROCESO NUMBER,
                                    P_NUSUARIO NUMBER,
                                    P_RESULTADO OUT VARCHAR);
PROCEDURE SP_HABILITAR_CALIFICAR(P_NIDCOMITE NUMBER,
                                    P_NIDUSU NUMBER,
                                    P_RESULTADO OUT VARCHAR);
PROCEDURE SP_GUARDAR_BASES( P_NIDREGISTRO IN OUT NUMBER, 
                            P_TIPO_TABLA IN NUMBER, 
                            P_NIDPROCESO IN NUMBER,
                            P_NIDTIPO IN NUMBER,
                            P_SDESCRIPCION IN VARCHAR2,
                            P_BACTIVO  IN NUMBER,
                            P_NPRIORIDAD  IN NUMBER,
                            P_NUSUARIO IN NUMBER,
                            P_SFECHA1 IN VARCHAR2,
                            P_SFECHA2 IN VARCHAR2);
PROCEDURE SP_DESCALIFICAR_POSTULANTE(P_NIDPROCESOUSU NUMBER,
                                    P_NIDUSU VARCHAR2,
                                    P_RESULTADO OUT VARCHAR);
PROCEDURE SP_CARGAR_CRONOGRAMA(P_NIDCONVOCATORIA NUMBER,
                                    P_NIDPROCESO NUMBER,
                                    P_NUSUARIO NUMBER,
                                    P_RESULTADO OUT VARCHAR);    
PROCEDURE SP_GUARDAR_CONTRATO (P_NRO_CONTRATO IN OUT NUMBER,
                                P_NIDPROCESOUSU NUMBER,
                                P_NOMBRE_ANIO VARCHAR2, 
                                P_SEXO_DIR CHAR,
                                P_NOMBRE_DIR VARCHAR2,
                                P_DNI_DIR VARCHAR2,
                                P_DRESOLUCION VARCHAR2,
                                P_FECHA_RESOL VARCHAR2,
                                P_NOMBRE_TRAB VARCHAR2,
                                P_DNI_TRAB VARCHAR2,
                                P_RUC_TRAB VARCHAR2,
                                P_SERVICIO VARCHAR2,
                                P_FINI_CONTRATO VARCHAR2,
                                P_FFIN_CONTRATO VARCHAR2,
                                P_NSUELDO NUMBER,
                                P_DSUELDO VARCHAR2,
                                P_OFICINA VARCHAR2,
                                P_NRO_CONVOCATORIA VARCHAR2,
                                P_FECHA_SUSCRIPCION VARCHAR2,
                                P_USUARIO NUMBER,
                                    P_RESULTADO OUT VARCHAR2,
                                    P_DIRECCION VARCHAR2);    
PROCEDURE SP_PROCESAR_FIRMA(P_NIDPROCESOUSU NUMBER,
                                    P_NFIRMA VARCHAR2,
                                    P_DFECHAFIRMA VARCHAR2,
                                    P_DFECHAGANADOR VARCHAR2,
                                    P_NIDUSU VARCHAR2,
                                    P_RESULTADO OUT VARCHAR);                            
END PKG_CAS_DML;
/
CREATE PACKAGE BODY "MCCAS2"."PKG_CAS_DML"
AS

 PROCEDURE SP_GUARDAR_DATOSPERS (P_NIDCODIGOUSUARIO IN OUT TR_DATOSPERSONALES.NIDCODIGOUSUARIO%TYPE,
                                  P_SAPATERNO IN TR_DATOSPERSONALES.SAPATERNO%TYPE,
                                  P_SAMATERNO IN TR_DATOSPERSONALES.SAMATERNO%TYPE,
                                  P_SNOMBRES IN TR_DATOSPERSONALES.SNOMBRES%TYPE,
                                  P_NEDAD IN TR_DATOSPERSONALES.NEDAD%TYPE,
                                  P_NIDESTADOCIVIL IN TR_DATOSPERSONALES.NIDESTADOCIVIL%TYPE,
                                  P_SUBIGEONAC IN  TR_DATOSPERSONALES.SUBIGEONAC%TYPE,
                                  P_DFECHANAC IN  TR_DATOSPERSONALES.DFECHANAC%TYPE,
                                  P_SSEXO IN  TR_DATOSPERSONALES.SSEXO%TYPE,
                                  P_SDNI IN TR_DATOSPERSONALES.SDNI%TYPE,
                                  P_SRUC IN  TR_DATOSPERSONALES.SRUC%TYPE,
                                  P_SBREVETE IN  TR_DATOSPERSONALES.SBREVETE%TYPE,
                                  P_SCATBREVETE IN  TR_DATOSPERSONALES.SCATBREVETE%TYPE,
                                  P_SDIRECCION IN  TR_DATOSPERSONALES.SDIRECCION%TYPE,
                                  P_SUBIGEODIR IN  TR_DATOSPERSONALES.SUBIGEODIR%TYPE,
                                  P_SNROLOTE IN TR_DATOSPERSONALES.SNROLOTE%TYPE,
                                  P_STELEFONOFIJO IN TR_DATOSPERSONALES.STELEFONOFIJO%TYPE,
                                  P_SCELULAR IN TR_DATOSPERSONALES.SCELULAR%TYPE,
                                  P_SCORREO IN TR_DATOSPERSONALES.SCORREO%TYPE,
                                  P_NUSUARIO IN TR_DATOSPERSONALES.NIDUSUCREACION%TYPE,
                                  P_SRUTADOC IN TR_DATOSPERSONALES.SRUTADOC%TYPE,
                                  P_NTIPODOC IN TR_DATOSPERSONALES.NTIPODOC%TYPE,
                                  P_SNOMBRE_C IN TR_DATOSPERSONALES.SNOMBRE_C%TYPE,
                                  P_TELEFONO IN TR_DATOSPERSONALES.STELEFONO%TYPE,
                                  P_SPARENTESCO IN TR_DATOSPERSONALES.SPARENTESCO%TYPE,
                                  P_SRUTADOC_NAC IN TR_DATOSPERSONALES.SRUTADOC_NAC%TYPE,
                                  P_SPAIS_NAC IN TR_DATOSPERSONALES.SPAIS_NAC%TYPE) AS

  V_FECHA DATE;
  V_CONT NUMBER;
  V_EDAD NUMBER;
  BEGIN
  V_FECHA:=SYSDATE;
  V_CONT:=0;

  SELECT COUNT(NIDCODIGOUSUARIO)
  INTO V_CONT
  FROM TR_DATOSPERSONALES
  WHERE NIDCODIGOUSUARIO = P_NIDCODIGOUSUARIO;
    IF P_DFECHANAC IS NOT NULL THEN
        V_EDAD := TRUNC((TRUNC(SYSDATE) - P_DFECHANAC)/365);
    END IF;
  IF  V_CONT = 0 THEN
    --SELECT NVL(MAX(DG.NIDCODIGOUSUARIO),0)+1 INTO P_NIDCODIGOUSUARIO FROM TR_DATOSPERSONALES DG;

    INSERT INTO TR_DATOSPERSONALES (NIDCODIGOUSUARIO,SAPATERNO,SAMATERNO,SNOMBRES,NEDAD,NIDESTADOCIVIL,SUBIGEONAC,DFECHANAC,SSEXO,
                                          SDNI,SRUC,SBREVETE,SCATBREVETE,SDIRECCION,SUBIGEODIR,SNROLOTE,STELEFONOFIJO,SCELULAR,SCORREO,
                                          BACTIVO,NIDUSUCREACION,DFECHACREACION, SRUTADOC,NTIPODOC,SNOMBRE_C,STELEFONO,SPARENTESCO,SRUTADOC_NAC,SPAIS_NAC )
                                   VALUES (P_NIDCODIGOUSUARIO,upper(P_SAPATERNO),upper(P_SAMATERNO),upper(P_SNOMBRES),V_EDAD,DECODE(P_NIDESTADOCIVIL,0,'',P_NIDESTADOCIVIL),P_SUBIGEONAC,P_DFECHANAC,P_SSEXO,
                                          SUBSTR(P_SDNI, 1, 8),SUBSTR(P_SRUC, 1, 11),SUBSTR(P_SBREVETE, 1, 11),SUBSTR(P_SCATBREVETE, 1, 30),upper(P_SDIRECCION),P_SUBIGEODIR,P_SNROLOTE,P_STELEFONOFIJO,P_SCELULAR,upper(P_SCORREO),
                                          1,P_NUSUARIO,V_FECHA, P_SRUTADOC,P_NTIPODOC,upper(P_SNOMBRE_C),P_TELEFONO,upper(P_SPARENTESCO),P_SRUTADOC_NAC,upper(P_SPAIS_NAC));
  ELSE
    UPDATE TR_DATOSPERSONALES SET SAPATERNO  =upper(P_SAPATERNO),
                                          SAMATERNO  =upper(P_SAMATERNO),
                                          SNOMBRES  =upper(P_SNOMBRES),
                                          NEDAD  =V_EDAD,
                                          NIDESTADOCIVIL  =DECODE(P_NIDESTADOCIVIL,0,'',P_NIDESTADOCIVIL),
                                          SUBIGEONAC  =P_SUBIGEONAC,
                                          DFECHANAC  =P_DFECHANAC,
                                          SSEXO  =P_SSEXO,
                                          SDNI  =P_SDNI,
                                          SRUC  =P_SRUC,
                                          SBREVETE  =P_SBREVETE,
                                          SCATBREVETE  =P_SCATBREVETE,
                                          SDIRECCION  =upper(P_SDIRECCION),
                                          SUBIGEODIR  =P_SUBIGEODIR,
                                          SNROLOTE  =P_SNROLOTE,
                                          STELEFONOFIJO  =P_STELEFONOFIJO,
                                          SCELULAR  =P_SCELULAR,
                                          SCORREO  =upper(P_SCORREO),
                                          NIDUSUEDICION  =P_NUSUARIO,
                                          DFECHAEDICION  =V_FECHA,
                                          SRUTADOC = P_SRUTADOC,
                                          NTIPODOC = P_NTIPODOC,
                                          SNOMBRE_C = upper(P_SNOMBRE_C),
                                          STELEFONO = P_TELEFONO,
                                          SPARENTESCO = upper(P_SPARENTESCO),
                                          SRUTADOC_NAC = P_SRUTADOC_NAC,
                                          SPAIS_NAC = upper(P_SPAIS_NAC)
      WHERE NIDCODIGOUSUARIO = P_NIDCODIGOUSUARIO;
  END IF;

  END SP_GUARDAR_DATOSPERS;

 PROCEDURE SP_GUARDAR_PROCESOUSU (P_NIDPROCESOUSU IN OUT TR_PROCESOUSUARIO.NIDPROCESOUSU%TYPE,
                                   P_NIDPROCESO IN TR_PROCESOUSUARIO.NIDPROCESO%TYPE,
                                   P_NIDCODIGOUSUARIO IN TR_PROCESOUSUARIO.NIDCODIGOUSUARIO%TYPE,
                                   P_BACTIVO  IN TR_PROCESOUSUARIO.BACTIVO%TYPE,
                                   P_NUSUARIO IN TR_PROCESOUSUARIO.NIDUSUCREACION%TYPE,
                                   P_SMENSAJE OUT VARCHAR2,
                                   P_NACTIVIDAD IN TR_PROCESOUSUARIO.NACTIVIDAD%TYPE) AS

V_FECHA DATE;
V_ESTADO NUMBER;
V_COUNT NUMBER;
BEGIN
    V_FECHA:=SYSDATE;
    P_SMENSAJE :='OK';
    IF  P_NIDPROCESOUSU = 0 THEN
        BEGIN
            SELECT CASE WHEN SYSDATE < DFECHAINI THEN 'EL PROCESO COMENZARÁ A PARTIR DEL '||TO_CHAR(DFECHAINI,'DD/MM/YYYY HH24:MI')
            ELSE (CASE WHEN SYSDATE > DECODE(NVL(P_NACTIVIDAD,0),0,DFECHAFIN,DFECHAFIN + 2) THEN 'EL PROCESO SE CULMINÓ DESDE EL '||TO_CHAR(DFECHAFIN,'DD/MM/YYYY HH24:MI') ELSE 'OK' END) END
            INTO P_SMENSAJE
            FROM TR_PROCESO P
            INNER JOIN TM_CONVOCATORIA C ON P.NIDPROCESO = P_NIDPROCESO AND C.NTIPO = P.NTIPO AND P.NIDCONVOCATORIA = C.NIDCONVOCATORIA AND DFECHAINI IS NOT NULL AND DFECHAFIN IS NOT NULL ;
        EXCEPTION WHEN NO_DATA_FOUND THEN
            P_SMENSAJE := 'NO SE HAN REGISTRADO FECHAS DE INICIO Y FIN DE LA CONVOCATORIA';
        END;
        IF P_SMENSAJE <> 'OK' THEN
            RETURN;
        END IF;
        IF P_NACTIVIDAD > 0 THEN
            SELECT COUNT(1) ,MAX(DECODE(NACTIVIDAD,P_NACTIVIDAD,1,0)) INTO V_COUNT, P_NIDPROCESOUSU
            FROM TR_PROCESOUSUARIO P 
            WHERE P.BACTIVO = 1 AND NIDCODIGOUSUARIO = P_NIDCODIGOUSUARIO AND P.NIDPROCESO IN (SELECT PR.NIDPROCESO 
                                    FROM TR_PROCESO PR
                                    WHERE PR.NIDCONVOCATORIA = (SELECT C.NIDCONVOCATORIA 
                                                             FROM TR_PROCESO C
                                                             WHERE C.NIDPROCESO =P_NIDPROCESO)
                                           and 2 = PR.NTIPO);
            IF V_COUNT >= 2 THEN
                P_SMENSAJE := 'NO PUEDE POSTULAR A MÁS DE 2 PROCESOS EN LA MISMA CONVOCATORIA';
                RETURN;
            END IF;
            IF P_NIDPROCESOUSU = 1 THEN
                P_SMENSAJE := 'YA SE ENCUENTRA INSCRITO EN LA ACTIVIDAD SELECCIONADA';
                RETURN;
            END IF;
        END IF;
        SELECT NVL(MAX(PU.NIDPROCESOUSU),0)+1 INTO P_NIDPROCESOUSU FROM TR_PROCESOUSUARIO PU;

        INSERT INTO TR_PROCESOUSUARIO (NIDPROCESOUSU,NIDPROCESO,NIDCODIGOUSUARIO,BACTIVO,NIDUSUCREACION,DFECHACREACION,NACTIVIDAD)
                                     VALUES (P_NIDPROCESOUSU,P_NIDPROCESO,P_NIDCODIGOUSUARIO,1,P_NUSUARIO,V_FECHA,P_NACTIVIDAD);
    ELSIF P_BACTIVO=0 THEN
        SELECT BESTADO INTO V_ESTADO 
        FROM TR_PROCESOUSUARIO
        WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
        IF V_ESTADO = 1 THEN
          UPDATE TR_PROCESOUSUARIO 
          SET BACTIVO=0,
              NIDUSUEDICION=P_NUSUARIO,
              DFECHAEDICION=V_FECHA
          WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
        ELSE
          P_SMENSAJE := 'NO SE PUEDE ELIMINAR UNA FICHA ENVIADA.';
        END IF;
    END IF;
END SP_GUARDAR_PROCESOUSU;

 PROCEDURE SP_GUARDAR_FORMACIONAC (P_NIDFACADEMICA IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_NIDTIPOFORMACION IN NUMBER,
                                    P_SINSTITUCION IN VARCHAR2,
                                    P_NIDGRADOACADEMICO IN NUMBER,
                                    P_SPROFESION IN VARCHAR2,
                                    P_NANIOSESTUDIO IN NUMBER,
                                    P_SFOLIO IN VARCHAR2,
                                    P_BACTIVO IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2,
                                    P_DFECHA_DESDE IN DATE,
                                    P_DFECHA_HASTA IN DATE,
                                    P_COD_INSTITUCION IN NUMBER, 
                                    P_COD_CARRERA IN VARCHAR2) AS

  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDFACADEMICA = 0 THEN
    SELECT NVL(MAX(FA.NIDFACADEMICA),0)+1 INTO P_NIDFACADEMICA FROM TR_FORMACIONAC FA;

    INSERT INTO TR_FORMACIONAC  (NIDFACADEMICA,NIDPROCESOUSU,NIDTIPOFORMACION,SINSTITUCION,NIDGRADOACADEMICO,
                                       SPROFESION,NANIOSESTUDIO,SFOLIO,
                                       BACTIVO,NIDUSUCREACION,DFECHACREACION,SRUTADOC, DFECHA_DESDE, DFECHA_HASTA, COD_INSTITUCION, COD_CARRERA)
                               VALUES (P_NIDFACADEMICA,P_NIDPROCESOUSU,P_NIDTIPOFORMACION,upper(P_SINSTITUCION),P_NIDGRADOACADEMICO,
                                       upper(P_SPROFESION),P_NANIOSESTUDIO,P_SFOLIO,
                                       1,P_NUSUARIO,V_FECHA, P_SRUTADOC, P_DFECHA_DESDE, P_DFECHA_HASTA,P_COD_INSTITUCION, P_COD_CARRERA);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_FORMACIONAC SET BACTIVO=0,
                                      NIDUSUEDICION=P_NUSUARIO,
                                      DFECHAEDICION=V_FECHA
      WHERE NIDFACADEMICA = P_NIDFACADEMICA;
    ELSE
      UPDATE TR_FORMACIONAC SET NIDTIPOFORMACION=P_NIDTIPOFORMACION,
                                      SINSTITUCION=upper(P_SINSTITUCION),
                                      NIDGRADOACADEMICO=P_NIDGRADOACADEMICO,
                                      SPROFESION=upper(P_SPROFESION),
                                      NANIOSESTUDIO=P_NANIOSESTUDIO,
                                      SFOLIO=P_SFOLIO,
                                      NIDUSUEDICION=P_NUSUARIO,
                                      DFECHAEDICION=V_FECHA,
                                      SRUTADOC=P_SRUTADOC,
                                      DFECHA_DESDE = P_DFECHA_DESDE,
                                      DFECHA_HASTA = P_DFECHA_HASTA,
                                      COD_INSTITUCION = P_COD_INSTITUCION,
                                      COD_CARRERA = P_COD_CARRERA
      WHERE NIDFACADEMICA = P_NIDFACADEMICA;
    END IF;

  END IF;

  END SP_GUARDAR_FORMACIONAC;

 PROCEDURE SP_GUARDAR_COLEGIATURA (P_NIDCOLEGIATURA  IN OUT NUMBER,
                                    P_NIDPROCESOUSU  IN NUMBER,
                                    P_SCOLEGIO IN VARCHAR2,
                                    P_SNROCOLEGIATURA IN VARCHAR2,
                                    P_BCONDICION  IN NUMBER,
                                    P_SFOLIO IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2) AS

  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDCOLEGIATURA = 0 THEN
    SELECT NVL(MAX(CO.NIDCOLEGIATURA),0)+1 INTO P_NIDCOLEGIATURA FROM TR_COLEGIATURA CO;

    INSERT INTO TR_COLEGIATURA  (NIDCOLEGIATURA,NIDPROCESOUSU,SCOLEGIO,SNROCOLEGIATURA,BCONDICION,
                                       SFOLIO,BACTIVO,NIDUSUCREACION,DFECHACREACION, SRUTADOC)
                               VALUES (P_NIDCOLEGIATURA,P_NIDPROCESOUSU,P_SCOLEGIO,P_SNROCOLEGIATURA,P_BCONDICION,
                                       P_SFOLIO,1,P_NUSUARIO,V_FECHA, P_SRUTADOC);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_COLEGIATURA SET BACTIVO=0,
                                      NIDUSUEDICION=P_NUSUARIO,
                                      DFECHAEDICION=V_FECHA
      WHERE NIDCOLEGIATURA = P_NIDCOLEGIATURA;
    ELSE
      UPDATE TR_COLEGIATURA SET SCOLEGIO=P_SCOLEGIO,
                                      SNROCOLEGIATURA=P_SNROCOLEGIATURA,
                                      BCONDICION=P_BCONDICION,
                                      SFOLIO=P_SFOLIO,
                                      NIDUSUEDICION=P_NUSUARIO,
                                      DFECHAEDICION=V_FECHA,
                                      SRUTADOC=P_SRUTADOC
      WHERE NIDCOLEGIATURA = P_NIDCOLEGIATURA;
    END IF;
  END IF;

  END SP_GUARDAR_COLEGIATURA;

 PROCEDURE SP_GUARDAR_CAPACITACION (P_NIDCAPACITACION IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_DFECHA_DESDE IN DATE,
                                    P_DFECHA_HASTA IN DATE,
                                    P_SCURSO IN VARCHAR2,
                                    P_SINTITUCION IN VARCHAR2,
                                    P_NHORAS IN NUMBER,
                                    P_SFOLIO IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2) AS

  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDCAPACITACION = 0 THEN
    SELECT NVL(MAX(CA.NIDCAPACITACION),0)+1 INTO P_NIDCAPACITACION FROM TR_CAPACITACION CA;

    INSERT INTO TR_CAPACITACION  (NIDCAPACITACION,NIDPROCESOUSU,DFECHA_DESDE,DFECHA_HASTA,
                                        SCURSO,SINTITUCION,NHORAS,SFOLIO,BACTIVO,NIDUSUCREACION,DFECHACREACION,SRUTADOC)
                               VALUES (P_NIDCAPACITACION,P_NIDPROCESOUSU,P_DFECHA_DESDE,P_DFECHA_HASTA,
                                       upper(P_SCURSO),upper(P_SINTITUCION),P_NHORAS,P_SFOLIO,1,P_NUSUARIO,V_FECHA,P_SRUTADOC);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_CAPACITACION SET BACTIVO=0,
                                       NIDUSUEDICION=P_NUSUARIO,
                                       DFECHAEDICION=V_FECHA
      WHERE NIDCAPACITACION = P_NIDCAPACITACION;
    ELSE
      UPDATE TR_CAPACITACION SET DFECHA_DESDE=P_DFECHA_DESDE,
                                      DFECHA_HASTA=P_DFECHA_HASTA,
                                      SCURSO=upper(P_SCURSO),
                                      SINTITUCION=upper(P_SINTITUCION),
                                      NHORAS=P_NHORAS,
                                      SFOLIO=P_SFOLIO,
                                      NIDUSUEDICION=P_NUSUARIO,
                                      DFECHAEDICION=V_FECHA,
                                      SRUTADOC=P_SRUTADOC
      WHERE NIDCAPACITACION = P_NIDCAPACITACION;
    END IF;
  END IF;

END SP_GUARDAR_CAPACITACION;

 PROCEDURE SP_GUARDAR_CONOCIMIENTO (P_NIDCONOCIMIENTO IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_SDESCRIPCION IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_NIDTIPO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2,
                                    P_NCONOCIMIENTO_B IN NUMBER) AS

  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDCONOCIMIENTO = 0 THEN
    SELECT NVL(MAX(C.NIDCONOCIMIENTO),0)+1 INTO P_NIDCONOCIMIENTO FROM TR_CONOCIMIENTO C;

    INSERT INTO TR_CONOCIMIENTO  (NIDCONOCIMIENTO,NIDPROCESOUSU,SDESCRIPCION,BACTIVO,NIDUSUCREACION,DFECHACREACION, NIDTIPO,SRUTADOC,NCONOCIMIENTO_B)
                               VALUES (P_NIDCONOCIMIENTO,P_NIDPROCESOUSU,upper(P_SDESCRIPCION),1,P_NUSUARIO,V_FECHA, P_NIDTIPO,P_SRUTADOC,P_NCONOCIMIENTO_B);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_CONOCIMIENTO SET BACTIVO=0,
                                       NIDUSUEDICION=P_NUSUARIO,
                                       DFECHAEDICION=V_FECHA
      WHERE NIDCONOCIMIENTO = P_NIDCONOCIMIENTO;
    ELSE
      UPDATE TR_CONOCIMIENTO SET SDESCRIPCION=upper(P_SDESCRIPCION),
                                      NIDUSUEDICION=P_NUSUARIO,
                                      DFECHAEDICION=V_FECHA,
                                      NIDTIPO = P_NIDTIPO,
                                      SRUTADOC = P_SRUTADOC,
                                      NCONOCIMIENTO_B = P_NCONOCIMIENTO_B
      WHERE NIDCONOCIMIENTO = P_NIDCONOCIMIENTO;
    END IF;
  END IF;

END SP_GUARDAR_CONOCIMIENTO;

 PROCEDURE SP_GUARDAR_CONOCIMIENTOINF (P_NIDCONOCIMIENTOINF IN OUT NUMBER,
                                        P_NIDPROCESOUSU IN NUMBER,
                                        P_SCONOCIMIENTO VARCHAR2,
                                        P_BTIPO  VARCHAR2,
                                        P_SFOLIO  VARCHAR2,
                                        P_BACTIVO  IN NUMBER,
                                        P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2) AS

  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDCONOCIMIENTOINF = 0 THEN
    SELECT NVL(MAX(C.NIDCONOCIMIENTOINF),0)+1 INTO P_NIDCONOCIMIENTOINF FROM TR_CONOCIMIENTOINF C;

    INSERT INTO TR_CONOCIMIENTOINF  (NIDCONOCIMIENTOINF,NIDPROCESOUSU,SCONOCIMIENTO,BTIPO,SFOLIO,BACTIVO,NIDUSUCREACION,DFECHACREACION, SRUTADOC)
                               VALUES (P_NIDCONOCIMIENTOINF,P_NIDPROCESOUSU,upper(P_SCONOCIMIENTO),P_BTIPO,P_SFOLIO,1,P_NUSUARIO,V_FECHA,P_SRUTADOC);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_CONOCIMIENTOINF SET BACTIVO=0,
                                       NIDUSUEDICION=P_NUSUARIO,
                                       DFECHAEDICION=V_FECHA
      WHERE NIDCONOCIMIENTOINF = P_NIDCONOCIMIENTOINF;
    ELSE
      UPDATE TR_CONOCIMIENTOINF SET SCONOCIMIENTO=upper(P_SCONOCIMIENTO),
                                          BTIPO=P_BTIPO,
                                          SFOLIO=P_SFOLIO,
                                          NIDUSUEDICION=P_NUSUARIO,
                                          DFECHAEDICION=V_FECHA,
                                      SRUTADOC=P_SRUTADOC
      WHERE NIDCONOCIMIENTOINF = P_NIDCONOCIMIENTOINF;
    END IF;
  END IF;

END SP_GUARDAR_CONOCIMIENTOINF;

 PROCEDURE SP_GUARDAR_IDIOMA (P_NIDIDIOMA IN OUT NUMBER,
                              P_NIDPROCESOUSU IN NUMBER,
                              P_SIDIOMA VARCHAR2,
                              P_BTIPO  VARCHAR2,
                              P_SFOLIO  VARCHAR2,
                              P_BACTIVO  IN NUMBER,
                              P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2) AS

  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDIDIOMA = 0 THEN
    SELECT NVL(MAX(C.NIDIDIOMA),0)+1 INTO P_NIDIDIOMA FROM TR_IDIOMA C;

    INSERT INTO TR_IDIOMA  (NIDIDIOMA,NIDPROCESOUSU,SIDIOMA,BTIPO,SFOLIO,BACTIVO,NIDUSUCREACION,DFECHACREACION, SRUTADOC)
                          VALUES (P_NIDIDIOMA,P_NIDPROCESOUSU,upper(P_SIDIOMA),P_BTIPO,P_SFOLIO,1,P_NUSUARIO,V_FECHA,P_SRUTADOC);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_IDIOMA SET BACTIVO=0,
                                 NIDUSUEDICION=P_NUSUARIO,
                                 DFECHAEDICION=V_FECHA
      WHERE NIDIDIOMA = P_NIDIDIOMA;
    ELSE
      UPDATE TR_IDIOMA SET SIDIOMA=upper(P_SIDIOMA),
                                  BTIPO=P_BTIPO,
                                  SFOLIO=P_SFOLIO,
                                  NIDUSUEDICION=P_NUSUARIO,
                                  DFECHAEDICION=V_FECHA,
                                      SRUTADOC=P_SRUTADOC
      WHERE NIDIDIOMA = P_NIDIDIOMA;
    END IF;
  END IF;

END SP_GUARDAR_IDIOMA;

 PROCEDURE SP_GUARDAR_EXPERIENCIA (P_NIDEXPERIENCIA IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_SENTIDAD IN VARCHAR2,
                                    P_SAREA  IN VARCHAR2,
                                    P_SCARGO  IN VARCHAR2,
                                    P_SFUNCIONES IN  VARCHAR2,
                                    P_SMODALIDAD  IN VARCHAR2,
                                    P_SMOTIVORETIRO IN  VARCHAR2,
                                    P_SNOMBRECARGOJEFE IN  VARCHAR2,
                                    P_NREMUNERACION IN NUMBER,
                                    P_STELEFONO IN  VARCHAR2,
                                    P_SFOLIO IN  VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SRUTADOC IN VARCHAR2,
                                    P_BESPECIFICA IN NUMBER,
                                    P_BSECTOR IN NUMBER,
                                    P_DFECHA_DESDE IN DATE,
                                    P_DFECHA_HASTA IN DATE,
                                    P_NPRESENTACIONES IN NUMBER) AS
  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDEXPERIENCIA = 0 THEN
    SELECT NVL(MAX(C.NIDEXPERIENCIA),0)+1 INTO P_NIDEXPERIENCIA FROM TR_EXPERIENCIA C;

    INSERT INTO TR_EXPERIENCIA  (NIDEXPERIENCIA,NIDPROCESOUSU,SENTIDAD,SAREA,SCARGO,SFUNCIONES,SMODALIDAD,SMOTIVORETIRO,
                                       SNOMBRECARGOJEFE,NREMUNERACION,
                                       STELEFONO,SFOLIO,BACTIVO,NIDUSUCREACION,DFECHACREACION,SRUTADOC,BESPECIFICA, BSECTOR, DFECHA_DESDE, DFECHA_HASTA, NPRESENTACIONES )
                               VALUES (P_NIDEXPERIENCIA,P_NIDPROCESOUSU,upper(P_SENTIDAD),upper(P_SAREA),upper(P_SCARGO),upper(P_SFUNCIONES),upper(P_SMODALIDAD),upper(P_SMOTIVORETIRO),
                                       upper(P_SNOMBRECARGOJEFE),P_NREMUNERACION,
                                       P_STELEFONO,P_SFOLIO,1,P_NUSUARIO,V_FECHA,P_SRUTADOC,P_BESPECIFICA, P_BSECTOR, P_DFECHA_DESDE, P_DFECHA_HASTA, P_NPRESENTACIONES);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_EXPERIENCIA SET BACTIVO=0,
                                       NIDUSUEDICION=P_NUSUARIO,
                                       DFECHAEDICION=V_FECHA
      WHERE NIDEXPERIENCIA = P_NIDEXPERIENCIA;
    ELSE
      UPDATE TR_EXPERIENCIA SET SENTIDAD=upper(P_SENTIDAD),
                                      SAREA=upper(P_SAREA),
                                      SCARGO=upper(P_SCARGO),
                                      SFUNCIONES=upper(P_SFUNCIONES),
                                      SMODALIDAD=upper(P_SMODALIDAD),
                                      SMOTIVORETIRO=upper(P_SMOTIVORETIRO),
                                      SNOMBRECARGOJEFE=upper(P_SNOMBRECARGOJEFE),
                                      NREMUNERACION=P_NREMUNERACION,
                                      STELEFONO=P_STELEFONO,
                                      SFOLIO=P_SFOLIO,
                                      NIDUSUEDICION=P_NUSUARIO,
                                      DFECHAEDICION=V_FECHA,
                                      SRUTADOC=P_SRUTADOC,
                                      BESPECIFICA=P_BESPECIFICA,
                                      BSECTOR=P_BSECTOR,
                                      DFECHA_DESDE=P_DFECHA_DESDE ,
                                      DFECHA_HASTA=P_DFECHA_HASTA,
                                      NPRESENTACIONES=P_NPRESENTACIONES
      WHERE NIDEXPERIENCIA = P_NIDEXPERIENCIA;
    END IF;
  END IF;

END SP_GUARDAR_EXPERIENCIA;

 PROCEDURE SP_GUARDAR_DATOSADIC (P_NIDDATOSADIC IN OUT NUMBER,
                                  P_NIDPROCESOUSU IN NUMBER,
                                  P_BFAMILIADIRECTA IN NUMBER,
                                  P_SFAMILIADIRECTA IN VARCHAR2,
                                  P_BDISCAPACIDAD IN NUMBER,
                                  P_STIPO IN VARCHAR2,
                                  P_SFOLIO IN VARCHAR2,
                                  P_BDEUDOR IN NUMBER,
                                  P_BANTECEDENTES IN NUMBER,
                                  P_SANTECEDENTES IN VARCHAR2,
                                  P_BFUERZAARMADA IN NUMBER,
                                  P_BACTIVO  IN NUMBER,
                                  P_NUSUARIO IN NUMBER,
                                  P_BTERM_COND IN NUMBER,
                                  P_SRUTADOC_DIS IN VARCHAR2,
                                  P_SRUTADOC_LFA IN VARCHAR2,
                                  P_BINHAB_ESTADO IN NUMBER,
                                  P_BINCOMP_ESTADO IN NUMBER,
                                  P_BPENSIONISTA IN NUMBER,
                                  P_BTIPO_PENSION IN NUMBER,
                                  P_BPENSION_SUSP IN NUMBER,
                                  P_BPARENTESCO IN NUMBER,
                                  P_SRUTADOC_OCI IN VARCHAR2,
                                  P_SRUTADOC_A3B IN VARCHAR2,
                                  P_BDEPORTISTA IN NUMBER,
                                  P_SRUTADOC_DEP IN VARCHAR2) AS

  V_FECHA DATE;
  V_COUNT NUMBER;
  BEGIN
  V_FECHA:=SYSDATE;
  SELECT COUNT(1) INTO V_COUNT
  FROM TR_DATOSADICIONALES
  WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;

  IF  P_NIDDATOSADIC = 0 AND V_COUNT = 0 THEN
    SELECT NVL(MAX(C.NIDDATOSADIC),0)+1 INTO P_NIDDATOSADIC FROM TR_DATOSADICIONALES C;

    INSERT INTO TR_DATOSADICIONALES  (NIDDATOSADIC,NIDPROCESOUSU,BFAMILIADIRECTA,SFAMILIADIRECTA,BDISCAPACIDAD,
                                            STIPO,SFOLIO,BDEUDOR,BANTECEDENTES,SANTECEDENTES,BFUERZAARMADA,BACTIVO,NIDUSUCREACION,DFECHACREACION, BTERM_COND,SRUTADOC_DIS,SRUTADOC_LFA,
                                            BINHAB_ESTADO,BINCOMP_ESTADO,BPENSIONISTA,BTIPO_PENSION,BPENSION_SUSP,BPARENTESCO,SRUTADOC_OCI, SRUTADOC_A3B,BDEPORTISTA, SRUTADOC_DEP)
                                    VALUES (P_NIDDATOSADIC,P_NIDPROCESOUSU,P_BFAMILIADIRECTA,P_SFAMILIADIRECTA,P_BDISCAPACIDAD,
                                            P_STIPO,P_SFOLIO,P_BDEUDOR,P_BANTECEDENTES,P_SANTECEDENTES,P_BFUERZAARMADA,1,P_NUSUARIO,V_FECHA, P_BTERM_COND,P_SRUTADOC_DIS,P_SRUTADOC_LFA,
                                            P_BINHAB_ESTADO,P_BINCOMP_ESTADO,P_BPENSIONISTA,P_BTIPO_PENSION,P_BPENSION_SUSP,P_BPARENTESCO,P_SRUTADOC_OCI, P_SRUTADOC_A3B,P_BDEPORTISTA, P_SRUTADOC_DEP);
  ELSE
    UPDATE TR_DATOSADICIONALES SET BFAMILIADIRECTA=P_BFAMILIADIRECTA,
                                        SFAMILIADIRECTA=P_SFAMILIADIRECTA,
                                        BDISCAPACIDAD=P_BDISCAPACIDAD,
                                        STIPO=P_STIPO,
                                        SFOLIO=P_SFOLIO,
                                        BDEUDOR=P_BDEUDOR,
                                        BANTECEDENTES=P_BANTECEDENTES,
                                        SANTECEDENTES=P_SANTECEDENTES,
                                        BFUERZAARMADA=P_BFUERZAARMADA,
                                        NIDUSUEDICION=P_NUSUARIO,
                                        DFECHAEDICION=V_FECHA,
                                        BTERM_COND=P_BTERM_COND,
                                        SRUTADOC_DIS = P_SRUTADOC_DIS,
                                        SRUTADOC_LFA = P_SRUTADOC_LFA,
                                        BINHAB_ESTADO = P_BINHAB_ESTADO,
                                        BINCOMP_ESTADO = P_BINCOMP_ESTADO,
                                        BPENSIONISTA = P_BPENSIONISTA,
                                        BTIPO_PENSION = P_BTIPO_PENSION,
                                        BPENSION_SUSP = P_BPENSION_SUSP,
                                        BPARENTESCO = P_BPARENTESCO,
                                        SRUTADOC_OCI = P_SRUTADOC_OCI,
                                        SRUTADOC_A3B = P_SRUTADOC_A3B,
                                        BDEPORTISTA = P_BDEPORTISTA, 
                                        SRUTADOC_DEP = P_SRUTADOC_DEP
    WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
  END IF;

END SP_GUARDAR_DATOSADIC;

 PROCEDURE SP_GUARDAR_PROCESOCOMITE (P_NIDCOMITE IN OUT NUMBER,
                                     P_NIDPROCESO IN NUMBER,
                                     P_NIDPERSONAL IN NUMBER,
                                     P_BACTIVO  IN NUMBER,
                                     P_NUSUARIO IN NUMBER,
                                     P_NTIPO_EVALUADOR IN NUMBER,
                                     P_ALL_CONV IN NUMBER,
                                     P_SMENSAJE OUT VARCHAR2,
                                     P_NPRINCIPAL IN NUMBER,
                                     P_NREVALCUR IN NUMBER,
                                     P_NREVALTEC IN NUMBER,
                                     P_NRENTREVISTA IN NUMBER,
                                     P_DSUSTENTOR IN VARCHAR2,
                                     P_NREEMPLAZO IN NUMBER,
                                     P_NIDACTIVIDAD IN NUMBER) AS


  V_FECHA DATE;
  V_COUNT NUMBER;
  BEGIN
  V_FECHA:=SYSDATE;
  V_COUNT:=0;

    
  IF  P_NIDCOMITE = 0 THEN
    IF P_NIDACTIVIDAD = 0 THEN
        FOR C_PROCESOS IN (SELECT NIDPROCESO FROM TR_PROCESO
                            WHERE (NIDPROCESO = P_NIDPROCESO OR (NVL(P_ALL_CONV,0) = 1
                                AND NIDCONVOCATORIA = (SELECT NIDCONVOCATORIA FROM TR_PROCESO WHERE NIDPROCESO = P_NIDPROCESO)))) LOOP
            SELECT COUNT(A.NIDCOMITE)
            INTO V_COUNT
            FROM  TR_PROCESOCOMITE A
            WHERE A.BACTIVO=1 AND A.NIDPERSONAL=P_NIDPERSONAL AND A.NIDPROCESO=C_PROCESOS.NIDPROCESO;

            IF V_COUNT=0 THEN
               SELECT NVL(MAX(C.NIDCOMITE),0)+1 INTO P_NIDCOMITE FROM TR_PROCESOCOMITE C;

               INSERT INTO TR_PROCESOCOMITE  (NIDCOMITE,NIDPROCESO,NIDPERSONAL,BACTIVO,NIDUSUCREACION,DFECHACREACION, NTIPO_EVALUADOR, NPRINCIPAL,NREVALCUR ,NREVALTEC ,NRENTREVISTA ,DSUSTENTOR ,NREEMPLAZO)
                                        VALUES (P_NIDCOMITE,C_PROCESOS.NIDPROCESO,P_NIDPERSONAL,1,P_NUSUARIO,V_FECHA, P_NTIPO_EVALUADOR, P_NPRINCIPAL,P_NREVALCUR ,P_NREVALTEC ,P_NRENTREVISTA ,P_DSUSTENTOR ,P_NREEMPLAZO);
               P_SMENSAJE:='1'; --REGISTRADO
            ELSIF NVL(P_ALL_CONV,0) = 0 THEN
               P_SMENSAJE:='4'; --REPETIDO
            END IF;
        END LOOP;
    ELSE
        FOR C_ACT IN (SELECT NIDPROCESO, NIDACTIVIDAD FROM TR_ACTIVIDAD
                            WHERE NIDACTIVIDAD= P_NIDACTIVIDAD OR (NVL(P_ALL_CONV,0) = 1
                                AND NIDPROCESO = P_NIDPROCESO)) LOOP
            SELECT COUNT(A.NIDCOMITE)
            INTO V_COUNT
            FROM  TR_PROCESOCOMITE A
            WHERE A.BACTIVO=1 AND A.NIDPERSONAL=P_NIDPERSONAL AND A.NIDACTIVIDAD=C_ACT.NIDACTIVIDAD ;

            IF V_COUNT=0 THEN
               SELECT NVL(MAX(C.NIDCOMITE),0)+1 INTO P_NIDCOMITE FROM TR_PROCESOCOMITE C;

               INSERT INTO TR_PROCESOCOMITE (NIDCOMITE,NIDPROCESO,NIDPERSONAL,BACTIVO,NIDUSUCREACION,DFECHACREACION, NPRINCIPAL,NIDACTIVIDAD)
                                            VALUES (P_NIDCOMITE,C_ACT.NIDPROCESO,P_NIDPERSONAL,1,P_NUSUARIO,V_FECHA,P_NPRINCIPAL,C_ACT.NIDACTIVIDAD);
               P_SMENSAJE:='1'; --REGISTRADO
            ELSIF NVL(P_ALL_CONV,0) = 0 THEN
               P_SMENSAJE:='4'; --REPETIDO
            END IF;
        END LOOP;
    END IF;
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_PROCESOCOMITE SET BACTIVO=0,
                                       NIDUSUEDICION=P_NUSUARIO,
                                       DFECHAEDICION=V_FECHA
      WHERE NIDCOMITE = P_NIDCOMITE;
      P_SMENSAJE:='3';--ANULADO
    END IF;
  END IF;

 END SP_GUARDAR_PROCESOCOMITE;
 PROCEDURE SP_GUARDAR_PROCESO (P_BESTADO IN TR_PROCESO.BESTADO%TYPE,
                                P_NEXP_GEN IN TR_PROCESO.NEXP_GEN%TYPE,
                                P_NEXP_ESP IN TR_PROCESO.NEXP_ESP%TYPE,
                                P_NCOLEG_OBLIG IN TR_PROCESO.NCOLEG_OBLIG%TYPE,
                                P_SSERVICIO IN TR_PROCESO.SSERVICIO%TYPE,
                                P_SPROCESO IN TR_PROCESO.SPROCESO%TYPE,
                                P_NPROCESO IN TR_PROCESO.NPROCESO%TYPE,
                                P_BACTIVO IN TR_PROCESO.BACTIVO%TYPE,
                                P_NIDUSUARIO IN TR_PROCESO.NIDUSUCREACION%TYPE,
                                P_NIDPROCESO IN  TR_PROCESO.NIDPROCESO%TYPE,
                                P_NIDCONVOCATORIA IN TR_PROCESO.NIDCONVOCATORIA%TYPE,
                                P_SIDSFORMACIONACAD IN TR_PROCESO.SIDSFORMACIONACAD%TYPE,
                                P_SIDSGRADOSACAD IN TR_PROCESO.SIDSGRADOSACAD%TYPE,
                                P_NELENCO IN TR_PROCESO.NELENCO%TYPE,
                                P_NPLAZAS IN TR_PROCESO.NPLAZAS%TYPE,
                                P_DPUESTO IN TR_PROCESO.DPUESTO%TYPE,
                                P_DOBJETO IN TR_PROCESO.DOBJETO%TYPE,
                                P_DLUGAR IN TR_PROCESO.DLUGAR%TYPE,
                                P_SDURACION IN TR_PROCESO.SDURACION%TYPE,
                                P_NSUELDO IN TR_PROCESO.NSUELDO%TYPE,
                                P_IDOFICODIGO IN TR_PROCESO.IDOFICODIGO%TYPE,
                                P_MENSAJE OUT VARCHAR2,
                                P_NOBLIG_BREVETE IN TR_PROCESO.NOBLIG_BREVETE%TYPE,
                                P_ncolegHab_oblig IN TR_PROCESO.ncolegHab_oblig%TYPE,
                                P_nrna_oblig IN TR_PROCESO.nrna_oblig%TYPE,
                                P_NRESULTADO IN TR_PROCESO.NRESULTADO%TYPE,
                                P_NOBLIG_DJ IN TR_PROCESO.NOBLIG_DJ%TYPE,
                                P_NOCI IN TR_PROCESO.NOCI%TYPE,
                                P_NMESES IN TR_PROCESO.NMESES%TYPE,
                                P_IDFTECODIGO IN TR_PROCESO.IDFTECODIGO%TYPE,
                                P_AIRHSP IN TR_PROCESO.SPLAZA_AIRHSP%TYPE,
                                P_SIAF IN TR_PROCESO.SIAF%TYPE,
                                P_IDSERCASCODIGO IN TR_PROCESO.IDSERCASCODIGO%TYPE,
                                P_NTIPOBASE IN TR_PROCESO.NTIPOBASE%TYPE)     AS

  V_FECHA DATE;
  V_NIDPROCESO TR_PROCESO.NIDPROCESO%TYPE;
  BEGIN
  V_FECHA:=SYSDATE;
  P_MENSAJE:='OK';
  SELECT NVL(MAX(NIDPROCESO),0) + 1
  INTO V_NIDPROCESO
  FROM TR_PROCESO;

  IF  P_NIDPROCESO = 0 THEN
    INSERT INTO TR_PROCESO (BESTADO,NEXP_GEN,NEXP_ESP,NCOLEG_OBLIG,NIDPROCESO,SSERVICIO,SPROCESO,NPROCESO,NOBLIG_BREVETE,NOBLIG_DJ,
                            BACTIVO,NIDUSUCREACION,DFECHACREACION,NIDCONVOCATORIA, SIDSFORMACIONACAD, SIDSGRADOSACAD, NELENCO, NPLAZAS, DPUESTO, DOBJETO, DLUGAR, SDURACION, NSUELDO, IDOFICODIGO,
                            ncolegHab_oblig, nrna_oblig, NRESULTADO, ntipo, NOCI,NMESES,IDFTECODIGO, SPLAZA_AIRHSP, SIAF,IDSERCASCODIGO,NTIPOBASE)
                    VALUES (P_BESTADO,P_NEXP_GEN,P_NEXP_ESP,P_NCOLEG_OBLIG,V_NIDPROCESO,P_SSERVICIO,P_SPROCESO,P_NPROCESO,P_NOBLIG_BREVETE,P_NOBLIG_DJ,
                            1,P_NIDUSUARIO,V_FECHA,P_NIDCONVOCATORIA, P_SIDSFORMACIONACAD, P_SIDSGRADOSACAD, P_NELENCO, P_NPLAZAS, P_DPUESTO, P_DOBJETO, P_DLUGAR, P_SDURACION, P_NSUELDO, P_IDOFICODIGO,
                            P_ncolegHab_oblig,P_nrna_oblig,P_NRESULTADO,1,P_NOCI,P_NMESES,P_IDFTECODIGO, P_AIRHSP, P_SIAF,P_IDSERCASCODIGO,P_NTIPOBASE);
  ELSIF P_BESTADO = 3 THEN
    UPDATE TR_PROCESO SET NRESULTADO = P_BESTADO
    WHERE NIDPROCESO = P_NIDPROCESO;
  ELSE
    UPDATE TR_PROCESO SET BESTADO = P_BACTIVO,
                        NEXP_GEN = P_NEXP_GEN,
                        NEXP_ESP = P_NEXP_ESP,
                        NCOLEG_OBLIG = P_NCOLEG_OBLIG,
                        SSERVICIO = P_SSERVICIO,
                        SPROCESO = P_SPROCESO,
                        NPROCESO = P_NPROCESO,
                        --BACTIVO = P_BACTIVO,
                        NIDUSUEDICION = P_NIDUSUARIO,
                        DFECHAEDICION = V_FECHA,
                        NIDCONVOCATORIA = P_NIDCONVOCATORIA,
                        SIDSFORMACIONACAD = P_SIDSFORMACIONACAD,
                        NELENCO = P_NELENCO,
                        NPLAZAS = P_NPLAZAS,
                        DPUESTO = P_DPUESTO,
                        DOBJETO = P_DOBJETO,
                        DLUGAR = P_DLUGAR,
                        SDURACION = P_SDURACION,
                        NSUELDO = P_NSUELDO,
                        IDOFICODIGO = P_IDOFICODIGO,
                        SIDSGRADOSACAD = P_SIDSGRADOSACAD,
                        NOBLIG_BREVETE = P_NOBLIG_BREVETE,
                        ncolegHab_oblig = P_ncolegHab_oblig, 
                        nrna_oblig = P_nrna_oblig,
                        NOBLIG_DJ = P_NOBLIG_DJ,
                        NRESULTADO = P_NRESULTADO,
                        NOCI = P_NOCI,
                        NMESES = P_NMESES,
                        IDFTECODIGO = P_IDFTECODIGO,
                        SPLAZA_AIRHSP = P_AIRHSP,
                        SIAF = P_SIAF,
                        IDSERCASCODIGO = P_IDSERCASCODIGO,
                        NTIPOBASE = P_NTIPOBASE
      WHERE NIDPROCESO = P_NIDPROCESO;
  END IF;

 EXCEPTION WHEN OTHERS THEN
    P_MENSAJE :='ERROR AL GRABAR:'||SQLERRM;
 END SP_GUARDAR_PROCESO;
 PROCEDURE SP_GUARDAR_PUNTAJE (P_NIDPROCESOUSU IN NUMBER,
                             P_NIDPERSONAL IN NUMBER,
                             P_NTIPO_EVAL IN NUMBER, --2:PUNTAJE, 3:EVAL_CUR, 4:EVAL_TECNICA
                             P_NCALIFICACION IN NUMBER,
                             P_NASISTENCIA IN NUMBER,
                             P_NTIPO_EVALUADOR IN NUMBER, --1:RRHH, 2:OGA, 3:AREA USUARIA
                             P_SMENSAJE OUT VARCHAR2) AS
 V_FECHA DATE;
 V_COUNT NUMBER;
 BEGIN
    P_SMENSAJE := 'OK';
    V_FECHA := SYSDATE;
    SELECT COUNT(1)
    INTO V_COUNT
    FROM TR_PROCESOUSUARIO_EVAL
    WHERE NIDPROCESOUSU = P_NIDPROCESOUSU AND NTIPO_EVAL = P_NTIPO_EVAL and NTIPO_EVALUADOR = P_NTIPO_EVALUADOR;
    IF V_COUNT > 0 THEN
        UPDATE TR_PROCESOUSUARIO_EVAL
        SET NCALIFICACION = P_NCALIFICACION,
            NIDUSUEDICION = P_NIDPERSONAL,
            DFECHAEDICION = V_FECHA,
            NASISTENCIA = P_NASISTENCIA,
            NIDPERSONAL = P_NIDPERSONAL
        WHERE NIDPROCESOUSU = P_NIDPROCESOUSU AND NTIPO_EVAL = P_NTIPO_EVAL AND NTIPO_EVALUADOR = P_NTIPO_EVALUADOR;
    ELSE
        INSERT INTO TR_PROCESOUSUARIO_EVAL(NIDPROCESOUSU,NIDPERSONAL, DFECHACREACION, NIDUSUCREACION,NCALIFICACION ,NASISTENCIA, NTIPO_EVAL, NTIPO_EVALUADOR)
        VALUES (P_NIDPROCESOUSU, P_NIDPERSONAL, V_FECHA, P_NIDPERSONAL, P_NCALIFICACION, P_NASISTENCIA, P_NTIPO_EVAL,P_NTIPO_EVALUADOR );
    END IF;
  EXCEPTION WHEN OTHERS THEN
    P_SMENSAJE :='ERROR AL GRABAR:'||SQLERRM;
 END SP_GUARDAR_PUNTAJE;
 PROCEDURE SP_ENVIAR_FICHA (P_NIDPROCESOUSU IN NUMBER,
                             P_NUSUARIO IN NUMBER,
                             P_SMENSAJE OUT VARCHAR2) AS
 V_FECHA DATE;
 V_COUNT NUMBER;
 V_NCOLEG_OBLIG TR_PROCESO.NCOLEG_OBLIG%TYPE;
 V_NEXP_ESP TR_PROCESO.NEXP_ESP%TYPE;
 V_NEXP_GEN TR_PROCESO.NEXP_GEN%TYPE;
 V_BTERM_COND TR_DATOSADICIONALES.BTERM_COND%TYPE;
 V_BDISCAPACIDAD TR_DATOSADICIONALES.BDISCAPACIDAD%TYPE;
 V_BFUERZAARMADA TR_DATOSADICIONALES.BFUERZAARMADA%TYPE;
 V_SRUTADOC_DISC TR_DATOSADICIONALES.SRUTADOC_DIS%TYPE;
 V_SRUTADOC_LFA TR_DATOSADICIONALES.SRUTADOC_LFA%TYPE;
 V_NOBLIG_BREVETE TR_PROCESO.NOBLIG_BREVETE%TYPE;
 V_NOBLIG_DJ TR_PROCESO.NOBLIG_DJ%TYPE;
 V_DP TR_DATOSPERSONALES%ROWTYPE;
 V_NIDCONVOCATORIA NUMBER;
 V_NOCI TR_PROCESO.NOCI%TYPE;
 V_DOLOSO NUMBER;
 V_CONOCIMIENTO VARCHAR2(1000);

 BEGIN
    P_SMENSAJE := 'OK';
    V_FECHA := SYSDATE;

    SELECT CASE WHEN SYSDATE > C.DFECHAFIN THEN 1 ELSE 0 END, P.NIDCONVOCATORIA INTO V_COUNT, V_NIDCONVOCATORIA
    FROM TR_PROCESO P
        INNER JOIN TR_PROCESOUSUARIO PU ON P.NIDPROCESO=PU.NIDPROCESO
        INNER JOIN TM_CONVOCATORIA C ON C.NTIPO = P.NTIPO AND P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
    WHERE PU.NIDPROCESOUSU = P_NIDPROCESOUSU;
    IF V_COUNT > 0 THEN
        P_SMENSAJE:= 'LA CONVOCATORIA PARA ESTE PROCESO HA FINALIZADO, AGREGUE UN PROCESO VIGENTE PARA POSTULAR.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
    
    select count(1) into  V_COUNT 
    FROM TR_PROCESO P
        INNER JOIN TR_PROCESOUSUARIO PU ON P.NIDPROCESO=PU.NIDPROCESO
        WHERE NIDCONVOCATORIA = V_NIDCONVOCATORIA AND PU.NIDCODIGOUSUARIO = P_NUSUARIO AND PU.BESTADO = 2; 
    IF V_COUNT > 0 THEN
        P_SMENSAJE:= 'NO PUEDE POSTULAR A MÁS DE UN PROCESO POR CONVOCATORIA.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
     SELECT
        (SELECT COUNT(1) FROM TR_EXPERIENCIA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU ) +
        (SELECT COUNT(1) FROM TR_FORMACIONAC WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU ) +
        (SELECT COUNT(1) FROM TR_COLEGIATURA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU ) +
        (SELECT COUNT(1) FROM TR_CAPACITACION WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU) +
        (SELECT COUNT(1) FROM TR_CONOCIMIENTO WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU )
    INTO V_COUNT
    FROM DUAL;
    IF V_COUNT = 0 THEN
        P_SMENSAJE:= 'DEBE INGRESAR SU INFORMACIÓN PARA PODER POSTULAR AL PROCESO, HACER CLIC EN LA IMAGEN(lápiz) DE LA COLUMNA EDITAR PARA REGISTRAR SU FICHA DE POSTULACIÓN.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
     SELECT
        (SELECT COUNT(1) FROM TR_EXPERIENCIA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL) +
        (SELECT COUNT(1) FROM TR_FORMACIONAC WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL) +
        (SELECT COUNT(1) FROM TR_COLEGIATURA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL) +
        (SELECT COUNT(1) FROM TR_CAPACITACION WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL) +
        (SELECT COUNT(1) FROM TR_CONOCIMIENTO WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL AND NIDTIPO = 3)
    INTO V_COUNT
    FROM DUAL;
    IF V_COUNT > 0 THEN
         SELECT
      MAX(DESCRIP) INTO P_SMENSAJE from (  SELECT 'EXP_LAB:'||SENTIDAD DESCRIP FROM TR_EXPERIENCIA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL union all
        SELECT 'INF_ACA: '||SINSTITUCION FROM TR_FORMACIONAC WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL union all
        SELECT 'COLEGIATURA' FROM TR_COLEGIATURA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL union all
        SELECT 'CURSOS: '||SCURSO FROM TR_CAPACITACION WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL union all
        SELECT 'CONOCIMIENTOS RELACIONADOS: '||SDESCRIPCION FROM TR_CONOCIMIENTO WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL AND NIDTIPO = 3);
        
        P_SMENSAJE:= 'UD. TIENE REGISTROS SIN ARCHIVOS DE SUSTENTO, validar si se han cargado el PDF('||P_SMENSAJE||'). SE RECOMIENDA QUE EL ARCHIVO SEA UN PDF, EL NOMBRE DEL ARCHIVO NO CONTENGA CARACTERES ESPECIALES Y PESE MENOS DE 2 MB.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;

    SELECT COUNT(1) INTO V_COUNT
    FROM TR_EXPERIENCIA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU;
    IF V_COUNT = 0 THEN
        P_SMENSAJE:= 'DEBE INGRESAR AL MENOS UN REGISTRO DE EXPERIENCIA LABORAL.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
    SELECT COUNT(1) INTO V_COUNT
    FROM TR_FORMACIONAC WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU;
    IF V_COUNT = 0 THEN
        P_SMENSAJE:= 'DEBE INGRESAR AL MENOS UN REGISTRO DE FORMACIÓN ACADÉMICA.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
    SELECT COUNT(1) INTO V_COUNT
    FROM TR_CAPACITACION WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU;
    IF V_COUNT = 0 THEN
        SELECT COUNT(1) INTO V_COUNT
        FROM TR_PROCESO_BASES WHERE BACTIVO = 1 AND NIDPROCESO = (SELECT NIDPROCESO FROM TR_PROCESOUSUARIO WHERE NIDPROCESOUSU = P_NIDPROCESOUSU) AND NIDTIPO_BASE = 4;
        IF V_COUNT > 0 THEN
            P_SMENSAJE:= 'DEBE INGRESAR AL MENOS UN REGISTRO DE ALGÚN CURSO SOLICITADO EN LAS BASES.';
            insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        END IF;
    END IF;
    SELECT NVL(NCOLEG_OBLIG,0), DECODE(NVL(NMESES,0),0,NEXP_ESP,NEXP_ESP/12) NEXP_ESP,DECODE(NVL(NMESES,0),0,NEXP_GEN,NEXP_GEN/12) NEXP_GEN,NVL(NOBLIG_BREVETE,0),NVL(NOBLIG_DJ,0),NVL(NOCI,0)
    INTO V_NCOLEG_OBLIG, V_NEXP_ESP, V_NEXP_GEN , V_NOBLIG_BREVETE , V_NOBLIG_DJ, V_NOCI
    FROM TR_PROCESO P INNER JOIN TR_PROCESOUSUARIO PU ON PU.NIDPROCESO = P.NIDPROCESO
    WHERE PU.NIDPROCESOUSU = P_NIDPROCESOUSU;

    IF V_NOBLIG_DJ = 1 THEN
        SELECT COUNT(1) INTO V_COUNT 
        FROM TR_CONOCIMIENTO WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC IS NULL AND NIDTIPO = 1;
        if V_COUNT > 0 then
            P_SMENSAJE:= 'UD. DEBE INGRESAR UNA DECLARACIÓN JURADA COMO SUSTENTO en la pestaña CONOCIMIENTOS RELACIONADOS AL SERVICIO.';
            insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        end if;
    END IF;
    IF V_NOCI = 1 THEN
        SELECT COUNT(1) INTO V_COUNT 
        FROM TR_DATOSADICIONALES WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC_OCI IS NULL;
        if V_COUNT > 0 then
            P_SMENSAJE:= 'UD. DEBE INGRESAR LAS DECLARACIÓN JURADAS SOLICITADAS POR EL ÓRGANO DE CONTROL INSTIRUCIONAL. EN LA PESTAÑA "DATOS ADICIONALES, EN EL ÍTEM 8", el formato de las DJ están adjuntas en sus bases.';
            insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        end if;
    END IF;
    
     SELECT COUNT(1) INTO V_COUNT 
        FROM TR_DATOSADICIONALES WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND SRUTADOC_A3B IS NULL;
        if V_COUNT > 0 then
            P_SMENSAJE:= 'UD. DEBE ADJUNTAR EL ANEXO 3B en la pestaña "DATOS ADICIONALES, EN EL ÍTEM 9".';
            insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        end if;
    
    SELECT *
    INTO V_DP
    FROM TR_DATOSPERSONALES
    WHERE NIDCODIGOUSUARIO = P_NUSUARIO;

    SELECT NVL(MAX(BTERM_COND),0),MAX(BDISCAPACIDAD), MAX(BFUERZAARMADA),  MAX(SRUTADOC_DIS), MAX(SRUTADOC_LFA), DECODE(NVL(max(BANTECEDENTES),0),1,DECODE(max(SANTECEDENTES),'1',1,0),0)
    INTO V_BTERM_COND, V_BDISCAPACIDAD, V_BFUERZAARMADA,  V_SRUTADOC_DISC, V_SRUTADOC_LFA, V_DOLOSO
    FROM TR_DATOSADICIONALES
    WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
    
    IF V_DOLOSO = 1 THEN
        P_SMENSAJE := 'UD. NO PUEDE POSTULAR CON ANTECEDENTES PENALES O JUDICIALES, CON EL TIPO DE DELITO "DOLOSO". ';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
    IF V_DP.SCORREO IS NULL OR V_DP.SDIRECCION IS NULL OR NVL(V_DP.SCELULAR,V_DP.STELEFONOFIJO) IS NULL THEN
        P_SMENSAJE := 'UD. NO HA REGISTRADO LOS DATOS DE CONTACTO OBLIGATORIOS EN LA FICHA, TELEFONO O CELULAR, CORREO Y DIRECCION, ';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
   /* IF (V_DP.SPAIS_NAC IS NULL OR V_DP.SRUTADOC_NAC IS NULL) AND V_DP.NTIPODOC <> 1  THEN
        P_SMENSAJE := 'UD. NO HA REGISTRADO EL PAÍS DE NACIONALIDAD Y ADJUNTADO EL DOCUMENTO SUSTENTO DE PERMISO LABORAL, INGRESE A LA OPCIÓN DATOS PERS. Y COMPLETE SU INFORMACIÓN.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;*/
    IF V_BDISCAPACIDAD > 0 AND V_SRUTADOC_DISC  IS NULL THEN
        P_SMENSAJE := 'UD. NO HA SUBIDO ARCHIVO DE SUSTENTO DE DISCAPACIDAD';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
    IF V_BFUERZAARMADA > 0 AND V_SRUTADOC_LFA  IS NULL THEN
        P_SMENSAJE := 'UD. NO HA SUBIDO ARCHIVO DE SUSTENTO DE LICENCIATURA DE FFAA';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;

    IF V_NCOLEG_OBLIG > 0 THEN
        SELECT COUNT(1)
        INTO V_COUNT
        FROM TR_COLEGIATURA
        WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
        IF V_COUNT = 0 THEN
            P_SMENSAJE := 'ESTA CONVOCATORIA REQUIERE DE UNA COLEGIATURA, DEBE INGRESAR LOS DATOS DE SU COLEGIATURA EN LA PESTAÑA "FORMACIÓN ACADÉMICA"';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        END IF;
    END IF;

    IF V_NOBLIG_BREVETE > 0 THEN
       /* IF NVL(V_DP.SCATBREVETE,0) = 0 OR V_DP.SBREVETE IS NULL THEN
            P_SMENSAJE := 'ESTA CONVOCATORIA REQUIERE DE BREVETE, ESTE DATO LO PUEDE REGISTRAR en la opción DATOS PERS.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        END IF;
        IF V_DP.SRUTADOC IS NULL THEN
            P_SMENSAJE := 'DEBE ADJUNTAR UN SU BREVETE ESCANEADO en la opción DATOS PERS.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        END IF;*/
         SELECT COUNT(1) INTO V_COUNT
          FROM TR_CONOCIMIENTO WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU AND NIDTIPO = 3;
        IF V_COUNT = 0 THEN
            P_SMENSAJE := 'ESTA CONVOCATORIA REQUIERE DE BREVETE, ESTE DATO LO PUEDE REGISTRAR en la pestaña CONOCIMIENTOS RELACIONADOS AL SERVICIO, Tipo conocimiento: LICENCIA DE CONDUCIR.';
            insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
            RETURN;
        END IF;
        
    END IF;

    IF V_NEXP_GEN > TO_NUMBER(F_CALCULA_EXP_ACUM(P_NIDPROCESOUSU, 'G', 'N')) THEN
        P_SMENSAJE := 'UD. NO CUENTA CON LA EXPERIENCIA LABORAL (GENERICA) MÍNIMA REQUERIDA POR ESTA CONVOCATORIA, VERIFIQUE LAS FECHAS INGRESADAS.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;

    IF V_NEXP_ESP > TO_NUMBER(F_CALCULA_EXP_ACUM(P_NIDPROCESOUSU, 'E', 'N')) THEN
        P_SMENSAJE := 'EXPERIENCIA LABORAL (ESPECIFICA) no es suficiente, VERIFIQUE LAS FECHAS INGRESADAS y recuerde indicar en cada registro si la experiencia agregada es específica.';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
    SELECT COUNT(1), MAX(PB.SDESCRIPCION) INTO V_COUNT, V_CONOCIMIENTO 
    FROM TR_PROCESO P
        INNER JOIN TR_PROCESOUSUARIO PU ON P.NIDPROCESO=PU.NIDPROCESO
        INNER JOIN TR_PROCESO_BASES PB ON PB.NIDPROCESO = P.NIDPROCESO AND NIDTIPO_BASE = 13 AND PB.BACTIVO = 1
        LEFT JOIN TR_CONOCIMIENTO C ON PB.NIDREGISTRO = C.NCONOCIMIENTO_B AND C.NIDPROCESOUSU = PU.NIDPROCESOUSU
        WHERE PU.NIDPROCESOUSU = P_NIDPROCESOUSU  AND NIDCONOCIMIENTO IS NULL and lower(pb.sdescripcion) not like 'no aplica%' ;
    IF V_COUNT > 0 THEN
        P_SMENSAJE := 'INGRESAR A LA PESTAÑA "CONOCIMIENTOS RELACIONADOS AL SERVICIO" E INGRESAR Y/O ASOCIAR CADA REGISTRO A UN CONOCIMIENTO SOLICITADO POR LAS BASES. POR EJEMPLO FALTA ASOCIAR: '||V_CONOCIMIENTO;
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;         
    IF V_BTERM_COND = 0 THEN
        P_SMENSAJE := 'UD. NO HA DECLARADO CONOCER LAS BASES DEL PROCESO(ir a pestana "Datos adicionales").';
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
        RETURN;
    END IF;
    
    UPDATE TR_PROCESOUSUARIO
    SET BESTADO = 2,
        NIDUSUEDICION = P_NUSUARIO,
        DFECHAEDICION =V_FECHA
    WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
     insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
 EXCEPTION WHEN OTHERS THEN
    P_SMENSAJE :='ERROR AL GRABAR:'||SQLERRM ;
        insert into tr_msg_validacion(nidprocesousu,fecha_msg,mensaje,NTIPO) values(P_NIDPROCESOUSU,sysdate,P_SMENSAJE,1);
 END SP_ENVIAR_FICHA;
 FUNCTION F_CALCULA_EXPERIENCIA(P_DFECHAINI DATE, P_DFECHAFIN DATE, P_SDATO VARCHAR2) RETURN VARCHAR2 AS
    V_SRPTA VARCHAR2(100) := 'NOK';
    V_DFECHA_INI DATE;
    V_NANIOS NUMBER := 0;
    V_NMESES NUMBER := 0;
    V_NDIAS NUMBER := 0;
    BEGIN
        V_DFECHA_INI := P_DFECHAINI;
        WHILE add_months(V_DFECHA_INI,12) - 1 <= P_DFECHAFIN
        LOOP
           V_NANIOS := V_NANIOS + 1;
           V_DFECHA_INI := add_months(V_DFECHA_INI,12);
        END LOOP;
        WHILE add_months(V_DFECHA_INI,1) - 1 <= P_DFECHAFIN
        LOOP
           V_NMESES := V_NMESES + 1;
           V_DFECHA_INI := add_months(V_DFECHA_INI,1);
        END LOOP;
        V_NDIAS := P_DFECHAFIN  - (V_DFECHA_INI - 1);
        V_SRPTA := CASE P_SDATO WHEN 'L' THEN /*TO_CHAR(V_NANIOS) || ' aÃ¿Â±o(s) '||TO_CHAR(V_NMESES) ||' mes(es) '||TO_CHAR(V_NDIAS) || ' dia(s) '*/
        TO_CHAR(V_NANIOS) || ' A '||TO_CHAR(V_NMESES) ||' M '||TO_CHAR(V_NDIAS) || ' D '
                                         ELSE TO_CHAR(V_NANIOS) || '|'||TO_CHAR(V_NMESES) ||'|'||TO_CHAR(V_NDIAS) END ;
        RETURN V_SRPTA;
    EXCEPTION WHEN OTHERS THEN
       RETURN V_SRPTA;
    END F_CALCULA_EXPERIENCIA;
 PROCEDURE SP_CARGA_CV(P_NIDPROCESOUSU IN NUMBER,
                     P_NUSUARIO IN NUMBER,
                     P_SMENSAJE OUT VARCHAR2) AS

 V_FECHA DATE := SYSDATE;
 V_NIDPROCESOUSU NUMBER;
 V_NID NUMBER;
 V_NCOUNT NUMBER;
 BEGIN
    P_SMENSAJE := 'OK';
    SELECT NVL(MAX(NIDPROCESOUSU),0)
    INTO V_NIDPROCESOUSU
    FROM TR_PROCESOUSUARIO
    WHERE NIDCODIGOUSUARIO = P_NUSUARIO AND BACTIVO = 1 AND NIDPROCESOUSU <> P_NIDPROCESOUSU;
    IF V_NIDPROCESOUSU = 0 THEN
        P_SMENSAJE:= 'UD. NO TIENE REGISTRO DE UNA CONVOCATORIA ANTERIOR.';
        RETURN;
    END IF;

    SELECT
        (SELECT COUNT(1) FROM TR_EXPERIENCIA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU) +
        (SELECT COUNT(1) FROM TR_IDIOMA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU) +
        (SELECT COUNT(1) FROM TR_FORMACIONAC WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU) +
        (SELECT COUNT(1) FROM TR_COLEGIATURA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU) +
        (SELECT COUNT(1) FROM TR_CAPACITACION WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU) +
        (SELECT COUNT(1) FROM TR_CONOCIMIENTOINF WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU) +
        (SELECT COUNT(1) FROM TR_CONOCIMIENTO WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDPROCESOUSU)
    INTO V_NCOUNT
    FROM DUAL;
    IF V_NCOUNT > 0 THEN
        P_SMENSAJE:= 'UD. YA TIENE INFORMACIÓN REGISTRADA PARA ESTA CONVOCATORIA.';
        RETURN;
    END IF;

    SELECT NVL(MAX(NIDEXPERIENCIA),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_EXPERIENCIA;
    IF V_NCOUNT > 0 THEN
      INSERT INTO TR_EXPERIENCIA
       (NIDEXPERIENCIA, NIDPROCESOUSU, SENTIDAD, SAREA, SCARGO,
        SFUNCIONES, SMODALIDAD, SMOTIVORETIRO, SNOMBRECARGOJEFE, NREMUNERACION,
        STELEFONO, SFOLIO, BACTIVO, NIDUSUCREACION, DFECHACREACION, SRUTADOC, BESPECIFICA, BSECTOR,
        DFECHA_DESDE, DFECHA_HASTA, NPRESENTACIONES)
      SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, SENTIDAD, SAREA, SCARGO,
        SFUNCIONES, SMODALIDAD, SMOTIVORETIRO, SNOMBRECARGOJEFE, NREMUNERACION,
        STELEFONO, SFOLIO, BACTIVO, P_NUSUARIO, V_FECHA, SRUTADOC, BESPECIFICA, BSECTOR,
        DFECHA_DESDE, DFECHA_HASTA, NPRESENTACIONES
      FROM TR_EXPERIENCIA
      WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;

    SELECT NVL(MAX(NIDIDIOMA),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_IDIOMA;
    IF V_NCOUNT > 0 THEN
        Insert into TR_IDIOMA
           (NIDIDIOMA, NIDPROCESOUSU, SIDIOMA, BTIPO, SFOLIO,
            BACTIVO, NIDUSUCREACION, DFECHACREACION, SRUTADOC)
         SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, SIDIOMA, BTIPO, SFOLIO,
        BACTIVO, P_NUSUARIO, V_FECHA, SRUTADOC
        FROM TR_IDIOMA
         WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;

    SELECT NVL(MAX(NIDFACADEMICA),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_FORMACIONAC;
    IF V_NCOUNT > 0 THEN
        Insert into TR_FORMACIONAC
            (NIDFACADEMICA, NIDPROCESOUSU, NIDTIPOFORMACION, SINSTITUCION, NIDGRADOACADEMICO,
            SPROFESION, NMESDESDE, NANIODESDE, NMESHASTA, NANIOHASTA,
            NANIOSESTUDIO, SFOLIO, BACTIVO, NIDUSUCREACION, DFECHACREACION, SRUTADOC)
        SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, NIDTIPOFORMACION, SINSTITUCION, NIDGRADOACADEMICO,
            SPROFESION, NMESDESDE, NANIODESDE, NMESHASTA, NANIOHASTA,
            NANIOSESTUDIO, SFOLIO, BACTIVO, P_NUSUARIO, V_FECHA, SRUTADOC
        FROM TR_FORMACIONAC
        WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;

    SELECT NVL(MAX(NIDCOLEGIATURA),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_COLEGIATURA;
    IF V_NCOUNT > 0 THEN
        Insert into TR_COLEGIATURA
           (NIDCOLEGIATURA, NIDPROCESOUSU, SCOLEGIO, SNROCOLEGIATURA, BCONDICION,
            SFOLIO, BACTIVO, NIDUSUCREACION, DFECHACREACION, SRUTADOC)
        SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, SCOLEGIO, SNROCOLEGIATURA, BCONDICION,
            SFOLIO, BACTIVO, P_NUSUARIO, V_FECHA, SRUTADOC
        FROM TR_COLEGIATURA
        WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;

    SELECT NVL(MAX(NIDCAPACITACION),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_CAPACITACION;
    IF V_NCOUNT > 0 THEN
        Insert into TR_CAPACITACION
           (NIDCAPACITACION, NIDPROCESOUSU, NMESDESDE, NANIODESDE, NMESHASTA,
            NANIOHASTA, SCURSO, SINTITUCION, NHORAS, SFOLIO,
            BACTIVO, NIDUSUCREACION, DFECHACREACION, SRUTADOC)
        SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, NMESDESDE, NANIODESDE, NMESHASTA,
            NANIOHASTA, SCURSO, SINTITUCION, NHORAS, SFOLIO,
            BACTIVO, P_NUSUARIO, V_FECHA, SRUTADOC
        FROM TR_CAPACITACION
        WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;

    SELECT NVL(MAX(NIDCONOCIMIENTOINF),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_CONOCIMIENTOINF;
    IF V_NCOUNT > 0 THEN
         Insert into TR_CONOCIMIENTOINF
           (NIDCONOCIMIENTOINF, NIDPROCESOUSU, SCONOCIMIENTO, BTIPO, SFOLIO,
            BACTIVO, NIDUSUCREACION, DFECHACREACION, SRUTADOC)
        SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, SCONOCIMIENTO, BTIPO, SFOLIO,
            BACTIVO, P_NUSUARIO, V_FECHA, SRUTADOC
        FROM TR_CONOCIMIENTOINF
        WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;

    SELECT NVL(MAX(NIDCONOCIMIENTO),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_CONOCIMIENTO;
    IF V_NCOUNT > 0 THEN
        Insert into TR_CONOCIMIENTO
            (NIDCONOCIMIENTO, NIDPROCESOUSU, SDESCRIPCION, BACTIVO, NIDUSUCREACION, DFECHACREACION, NIDTIPO)
        SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, SDESCRIPCION, BACTIVO, P_NUSUARIO, V_FECHA,NIDTIPO
        FROM TR_CONOCIMIENTO
        WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;
    SELECT NVL(MAX(NIDRNA),0), SUM(DECODE(NIDPROCESOUSU,V_NIDPROCESOUSU,BACTIVO,0))
    INTO V_NID, V_NCOUNT
    FROM TR_RNA;
    IF V_NCOUNT > 0 THEN
        Insert into TR_RNA
            (NIDRNA, NIDPROCESOUSU, SCODIGO_INS, BACTIVO, NIDUSUCREACION, DFECHACREACION, DFECHA_REG)
        SELECT V_NID + ROWNUM, P_NIDPROCESOUSU, SCODIGO_INS, BACTIVO, P_NUSUARIO, V_FECHA,DFECHA_REG
        FROM TR_RNA
        WHERE BACTIVO = 1 AND NIDPROCESOUSU = V_NIDPROCESOUSU;
    END IF;
 EXCEPTION WHEN OTHERS THEN
        P_SMENSAJE:= 'OCURRIÓ UN ERROR AL PROCESAR.';
 END   SP_CARGA_CV;
 FUNCTION F_CALCULA_EXP_ACUM(P_NIDPROCESOUSU IN NUMBER, P_STIPO IN VARCHAR2, P_SDATO IN VARCHAR2) RETURN VARCHAR2 IS
    V_SRPTA VARCHAR2(200) :='NOK';
    V_DFINI DATE;
    V_DFFIN DATE:= TO_DATE('19000101','YYYYMMDD');
    V_NEXP VARCHAR(100);
    V_NDIAS NUMBER := 0;
    V_NMESES NUMBER := 0;
    V_NANIOS NUMBER := 0;
 BEGIN
    FOR C IN
    (SELECT DFECHA_DESDE,DFECHA_HASTA
        FROM TR_EXPERIENCIA
        WHERE NIDPROCESOUSU = P_NIDPROCESOUSU AND (P_STIPO = 'G' OR BESPECIFICA = 1) AND BACTIVO = 1
        ORDER BY DFECHA_DESDE)
    LOOP
        IF C.DFECHA_DESDE < V_DFFIN THEN
           V_DFINI := V_DFFIN + 1;
        ELSE
            V_DFINI := C.DFECHA_DESDE;
        END IF;
        IF V_DFINI < C.DFECHA_HASTA THEN
            V_DFFIN := C.DFECHA_HASTA;
            V_NEXP:= PKG_CAS_DML.F_CALCULA_EXPERIENCIA(V_DFINI, V_DFFIN, 'N');
            V_NANIOS := V_NANIOS + TO_NUMBER(SUBSTR(V_NEXP,1,INSTR(V_NEXP,'|') - 1));
            V_NEXP := SUBSTR(V_NEXP,INSTR(V_NEXP,'|') + 1);
            V_NMESES := V_NMESES + TO_NUMBER(SUBSTR(V_NEXP,1,INSTR(V_NEXP, '|') - 1));
            V_NEXP := SUBSTR(V_NEXP,INSTR(V_NEXP,'|') + 1);
            V_NDIAS := V_NDIAS + TO_NUMBER(V_NEXP);
            IF V_NDIAS >= 30 THEN
                V_NMESES := V_NMESES + 1;
                V_NDIAS := V_NDIAS - 30;
            END IF;
            IF V_NMESES >=12 THEN
                V_NANIOS := V_NANIOS + 1 ;
                V_NMESES := V_NMESES - 12;
            END IF;
        ELSE
            V_DFINI := V_DFFIN - 1;
        END IF;
    END LOOP;
    V_SRPTA := CASE P_SDATO WHEN 'L' THEN TO_CHAR(V_NANIOS) || ' año(s) '||TO_CHAR(V_NMESES) ||' mes(es) '||TO_CHAR(V_NDIAS) || ' día(s)'
                            ELSE  TO_CHAR(V_NANIOS + (V_NMESES/12)) END;
    RETURN V_SRPTA;
 EXCEPTION WHEN OTHERS THEN
   RETURN V_SRPTA;
 END F_CALCULA_EXP_ACUM;
 PROCEDURE SP_GUARDAR_RNA (P_NIDRNA IN OUT NUMBER,
                                    P_NIDPROCESOUSU IN NUMBER,
                                    P_SCODIGO_INS IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_DFECHA_REG IN DATE) AS

  V_FECHA DATE;
  BEGIN
  V_FECHA:=SYSDATE;

  IF  P_NIDRNA = 0 THEN
    SELECT NVL(MAX(C.NIDRNA),0)+1 INTO P_NIDRNA FROM TR_RNA C;

    INSERT INTO TR_RNA  (NIDRNA,NIDPROCESOUSU,SCODIGO_INS,BACTIVO,NIDUSUCREACION,DFECHACREACION, DFECHA_REG)
                               VALUES (P_NIDRNA,P_NIDPROCESOUSU,P_SCODIGO_INS,1,P_NUSUARIO,V_FECHA, P_DFECHA_REG);
  ELSE
    IF P_BACTIVO=0 THEN
      UPDATE TR_RNA SET BACTIVO=0,
                                       NIDUSUEDICION=P_NUSUARIO,
                                       DFECHAEDICION=V_FECHA
      WHERE NIDRNA = P_NIDRNA;
    ELSE
      UPDATE TR_RNA SET SCODIGO_INS=P_SCODIGO_INS,
                              NIDUSUEDICION=P_NUSUARIO,
                              DFECHAEDICION=V_FECHA,
                              DFECHA_REG = P_DFECHA_REG
      WHERE NIDRNA = P_NIDRNA;
    END IF;
  END IF;

END SP_GUARDAR_RNA;
PROCEDURE SP_GUARDAR_TGD (P_NIDITEM IN OUT NUMBER,
                                    P_NIDTABLA IN NUMBER,
                                    P_SDITEM IN VARCHAR2,
                                    P_BACTIVO  IN NUMBER,
                                    P_NUSUARIO IN NUMBER,
                                    P_SSITEM IN VARCHAR2,
                                    P_SFECHA1 IN VARCHAR2,
                                    P_SFECHA2 IN VARCHAR2) AS

  V_FECHA DATE;
  V_FECHA1 DATE;
  V_FECHA2 DATE;
  V_UEJECOD VARCHAR2(3);
  BEGIN
  V_FECHA:=SYSDATE;
  BEGIN
  V_FECHA1 := TO_DATE(P_SFECHA1,'DD/MM/YYYY HH24:MI');
  V_FECHA2 := TO_DATE(P_SFECHA2,'DD/MM/YYYY HH24:MI');
  EXCEPTION WHEN OTHERS THEN
  V_FECHA1 := NULL;
  V_FECHA2 := NULL;
  END;
  IF P_NIDTABLA IN (4,15) THEN
  /*  BEGIN
      SELECT NVL(IDUEJECOD,'001') INTO V_UEJECOD
      FROM MCSGAGEN.TM_SGAUSUARIO WHERE NCODIGOUSUARIO = P_NUSUARIO;
    EXCEPTION WHEN OTHERS THEN*/
      V_UEJECOD := '001';  
  --  END;
      IF  P_NIDITEM = 0 THEN
        SELECT NVL(MAX(D.nidconvocatoria),0)+1 INTO P_NIDITEM FROM tm_convocatoria D;
        INSERT INTO tm_convocatoria  (nidconvocatoria, iduejecod, dconvocatoria, sconvocatoriA, nanio, ntipo, dfechaini, dfechafin, bactivo, dfechacreacion, nidusucreacioN)
                           VALUES ( P_NIDITEM, V_UEJECOD,P_SDITEM,P_SSITEM,NULL,DECODE(P_NIDTABLA,4,1,2),V_FECHA1,V_FECHA2,P_BACTIVO,V_FECHA,P_NUSUARIO);
      ELSE
        IF P_BACTIVO=2 THEN
          UPDATE tm_convocatoria SET BACTIVO=P_BACTIVO,
                                           NIDUSUEDICION=P_NUSUARIO,
                                           DFECHAEDICION=V_FECHA
          WHERE  nidconvocatoria = P_NIDITEM;
        ELSE
          UPDATE tm_convocatoria SET DconvocatoriA=P_SDITEM,
                                  NIDUSUEDICION=P_NUSUARIO,
                                  DFECHAEDICION=V_FECHA,
                                  SconvocatoriA = P_SSITEM,
                                  BACTIVO=P_BACTIVO,
                                  dfechaini=V_FECHA1,
                                  dfechafin=V_FECHA2
          WHERE nidconvocatoria = P_NIDITEM;
        END IF;
      END IF;
  ELSE
      IF  P_NIDITEM = 0 THEN
        SELECT NVL(MAX(D.NIDITEM),0)+1 INTO P_NIDITEM FROM TM_TABLA_GENERAL_D D WHERE NIDTABLA = P_NIDTABLA;

        INSERT INTO TM_TABLA_GENERAL_D  (NIDTABLA, NIDITEM,SDITEM,BACTIVO,NIDUSUCREACION,DFECHACREACION, SSITEM, DFECHA1, DFECHA2)
                           VALUES (P_NIDTABLA, P_NIDITEM,P_SDITEM,P_BACTIVO,P_NUSUARIO,V_FECHA, P_SSITEM,V_FECHA1,V_FECHA2);
      ELSE
        IF P_BACTIVO=2 THEN
          UPDATE TM_TABLA_GENERAL_D SET BACTIVO=P_BACTIVO,
                                           NIDUSUEDICION=P_NUSUARIO,
                                           DFECHAEDICION=V_FECHA
          WHERE NIDTABLA = P_NIDTABLA AND NIDITEM = P_NIDITEM;
        ELSE
          UPDATE TM_TABLA_GENERAL_D SET SDITEM=P_SDITEM,
                                  NIDUSUEDICION=P_NUSUARIO,
                                  DFECHAEDICION=V_FECHA,
                                  SSITEM = P_SSITEM,
                                  BACTIVO=P_BACTIVO,
                                  DFECHA1=V_FECHA1,
                                  DFECHA2=V_FECHA2
          WHERE NIDTABLA = P_NIDTABLA AND NIDITEM = P_NIDITEM;
        END IF;
      END IF;
  END IF;

END SP_GUARDAR_TGD;

PROCEDURE SP_GUARDAR_ESTADO_EVAL(P_NIDCONVOCATORIA NUMBER,
                                    P_NIDESTADO NUMBER,
                                    P_NIDUSU NUMBER,
                                    P_SOBSERVACION VARCHAR2,
                                    P_TIPO_EST NUMBER, -- 1 INI, 2 FIN
                                    P_RESULTADO OUT VARCHAR) AS
 V_FECHA DATE;
 V_COUNT NUMBER;
BEGIN
 V_FECHA:=SYSDATE;
 P_RESULTADO:='OK';
    SELECT COUNT(1) INTO V_COUNT
    FROM TR_ESTADO_EVAL
    WHERE NIDCONVOCATORIA = P_NIDCONVOCATORIA AND NIDESTADO = P_NIDESTADO AND DECODE(P_TIPO_EST,1,1,2,DECODE(DFECHAFIN,NULL,0,1)) = 1;

    IF V_COUNT > 0 THEN
        P_RESULTADO :='ESTA ETAPA YA FUE '|| CASE P_TIPO_EST WHEN 1 THEN 'INICIADA' ELSE 'FINALIZADA' END;
        RETURN;
    END IF;
    IF P_TIPO_EST = 1 THEN
        SELECT COUNT(1) INTO V_COUNT
        FROM TR_ESTADO_EVAL
        WHERE NIDCONVOCATORIA = P_NIDCONVOCATORIA AND DFECHAFIN IS NULL;
        IF V_COUNT > 0 THEN
            P_RESULTADO :='TIENE OTRA ETAPA DE EVALUACION EN CURSO.';
            RETURN;
        END IF;
    END IF;

    IF P_TIPO_EST = 2 THEN
        SELECT COUNT(1) INTO V_COUNT
        FROM TR_ESTADO_EVAL
        WHERE NIDCONVOCATORIA = P_NIDCONVOCATORIA AND NIDESTADO = P_NIDESTADO;
        IF V_COUNT = 0 THEN
            P_RESULTADO :='AUN NO HA INICIADO ESTA ETAPA DE EVALUACION.';
            RETURN;
        END IF;
    END IF;

    IF  P_TIPO_EST = 1 THEN
        INSERT INTO TR_ESTADO_EVAL  (NIDCONVOCATORIA,NIDESTADO,DFECHAINI,NIDUSUINI,SOBSERVACION)
                       VALUES (P_NIDCONVOCATORIA,P_NIDESTADO,V_FECHA,P_NIDUSU,P_SOBSERVACION);
    ELSE
        UPDATE TR_ESTADO_EVAL
        SET DFECHAFIN = V_FECHA,
            NIDUSUFIN = P_NIDUSU
        WHERE NIDCONVOCATORIA = P_NIDCONVOCATORIA
            AND NIDESTADO = P_NIDESTADO;
    END IF;
    EXCEPTION WHEN OTHERS THEN
        P_RESULTADO:='OCURRIO UN ERROR; '||SQLERRM;
END SP_GUARDAR_ESTADO_EVAL;
PROCEDURE SP_PROCESAR_GANADORES(P_NIDCONVOCATORIA NUMBER,
                                    P_SOBSERVACION VARCHAR2,
                                    P_NIDPROCESO NUMBER,
                                    P_NUSUARIO NUMBER,
                                    P_RESULTADO OUT VARCHAR) AS
 V_FECHA DATE;
 V_COUNT NUMBER;
BEGIN
    V_FECHA:=SYSDATE;
    P_RESULTADO:='OK';
    V_COUNT :=1;
    FOR C_PROCESOS IN (
            SELECT NIDPROCESO,NPLAZAS,NELENCO FROM TR_PROCESO WHERE NIDCONVOCATORIA = P_NIDCONVOCATORIA AND (NIDPROCESO = P_NIDPROCESO OR P_NIDPROCESO = 0)
    )LOOP
        V_COUNT:=1;
        FOR C_PR_USU_AP IN (
            SELECT NIDPROCESOUSU, (DECODE(C_PROCESOS.NELENCO,1,30,50) + NEVAL_TECNICA + NPUNTAJE + (BFA*0.1*(NPUNTAJE + (DECODE(C_PROCESOS.NELENCO,1,30,50)))) +  (BDISC*0.15*(NPUNTAJE + neval_tecnica + DECODE(C_PROCESOS.NELENCO,1,30,50)))) NTOTAL,(BFA*0.1*(NPUNTAJE + (DECODE(C_PROCESOS.NELENCO,1,30,50)))) BFA, (BDISC*0.15*(NPUNTAJE + neval_tecnica + DECODE(C_PROCESOS.NELENCO,1,30,50))) BDISC FROM
            (SELECT PU.NIDPROCESOUSU, NVL(MAX(decode(dp.nexcluido_ffaa,1,0,DA.BFUERZAARMADA)),0) BFA, NVL(MAX(DA.BDISCAPACIDAD),0) BDISC,
         NVL(f_getCalificacion (PU.NIDPROCESOUSU, 2),0) NEVAL_CUR,
         nvl(MAX(DECODE(PE.NTIPO_EVAL,3,PE.NCALIFICACION)),0) NEVAL_TECNICA,
          nvl(MAX(DECODE(PE.NTIPO_EVAL,4,PE.NCALIFICACION)),0) NPUNTAJE
         FROM TR_PROCESOUSUARIO PU INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
         LEFT JOIN TR_PROCESOUSUARIO_EVAL PE ON PE.NIDPROCESOUSU = PU.NIDPROCESOUSU
         LEFT JOIN TR_DATOSADICIONALES DA ON DA.NIDPROCESOUSU = PU.NIDPROCESOUSU
         WHERE PU.BACTIVO = 1 AND PU.BESTADO = 2 AND PU.NIDPROCESO = C_PROCESOS.NIDPROCESO AND NVL(NGANADOR,0) <> 99 AND PU.NFIRMA <> 2
         GROUP BY PU.NIDPROCESOUSU)
            WHERE NEVAL_CUR = 1 ORDER BY NTOTAL DESC
        ) LOOP
            UPDATE TR_PROCESOUSUARIO SET NGANADOR = 0,NPUNTAJE = 0,NADIC_DISC = 0,NADIC_FFAA = 0 WHERE NIDPROCESOUSU = C_PR_USU_AP.NIDPROCESOUSU;
            IF ((C_PR_USU_AP.NTOTAL >=70 and C_PROCESOS.NELENCO = 1) or C_PR_USU_AP.NTOTAL >=80) THEN
                IF V_COUNT <= C_PROCESOS.NPLAZAS THEN
                    UPDATE TR_PROCESOUSUARIO SET NGANADOR = 1,DFECHAEDICION = V_FECHA WHERE NIDPROCESOUSU = C_PR_USU_AP.NIDPROCESOUSU;
                ELSIF V_COUNT = C_PROCESOS.NPLAZAS + 1 THEN
                    UPDATE TR_PROCESOUSUARIO SET NGANADOR = 2,DFECHAEDICION = V_FECHA WHERE NIDPROCESOUSU = C_PR_USU_AP.NIDPROCESOUSU;
                ELSIF V_COUNT = C_PROCESOS.NPLAZAS + 2 THEN
                    UPDATE TR_PROCESOUSUARIO SET NGANADOR = 3,DFECHAEDICION = V_FECHA WHERE NIDPROCESOUSU = C_PR_USU_AP.NIDPROCESOUSU;
                END IF;
            END IF;
            UPDATE TR_PROCESOUSUARIO SET NPUNTAJE = C_PR_USU_AP.NTOTAL, NADIC_DISC =  C_PR_USU_AP.BDISC, NADIC_FFAA =  C_PR_USU_AP.BFA  WHERE NIDPROCESOUSU = C_PR_USU_AP.NIDPROCESOUSU;
            V_COUNT := V_COUNT + 1;
            UPDATE TR_PROCESOCOMITE SET NMODIFICA = 0 WHERE NIDPROCESO = C_PROCESOS.NIDPROCESO;
        END LOOP;
    END LOOP;
    IF P_NIDPROCESO = 0 THEN
        SELECT COUNT(1) INTO V_COUNT
        FROM TR_ESTADO_EVAL
        WHERE NIDCONVOCATORIA = P_NIDCONVOCATORIA AND NIDESTADO = 5;
        IF V_COUNT > 0 THEN
            UPDATE TR_ESTADO_EVAL
                SET DFECHAFIN = V_FECHA,
                    NIDUSUFIN = P_NUSUARIO
            WHERE NIDCONVOCATORIA = P_NIDCONVOCATORIA
                AND NIDESTADO = 5;
        ELSE
            INSERT INTO TR_ESTADO_EVAL  (NIDCONVOCATORIA,NIDESTADO,DFECHAINI,NIDUSUINI,SOBSERVACION)
                       VALUES (P_NIDCONVOCATORIA,5,V_FECHA,P_NUSUARIO,P_SOBSERVACION);
        END IF;
    END IF;
END SP_PROCESAR_GANADORES;
PROCEDURE SP_HABILITAR_CALIFICAR(P_NIDCOMITE NUMBER,
                                    P_NIDUSU NUMBER,
                                    P_RESULTADO OUT VARCHAR) AS
 V_FECHA DATE;
BEGIN
 V_FECHA:=SYSDATE;
 P_RESULTADO:='OK';
 UPDATE TR_PROCESOCOMITE SET NMODIFICA = 1, NIDUSUEDICION = P_NIDUSU, DFECHAEDICION = V_FECHA
 WHERE NIDCOMITE = P_NIDCOMITE;
EXCEPTION WHEN OTHERS THEN
    P_RESULTADO:='OCURRIO UN ERROR; '||SQLERRM;
END SP_HABILITAR_CALIFICAR;
PROCEDURE SP_GUARDAR_BASES( P_NIDREGISTRO IN OUT NUMBER,
                            P_TIPO_TABLA IN NUMBER,
                            P_NIDPROCESO IN NUMBER,
                            P_NIDTIPO IN NUMBER,
                            P_SDESCRIPCION IN VARCHAR2,
                            P_BACTIVO  IN NUMBER,
                            P_NPRIORIDAD  IN NUMBER,
                            P_NUSUARIO IN NUMBER,
                            P_SFECHA1 IN VARCHAR2,
                            P_SFECHA2 IN VARCHAR2) AS

  V_FECHA DATE;
  V_FECHA1 DATE;
  V_FECHA2 DATE;
  V_NPRIORIDAD NUMBER;
  BEGIN
  V_FECHA:=SYSDATE;
  BEGIN
  V_FECHA1 := TO_DATE(P_SFECHA1,'DD/MM/YYYY HH24:MI');
  V_FECHA2 := TO_DATE(P_SFECHA2,'DD/MM/YYYY HH24:MI');
  EXCEPTION WHEN OTHERS THEN
  V_FECHA1 := NULL;
  V_FECHA2 := NULL;
  END;
  IF P_TIPO_TABLA = 1 THEN -- tr_proceso_bases
      IF  P_NIDREGISTRO = 0 THEN
        SELECT NVL(MAX(NIDREGISTRO),0)+1 INTO P_NIDREGISTRO FROM tr_proceso_bases ;
        SELECT NVL(MAX(NPRIORIDAD),0)+1 INTO V_NPRIORIDAD FROM tr_proceso_bases WHERE NIDPROCESO = P_NIDPROCESO AND nidtipo_base = P_NIDTIPO;
        INSERT INTO tr_proceso_bases  (nidproceso,NIDREGISTRO, nidtipo_base,sdescripcion,BACTIVO,NIDUSUCREACION,DFECHACREACION, nprioridad)
                           VALUES (P_NIDPROCESO,P_NIDREGISTRO, P_NIDTIPO,P_SDESCRIPCION,P_BACTIVO,P_NUSUARIO,V_FECHA, V_NPRIORIDAD);
      ELSE
        IF P_BACTIVO=0 THEN
          UPDATE tr_proceso_bases SET BACTIVO=P_BACTIVO,
                                           NIDUSUEDICION=P_NUSUARIO,
                                           DFECHAEDICION=V_FECHA
          WHERE NIDREGISTRO = P_NIDREGISTRO;
        ELSE
          SELECT NPRIORIDAD INTO V_NPRIORIDAD FROM tr_proceso_bases WHERE NIDREGISTRO = P_NIDREGISTRO;

          IF V_NPRIORIDAD <> P_NPRIORIDAD THEN
            UPDATE tr_proceso_bases SET NPRIORIDAD=NPRIORIDAD + 1
            WHERE NIDPROCESO = P_NIDPROCESO AND nidtipo_base = P_NIDTIPO AND NPRIORIDAD >= P_NPRIORIDAD;
          END IF;

          UPDATE tr_proceso_bases SET SDESCRIPCION=P_SDESCRIPCION,
                                  NIDTIPO_BASE=P_NIDTIPO,
                                  DFECHAEDICION=V_FECHA,
                                  NPRIORIDAD=P_NPRIORIDAD
          WHERE NIDREGISTRO = P_NIDREGISTRO;

        END IF;
      END IF;
  ELSIF P_TIPO_TABLA = 2 THEN -- tr_proceso_cronograma
    IF  P_NIDREGISTRO = 0 THEN
        SELECT NVL(MAX(NIDREGISTRO),0)+1 INTO P_NIDREGISTRO FROM tr_proceso_cronograma ;

        INSERT INTO tr_proceso_cronograma  (NIDREGISTRO,nidproceso, nidtipo_fecha,dfechaini,BACTIVO,NIDUSUCREACION,DFECHACREACION, dfechaFIN)
                                        VALUES (P_NIDREGISTRO, P_NIDPROCESO ,P_NIDTIPO,V_FECHA1,P_BACTIVO,P_NUSUARIO,V_FECHA, V_FECHA2);
      ELSE
        IF P_BACTIVO=0 THEN
          UPDATE tr_proceso_cronograma SET BACTIVO=P_BACTIVO,
                                           NIDUSUEDICION=P_NUSUARIO,
                                           DFECHAEDICION=V_FECHA
          WHERE NIDREGISTRO = P_NIDREGISTRO;
        ELSE
          UPDATE tr_proceso_cronograma SET dfechaini=V_FECHA1,
                                dfechaFIN=V_FECHA2,
                                  nidtipo_fecha=P_NIDTIPO,
                                  DFECHAEDICION=V_FECHA
          WHERE NIDREGISTRO = P_NIDREGISTRO;
        END IF;
      END IF;
  END IF;
END SP_GUARDAR_BASES;
PROCEDURE SP_DESCALIFICAR_POSTULANTE(P_NIDPROCESOUSU NUMBER,
                                    P_NIDUSU VARCHAR2,
                                    P_RESULTADO OUT VARCHAR) AS
 V_FECHA DATE;
BEGIN
 V_FECHA:=SYSDATE;
 P_RESULTADO:='OK';
 UPDATE TR_PROCESOUSUARIO SET NGANADOR = 99, NIDUSUEDICION = P_NIDUSU, DFECHAEDICION = V_FECHA
 WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
EXCEPTION WHEN OTHERS THEN
    P_RESULTADO:='OCURRIO UN ERROR; '||SQLERRM;
END SP_DESCALIFICAR_POSTULANTE;
PROCEDURE SP_CARGAR_CRONOGRAMA(P_NIDCONVOCATORIA NUMBER,
                                    P_NIDPROCESO NUMBER,
                                    P_NUSUARIO NUMBER,
                                    P_RESULTADO OUT VARCHAR) AS
V_NIDREGISTRO NUMBER;
V_FECHA DATE;
BEGIN
    V_FECHA:=SYSDATE;
    P_RESULTADO:='OK';
    SELECT NVL(MAX(NIDREGISTRO),0)+1 INTO V_NIDREGISTRO
    FROM tr_proceso_cronograma ;
    FOR C IN (SELECT DISTINCT NIDTIPO_FECHA,DFECHAINI,DFECHAFIN
                FROM TR_PROCESO P INNER JOIN TR_PROCESO_CRONOGRAMA C ON C.NIDPROCESO = P.NIDPROCESO
                WHERE P.NIDCONVOCATORIA = P_NIDCONVOCATORIA AND C.BACTIVO = 1 and P.BACTIVO = 1 ) LOOP
                    INSERT INTO tr_proceso_cronograma  (NIDREGISTRO,nidproceso, nidtipo_fecha,dfechaini,BACTIVO,NIDUSUCREACION,DFECHACREACION, dfechaFIN)
                    VALUES (V_NIDREGISTRO, P_NIDPROCESO ,C.NIDTIPO_FECHA,C.DFECHAINI,1,P_NUSUARIO,V_FECHA, C.DFECHAFIN);
                    V_NIDREGISTRO := V_NIDREGISTRO + 1;
                END LOOP;
EXCEPTION WHEN OTHERS THEN
    P_RESULTADO:='OCURRIO UN ERROR; '||SQLERRM;
END SP_CARGAR_CRONOGRAMA;
PROCEDURE SP_GUARDAR_CONTRATO (P_NRO_CONTRATO IN OUT NUMBER,
                                P_NIDPROCESOUSU NUMBER,
                                P_NOMBRE_ANIO VARCHAR2, 
                                P_SEXO_DIR CHAR,
                                P_NOMBRE_DIR VARCHAR2,
                                P_DNI_DIR VARCHAR2,
                                P_DRESOLUCION VARCHAR2,
                                P_FECHA_RESOL VARCHAR2,
                                P_NOMBRE_TRAB VARCHAR2,
                                P_DNI_TRAB VARCHAR2,
                                P_RUC_TRAB VARCHAR2,
                                P_SERVICIO VARCHAR2,
                                P_FINI_CONTRATO VARCHAR2,
                                P_FFIN_CONTRATO VARCHAR2,
                                P_NSUELDO NUMBER,
                                P_DSUELDO VARCHAR2,
                                P_OFICINA VARCHAR2,
                                P_NRO_CONVOCATORIA VARCHAR2,
                                P_FECHA_SUSCRIPCION VARCHAR2,
                                P_USUARIO NUMBER,
                                    P_RESULTADO OUT VARCHAR2,
                                    P_DIRECCION VARCHAR2) AS

  V_FECHA DATE;
  V_FINI DATE;
  V_FFIN DATE;
  V_FSUS DATE;
  V_FRES DATE;
  BEGIN
      V_FECHA:=SYSDATE;
      P_RESULTADO := 'OK';
      BEGIN
          V_FINI := TO_DATE(P_FINI_CONTRATO,'DD/MM/YYYY HH24:MI');
          V_FFIN := TO_DATE(P_FFIN_CONTRATO,'DD/MM/YYYY HH24:MI');
          V_FSUS := TO_DATE(P_FECHA_SUSCRIPCION,'DD/MM/YYYY HH24:MI');
          V_FRES := TO_DATE(P_FECHA_RESOL,'DD/MM/YYYY HH24:MI');
      EXCEPTION WHEN OTHERS THEN
          P_RESULTADO := 'UNA DE LAS FECHAS NO TIENE FORMATO CORRECTO';
      END;
      IF  P_NRO_CONTRATO = 0 THEN
        SELECT NVL(MAX(NRO_CONTRATO),0)+1 INTO P_NRO_CONTRATO FROM TR_CONTRATO;

        INSERT INTO TR_CONTRATO  (NRO_CONTRATO,NIDPROCESOUSU,NOMBRE_ANIO,SEXO_DIR,NOMBRE_DIR,DNI_DIR,DRESOLUCION,FECHA_RESOL,NOMBRE_TRAB,
                                            DNI_TRAB,RUC_TRAB,SERVICIO,FINI_CONTRATO,FFIN_CONTRATO,NSUELDO,DSUELDO,OFICINA,NRO_CONVOCATORIA,FECHA_SUSCRIPCION,
                                            NIDUSUARIO_CREA,DFECHA_CREA, SDIRECCION)
                           VALUES (P_NRO_CONTRATO,P_NIDPROCESOUSU,P_NOMBRE_ANIO,P_SEXO_DIR,P_NOMBRE_DIR,P_DNI_DIR,P_DRESOLUCION,V_FRES,P_NOMBRE_TRAB,
                                    P_DNI_TRAB,P_RUC_TRAB,P_SERVICIO,V_FINI,V_FFIN,P_NSUELDO,P_DSUELDO,P_OFICINA,P_NRO_CONVOCATORIA,V_FSUS,
                                   P_USUARIO, V_FECHA,P_DIRECCION);
      ELSE
          UPDATE TR_CONTRATO SET 
                                NOMBRE_ANIO = NOMBRE_ANIO,
                                SEXO_DIR= SEXO_DIR,
                                NOMBRE_DIR= NOMBRE_DIR,
                                DNI_DIR= DNI_DIR,
                                DRESOLUCION= DRESOLUCION,
                                FECHA_RESOL= V_FRES,
                                NOMBRE_TRAB= NOMBRE_TRAB,
                                DNI_TRAB= DNI_TRAB,
                                RUC_TRAB= RUC_TRAB,
                                SERVICIO= SERVICIO,
                                FINI_CONTRATO= V_FINI,
                                FFIN_CONTRATO= V_FFIN,
                                NSUELDO= NSUELDO,
                                DSUELDO= DSUELDO,
                                OFICINA= OFICINA,
                                NRO_CONVOCATORIA= NRO_CONVOCATORIA,
                                FECHA_SUSCRIPCION= V_FSUS,
                                DFECHA_MOD = V_FECHA,
                                NIDUSUARIO_MOD = P_USUARIO,
                                SDIRECCION = P_DIRECCION
          WHERE NRO_CONTRATO = P_NRO_CONTRATO;
      END IF;
EXCEPTION WHEN OTHERS THEN
    P_RESULTADO:='OCURRIO UN ERROR; '||SQLERRM;
END SP_GUARDAR_CONTRATO;
PROCEDURE SP_PROCESAR_FIRMA(P_NIDPROCESOUSU NUMBER,
                                    P_NFIRMA VARCHAR2,
                                    P_DFECHAFIRMA VARCHAR2,
                                    P_DFECHAGANADOR VARCHAR2,
                                    P_NIDUSU VARCHAR2,
                                    P_RESULTADO OUT VARCHAR)
  AS
  V_F_FIRMA DATE;
  V_F_GANADOR DATE;
BEGIN
    P_RESULTADO := 'OK';
    V_F_FIRMA := TO_DATE(P_DFECHAFIRMA,'DD/MM/YYYY');
    V_F_GANADOR := TO_DATE(P_DFECHAGANADOR,'DD/MM/YYYY');
    
    UPDATE TR_PROCESOUSUARIO SET NFIRMA = P_NFIRMA,
                                DFECHA_FIRMA = V_F_FIRMA,
                                DFECHAEDICION = V_F_GANADOR,
                                NIDUSUEDICION = P_NIDUSU
    WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
EXCEPTION WHEN OTHERS THEN
    P_RESULTADO:='OCURRIO UN ERROR; '||SQLERRM;
END SP_PROCESAR_FIRMA;        
END PKG_CAS_DML;
/

CREATE PACKAGE "MCCAS2"."PKG_CAS_READ"
AS

TYPE RESULTADO_CURSOR IS REF CURSOR;

  PROCEDURE SP_LISTA_MENU_PERFIL(V_NCODPERFIL_IN IN NUMBER,
                                  CURSORS OUT SYS_REFCURSOR, 
                                  V_NIDUSUARIO_IN IN NUMBER);

  PROCEDURE SP_OBT_TIPO_FORM (C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_OBT_DEPARTAMENTO (C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_OBT_PROVINCIA (P_NDEPARTAMENTO IN  VARCHAR2,
                               C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_OBT_DISTRITO(P_NPROVINCIA in VARCHAR2,
                             C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_OBT_ESTADOCIVIL (C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONSULTA_DATOSPERS (P_NIDCODIGOUSUARIO IN NUMBER,
                                  C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_OBT_PROCESODISPO(P_NCODIGOUSUARIO in NUMBER, P_NTIPO in NUMBER,
                                C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_LISTA_PROCXUSU(P_NCODIGOUSUARIO in NUMBER,
                              C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_LISTA_PROCESO(P_NOPT in NUMBER, P_NIDPROCESO in NUMBER,P_NIDCONVOCATORIA in NUMBER,
                             C_DATA OUT SYS_REFCURSOR,P_NUSUARIO in NUMBER);
  FUNCTION F_CONCATENA_ITEMS(P_NIDTABLA NUMBER, P_SIDS VARCHAR2) RETURN VARCHAR2;

  PROCEDURE SP_LISTA_PERSONAL(P_NOPT in NUMBER,
                             C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_LISTA_PROCESOCOMITE(P_NOPT in NUMBER,
                                   P_NIDPROCESO in NUMBER,
                                   P_NIDPERSONAL in NUMBER,
                                   C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_LISTA_POSTULACION(P_NOPT in NUMBER,
                                 P_NIDPROCESO in NUMBER,
                                 P_NTIPO_EVALUADOR in NUMBER,
                                 C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONSULTA_PROCUSU(P_NIDPROCESOUSU in NUMBER,
                                C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_FORMACIONAC(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_COLEGIATURA(P_NIDPROCESOUSU in NUMBER,
                                C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_CAPACITACION(P_NIDPROCESOUSU in NUMBER,
                                    C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_CONOCIMIENTO(P_NIDPROCESOUSU in NUMBER,
                                      C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_CONOCIMIENTOINF(P_NIDPROCESOUSU in NUMBER,
                                      C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_IDIOMA(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_EXPERIENCIA(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_DATOSADIC(P_NIDPROCESOUSU in NUMBER,
                                  C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONS_DATOSPERS(P_NIDPROCESOUSU in NUMBER,
                              C_DATA OUT SYS_REFCURSOR);
  PROCEDURE SP_CONS_EXP_ACUM(P_NIDPROCESOUSU in NUMBER,
                                P_SEXP_ESP OUT VARCHAR2,
                                P_SEXP_GEN OUT VARCHAR2);
  PROCEDURE SP_CONS_TABLA_D(P_NIDTABLA in NUMBER,
                            P_SDATO VARCHAR2,
                            P_NIDPROCESO NUMBER,
                            C_DATA OUT SYS_REFCURSOR);
  PROCEDURE SP_CONS_TABLA_C(C_DATA OUT SYS_REFCURSOR);
  PROCEDURE SP_CONS_RNA(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR);
  PROCEDURE SP_LISTA_ESTADOS_CONV(P_NIDCONVOCATORIA in NUMBER,
                                    C_DATA OUT SYS_REFCURSOR)     ;

  PROCEDURE SP_LISTA_POST_RESULT(P_NOPT in NUMBER, P_NIDPROCESO in NUMBER,
                                    C_DATA OUT SYS_REFCURSOR);
    PROCEDURE SP_LISTA_BASES(P_NOPT IN NUMBER, P_NIDPROCESO IN  NUMBER, C_DATA OUT SYS_REFCURSOR);
    PROCEDURE SP_F_RESULT_FIN_CONV (P_NIDCONVOCATORIA IN  NUMBER, C_DATA OUT SYS_REFCURSOR);
    PROCEDURE SP_LISTA_GANADORES (   C_DATA              OUT SYS_REFCURSOR, PI_IDUSUARIO NUMBER);
    PROCEDURE SP_DATOS_CONTRATO (   P_NOPT IN NUMBER, P_NIDPROCESOUSU IN  NUMBER,   C_DATA OUT SYS_REFCURSOR);
END PKG_CAS_READ;
/
CREATE PACKAGE BODY "MCCAS2"."PKG_CAS_READ"
AS

  PROCEDURE SP_LISTA_MENU_PERFIL(V_NCODPERFIL_IN IN NUMBER,
                                  CURSORS OUT SYS_REFCURSOR, 
                                  V_NIDUSUARIO_IN IN NUMBER) AS
  V_VOL NUMBER:=0;
  BEGIN
    IF V_NCODPERFIL_IN = 204 THEN
        SELECT DECODE(COUNT(1),0,14,0) INTO V_VOL 
        FROM TR_PROCESOUSUARIO PU
         WHERE PU.BACTIVO=1  AND PU.NACTIVIDAD>0 AND PU.BESTADO = 2 AND PU.NIDCODIGOUSUARIO=V_NIDUSUARIO_IN AND PU.NGANADOR = 1;
    END IF;
    OPEN CURSORS FOR
      SELECT M.NCODIGOMENU,
             M.SDESCRIPCION,
             M.SICONCLASS,
             M.SURL,
             NVL(M.LISCLASS,' ') LISCLASS,
             M.NCODIGOPADRE,
             M.SMODULO,
             M.SESTADO,
             M.NORDEN
        FROM TM_MENU M
       INNER JOIN TM_ACCESOS A
          ON M.NCODIGOMENU = A.NCODIGOMENU
       WHERE A.NCODIGOPERFIL = V_NCODPERFIL_IN
         AND A.SESTADO = '1'
         AND M.SESTADO = '1' AND M.NCODIGOMENU != V_VOL
       ORDER BY M.NORDEN;

  END SP_LISTA_MENU_PERFIL;

  PROCEDURE SP_OBT_TIPO_FORM (C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN
    OPEN C_DATA FOR
      select distinct NIDTIPOFORMACION , SDESCRIPCION, BACTIVO
      from TM_TIPOFORMACION WHERE BACTIVO = 1
      order by NIDTIPOFORMACION;

  END SP_OBT_TIPO_FORM;

  PROCEDURE SP_OBT_DEPARTAMENTO (C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN
    OPEN C_DATA FOR
      select distinct NDEPARTAMENTO , SDEPARTAMENTO from VW_DISTRITOS order by sdepartamento;

  END SP_OBT_DEPARTAMENTO;

  PROCEDURE SP_OBT_PROVINCIA (P_NDEPARTAMENTO IN  VARCHAR2,
                               C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
     select distinct NPROVINCIA , SPROVINCIA from VW_DISTRITOS where ndepartamento = P_NDEPARTAMENTO  order by 2;

  END SP_OBT_PROVINCIA;

  PROCEDURE SP_OBT_DISTRITO(P_NPROVINCIA in VARCHAR2,
                             C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
     select distinct NDISTRITO , SDISTRITO from VW_DISTRITOS where nprovincia = P_NPROVINCIA  order by 2;

  END SP_OBT_DISTRITO;

  PROCEDURE SP_OBT_ESTADOCIVIL (C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN
    OPEN C_DATA FOR

    SELECT NIDESTADOCIVIL,SDESCRIPCION FROM TM_ESTADOCIVIL
    WHERE BACTIVO=1;

  END SP_OBT_ESTADOCIVIL;


  PROCEDURE SP_CONSULTA_DATOSPERS (P_NIDCODIGOUSUARIO IN NUMBER,
                                  C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN
    OPEN C_DATA FOR

    SELECT NIDCODIGOUSUARIO,SAPATERNO,SAMATERNO,SNOMBRES,TRUNC((TRUNC(SYSDATE) - DFECHANAC)/365) NEDAD,NIDESTADOCIVIL,SUBIGEONAC,TO_CHAR(DFECHANAC,'DD/MM/YYYY') AS DFECHANAC,SSEXO,SDNI,
           SRUC,SBREVETE,SCATBREVETE,SDIRECCION,SUBIGEODIR,SNROLOTE,STELEFONOFIJO,SCELULAR,SCORREO,BACTIVO,
           NIDUSUCREACION,DFECHACREACION,NIDUSUEDICION,DFECHAEDICION,SRUTADOC,NTIPODOC,SNOMBRE_C,STELEFONO,SPARENTESCO,SRUTADOC_NAC, SPAIS_NAC
    FROM TR_DATOSPERSONALES
    WHERE NIDCODIGOUSUARIO=P_NIDCODIGOUSUARIO;

  END SP_CONSULTA_DATOSPERS;

  PROCEDURE SP_OBT_PROCESODISPO(P_NCODIGOUSUARIO in NUMBER, P_NTIPO in NUMBER,
                                C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT NVL(P.NIDCONVOCATORIA,0),P.NIDPROCESO,P.SSERVICIO,P.SPROCESO,P.SPROCESO || DECODE(P.NTIPO,1,' - ') ||  P.SSERVICIO AS SNOMBRE
        FROM TR_PROCESO P
        INNER JOIN TM_CONVOCATORIA C ON C.NTIPO = P.NTIPO AND P.NIDCONVOCATORIA = C.NIDCONVOCATORIA AND C.BACTIVO = 1 /*AND SYSDATE BETWEEN DFECHA1 AND DFECHA2*/
        WHERE P.BACTIVO=1 AND P.BESTADO=1 AND (P.NTIPO = P_NTIPO ) and nvl(nresultado,0) <> 4
               AND (NVL(P.NIDPROCESO,0) NOT IN (
              SELECT NVL(PU.NIDPROCESO,0)
                                       FROM TR_PROCESOUSUARIO PU --INNER JOIN TR_PROCESO PC ON PU.NIDPROCESO=PC.NIDPROCESO
                                       WHERE PU.NIDCODIGOUSUARIO=P_NCODIGOUSUARIO --AND PC.NTIPO = P.NTIPO
                                             AND PU.BACTIVO!=0 ) OR  P_NTIPO = 2)
        ORDER BY P.SPROCESO, P.SSERVICIO        ;
  END SP_OBT_PROCESODISPO;

  PROCEDURE SP_LISTA_PROCXUSU(P_NCODIGOUSUARIO in NUMBER,
                              C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN
    OPEN C_DATA FOR
        SELECT P.NIDPROCESO,P.SSERVICIO,P.SPROCESO,PU.NIDCODIGOUSUARIO,PU.NIDPROCESOUSU, PU.BESTADO,
        DECODE(P.NTIPO,1,P.SPROCESO || ' - ' ||  P.SSERVICIO,2,P.SSERVICIO || ' - '|| (SELECT A.SNOMBRE FROM TR_ACTIVIDAD A WHERE A.NIDACTIVIDAD = PU.NACTIVIDAD AND P.NIDPROCESO = PU.NIDPROCESO))  AS SNOMBRE,
          CASE WHEN DFECHAINI IS NULL OR DFECHAFIN IS NULL THEN 'NO SE HAN INGRESADO FECHAS DE INICIO Y FIN DE ESTA CONVOCATORIA' ELSE
         (CASE WHEN SYSDATE < DFECHAINI THEN 'EL PROCESO COMENZARA A PARTIR DEL '||TO_CHAR(DFECHAINI,'DD/MM/YYYY HH24:MI')
            ELSE (CASE WHEN SYSDATE > DFECHAFIN + 1 THEN 'EL PROCESO SE CULMINÓ DESDE EL '||TO_CHAR(DFECHAFIN,'DD/MM/YYYY HH24:MI') ELSE 'OK' END) END) END
            MENSAJE,P.NTIPO
        FROM TR_PROCESO P
        INNER JOIN TR_PROCESOUSUARIO PU ON P.NIDPROCESO=PU.NIDPROCESO
            INNER JOIN TM_CONVOCATORIA C ON C.NTIPO = P.NTIPO AND P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
        WHERE PU.BACTIVO=1 AND PU.NIDCODIGOUSUARIO=P_NCODIGOUSUARIO;

  END SP_LISTA_PROCXUSU;

  PROCEDURE SP_LISTA_PROCESO(P_NOPT in NUMBER,P_NIDPROCESO in NUMBER,P_NIDCONVOCATORIA in NUMBER,
                             C_DATA OUT SYS_REFCURSOR,P_NUSUARIO in NUMBER)
  AS
  V_UEJECOD VARCHAR(3);
  BEGIN

      IF P_NOPT = 2 THEN
           --LISTA EL PROCESO SEGÚN PARÁMETRO P_NIDPROCESO
          OPEN C_DATA FOR
          SELECT NIDPROCESO,BESTADO,NEXP_GEN,NEXP_ESP,NCOLEG_OBLIG,SSERVICIO,SPROCESO,NPROCESO,BESTADO BACTIVO,NIDCONVOCATORIA, SIDSGRADOSACAD,SIDSFORMACIONACAD,
          PKG_CAS_READ.F_CONCATENA_ITEMS(1,SIDSFORMACIONACAD) LISTA_FA,PKG_CAS_READ.F_CONCATENA_ITEMS(2,SIDSGRADOSACAD) LISTA_GA, NELENCO, NPLAZAS, SRUTADOC,
          /*(select mofidescri from adminmc.s_oficinas o inner join tm_convocatoria c on C.IDUEJECOD = o.iduejecod where idoficodigo = p.idoficodigo and c.nidconvocatoria = p.nidconvocatoria )*/ 'oficina' DOFICINA, DPUESTO, DOBJETO, DLUGAR,SDURACION, 'S/' || TO_CHAR(NSUELDO,'99,999') || ' ('|| initcap(Numero_a_Texto ( NSUELDO, 2)) ||'y 00/100 Soles)' SREMUNERACION
          ,p.idoficodigo, NSUELDO, NOBLIG_BREVETE, ncolegHab_oblig, nrna_oblig,NRESULTADO, NOBLIG_DJ, NOCI,NMESES,IDFTECODIGO, SPLAZA_AIRHSP, SIAF,IDSERCASCODIGO,NTIPOBASE
          FROM TR_PROCESO p
          WHERE NIDPROCESO = P_NIDPROCESO;
      ELSIF P_NOPT = 3 THEN
          -- LISTA PROCESOS POR CONVOCATORIA
          OPEN C_DATA FOR
          SELECT P.NIDPROCESO,P.SSERVICIO || decode('o.mofisigla',null,'',' - '||'o.mofisigla') SSERVICIO ,P.SPROCESO,P.SPROCESO || ' - ' ||  P.SSERVICIO AS SNOMBRE, P.NIDCONVOCATORIA,DECODE(NRESULTADO,3,'(DESIERTO)',4,'(CANCELADO)') TEXTO_ADIC
           FROM TR_PROCESO P
          LEFT JOIN TM_CONVOCATORIA C ON C.NTIPO = P.NTIPO AND P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
          --left join  adminmc.s_oficinas o on C.IDUEJECOD = o.iduejecod and o.idoficodigo = p.idoficodigo
          WHERE P.BACTIVO=1 and P.NIDCONVOCATORIA = P_NIDCONVOCATORIA
          ORDER BY P.BACTIVO desc,3 DESC;
      ELSIF P_NOPT = 4 THEN
          -- LISTA PROCESOS POR CONVOCATORIA voluntariado
          OPEN C_DATA FOR
          SELECT P.NIDPROCESO,P.NIDACTIVIDAD, P.SNOMBRE, F_GET_DATO('OFI', 1, NULL,IDOFICODIGO) OFICINA
           FROM TR_ACTIVIDAD P
          WHERE P.NESTADO=1 and P.NIDPROCESO = P_NIDCONVOCATORIA
          ORDER BY 4,3 DESC;
      ELSE
          /*  BEGIN
              SELECT IDUEJECOD INTO V_UEJECOD
              FROM MCSGAGEN.TM_SGAUSUARIO WHERE NCODIGOUSUARIO = P_NUSUARIO;
            EXCEPTION WHEN OTHERS THEN*/
              V_UEJECOD := '001';  
         --   END;
          --TODOS LOS PROCESOS ACTIVOS
          OPEN C_DATA FOR
          SELECT P.NIDPROCESO,P.SSERVICIO || decode('o.mofisigla',null,'',' - '||'o.mofisigla') SSERVICIO,P.SPROCESO,P.SPROCESO || ' - ' ||  P.SSERVICIO AS SNOMBRE, SCONVOCATORIA, P.NIDCONVOCATORIA
          FROM TR_PROCESO P
          LEFT JOIN TM_CONVOCATORIA C ON C.NTIPO = P.NTIPO AND P.NIDCONVOCATORIA = C.NIDCONVOCATORIA
         -- left join  adminmc.s_oficinas o on C.IDUEJECOD = o.iduejecod and o.idoficodigo = p.idoficodigo
          WHERE  P.NTIPO = 1 AND P_NOPT = NVL(P.NANIO,EXTRACT(YEAR FROM SYSDATE))  and c.iduejecod = V_UEJECOD and p.bactivo = 1
          ORDER BY P.Bestado desc,3 DESC;
      END IF;
  END SP_LISTA_PROCESO;

  FUNCTION F_CONCATENA_ITEMS(P_NIDTABLA NUMBER, P_SIDS VARCHAR2) RETURN VARCHAR2 IS
  V_SLISTA VARCHAR2(300);
  BEGIN
    FOR C IN (SELECT SDITEM
              FROM TM_TABLA_GENERAL_D
              WHERE NIDTABLA = P_NIDTABLA
                AND NIDITEM IN (select regexp_substr(P_SIDS,'[^,]+', 1, level) as item
                                from DUAL connect by regexp_substr(P_SIDS, '[^,]+', 1, level) is not null)) LOOP
    V_SLISTA := V_SLISTA || C.SDITEM || '<BR/>';
    END LOOP;
  RETURN V_SLISTA;
  EXCEPTION WHEN OTHERS THEN
    RETURN '';
  END;
  PROCEDURE SP_LISTA_PERSONAL(P_NOPT in NUMBER,
                             C_DATA OUT SYS_REFCURSOR)
  AS
  V_ANIO VARCHAR2(4):= TO_CHAR(SYSDATE,'YYYY');
  BEGIN
      IF P_NOPT = 1 THEN
          --TODOS LOS PROCESOS ACTIVOS
          OPEN C_DATA FOR
             SELECT 1 NCODIGOPERSONA, 'DNI' STIPODOCUMENTO,'47586912' SNUMERODOCUMENTO,--P.SPATERNO || ' ' || P.SMATERNO || ' ' || P.SNOMBRE AS 
             'NOMBRE DEL PERSONAL' SNOMBREPERSONA, null
             FROM DUAL;
        /*   SELECT P.NCODIGOPERSONA,P.STIPODOCUMENTO,P.SNUMERODOCUMENTO,P.SPATERNO || ' ' || P.SMATERNO || ' ' || P.SNOMBRE AS SNOMBREPERSONA, null
           FROM ADMINMC.S_PERSONAL S
           INNER JOIN TM_GENPERSONA P ON S.PERNUMDNI=P.SNUMERODOCUMENTO
           INNER JOIN ADMINMC.S_CONDLABXPER VXP ON S.IDPPICODIGO = VXP.IDPPICODIGO AND CXPESTADO = 'V'
           INNER JOIN ADMINMC.S_VIDALABPER VD  ON VXP.IDCXPCODIGO=VD.IDCXPCODIGO AND VXP.IDPPICODIGO = VD.IDPPICODIGO
           INNER JOIN ADMINMC.M_OFICINA O ON O.IDUEJECOD = VD.IDUEJECOD AND O.IDOFICODIGO = VD.IDOFICODIGO
           WHERE VD.VLPESTADO = 'V' AND VD.VLPINDULT='1' AND VD.IDTDOCODIGO = '933'
                 AND S.PERESTADO='1'
                 AND VD.IDANOPROC = V_ANIO
                union
           select P.NCODIGOPERSONA,P.STIPODOCUMENTO,P.SNUMERODOCUMENTO,P.SPATERNO || ' ' || P.SMATERNO || ' ' || P.SNOMBRE AS SNOMBREPERSONA, null from MCSGAGEN.TM_GENPERSONA p inner join MCSGAGEN.TM_SGAUSUARIO u on P.NCODIGOPERSONA = u.NCODIGOusuario
            where ncodigoorganigrama IN ( 114,99,83,101,96,78,48,49)
           ORDER BY SNOMBREPERSONA;*/
      END IF;
  END SP_LISTA_PERSONAL;




  PROCEDURE SP_LISTA_PROCESOCOMITE(P_NOPT in NUMBER,
                                   P_NIDPROCESO in NUMBER,
                                   P_NIDPERSONAL in NUMBER,
                                   C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN
    IF P_NOPT = 1 THEN
      OPEN C_DATA FOR
      SELECT NULL SPROCESO,PC.NIDCOMITE,PC.NIDPERSONAL,P.SPATERNO || ' ' || P.SMATERNO || ' ' || P.SNOMBRE || DECODE(PC.NREEMPLAZO,1,' (R)') SNOMBREPERSONA,
      PC.NIDPROCESO,'O.MOFIDESCRI' SOFICINA,  C.SDITEM STIPO_EVALUADOR, PC.NPRINCIPAL, PC.NIDACTIVIDAD
      FROM TR_PROCESOCOMITE PC
      INNER JOIN TM_GENPERSONA P ON PC.NIDPERSONAL=P.NCODIGOPERSONA
            /*      LEFT JOIN (ADMINMC.S_PERSONAL S
                 INNER JOIN ADMINMC.S_CONDLABXPER VXP ON S.IDPPICODIGO = VXP.IDPPICODIGO AND CXPESTADO = 'V'
                 INNER JOIN ADMINMC.S_VIDALABPER VD  ON VXP.IDCXPCODIGO=VD.IDCXPCODIGO AND VXP.IDPPICODIGO = VD.IDPPICODIGO
                 INNER JOIN ADMINMC.M_OFICINA O ON O.IDUEJECOD = VD.IDUEJECOD AND O.IDOFICODIGO = VD.IDOFICODIGO)
                 ON S.PERNUMDNI=P.SNUMERODOCUMENTO
                 AND VD.VLPESTADO = 'V' AND VD.VLPINDULT='1' AND VD.IDTDOCODIGO = '933'
                       AND S.PERESTADO='1'
                       AND VD.IDANOPROC = TO_CHAR(SYSDATE,'YYYY')*/
      LEFT JOIN TM_TABLA_GENERAL_D C ON C.NIDTABLA = 5 AND PC.NTIPO_EVALUADOR = C.NIDITEM
      WHERE PC.BACTIVO=1 AND PC.NIDPROCESO=P_NIDPROCESO ;
    elsIF P_NOPT = 4 THEN
        OPEN C_DATA FOR
      SELECT PC.NIDCOMITE,PC.NIDPERSONAL,P.SPATERNO || ' ' || P.SMATERNO || ' ' || P.SNOMBRE|| DECODE(PC.NPRINCIPAL,1,' (P)')  SNOMBREPERSONA,
      PC.NIDPROCESO, PC.NIDACTIVIDAD
      FROM TR_PROCESOCOMITE PC
      INNER JOIN TM_GENPERSONA P ON PC.NIDPERSONAL=P.NCODIGOPERSONA      
      WHERE PC.BACTIVO=1 AND PC.NIDACTIVIDAD=P_NIDPROCESO ;
    else
      OPEN C_DATA FOR
      SELECT PC.NIDCOMITE,PC.NIDPERSONAL,PC.NIDPROCESO,  DECODE( PC.NIDACTIVIDAD,0, P.SPROCESO,SSERVICIO)SPROCESO,
      DECODE( PC.NIDACTIVIDAD,0, P.SSERVICIO,(SELECT A.SNOMBRE FROM TR_ACTIVIDAD A WHERE A.NIDACTIVIDAD = PC.NIDACTIVIDAD))SSERVICIO, 
      nvl(PC.NTIPO_EVALUADOR,0) NTIPO_EVALUADOR,nvl(P.NELENCO,0) NELENCO,
      (SELECT NVL(MAX(TO_CHAR(NIDESTADO)||DECODE(DFECHAFIN,NULL,0,1)),0) FROM TR_ESTADO_EVAL EE WHERE EE.NIDCONVOCATORIA = P.NIDCONVOCATORIA) ESTADO_EVAL,
      NVL(PC.NMODIFICA,0) NMODIFICA, NVL(PC.NPRINCIPAL,0)NPRINCIPAL, PC.NIDACTIVIDAD
      FROM TR_PROCESOCOMITE PC
      INNER JOIN TR_PROCESO P ON PC.NIDPROCESO = P.NIDPROCESO
      WHERE PC.BACTIVO=1 AND PC.NIDPERSONAL=P_NIDPERSONAL  AND P_NOPT = NVL(P.NANIO,EXTRACT(YEAR FROM SYSDATE)) and p.bactivo = 1
      AND (NVL(PC.NIDACTIVIDAD,0) = 0 OR EXISTS(SELECT 1 FROM TR_ACTIVIDAD A WHERE A.NIDACTIVIDAD = PC.NIDACTIVIDAD AND A.NESTADO = 1))
      ;
    END IF;
  END SP_LISTA_PROCESOCOMITE;

  PROCEDURE SP_LISTA_POSTULACION(P_NOPT in NUMBER,
                                 P_NIDPROCESO in NUMBER,
                                 P_NTIPO_EVALUADOR in NUMBER,
                                 C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN
    IF P_NOPT = 1 THEN
      OPEN C_DATA FOR
      SELECT PU.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,PU.BESTADO,D.SAPATERNO || ' ' || D.SAMATERNO || ' ' || D.SNOMBRES AS SNOMBREPOSTULANTE,
      --, nvl(EV.NPUNTAJE,0) NPUNTAJE,
     -- (select NVL(min(EV.NEVAL_CUR) ,0) from TR_PROCESOUSUARIO_EVAL ev inner join tr_procesocomite pc on pc.nidpersonal = EV.NIDPERSONAL and EV.NIDPROCESOUSU = pc.NIDPROCESOUSU
     -- where EV.NIDPROCESOUSU = PU.NIDPROCESOUSU) NEVAL_CUR -- 1:APTO, 2:NO APTO
       NVL(MAX(DECODE(EV.NTIPO_EVAL,2,decode(EV.NTIPO_EVALUADOR,P_NTIPO_EVALUADOR,NCALIFICACION))),0) NEVAL_CUR_EV,
       NVL(min(DECODE(EV.NTIPO_EVAL,2,DECODE(NCALIFICACION,0,'Sin Evaluar',2,'NO APTO',1,'APTO'))),0) NEVAL_CUR,
       NVL(MAX(DECODE(EV.NTIPO_EVAL,3,decode(EV.NTIPO_EVALUADOR,P_NTIPO_EVALUADOR,NCALIFICACION))),0) NEVAL_TECNICA,
       NVL(MAX(DECODE(EV.NTIPO_EVAL,4,decode(EV.NTIPO_EVALUADOR,P_NTIPO_EVALUADOR,NCALIFICACION))),0) NENTREVISTA,
       to_char(PU.DFECHAEDICION,'hh24:mi') HORA_ENVIO, MAX(D.NEDAD) NEDAD, MAX(D.SPAIS_NAC) PAIS, MAX(D.SRUTADOC_NAC) DOC
      FROM TR_PROCESOUSUARIO PU
      INNER JOIN TR_DATOSPERSONALES D ON PU.NIDCODIGOUSUARIO=D.NIDCODIGOUSUARIO
      LEFT JOIN TR_PROCESOUSUARIO_EVAL EV ON EV.NIDPROCESOUSU = PU.NIDPROCESOUSU  --AND EV.NIDPERSONAL = P_NIDPERSONAL
      WHERE PU.BACTIVO=1 AND PU.NIDPROCESO=P_NIDPROCESO AND PU.BESTADO = 2
      GROUP BY PU.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,PU.BESTADO,D.SAPATERNO, D.SAMATERNO, D.SNOMBRES,PU.DFECHAEDICION;
    ELSE
        OPEN C_DATA FOR
      SELECT PU.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,PU.BESTADO,D.SAPATERNO || ' ' || D.SAMATERNO || ' ' || D.SNOMBRES AS SNOMBREPOSTULANTE,
      --, nvl(EV.NPUNTAJE,0) NPUNTAJE,
     -- (select NVL(min(EV.NEVAL_CUR) ,0) from TR_PROCESOUSUARIO_EVAL ev inner join tr_procesocomite pc on pc.nidpersonal = EV.NIDPERSONAL and EV.NIDPROCESOUSU = pc.NIDPROCESOUSU
     -- where EV.NIDPROCESOUSU = PU.NIDPROCESOUSU) NEVAL_CUR -- 1:APTO, 2:NO APTO
       NVL(MAX(DECODE(EV.NTIPO_EVAL,2,decode(EV.NTIPO_EVALUADOR,P_NTIPO_EVALUADOR,NCALIFICACION))),0) NEVAL_CUR_EV,
       to_char(PU.DFECHAEDICION,'mm-dd hh24:mi') HORA_ENVIO, MAX(D.NEDAD) NEDAD, MAX(D.SPAIS_NAC) PAIS, MAX(D.SRUTADOC_NAC) DOC
      FROM TR_PROCESOUSUARIO PU
      INNER JOIN TR_DATOSPERSONALES D ON PU.NIDCODIGOUSUARIO=D.NIDCODIGOUSUARIO
      LEFT JOIN TR_PROCESOUSUARIO_EVAL EV ON EV.NIDPROCESOUSU = PU.NIDPROCESOUSU  --AND EV.NIDPERSONAL = P_NIDPERSONAL
      WHERE PU.BACTIVO=1 AND PU.NACTIVIDAD=P_NIDPROCESO AND PU.BESTADO = 2
      GROUP BY PU.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,PU.BESTADO,D.SAPATERNO, D.SAMATERNO, D.SNOMBRES,PU.DFECHAEDICION;
    END IF;
  END SP_LISTA_POSTULACION;

  PROCEDURE SP_CONSULTA_PROCUSU(P_NIDPROCESOUSU in NUMBER,
                                C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT P.NIDPROCESO,P.SSERVICIO,P.SPROCESO,
        DECODE(P.NTIPO,1,P.SPROCESO || ' - ' ||  P.SSERVICIO,2,P.SSERVICIO || ' - '|| (SELECT A.SNOMBRE FROM TR_ACTIVIDAD A WHERE A.NIDACTIVIDAD = PU.NACTIVIDAD AND P.NIDPROCESO = PU.NIDPROCESO)) AS SNOMBRE
        ,PU.NIDCODIGOUSUARIO,PU.NIDPROCESOUSU, D.SAPATERNO || ' ' || D.SAMATERNO || ' ' || D.SNOMBRES AS SNOMBREPOSTULANTE, NVL(NENFERMEDAD,0) NENFERMEDAD, SENFERMEDAD, NVL(NSEGURO,0) NSEGURO, SSEGURO
        FROM TR_PROCESO P
        INNER JOIN TR_PROCESOUSUARIO PU ON P.NIDPROCESO=PU.NIDPROCESO
        INNER JOIN TR_DATOSPERSONALES D ON PU.NIDCODIGOUSUARIO=D.NIDCODIGOUSUARIO
        WHERE PU.BACTIVO=1 AND PU.NIDPROCESOUSU=P_NIDPROCESOUSU;

  END SP_CONSULTA_PROCUSU;

  PROCEDURE SP_CONS_FORMACIONAC(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN
    OPEN C_DATA FOR
        SELECT FA.NIDFACADEMICA,FA.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,FA.NIDTIPOFORMACION,TF.SDITEM AS STIPOFORMACION,
               FA.SINSTITUCION,FA.SPROFESION,TO_CHAR(FA.DFECHA_DESDE,'DD/MM/YYYY') DFECHA_DESDE, TO_CHAR(FA.DFECHA_HASTA,'DD/MM/YYYY') DFECHA_HASTA,
               FA.NANIOSESTUDIO,FA.SFOLIO,FA.BACTIVO,FA.NIDUSUCREACION,FA.DFECHACREACION,FA.NIDUSUEDICION,FA.DFECHAEDICION,FA.SRUTADOC,
               FA.NIDGRADOACADEMICO, GA.SDITEM AS SGRADOACADEMICO,
               TO_CHAR(FA.DFECHA_DESDE,'DD/MM/YYYY') SDESDE, TO_CHAR(FA.DFECHA_HASTA,'DD/MM/YYYY') SHASTA, COD_INSTITUCION, COD_CARRERA
        FROM TR_FORMACIONAC FA
        LEFT JOIN TM_TABLA_GENERAL_D TF ON TF.NIDTABLA = 1 AND FA.NIDTIPOFORMACION=TF.NIDITEM
        LEFT JOIN TM_TABLA_GENERAL_D GA ON GA.NIDTABLA = 2 AND FA.NIDGRADOACADEMICO=GA.NIDITEM
        INNER JOIN TR_PROCESOUSUARIO PU ON FA.NIDPROCESOUSU=PU.NIDPROCESOUSU
        WHERE FA.BACTIVO=1 AND FA.NIDPROCESOUSU=P_NIDPROCESOUSU
        ORDER BY FA.DFECHA_DESDE DESC;
  END SP_CONS_FORMACIONAC;

  PROCEDURE SP_CONS_COLEGIATURA(P_NIDPROCESOUSU in NUMBER,
                                C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT C.NIDCOLEGIATURA,C.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,C.SCOLEGIO,C.SNROCOLEGIATURA,
               C.BCONDICION,DECODE(C.BCONDICION,0,'NO HABILITADO',1, 'HABILITADO','-') AS SCONDICION,
               C.SFOLIO,C.BACTIVO,C.NIDUSUCREACION,C.DFECHACREACION,C.NIDUSUEDICION,C.DFECHAEDICION,C.SRUTADOC
        FROM TR_COLEGIATURA C
        INNER JOIN TR_PROCESOUSUARIO PU ON C.NIDPROCESOUSU=PU.NIDPROCESOUSU
        WHERE C.BACTIVO=1 AND C.NIDPROCESOUSU=P_NIDPROCESOUSU;

  END SP_CONS_COLEGIATURA;


    PROCEDURE SP_CONS_CAPACITACION(P_NIDPROCESOUSU in NUMBER,
                                    C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT C.NIDCAPACITACION,C.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,C.NMESDESDE,C.NANIODESDE,C.NMESHASTA,
                C.NANIOHASTA,C.SCURSO,C.SINTITUCION,
                TO_CHAR(C.DFECHA_DESDE,'DD/MM/YYYY')  AS DFECHA_DESDE,TO_CHAR(C.DFECHA_HASTA,'DD/MM/YYYY')  AS DFECHA_HASTA,
                C.NHORAS,C.SFOLIO,C.BACTIVO,C.NIDUSUCREACION,C.DFECHACREACION,
                C.NIDUSUEDICION,C.DFECHAEDICION,C.SRUTADOC,
                TO_CHAR(C.DFECHA_DESDE,'DD/MM/YYYY')  AS SDESDE,TO_CHAR(C.DFECHA_HASTA,'DD/MM/YYYY')  AS SHASTA
        FROM TR_CAPACITACION C
        INNER JOIN TR_PROCESOUSUARIO PU ON C.NIDPROCESOUSU=PU.NIDPROCESOUSU
        WHERE C.BACTIVO=1 AND C.NIDPROCESOUSU=P_NIDPROCESOUSU
        ORDER BY C.DFECHA_DESDE DESC;

  END SP_CONS_CAPACITACION;

      PROCEDURE SP_CONS_CONOCIMIENTO(P_NIDPROCESOUSU in NUMBER,
                                      C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT C.NIDCONOCIMIENTO,C.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,C.SDESCRIPCION,C.BACTIVO,C.NIDUSUCREACION,
               C.DFECHACREACION,C.NIDUSUEDICION,C.DFECHAEDICION,C.NIDTIPO, TC.SDITEM STIPO, SRUTADOC,NCONOCIMIENTO_B, NVL(F_GET_DATO('CRS', NCONOCIMIENTO_B, NULL,NULL),'ADICIONAL') SCONOCIMIENTO_B,
               NVL(F_GET_DATO('CRS', NCONOCIMIENTO_B, NULL,NULL),'ADICIONAL')|| ' - '|| C.SDESCRIPCION sdescripcion_ficha 
        FROM TR_CONOCIMIENTO C
        INNER JOIN TR_PROCESOUSUARIO PU ON C.NIDPROCESOUSU=PU.NIDPROCESOUSU
        INNER JOIN TM_TABLA_GENERAL_D TC ON TC.NIDTABLA = 3 AND TC.NIDITEM = C.NIDTIPO
        WHERE C.BACTIVO=1 AND C.NIDPROCESOUSU=P_NIDPROCESOUSU
        ORDER BY NIDTIPO;

  END SP_CONS_CONOCIMIENTO;


    PROCEDURE SP_CONS_CONOCIMIENTOINF(P_NIDPROCESOUSU in NUMBER,
                                      C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT C.NIDCONOCIMIENTOINF,C.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,C.SCONOCIMIENTO,C.BTIPO,
               DECODE(C.BTIPO,'B','BASICO','I', 'INTERMEDIO','A','AVANZADO','-') AS STIPO,C.SFOLIO,
               C.BACTIVO,C.NIDUSUCREACION,C.DFECHACREACION,C.NIDUSUEDICION,C.DFECHAEDICION,
               DECODE(C.BTIPO,'B','X','') AS SBASICO,DECODE(C.BTIPO,'I','X','') AS SINTERMEDIO,
               DECODE(C.BTIPO,'A','X','') AS SAVANZADO,C.SRUTADOC
        FROM TR_CONOCIMIENTOINF C
        INNER JOIN TR_PROCESOUSUARIO PU ON C.NIDPROCESOUSU=PU.NIDPROCESOUSU
        WHERE C.BACTIVO=1 AND C.NIDPROCESOUSU=P_NIDPROCESOUSU;


  END SP_CONS_CONOCIMIENTOINF;

      PROCEDURE SP_CONS_IDIOMA(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT C.NIDIDIOMA,C.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,C.SIDIOMA,C.BTIPO,
               DECODE(C.BTIPO,'B','BASICO','I', 'INTERMEDIO','A','AVANZADO','-') AS STIPO,C.SFOLIO,
               C.BACTIVO,C.NIDUSUCREACION,C.DFECHACREACION,C.NIDUSUEDICION,C.DFECHAEDICION,
               DECODE(C.BTIPO,'B','X','') AS SBASICO,DECODE(C.BTIPO,'I','X','') AS SINTERMEDIO,
               DECODE(C.BTIPO,'A','X','') AS SAVANZADO,C.SRUTADOC
        FROM TR_IDIOMA C
        INNER JOIN TR_PROCESOUSUARIO PU ON C.NIDPROCESOUSU=PU.NIDPROCESOUSU
        WHERE C.BACTIVO=1 AND C.NIDPROCESOUSU=P_NIDPROCESOUSU;

  END SP_CONS_IDIOMA;

  PROCEDURE SP_CONS_EXPERIENCIA(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN

    OPEN C_DATA FOR
        SELECT E.NIDEXPERIENCIA,E.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,E.SENTIDAD,E.SAREA,E.SCARGO,E.SFUNCIONES,SUBSTR(E.SFUNCIONES, 1, 100) AS SFUNCIONESC,
               E.SMODALIDAD,E.SMOTIVORETIRO,E.SNOMBRECARGOJEFE,E.NREMUNERACION,E.STELEFONO,E.SFOLIO,E.BACTIVO,E.NIDUSUCREACION,E.DFECHACREACION,E.NIDUSUEDICION,E.DFECHAEDICION,E.SRUTADOC,
               PKG_CAS_DML.F_CALCULA_EXPERIENCIA(E.DFECHA_DESDE, E.DFECHA_HASTA, 'L') STIEMPOSERVICIO,TO_CHAR(DFECHA_DESDE,'DD/MM/YYYY') DFECHA_DESDE ,
               TO_CHAR(DFECHA_HASTA,'DD/MM/YYYY') DFECHA_HASTA,E.BSECTOR,E.BESPECIFICA,E.NPRESENTACIONES,
               TO_CHAR(DFECHA_DESDE,'DD/MM/YYYY') SDESDE, TO_CHAR(DFECHA_HASTA,'DD/MM/YYYY') SHASTA,
               PKG_CAS_DML.F_CALCULA_EXPERIENCIA(E.DFECHA_DESDE, E.DFECHA_HASTA, 'L') NTIEMPOSERVICIO
        FROM TR_EXPERIENCIA E
        INNER JOIN TR_PROCESOUSUARIO PU ON E.NIDPROCESOUSU=PU.NIDPROCESOUSU
        WHERE E.BACTIVO=1 AND E.NIDPROCESOUSU=P_NIDPROCESOUSU
        ORDER BY E.NANIODESDE DESC, E.NMESDESDE ASC, E.NANIOHASTA DESC, E.NMESHASTA ASC;

  END SP_CONS_EXPERIENCIA;

 PROCEDURE SP_CONS_DATOSADIC(P_NIDPROCESOUSU in NUMBER,
                             C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN
    OPEN C_DATA FOR
        SELECT A.NIDDATOSADIC,A.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,A.BFAMILIADIRECTA,
               DECODE(A.BFAMILIADIRECTA,1,'SI',0, 'NO','-') AS SFAMILIADIRECTAA,
               A.SFAMILIADIRECTA,A.BDISCAPACIDAD,
               DECODE(A.BDISCAPACIDAD,1,'SI',0, 'NO','-') AS SDISCAPACIDADD,
               A.STIPO,A.SFOLIO,
               A.BDEUDOR,DECODE(A.BDEUDOR,1,'SI',0, 'NO','-') AS SDEUDOR,
               A.BANTECEDENTES,A.SANTECEDENTES,DECODE(A.BANTECEDENTES,1,'SI',0, 'NO','-') AS SANTECEDENTESS,
               A.BFUERZAARMADA,DECODE(A.BFUERZAARMADA,1,'SI',0, 'NO','-') AS SFUERZAARMADA,
               A.BACTIVO,
               A.NIDUSUCREACION,A.DFECHACREACION,A.NIDUSUEDICION,A.DFECHAEDICION,
               DECODE(A.BFAMILIADIRECTA,1,'X',0, ' ',' ') AS SFAMILIADIRECTA_SI,
               DECODE(A.BFAMILIADIRECTA,1,' ',0, 'X',' ') AS SFAMILIADIRECTA_NO,
               DECODE(A.BDISCAPACIDAD,1,'X',0, ' ',' ') AS SDISCAPACIDAD_SI,
               DECODE(A.BDISCAPACIDAD,1,' ',0, 'X',' ') AS SDISCAPACIDAD_NO,
               DECODE(A.BDEUDOR,1,'X',0, ' ',' ') AS SDEUDOR_SI,
               DECODE(A.BDEUDOR,1,' ',0, 'X',' ') AS SDEUDOR_NO,
               DECODE(A.BANTECEDENTES,1,'X',0, ' ',' ') AS SANTECEDENTES_SI,
               DECODE(A.BANTECEDENTES,1,' ',0, 'X',' ') AS SANTECEDENTES_NO,
               DECODE(A.BFUERZAARMADA,1,'X',0, ' ',' ') AS SFUERZAARMADA_SI,
               DECODE(A.BFUERZAARMADA,1,' ',0, 'X',' ') AS SFUERZAARMADA_NO,
               DECODE(A.BINCOMP_ESTADO,1,'X',0, ' ',' ') AS SINCOMP_ESTADO_SI,
               DECODE(A.BINCOMP_ESTADO,1,' ',0, 'X',' ') AS SINCOMP_ESTADO_NO,
               DECODE(A.BINHAB_ESTADO,1,'X',0, ' ',' ') AS SINHAB_ESTADO_SI,
               DECODE(A.BINHAB_ESTADO,1,' ',0, 'X',' ') AS SINHAB_ESTADO_NO,
               DECODE(PR.NOCI,1,'X',0, ' ',' ') AS SOCI_SI,
               DECODE(PR.NOCI,1,' ',0, 'X',' ') AS SOCI_NO,
             --  DECODE(A.BPENSIONISTA,1,decode(A.BPENSION_SUSP,1,'SUSPENDIDA','SIN SUSPENDER'),'') AS BPENSION_SUSP,
               A.BTERM_COND,A.SRUTADOC_DIS, A.SRUTADOC_LFA,
               BINHAB_ESTADO,BINCOMP_ESTADO,BPENSIONISTA,BTIPO_PENSION,BPENSION_SUSP,BPARENTESCO,
               NVL(C.SDITEM,SANTECEDENTES) DANTECEDENTES, DECODE(D.SDITEM,NULL,'',', TIPO: '||D.SDITEM||', ') DTIPO, A.SRUTADOC_OCI, A.SRUTADOC_A3B,
               BDEPORTISTA, SRUTADOC_DEP
        FROM TR_DATOSADICIONALES A
        INNER JOIN TR_PROCESOUSUARIO PU ON A.NIDPROCESOUSU=PU.NIDPROCESOUSU
        INNER JOIN TR_PROCESO PR ON PU.NIDPROCESO = PR.NIDPROCESO
        LEFT JOIN TM_TABLA_GENERAL_D C ON C.NIDTABLA = 12 AND A.SANTECEDENTES = C.NIDITEM
        LEFT JOIN TM_TABLA_GENERAL_D D ON D.NIDTABLA = 11 AND A.BTIPO_PENSION = D.NIDITEM
        WHERE A.BACTIVO=1 AND A.NIDPROCESOUSU=P_NIDPROCESOUSU;

  END SP_CONS_DATOSADIC;

  PROCEDURE SP_CONS_DATOSPERS(P_NIDPROCESOUSU in NUMBER,
                              C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN

    OPEN C_DATA FOR
        SELECT P.NIDCODIGOUSUARIO,P.SAPATERNO,P.SAMATERNO,P.SNOMBRES,P.NEDAD,P.NIDESTADOCIVIL,EC.SDESCRIPCION AS SIDESTADOCIVIL,
                   TO_CHAR(P.DFECHANAC,'DD/MM/YYYY') AS DFECHANAC,TO_CHAR(P.DFECHANAC,'DD') AS DDIANAC,TO_CHAR(P.DFECHANAC,'MM') AS DMESNAC,
                   TO_CHAR(P.DFECHANAC,'YYYY') AS DANIONAC,
                   P.SUBIGEONAC,UB1.SDISTRITO AS SDISTRITONAC,UB1.SPROVINCIA AS SPROVINCIANAC,
                   UB1.SDEPARTAMENTO AS SDEPARTAMENTONAC,P.SSEXO,P.SDNI,P.SRUC,P.SBREVETE,NVL(BRE.SDITEM,P.SCATBREVETE) SCATBREVETE,P.SDIRECCION,P.SUBIGEODIR,
                   UB2.SDISTRITO AS SDISTRITODIR,UB2.SPROVINCIA AS SPROVINCIADIR,UB2.SDEPARTAMENTO AS SDEPARTAMENTODIR,
                   P.SNROLOTE,P.STELEFONOFIJO,P.SCELULAR,P.SCORREO,P.BACTIVO,P.NIDUSUCREACION,P.DFECHACREACION,P.NIDUSUEDICION,P.DFECHAEDICION, SPAIS_NAC , P.SPARENTESCO,P.STELEFONO, P.SNOMBRE_C
        FROM TR_DATOSPERSONALES P
        INNER JOIN TR_PROCESOUSUARIO PU ON P.NIDCODIGOUSUARIO=PU.NIDCODIGOUSUARIO
        LEFT JOIN TM_TABLA_GENERAL_D BRE ON BRE.NIDTABLA = 9 AND P.SCATBREVETE = BRE.NIDITEM 
        LEFT JOIN TM_ESTADOCIVIL EC ON P.NIDESTADOCIVIL=EC.NIDESTADOCIVIL
        LEFT JOIN VW_DISTRITOS UB1 ON P.SUBIGEONAC=UB1.NDISTRITO
        LEFT JOIN VW_DISTRITOS UB2 ON P.SUBIGEODIR=UB2.NDISTRITO
        WHERE PU.BACTIVO=1 AND PU.NIDPROCESOUSU=P_NIDPROCESOUSU;

  END SP_CONS_DATOSPERS;

  PROCEDURE SP_CONS_EXP_ACUM(P_NIDPROCESOUSU in NUMBER,
                                P_SEXP_ESP OUT VARCHAR2,
                                P_SEXP_GEN OUT VARCHAR2) AS
  BEGIN
      P_SEXP_GEN := PKG_CAS_DML.F_CALCULA_EXP_ACUM(P_NIDPROCESOUSU, 'G', 'L');
      P_SEXP_ESP := PKG_CAS_DML.F_CALCULA_EXP_ACUM(P_NIDPROCESOUSU, 'E','L');
  END SP_CONS_EXP_ACUM;

  PROCEDURE SP_CONS_TABLA_D(P_NIDTABLA in NUMBER, P_SDATO VARCHAR2, P_NIDPROCESO NUMBER,
                              C_DATA OUT SYS_REFCURSOR)  AS
  V_SIDS VARCHAR2(100);
  V_UEJECOD varchar2(3);
  BEGIN
    IF P_NIDPROCESO > 0 AND P_SDATO NOT IN ('V','DV','P','PR','PR_AC','PR_AC_VO') THEN
        IF P_NIDTABLA = 23 THEN
            OPEN C_DATA FOR
            SELECT NIDTABLA ,    NIDITEM ,    SDITEM ,    SSITEM
            FROM TM_TABLA_GENERAL_D
            WHERE NIDTABLA=P_NIDTABLA AND BACTIVO = 1 AND NOT EXISTS (SELECT 1 FROM TR_ADJUNTO WHERE NIDPROCESOUSU = P_NIDPROCESO AND BACTIVO = 1 AND NIDTIPO = NIDITEM)
            ORDER BY BACTIVO DESC, NIDITEM ;
        /*ELSIF P_NIDTABLA = 22 OR P_NIDTABLA = 21 THEN
            OPEN C_DATA FOR
            SELECT NIDTABLA ,    NIDITEM ,    SDITEM ,    SSITEM
            FROM TM_TABLA_GENERAL_D
            WHERE NIDTABLA=P_NIDTABLA AND BACTIVO = 1
            AND NOT EXISTS (SELECT 1 FROM TR_VOLUNTARIADO
                            WHERE NIDPROCESOUSU = P_NIDPROCESO AND BACTIVO = 1 AND ((P_NIDTABLA = 21 AND NTIPO_DATO = NIDITEM AND NIDITEM NOT IN (1,2,3)) OR (P_NIDTABLA = 22 AND DECODE(NTIPO_DATO,1,SDATO,0) = NIDITEM)))
            ORDER BY BACTIVO DESC, NIDITEM ;*/
        ELSIF P_NIDTABLA = 1000 THEN
            OPEN C_DATA FOR
            --SELECT RDENEMSIAF NIDITEM,RDENEMSIAF SDITEM 
            SELECT 1 NIDITEM, '0051' SDITEM
            FROM DUAL;
           /* ADMINMC.SIAFXOFIC 
            WHERE SXOANOPROC = P_NIDPROCESO AND IDOFICODIGO = P_SDATO AND IDUEJECOD = '001'
            ORDER BY 2;*/
        ELSIF P_NIDTABLA IN (4,15) THEN
         /*   BEGIN
              SELECT IDUEJECOD INTO V_UEJECOD
              FROM MCSGAGEN.TM_SGAUSUARIO WHERE NCODIGOUSUARIO = P_NIDPROCESO;
            EXCEPTION WHEN OTHERS THEN*/
              V_UEJECOD := '001';  
          --  END;
            if length(P_SDATO) = 4 then
                OPEN C_DATA FOR
                SELECT P_NIDTABLA NIDTABLA , NIDCONVOCATORIA   NIDITEM , BACTIVO ,  SCONVOCATORIA     SSITEM ,
                    F_GET_DATO('TGC', 6, (SELECT NVL(MAX(NIDESTADO),1) FROM TR_ESTADO_EVAL e WHERE e.NIDCONVOCATORIA = c.nidconvocatoria),NULL) SACTIVO
                FROM TM_CONVOCATORIA c
                WHERE P_SDATO = nvl(NANIO,(extract(year from sysdate))) AND NTIPO = DECODE(P_NIDTABLA,4,1,2) AND BACTIVO <> 2 and IDUEJECOD = V_UEJECOD
                ORDER BY BACTIVO DESC, NIDITEM ;
            else
                OPEN C_DATA FOR
                SELECT P_NIDTABLA NIDTABLA , NIDCONVOCATORIA   NIDITEM , DCONVOCATORIA   SDITEM ,  SCONVOCATORIA     SSITEM ,
                    TO_CHAR(DFECHAINI,'DD/MM/YYYY') SFECHA1 ,    TO_CHAR(DFECHAFIN,'DD/MM/YYYY') SFECHA2 ,  TO_CHAR(DFECHAINI,'HH24:MI') SHORA1 , TO_CHAR(DFECHAFIN,'HH24:MI') SHORA2 ,
                       0 NPARAM1 ,    0 NPARAM2,BACTIVO, DECODE(BACTIVO,0,'Inactivo',1,'Activo','Eliminado')SACTIVO
                FROM TM_CONVOCATORIA
                WHERE (P_SDATO = 'T' OR NANIO IS NULL) AND NTIPO = DECODE(P_NIDTABLA,4,1,2) AND BACTIVO <> 2 and IDUEJECOD = V_UEJECOD
                ORDER BY BACTIVO DESC, NIDITEM desc;
            end if;
        ELSE
            SELECT DECODE(P_NIDTABLA,1,SIDSFORMACIONACAD,2,SIDSGRADOSACAD) INTO  V_SIDS
            FROM TR_PROCESO
            WHERE NIDPROCESO = P_NIDPROCESO;
            OPEN C_DATA FOR
                SELECT NIDTABLA ,    NIDITEM ,    SDITEM ,    SSITEM ,
                TO_CHAR(DFECHA1,'DD/MM/YYYY') SFECHA1 ,    TO_CHAR(DFECHA2,'DD/MM/YYYY') SFECHA2 ,  TO_CHAR(DFECHA1,'HH24:MI') SHORA1 , TO_CHAR(DFECHA2,'HH24:MI') SHORA2 ,
                  NPARAM1 ,    NPARAM2,BACTIVO, DECODE(BACTIVO,0,'Inactivo',1,'Activo','Eliminado')SACTIVO
                FROM TM_TABLA_GENERAL_D
                WHERE (P_SDATO = 'T' OR BACTIVO=1) AND NIDTABLA=P_NIDTABLA AND BACTIVO <> 2 AND  (NIDITEM IN (select regexp_substr(V_SIDS,'[^,]+', 1, level) as item
                                    from DUAL connect by regexp_substr(V_SIDS, '[^,]+', 1, level) is not null) OR NVL(V_SIDS,'T') = 'T')
                ORDER BY BACTIVO DESC, NIDITEM ;
        END IF;
    ELSIF P_SDATO = 'PUESTOS' THEN
        OPEN C_DATA FOR
            SELECT 1 NIDITEM, 'CARGO 1' SDITEM
            FROM DUAL;
       /* select IDSERCASCODIGO NIDITEM, SERCASDESCRI SDITEM 
        from adminmc.S_CATSERCAS 
        WHERE SERCASDESCRI NOT LIKE 'SERVICIO% DE %' AND SERCASESTADO = '1' AND LENGTH(SERCASDESCRI) <=200 AND SERCASDESCRI NOT LIKE 'FUNCIO% DE %'
        AND SERCASDESCRI NOT LIKE 'DIRECTOR% DE %' AND SERCASDESCRI NOT LIKE '% DE %OFICINA%' AND SERCASDESCRI NOT LIKE 'CONTRATACION%'
        ORDER BY 2;*/
    ELSIF P_SDATO = 'PVOL' THEN
        OPEN C_DATA FOR
        select NIDPROCESO NIDITEM,SSERVICIO SDITEM 
        from TR_PROCESO 
        WHERE NTIPO =2 AND NIDCONVOCATORIA = P_NIDTABLA AND BACTIVO = 1;
    ELSIF P_SDATO = 'PR' THEN
        OPEN C_DATA FOR
        select NIDPROCESO NIDITEM,SSERVICIO SDITEM 
        from TR_PROCESO 
        WHERE NTIPO =2 AND NIDCONVOCATORIA = P_NIDTABLA AND BACTIVO = 1 AND (NIDPROCESO IN (SELECT NIDPROCESO FROM TR_PROCESOCOMITE WHERE NIDPERSONAL =  P_NIDPROCESO) OR P_NIDPROCESO = 0)
        order by 2;
    ELSIF P_SDATO = 'PR_AC' THEN
        OPEN C_DATA FOR
        select NIDACTIVIDAD NIDITEM,SNOMBRE SDITEM 
        from TR_ACTIVIDAD 
        WHERE NESTADO = 1 AND NIDPROCESO = P_NIDTABLA AND (NIDACTIVIDAD IN (SELECT NIDACTIVIDAD FROM TR_PROCESOCOMITE WHERE NIDPERSONAL =  P_NIDPROCESO) OR P_NIDPROCESO = 0)
        order by 2;
    ELSIF P_SDATO = 'PR_AC_VO' THEN
        OPEN C_DATA FOR
        select NIDPROCESOUSU NIDITEM,SAPATERNO ||' '||SAMATERNO||', '||SNOMBRES SDITEM 
        from TR_PROCESOUSUARIO PU INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
        WHERE PU.BESTADO = 2 AND PU.NGANADOR = 1 AND NACTIVIDAD = P_NIDTABLA AND NACTIVIDAD > 0 
        AND (NACTIVIDAD IN (SELECT NIDACTIVIDAD FROM TR_PROCESOCOMITE WHERE NIDPERSONAL =  P_NIDPROCESO) OR P_NIDPROCESO = 0)
        order by 2;
    ELSIF P_SDATO = 'INST' THEN
        OPEN C_DATA FOR
        select COD_INSTITUCION NIDITEM,DESC_INSTITUCION SDITEM 
        from tm_inst_educativa
        order by decode(cod_tipo_inst,9,1,0) desc, desc_institucion desc;
    ELSIF P_SDATO = 'CARR' THEN
        OPEN C_DATA FOR
        select COD_CARRERA NIDITEM,DESC_CARRERA SDITEM from TREG_IE_CARRERAS A WHERE COD_INSTITUCION = P_NIDTABLA;
    ELSIF P_SDATO = 'P' THEN
        OPEN C_DATA FOR
       SELECT NIDPROCESO  NIDITEM, SPROCESO SDITEM
        FROM TR_PROCESO
            WHERE NIDCONVOCATORIA = P_NIDPROCESO;
    ELSIF P_SDATO IN ('E','ET') THEN
      /*  BEGIN
          SELECT IDUEJECOD INTO V_UEJECOD
          FROM MCSGAGEN.TM_SGAUSUARIO WHERE NCODIGOUSUARIO = P_NIDTABLA;
        EXCEPTION WHEN OTHERS THEN*/
          V_UEJECOD := '001';  
       -- END;
        OPEN C_DATA FOR
            SELECT 4 NIDTABLA , nidconvocatoria NIDITEM ,    dconvocatoria SDITEM ,    sconvocatoria SSITEM , C.BACTIVO,
            F_GET_DATO('TGC', 6, (SELECT NVL(MAX(NIDESTADO),1) FROM TR_ESTADO_EVAL WHERE NIDCONVOCATORIA = C.nidconvocatoria),NULL) SACTIVO
            FROM TM_convocatoria C
            WHERE  C.BACTIVO<>2  and c.ntipo = 1 and (P_SDATO = 'ET' or nanio is null) and iduejecod = V_UEJECOD
            ORDER BY C.BACTIVO DESC, NIDITEM ;
    ELSIF P_SDATO = 'D' THEN
        OPEN C_DATA FOR
            SELECT SRUTADOC ruta , 'EXP_'||sentidad nombre FROM TR_EXPERIENCIA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDTABLA AND SRUTADOC IS not NULL
                union all SELECT SRUTADOC, 'ACA_'||sinstitucion FROM TR_FORMACIONAC WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDTABLA AND SRUTADOC IS not NULL
                union all SELECT SRUTADOC, 'COL_'||scolegio FROM TR_COLEGIATURA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDTABLA AND SRUTADOC IS not NULL
                union all SELECT SRUTADOC,'CAP_'||SUBSTR(scurso,1,50) FROM TR_CAPACITACION WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDTABLA AND SRUTADOC IS not NULL
                union all SELECT SRUTADOC, 'CON_'||substr(sdescripcion,1,50) FROM TR_CONOCIMIENTO WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDTABLA AND SRUTADOC IS not NULL
                union all SELECT SRUTADOC, 'IDI_'||substr(SIDIOMA,1,50) FROM TR_IDIOMA WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDTABLA AND SRUTADOC IS not NULL
                union all SELECT SRUTADOC, 'INF_'||substr(SCONOCIMIENTO,1,50) FROM TR_CONOCIMIENTOINF WHERE BACTIVO = 1 AND NIDPROCESOUSU = P_NIDTABLA AND SRUTADOC IS not NULL;
    ELSIF P_SDATO = 'DV' THEN
        OPEN C_DATA FOR 
        SELECT PR.SSERVICIO ||'_'||AC.SNOMBRE||'_'|| UPPER(D.SAPATERNO ||' '|| D.SAMATERNO ||', '|| D.SNOMBRES) || '_'|| F_GET_DATO('TGC', 23, NIDTIPO,NULL)||'.pdf' nombre, A.SRUTADOC ruta
            FROM TR_PROCESOUSUARIO P 
                INNER JOIN TR_ADJUNTO A ON A.NIDPROCESOUSU = P.NIDPROCESOUSU
                INNER JOIN TR_DATOSPERSONALES D ON P.NIDCODIGOUSUARIO = D.NIDCODIGOUSUARIO  
                INNER JOIN TR_ACTIVIDAD AC ON AC.NIDACTIVIDAD = P.NACTIVIDAD
                INNER JOIN TR_PROCESO PR ON PR.NIDPROCESO = P.NIDPROCESO
            WHERE P.BACTIVO = 1 AND A.BACTIVO = 1 AND P.NIDPROCESO = decode(P_NIDPROCESO,0,P.NIDPROCESO,P_NIDPROCESO) AND P.BESTADO = DECODE(P_NIDTABLA,1,2,P.BESTADO) AND NIDCONVOCATORIA = 152;
    ELSIF P_SDATO = 'O' and P_NIDTABLA > 0 THEN
        OPEN C_DATA FOR
        SELECT '1214' IDOFICODIGO, 'MOFIDESCRI' DOFICINA , 1 NRO_PROCESOS
        from dual;
        /*  SELECT P.IDOFICODIGO, MOFIDESCRI DOFICINA , COUNT(1) NRO_PROCESOS
          FROM TR_PROCESO P INNER JOIN ADMINMC.S_OFICINAS O ON O.IDOFICODIGO = P.IDOFICODIGO
          WHERE NIDCONVOCATORIA = P_NIDTABLA
                         GROUP BY P.IDOFICODIGO,MOFIDESCRI;*/
    ELSIF P_NIDTABLA = 6 THEN
        OPEN C_DATA FOR
            SELECT C.NIDTABLA ,    C.NIDITEM ,    C.SDITEM ,    C.SSITEM , C.BACTIVO, DECODE(C.BACTIVO,0,'Inactivo',1,'Activo','Eliminado')SACTIVO,
            NULL SFECHA1 ,    NULL SFECHA2, NULL SHORA1 , NULL SHORA2
            FROM TM_TABLA_GENERAL_D C
             WHERE C.BACTIVO=1 AND c.nidtabla = P_NIDTABLA AND NIDITEM IN (2,3,4)
            ORDER BY C.BACTIVO DESC, C.NIDITEM ;
    ELSIF P_NIDTABLA in (8,16) THEN
        OPEN C_DATA FOR
            SELECT C.NIDTABLA ,    C.NIDITEM ,    C.SDITEM ,    C.SSITEM , C.BACTIVO, DECODE(C.BACTIVO,0,'Inactivo',1,'Activo','Eliminado')SACTIVO,
            NULL SFECHA1 ,    NULL SFECHA2, NULL SHORA1 , NULL SHORA2
            FROM TM_TABLA_GENERAL_D C
             WHERE C.BACTIVO=1 AND c.nidtabla = P_NIDTABLA AND NPARAM2 = DECODE(P_SDATO,'TB', 1,2)
            ORDER BY NPARAM1 ;
    ELSIF P_SDATO = 'O' THEN
         OPEN C_DATA FOR
         SELECT 0 NIDITEM,'oficina' SDITEM FROM dual;
          /*  SELECT IDOFICODIGO NIDITEM,UPPER(MOFIDESCRI) SDITEM FROM ADMINMC.S_OFICINAS WHERE MOFIESTADO = 5 or (iduejecod = '001' and MOFIESTADO = 0) 
            ORDER BY 2;*/
    ELSIF P_SDATO = 'O001' THEN
         OPEN C_DATA FOR
         SELECT 0 NIDITEM,'oficina' SDITEM FROM dual;
          /*  SELECT IDOFICODIGO NIDITEM,UPPER(MOFIDESCRI) SDITEM FROM ADMINMC.S_OFICINAS WHERE MOFIESTADO in (5,0) and iduejecod = '001'
            ORDER BY 2;*/
    ELSIF P_SDATO = 'V' THEN
         OPEN C_DATA FOR
            SELECT NIDPROCESO NIDITEM, SSERVICIO SDITEM FROM TR_PROCESO WHERE BACTIVO = 1 AND NTIPO = 2
            ORDER BY  NIDCONVOCATORIA,2;
    ELSE
        OPEN C_DATA FOR
            SELECT NIDTABLA ,    NIDITEM ,    SDITEM ,    SSITEM ,
                TO_CHAR(DFECHA1,'DD/MM/YYYY') SFECHA1 ,    TO_CHAR(DFECHA2,'DD/MM/YYYY') SFECHA2 ,  TO_CHAR(DFECHA1,'HH24:MI') SHORA1 , TO_CHAR(DFECHA2,'HH24:MI') SHORA2 ,
                   NPARAM1 ,    NPARAM2,BACTIVO, DECODE(BACTIVO,0,'Inactivo',1,'Activo','Eliminado')SACTIVO
            FROM TM_TABLA_GENERAL_D
            WHERE (P_SDATO = 'T' OR BACTIVO=1) AND NIDTABLA=P_NIDTABLA AND BACTIVO <> 2
            ORDER BY BACTIVO DESC, NIDITEM ;
    END IF;
  END SP_CONS_TABLA_D;
  PROCEDURE SP_CONS_TABLA_C(C_DATA OUT SYS_REFCURSOR)
  AS
  BEGIN
  OPEN C_DATA FOR
      SELECT NIDTABLA , SDTABLA, BFECHAS
      FROM TM_TABLA_GENERAL_C
      WHERE BACTIVO=1;
  END SP_CONS_TABLA_C;
  PROCEDURE SP_CONS_RNA(P_NIDPROCESOUSU in NUMBER,
                               C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN
    OPEN C_DATA FOR
        SELECT R.NIDRNA,R.NIDPROCESOUSU,PU.NIDCODIGOUSUARIO,PU.NIDPROCESO,R.SCODIGO_INS,
               TO_CHAR(R.DFECHA_REG,'DD/MM/YYYY') DFECHA_REG
        FROM TR_RNA R
        INNER JOIN TR_PROCESOUSUARIO PU ON R.NIDPROCESOUSU=PU.NIDPROCESOUSU
        WHERE R.BACTIVO=1 AND R.NIDPROCESOUSU=P_NIDPROCESOUSU
        ORDER BY 1;
  END SP_CONS_RNA;
  PROCEDURE SP_LISTA_ESTADOS_CONV(P_NIDCONVOCATORIA in NUMBER,
                                    C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN
    OPEN C_DATA FOR
        SELECT EST.SSITEM,TO_CHAR(R.DFECHAINI,'DD/MM/YYYY HH24:MI') DFECHAINI,TO_CHAR(R.DFECHAFIN,'DD/MM/YYYY HH24:MI') DFECHAFIN,
               (GPI.SPATERNO || ' ' || GPI.SMATERNO || ', ' || GPI.SNOMBRE ) NIDUSUINI, (GPF.SPATERNO || ' ' || GPF.SMATERNO || DECODE(GPF.SMATERNO,NULL,'',', ') || GPF.SNOMBRE ) NIDUSUFIN,
                SOBSERVACION,NIDESTADO
        FROM tr_estado_eval R
        INNER JOIN TM_TABLA_GENERAL_D EST ON R.NIDESTADO=EST.NIDITEM AND EST.NIDTABLA = 6
        LEFT JOIN  TM_GENPERSONA GPI ON GPI.NCODIGOPERSONA = R.NIDUSUINI
        LEFT JOIN  TM_GENPERSONA GPF ON GPF.NCODIGOPERSONA = R.NIDUSUFIN
        WHERE R.NIDCONVOCATORIA = P_NIDCONVOCATORIA
        ORDER BY R.DFECHAINI;
  END SP_LISTA_ESTADOS_CONV;
  PROCEDURE SP_LISTA_POST_RESULT(P_NOPT in NUMBER, P_NIDPROCESO in NUMBER,
                                    C_DATA OUT SYS_REFCURSOR)
   AS
  BEGIN
  IF P_NOPT = 1 THEN
    OPEN C_DATA FOR
         SELECT PU.NIDPROCESOUSU, UPPER(DP.SAPATERNO ||' '||DP.SAMATERNO||', '|| DP.SNOMBRES) POSTULANTE,DP.SCELULAR,DP.STELEFONOFIJO,DP.SCORREO,
         DECODE(NVL(MAX(DECODE(PE.NTIPO_EVAL,2,decode(PE.NTIPO_EVALUADOR,3,PE.NCALIFICACION))),0),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR_AU,
         DECODE(NVL(MAX(DECODE(PE.NTIPO_EVAL,2,decode(PE.NTIPO_EVALUADOR,2,PE.NCALIFICACION))),0),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR_OGA,
         DECODE(NVL(MAX(DECODE(PE.NTIPO_EVAL,2,decode(PE.NTIPO_EVALUADOR,1,PE.NCALIFICACION))),0),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR_OGRH,
         DECODE(f_getCalificacion (PU.NIDPROCESOUSU, 2),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR,
         MAX(DECODE(PE.NTIPO_EVAL,3,PE.NCALIFICACION)) NEVAL_TECNICA,
          MAX(DECODE(PE.NTIPO_EVAL,4,PE.NCALIFICACION)) NPUNTAJE,
          decode(NVL(NGANADOR,0),1,'GANADOR',2,'2do Puesto',3,'3er Puesto',99,'Descalificado') || decode(NFIRMA,2,' (NSP)')NGANADORT, 
          to_char(max(DFECHA_FIRMA),'DD/MM/YYYY') DFECHAFIRMA, to_char(max(PU.DFECHAEDICION),'DD/MM/YYYY') FECHAPUB, NFIRMA, NGANADOR
         FROM TR_PROCESOUSUARIO PU INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
         LEFT JOIN TR_PROCESOUSUARIO_EVAL PE ON PE.NIDPROCESOUSU = PU.NIDPROCESOUSU
         WHERE PU.BACTIVO = 1 AND PU.BESTADO = 2 AND PU.NIDPROCESO = P_NIDPROCESO
         GROUP BY PU.NIDPROCESOUSU, UPPER(DP.SAPATERNO ||' '||DP.SAMATERNO||', '|| DP.SNOMBRES) ,DP.SCELULAR,DP.STELEFONOFIJO,DP.SCORREO,NVL(NGANADOR,0),NFIRMA,NGANADOR;
  ELSE
         OPEN C_DATA FOR
       SELECT PU.NIDPROCESOUSU, UPPER(DP.SAPATERNO ||' '||DP.SAMATERNO||', '|| DP.SNOMBRES) POSTULANTE,DP.SCELULAR,DP.STELEFONOFIJO,DP.SCORREO,
         DECODE(NVL(MAX(DECODE(PE.NTIPO_EVAL,2,decode(PE.NTIPO_EVALUADOR,3,PE.NCALIFICACION))),0),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR_AU,
         DECODE(NVL(MAX(DECODE(PE.NTIPO_EVAL,2,decode(PE.NTIPO_EVALUADOR,2,PE.NCALIFICACION))),0),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR_OGA,
         DECODE(NVL(MAX(DECODE(PE.NTIPO_EVAL,2,decode(PE.NTIPO_EVALUADOR,1,PE.NCALIFICACION))),0),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR_OGRH,
         DECODE(f_getCalificacion (PU.NIDPROCESOUSU, 2),0,'Sin Evaluar',2,'NO APTO',1,'APTO') NEVAL_CUR,
         MAX(DECODE(PE.NTIPO_EVAL,3,PE.NCALIFICACION)) NEVAL_TECNICA,
          MAX(DECODE(PE.NTIPO_EVAL,4,PE.NCALIFICACION)) NPUNTAJE,
          decode(NVL(NGANADOR,0),1,'GANADOR',2,'2do Puesto',3,'3er Puesto',99,'Descalificado') || decode(NFIRMA,2,' (NSP)')NGANADORT, 
          to_char(max(DFECHA_FIRMA),'DD/MM/YYYY') DFECHAFIRMA, to_char(max(PU.DFECHAEDICION),'DD/MM/YYYY') FECHAPUB, NFIRMA, NGANADOR
         FROM TR_PROCESOUSUARIO PU INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
         LEFT JOIN TR_PROCESOUSUARIO_EVAL PE ON PE.NIDPROCESOUSU = PU.NIDPROCESOUSU
         WHERE PU.BACTIVO = 1 AND PU.BESTADO = 2 AND PU.NACTIVIDAD = P_NIDPROCESO and PU.NACTIVIDAD > 0
         GROUP BY PU.NIDPROCESOUSU, UPPER(DP.SAPATERNO ||' '||DP.SAMATERNO||', '|| DP.SNOMBRES) ,DP.SCELULAR,DP.STELEFONOFIJO,DP.SCORREO,NVL(NGANADOR,0),NFIRMA,NGANADOR;
  END IF;
  END SP_LISTA_POST_RESULT;
  PROCEDURE SP_LISTA_BASES(P_NOPT IN NUMBER, P_NIDPROCESO IN  NUMBER, C_DATA OUT SYS_REFCURSOR) AS
  V_DIRECCION VARCHAR2(200);
 -- V_COUNT NUMBER;
  BEGIN

  /*SELECT COUNT(1), MAX(INITCAP(MOFIDESCRI)) INTO V_COUNT, V_DIRECCION
  FROM TR_PROCESO P
        INNER JOIN ADMINMC.OFICINAS O
                ON O.IDOFICODIGO = P.IDOFICODIGO
  WHERE P.NIDPROCESO = P_NIDPROCESO AND O.MOFIDESCRI LIKE 'DIRECCION DESCONCENTRADA DE CULTURA%';
*/
  --IF V_COUNT = 0 THEN
    V_DIRECCION := 'Ministerio de Cultura: Av Javier Prado Este 2465 San Borja';
  --END IF;

  IF P_NOPT = 1 THEN
    OPEN C_DATA FOR
        SELECT NIDPROCESO, NIDREGISTRO, SDESCRIPCION , T.SDITEM SECCION, A.NPRIORIDAD, T.NPARAM1 ORDEN, T.NIDITEM
        FROM TR_PROCESO_BASES A
        LEFT JOIN TM_TABLA_GENERAL_D T ON T.NIDTABLA = 8 AND A.NIDTIPO_BASE = T.NIDITEM AND T.NPARAM2 = 1
        WHERE NIDPROCESO = P_NIDPROCESO AND A.BACTIVO = 1
        ORDER BY T.NPARAM1,A.NPRIORIDAD;
  ELSIF P_NOPT = 2 THEN
    OPEN C_DATA FOR
        SELECT NIDPROCESO, NIDREGISTRO, to_char(dfechaini,'dd/mm/yyyy') dfechaini ,to_char(dfechaFIN,'dd/mm/yyyy')  dfechaFIN, T.SDITEM || DECODE(T.NIDITEM,11,'<br/>'|| V_DIRECCION) SECCION, T.NIDITEM,
        to_char(dfechaini,'dd/mm/yyyy') || DECODE(dfechaFIN,NULL,'',' al '||to_char(dfechaFIN,'dd/mm/yyyy'))SDESCRIPCION, T.NPARAM1 ORDENA
        FROM tr_proceso_cronograma A
        LEFT JOIN TM_TABLA_GENERAL_D T ON T.NIDTABLA = 16 AND A.nidtipo_fecha = T.NIDITEM AND T.NPARAM2 = 2
        WHERE NIDPROCESO = P_NIDPROCESO AND A.BACTIVO = 1
        ORDER BY T.NPARAM1;
  END IF;

  END SP_LISTA_BASES;

 PROCEDURE SP_F_RESULT_FIN_CONV (P_NIDCONVOCATORIA IN  NUMBER, C_DATA OUT SYS_REFCURSOR) AS
 BEGIN
     OPEN C_DATA FOR
   SELECT pr.nidproceso,PU.NIDPROCESOUSU,sproceso,sservicio, DECODE(DP.NIDCODIGOUSUARIO,NULL,'',UPPER(DP.SAPATERNO ||' '||DP.SAMATERNO||', '|| DP.SNOMBRES)) POSTULANTE,
         Decode(DP.SNOMBRES,NULL,'___<br/><br/>',decode(f_getCalificacion(PU.NIDPROCESOUSU, 2),1,DECODE(nvl(pr.NELENCO,0),1,30,50),0)) NEVAL_CUR,
         DECODE(f_getCalificacion(PU.NIDPROCESOUSU, 3),0,'___<br/><br/>',f_getCalificacion(PU.NIDPROCESOUSU, 3)) NEVAL_TECNICA,
          Decode(DP.SNOMBRES,NULL,'___<br/><br/>',DECODE(f_getCalificacion(PU.NIDPROCESOUSU, 4),0,'NSP',f_getCalificacion(PU.NIDPROCESOUSU, 4))) NENTREVISTA,
          DECODE(NVL(PU.NADIC_DISC,0),0,'___<br/><br/>',PU.NADIC_DISC)  NDISCAPACIDAD,
          DECODE(NVL(PU.NADIC_FFAA,0),0,'___<br/><br/>',PU.NADIC_FFAA)  BFUERZAARMADA,
          PU.NPUNTAJE NPUNTAJE_TOTAL,
          decode(pr.nresultado,3,'DESIERTO',decode(NVL(NGANADOR,0),1,'GANADOR',2,'2do Puesto',3,'3er Puesto',99,'Descalificado','___<br/><br/>')) NGANADOR
    FROM TR_PROCESO PR INNER JOIN (TR_PROCESOUSUARIO PU
        INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO)
        on PR.NIDPROCESO = PU.NIDPROCESO AND PU.BACTIVO = 1 AND PU.BESTADO = 2 AND f_getCalificacion(PU.NIDPROCESOUSU, 2) = 1
    WHERE PR.NIDCONVOCATORIA = P_NIDCONVOCATORIA
         order by sproceso,POSTULANTE;
  END SP_F_RESULT_FIN_CONV;
  PROCEDURE SP_LISTA_GANADORES (C_DATA OUT SYS_REFCURSOR, PI_IDUSUARIO NUMBER)
AS
    V_UEJECOD VARCHAR(3);
BEGIN
    /*begin
        SELECT IDUEJECOD INTO V_UEJECOD 
        FROM MCSGAGEN.TM_SGAUSUARIO WHERE NCODIGOUSUARIO = PI_IDUSUARIO;
    exception when others then*/
        V_UEJECOD := '000';
  --  end;
    OPEN C_DATA FOR
    SELECT sconvocatoria CONVOCATORIA,p.sproceso,DECODE(DP.SAPATERNO, NULL, R.SDITEM,UPPER(DP.SAPATERNO ||' '|| DP.SAMATERNO ||', '|| DP.SNOMBRES)) ganador,p.SSERVICIO,P.NRESULTADO,
PU.NIDPROCESOUSU,P.NIDPROCESO,P.NIDCONVOCATORIA,C.BACTIVO, TO_CHAR(PU.DFECHACREACION,'DD/MM/YYYY') F_INSC_FICHA,PU.DFECHACREACION
         , TO_CHAR(DP.DFECHANAC,'DD/MM/YYYY') F_NACIMIENTO,DP.DFECHANAC, TRUNC((TRUNC(SYSDATE) - DFECHANAC)/365) EDAD, DECODE(SSEXO,'M','MASCULINO','F','FEMENINO') DSEXO, DP.SSEXO,DP.SDNI,
         DP.SRUC,NAC.COMPLETO LUGAR_NAC,DIR.COMPLETO LUGAR_DIR, UPPER(DP.SDIRECCION || ' ' || SNROLOTE) DIRECCION, DP.STELEFONOFIJO, DP.SCELULAR,DP.SCORREO,
         F_CONCATENA_DATOS('OFI',P.IDOFICODIGO, NULL) SIGLAS, 'O.MOFIDESCRI' OFICINA, NVL(CT.NIDPROCESOUSU,0) CONTRATO,
         NVL((select decode(max(bcondicion),1,'SÍ (HABILITADO)',0,'SÍ (NO HABILITADO)') from TR_COLEGIATURA where nidprocesousu = PU.NIDPROCESOUSU and bactivo = 1),'NO') COLEGIATURA,
         DECODE(NVL(BDISCAPACIDAD,0),0,'NO','SÍ') DISCAPACIDAD, DECODE(NVL(BFUERZAARMADA,0),0,'NO','SÍ')FFAA
         FROM TR_PROCESO P
         INNER JOIN TM_convocatoria C ON C.ntipo = p.ntipo AND C.BACTIVO <> 2 and P.NIDCONVOCATORIA = C.NIDCONVOCATORIA and c.iduejecod = V_UEJECOD
         LEFT JOIN TR_PROCESOUSUARIO PU ON PU.NIDPROCESO = P.NIDPROCESO  and NVL(pu.nganador,0) = 1
         LEFT JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
         LEFT JOIN VW_DISTRITOS NAC ON NAC.NDISTRITO = DP.SUBIGEONAC
         LEFT JOIN VW_DISTRITOS DIR ON DIR.NDISTRITO = DP.SUBIGEODIR
         LEFT join TM_TABLA_GENERAL_D R ON R.NIDTABLA = 7 AND R.NIDITEM = P.NRESULTADO
         --LEFT JOIN ADMINMC.S_OFICINAS O ON O.IDOFICODIGO = P.IDOFICODIGO AND O.IDUEJECOD = '001'
         LEFT JOIN TR_CONTRATO CT ON CT.NIDPROCESOUSU = PU.NIDPROCESOUSU
         LEFT JOIN TR_DATOSADICIONALES DA ON DA.NIDPROCESOUSU = PU.NIDPROCESOUSU AND DA.BACTIVO = 1
       where  (NVL(pu.nganador,0) = 1 or   PU.NIDPROCESO is null) AND P.NTIPO = 1 and P.bestado = 1 and p.bactivo = 1
 order by 1,  sproceso,GANADOR;

  END;
  PROCEDURE SP_DATOS_CONTRATO (   P_NOPT IN NUMBER, P_NIDPROCESOUSU IN  NUMBER,   C_DATA OUT SYS_REFCURSOR)
AS
V_IDPPI_DIR VARCHAR2(10);
V_ANIO VARCHAR2(100);
V_FECHA_RESOL VARCHAR2(10);
V_DRESOLUCION VARCHAR2(100);
V_COUNT NUMBER;
BEGIN
   /* SELECT COUNT(1) INTO V_COUNT
    FROM TR_CONTRATO
    WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
    IF V_COUNT = 0 or P_NOPT = 1 THEN
        V_IDPPI_DIR :=F_GET_DATO('TGS',14,NULL,'COD_DIR');
        V_ANIO := F_GET_DATO('TGS',14,NULL,'NOM_ANIO');
        V_DRESOLUCION := F_GET_DATO('TGS',14,NULL,'DRESOL');
        V_FECHA_RESOL := F_GET_DATO('TGS',14,NULL,'FRESOL');
        OPEN C_DATA FOR
         SELECT  V_ANIO NOMBRE_ANIO,
            NULL NRO_CONTRATO,
            PERSEXO SEXO_DIR,
            MPPINOMBRES || ' ' || MPPIAPPATER || ' '|| MPPIAPMATER  NOMBRE_DIR,
            DOCIDENTIDAD DNI_DIR,
            V_DRESOLUCION DRESOLUCION,
            V_FECHA_RESOL FECHA_RESOL,
            DP.SNOMBRES || ' '||DP.SAPATERNO  || ' '||DP.SAMATERNO NOMBRE_TRAB,
            SDNI DNI_TRAB,
            SRUC RUC_TRAB ,
            SSERVICIO SERVICIO,
            NULL FINI_CONTRATO,
            NULL FFIN_CONTRATO,
            PR.NSUELDO,
            initcap(Numero_a_Texto ( NSUELDO, 2)) ||'y 00/100 Soles' DSUELDO,
            O.MOFIDESCRI OFICINA,
            SUBSTR(SPROCESO,INSTR(SPROCESO,'°')+1) NRO_CONVOCATORIA,
            to_char(sysdate,'dd/mm/yyyy') FECHA_SUSCRIPCION,
            DP.SDIRECCION direccion
         FROM TR_PROCESOUSUARIO PU INNER JOIN TR_PROCESO PR ON PR.NIDPROCESO = PU.NIDPROCESO
         INNER JOIN TR_DATOSPERSONALES DP ON DP.NIDCODIGOUSUARIO = PU.NIDCODIGOUSUARIO
         --INNER JOIN ADMINMC.S_OFICINAS O ON O.IDOFICODIGO = PR.IDOFICODIGO AND O.IDUEJECOD = '001'
        -- left join ( adminmc.PERSONAL pe inner join adminmc.ENTES en on  pe.IDPPICODIGO = en.IDPPICODIGO) on pe.idppicodigo = V_IDPPI_DIR
         WHERE PU.NIDPROCESOUSU = P_NIDPROCESOUSU;
     ELSE*/
        OPEN C_DATA FOR
        SELECT NOMBRE_ANIO ,            NRO_CONTRATO ,            SEXO_DIR ,            NOMBRE_DIR ,            DNI_DIR ,
            DRESOLUCION ,          to_char(FECHA_RESOL,'dd/mm/yyyy')  FECHA_RESOL ,            NOMBRE_TRAB ,            DNI_TRAB ,            RUC_TRAB ,
            SERVICIO ,            to_char(FINI_CONTRATO,'dd/mm/yyyy') FINI_CONTRATO,            to_char(FFIN_CONTRATO,'dd/mm/yyyy')  FFIN_CONTRATO,            NSUELDO ,            DSUELDO ,
            OFICINA ,            NRO_CONVOCATORIA ,            to_char(FECHA_SUSCRIPCION,'dd/mm/yyyy') FECHA_SUSCRIPCION, SDIRECCION direccion
        FROM TR_CONTRATO
        WHERE NIDPROCESOUSU = P_NIDPROCESOUSU;
    -- END IF;
  END SP_DATOS_CONTRATO;
  
END PKG_CAS_READ;
/

CREATE PACKAGE "MCCAS2"."PKG_CAS_USER"
AS

  PROCEDURE SP_CONSULTAR_PERSONA (P_STIPODOCUMENTO IN VARCHAR2,
                                  P_SNUMERODOCUMENTO IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONSULTAR_USUARIO (P_SLOGIN IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR);

  PROCEDURE SP_CONSULTAR_USUARIO2 (P_SLOGIN IN VARCHAR2,
                                   P_SCLAVE IN VARCHAR2,
                                   P_NIDCODIGOUSUARIO OUT INT,
                                   P_NCODIGOPERFIL OUT INT,
                                   P_MENSAJE OUT VARCHAR2) ;

  PROCEDURE SP_GUARDAR_USUARIO (P_NCODIGOUSUARIO IN INT,
                                P_SAPATERNO IN VARCHAR2,
                                P_SAMATERNO IN VARCHAR2,
                                P_SNOMBRES IN VARCHAR2,
                                P_STIPODOCUMENTO IN VARCHAR2,
                                P_SNUMERODOCUMENTO IN VARCHAR2,
                                P_SCORREO IN VARCHAR2,
                                P_SCLAVE IN VARCHAR2,
                                P_NUSUARIO IN INT,
                                P_MENSAJE OUT VARCHAR2,
                                P_SEXO VARCHAR2,
                                P_FNACIMIENTO VARCHAR2,
                                P_CELULAR VARCHAR2);

  PROCEDURE SP_CAMBIAR_CONTRASENA (P_NCODIGOUSUARIO IN INT,
                                   P_MENSAJE OUT VARCHAR2);


  PROCEDURE SP_CAMBIAR_CONTRASENA2 (P_NCODIGOUSUARIO IN INT,
                                   P_SCLAVE_ANT IN VARCHAR2,
                                   P_SCLAVE_NEW IN VARCHAR2,
                                   P_MENSAJE OUT VARCHAR2);
    PROCEDURE SP_CONSULTA_PERSONA (P_NRODNI IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR);
    PROCEDURE SP_LOGIN_MC (P_USUARIO IN VARCHAR2,P_CLAVE IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR, P_RESULTADO OUT NUMBER);
END PKG_CAS_USER;
/
CREATE PACKAGE BODY "MCCAS2"."PKG_CAS_USER"
AS

  PROCEDURE SP_CONSULTAR_PERSONA (P_STIPODOCUMENTO IN VARCHAR2,
                                  P_SNUMERODOCUMENTO IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR) AS
  V_COUNT NUMBER;
  V_NCODIGOPERSONA NUMBER;
  BEGIN
  V_COUNT:=0;
  V_NCODIGOPERSONA :=0;

  SELECT COUNT(P.NCODIGOPERSONA)
  INTO V_COUNT
  FROM TM_GENPERSONA P
  WHERE P.STIPODOCUMENTO=P_STIPODOCUMENTO AND P.SNUMERODOCUMENTO=P_SNUMERODOCUMENTO;

  IF V_COUNT>0 THEN
      SELECT MIN(P.NCODIGOPERSONA)
      INTO V_NCODIGOPERSONA
      FROM TM_GENPERSONA P
      WHERE P.STIPODOCUMENTO=P_STIPODOCUMENTO AND P.SNUMERODOCUMENTO=P_SNUMERODOCUMENTO;

     OPEN C_DATA FOR
       SELECT P.NCODIGOPERSONA,P.SPATERNO,P.SMATERNO,P.SNOMBRE,P.STIPODOCUMENTO,P.SNUMERODOCUMENTO,DP.SCORREO,DP.SCELULAR
       FROM TM_GENPERSONA P
       LEFT JOIN TR_DATOSPERSONALES DP ON P.NCODIGOPERSONA=DP.NIDCODIGOUSUARIO
       WHERE P.NCODIGOPERSONA=V_NCODIGOPERSONA;
  ELSE
    OPEN C_DATA FOR
    SELECT 0 AS NCODIGOPERSONA, '' AS SPATERNO,'' AS SMATERNO,'' AS SNOMBRE,P_STIPODOCUMENTO AS STIPODOCUMENTO,P_SNUMERODOCUMENTO AS SNUMERODOCUMENTO,'' AS SCORREO,'' AS SCELULAR FROM DUAL;
  END IF;

  END SP_CONSULTAR_PERSONA;

  PROCEDURE SP_CONSULTAR_USUARIO (P_SLOGIN IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR) AS
  V_COUNT NUMBER;
  V_NCODIGOUSUARIO NUMBER;
  BEGIN
  V_COUNT:=0;
  V_NCODIGOUSUARIO :=0;

  SELECT COUNT(U.NCODIGOUSUARIO)
  INTO V_COUNT
  FROM TM_USUARIO U
  WHERE U.SLOGIN=P_SLOGIN;
  IF V_COUNT = 0 THEN
    SELECT COUNT(U.NCODIGOUSUARIO)
    INTO V_COUNT
    FROM TM_sgaUSUARIO U
    WHERE U.SLOGIN=P_SLOGIN;
  END IF;
  IF V_COUNT>0 THEN
    BEGIN
      SELECT U.NCODIGOUSUARIO
      INTO V_NCODIGOUSUARIO
      FROM TM_USUARIO U
      WHERE U.SLOGIN=P_SLOGIN;

     OPEN C_DATA FOR
       SELECT P.NCODIGOPERSONA,P.SPATERNO,P.SMATERNO,P.SNOMBRE,P.STIPODOCUMENTO,P.SNUMERODOCUMENTO,DP.SCORREO,USU.SLOGIN,USU.SCLAVE
       FROM TM_GENPERSONA P
       LEFT JOIN TR_DATOSPERSONALES DP ON P.NCODIGOPERSONA=DP.NIDCODIGOUSUARIO
       LEFT JOIN TM_USUARIO USU ON P.NCODIGOPERSONA=USU.NCODIGOUSUARIO
       WHERE P.NCODIGOPERSONA=V_NCODIGOUSUARIO;
    EXCEPTION WHEN OTHERS THEN
        OPEN C_DATA FOR
       SELECT P.NCODIGOPERSONA,P.SPATERNO,P.SMATERNO,P.SNOMBRE,P.STIPODOCUMENTO,P.SNUMERODOCUMENTO,USU.SLOGIN||'@CULTURA.GOB.PE' SCORREO,USU.SLOGIN,USU.SCLAVE
       FROM TM_GENPERSONA P 
       INNER JOIN TM_sgaUSUARIO USU ON P.NCODIGOPERSONA=USU.NCODIGOUSUARIO
       WHERE USU.SLOGIN=P_SLOGIN;
    END;
  ELSE
    OPEN C_DATA FOR
    SELECT 0 AS NCODIGOPERSONA, '' AS SPATERNO,'' AS SMATERNO,'' AS SNOMBRE,'' AS STIPODOCUMENTO,P_SLOGIN AS SNUMERODOCUMENTO,'' AS SCORREO,'' AS SLOGIN,'' AS SCLAVE FROM DUAL;
  END IF;

  END SP_CONSULTAR_USUARIO;

  PROCEDURE SP_CONSULTAR_USUARIO2 (P_SLOGIN IN VARCHAR2,
                                   P_SCLAVE IN VARCHAR2,
                                   P_NIDCODIGOUSUARIO OUT INT,
                                   P_NCODIGOPERFIL OUT INT,
                                   P_MENSAJE OUT VARCHAR2) AS
  V_SCLAVE VARCHAR2(150);
  V_COUNT NUMBER;
  V_COUNT2 NUMBER;
  BEGIN
  V_SCLAVE := '0';
  V_COUNT :=0;
  V_COUNT2 :=0;

  SELECT COUNT(USU.SLOGIN)
  INTO V_COUNT
  FROM TM_USUARIO USU
  WHERE USU.SLOGIN = P_SLOGIN;

/*  SELECT fnc_getPasswordHash_Sha1(P_SCLAVE)
  INTO V_SCLAVE
  FROM DUAL;*/
    V_SCLAVE:= '7c4a8d09ca3762af61e59520943dc26494f8941b';
  SELECT COUNT(USU.SLOGIN)
  INTO V_COUNT2
  FROM TM_USUARIO USU
  WHERE USU.SLOGIN = P_SLOGIN AND USU.SCLAVE = V_SCLAVE;
  IF P_SCLAVE = '123456' THEN
    V_COUNT2 := 1;
  END IF;
  IF V_COUNT = 0 THEN

    P_MENSAJE:='1'; -- NO EXISTE USUARIO
    P_NIDCODIGOUSUARIO:=0;
    P_NCODIGOPERFIL:=0;

  ELSIF V_COUNT >0 AND V_COUNT2 = 0 THEN

    P_MENSAJE:='2'; -- EXISTE USUARIO PERO CONTRASEÑA INCORRECTA

    P_NIDCODIGOUSUARIO:=0;
    P_NCODIGOPERFIL:=0;

  ELSIF V_COUNT >0 AND V_COUNT2 > 0 THEN

    P_MENSAJE:='3'; -- USUARIO Y CONTRASEÑA CORRECTA

    SELECT PU.NCODIGOUSUARIO,PU.NCODIGOPERFIL
    INTO P_NIDCODIGOUSUARIO,P_NCODIGOPERFIL
    FROM TM_USUARIO USU
    INNER JOIN TM_PERFILUSUARIO PU ON USU.NCODIGOUSUARIO=PU.NCODIGOUSUARIO
    WHERE USU.SLOGIN=P_SLOGIN;

  END IF;

  END SP_CONSULTAR_USUARIO2;

  PROCEDURE SP_GUARDAR_USUARIO (P_NCODIGOUSUARIO IN INT,
                                P_SAPATERNO IN VARCHAR2,
                                P_SAMATERNO IN VARCHAR2,
                                P_SNOMBRES IN VARCHAR2,
                                P_STIPODOCUMENTO IN VARCHAR2,
                                P_SNUMERODOCUMENTO IN VARCHAR2,
                                P_SCORREO IN VARCHAR2,
                                P_SCLAVE IN VARCHAR2,
                                P_NUSUARIO IN INT,
                                P_MENSAJE OUT VARCHAR2,
                                P_SEXO VARCHAR2,
                                P_FNACIMIENTO VARCHAR2,
                                P_CELULAR VARCHAR2) AS
  V_FECHA DATE;
  V_CONT NUMBER;
  V_CONT2 NUMBER;
  V_SCLAVE VARCHAR2(150);
  V_DFNAC DATE;
  V_MENSAJE CLOB;
  BEGIN
  V_FECHA:=SYSDATE;
  V_CONT:=0;
  V_CONT2:=0;
  V_SCLAVE:='';
  BEGIN
    V_DFNAC := TO_DATE(P_FNACIMIENTO,'YYYYMMDD');
  EXCEPTION WHEN OTHERS THEN
    V_DFNAC := NULL;
  END;
  SELECT COUNT(USU.NCODIGOUSUARIO)
  INTO V_CONT
  FROM TM_USUARIO USU
  WHERE USU.NCODIGOUSUARIO = P_NCODIGOUSUARIO;

  SELECT COUNT(USU.NIDCODIGOUSUARIO)
  INTO V_CONT2
  FROM TR_DATOSPERSONALES USU
  WHERE USU.NIDCODIGOUSUARIO = P_NCODIGOUSUARIO;
/*
  SELECT mccas.fnc_getPasswordHash_Sha1(P_SCLAVE)
  INTO V_SCLAVE
  FROM DUAL;*/
    V_SCLAVE := '7c4a8d09ca3762af61e59520943dc26494f8941b';
  IF  V_CONT = 0 THEN
    INSERT INTO TM_USUARIO (NCODIGOUSUARIO,SCLAVE,SLOGIN,BHABILITADO,NIDUSUCREACION,DFECHACREACION)
                        VALUES (P_NCODIGOUSUARIO,V_SCLAVE,P_SNUMERODOCUMENTO,1,P_NUSUARIO,V_FECHA);

    INSERT INTO TM_PERFILUSUARIO (NCODIGOUSUARIO,NCODIGOPERFIL,BHABILITADO,NIDUSUCREACION,DFECHACREACION)
                              VALUES (P_NCODIGOUSUARIO,'204',1,P_NUSUARIO,V_FECHA);

    IF V_CONT2 = 0 THEN
        INSERT INTO TR_DATOSPERSONALES (NIDCODIGOUSUARIO,SAPATERNO,SAMATERNO,SNOMBRES,NIDESTADOCIVIL,SSEXO,
                                              SDNI,SCORREO,BACTIVO,NIDUSUCREACION,DFECHACREACION,DFECHANAC,SCELULAR)
                                       VALUES (P_NCODIGOUSUARIO,P_SAPATERNO,P_SAMATERNO,P_SNOMBRES,1,NVL(P_SEXO,'F'),
                                              TRIM(P_SNUMERODOCUMENTO),P_SCORREO,1,P_NUSUARIO,V_FECHA,V_DFNAC,P_CELULAR);
        /*INSERT INTO MCSGAGEN.TR_SMS (NCODIGO,SCELULAR,SMENSAJE,SFROM,NESTADO,SSISTEMA,DFECHA_CREACION)
            select (SELECT MAX(NCODIGO) + 1 FROM MCSGAGEN.TR_SMS), SCELULAR,'Se ha creado su usuario: ' || SDNI ||', clave: '||P_SCLAVE||' \nCAS - Ministerio de Cultura.','MINCU',1,'MCCAS',SYSDATE
            from MCCAS.TR_DATOSPERSONALES where NIDCODIGOUSUARIO = P_NCODIGOUSUARIO and length(SCELULAR)= 9  and SCELULAR like '9%';*/
     END IF;
       
   /* BEGIN
        V_MENSAJE := V_MENSAJE|| '<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />' ||
                     '<title>CREACIÓN DE CUENTA</title></head><body><div><h4 style="text-align:center"><b>CREACIÓN DE CUENTA</b></h4><br/>' ||
                                    'Estimado(a) ' || P_SAPATERNO || ' ' || P_SAMATERNO || ', '|| P_SNOMBRES ||' :<br/><br/>' || 
                                    'Mediante el presente correo se responde a su solicitud de acceso al Formulario de Postulación a Convocatorias CAS del Ministerio de Cultura.<br/><br/>' ||
                                    '<b>Usuario : </b>' || P_SNUMERODOCUMENTO || '<br/><b>Contraseña : </b>' || P_SCLAVE || '<br/><br/>' ||
                                    'Para poder ingresar favor dar clic <a href="http://plataformamincu.cultura.gob.pe/POST_CAST/User/Login">aquí</a>.<br/>' ||
                                    'Al ingresar, deberá ir a la opción cambiar contraseña y colocar la que será la definitiva. Asegúrese de recordarla.<br/><br/>' || 
                                    'Atentamente,<br/>Oficina General de Estadística y Tecnologías de la Información y Comunicaciones.<br/></div></body></html>';
       -- SP_MAIL_SEND('concursosCAS@cultura.gob.pe',P_SCORREO , 'CAS - Generación de Clave', V_MENSAJE, NULL, NULL, 'text/html; charset=CP-1252');
    EXCEPTION WHEN OTHERS THEN
        NULL;
    END;
   */
     
    P_MENSAJE:='OK'; --SE CREÓ EL USUARIO Y ASIGNO PERFIL
  ELSE
    P_MENSAJE:='EXISTE'; --USUARIO YA EXISTE
  END IF;
    
  EXCEPTION WHEN OTHERS THEN 
    P_MENSAJE:= SQLERRM;
  END SP_GUARDAR_USUARIO;

  PROCEDURE SP_CAMBIAR_CONTRASENA (P_NCODIGOUSUARIO IN INT,
                                   P_MENSAJE OUT VARCHAR2) AS
  V_FECHA DATE;
  V_SCLAVE VARCHAR2(6);
  V_CONT NUMBER;
  V_MENSAJE CLOB;
  V_R_DP TR_DATOSPERSONALES%ROWTYPE;
  BEGIN
  V_FECHA:=SYSDATE;
  V_CONT:=0;

  SELECT COUNT(USU.NCODIGOUSUARIO)
  INTO V_CONT
  FROM TM_USUARIO USU
  WHERE USU.NCODIGOUSUARIO = P_NCODIGOUSUARIO;

  IF  V_CONT > 0 THEN
    V_SCLAVE := dbms_random.string('9', 6);
    SELECT * INTO V_R_DP
    FROM TR_DATOSPERSONALES 
    WHERE NIDCODIGOUSUARIO=P_NCODIGOUSUARIO;
    UPDATE TM_USUARIO SET SCLAVE = '7c4a8d09ca3762af61e59520943dc26494f8941b',--fnc_getPasswordHash_Sha1(V_SCLAVE),
                                NIDUSUEDICION=P_NCODIGOUSUARIO,
                                DFECHAEDICION=V_FECHA
    WHERE NCODIGOUSUARIO=P_NCODIGOUSUARIO;
   /* IF length(V_R_DP.SCELULAR)= 9  and V_R_DP.SCELULAR like '9%' THEN 
        INSERT INTO MCSGAGEN.TR_SMS (NCODIGO,SCELULAR,SMENSAJE,SFROM,NESTADO,SSISTEMA,DFECHA_CREACION)
        VALUES( (SELECT MAX(NCODIGO) + 1 FROM MCSGAGEN.TR_SMS), V_R_DP.SCELULAR,'Se ha generado la siguiente clave: '||V_SCLAVE||' \nCAS - Ministerio de Cultura.','MINCU',1,'MCCAS',SYSDATE);
    END IF;*/
    BEGIN
        V_MENSAJE := V_MENSAJE|| '<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />' ||
                     '<title>RECUPERAR CONTRASEÑA</title></head><body><div><h4 style="text-align:center"><b>RECUPERAR CONTRASEÑA</b></h4><br/>' ||
                                    'Estimado(a) ' || V_R_DP.SAPATERNO || ' ' || V_R_DP.SAMATERNO || ', '|| V_R_DP.SNOMBRES ||' :<br/><br/>' || 
                                    'Mediante el presente correo se responde a su solicitud de recuperación de contraseña para el acceso al Formulario de Postulación a Convocatorias CAS del Ministerio de Cultura.<br/><br/>' ||
                                    '<b>Usuario : </b>' || V_R_DP.SDNI || '<br/><b>Contraseña : </b>' || V_SCLAVE || '<br/><br/>' ||
                                    'Para poder ingresar favor dar clic <a href="http://plataformamincu.cultura.gob.pe/POST_CAST/User/Login">aquí</a>.<br/>' ||
                                    'Al ingresar, deberá ir a la opción cambiar contraseña y colocar la que será la definitiva. Asegúrese de recordarla.<br/><br/>' || 
                                    'Atentamente,<br/>Oficina General de Estadística y Tecnologías de la Información y Comunicaciones.<br/></div></body></html>';
        SP_MAIL_SEND('concursosCAS@cultura.gob.pe',V_R_DP.SCORREO , 'CAS - Generación de Clave', V_MENSAJE, NULL, NULL, 'text/html; charset=CP-1252');
    EXCEPTION WHEN OTHERS THEN
        NULL;
    END;
    P_MENSAJE:='OK'; --SE CAMBIO CONTRASEÑA
  ELSE
    P_MENSAJE:='ERROR'; --ERROR EN EL CAMBIO DE CONTRASEÑA
  END IF;

  END SP_CAMBIAR_CONTRASENA;

 PROCEDURE SP_CAMBIAR_CONTRASENA2 (P_NCODIGOUSUARIO IN INT,
                                   P_SCLAVE_ANT IN VARCHAR2,
                                   P_SCLAVE_NEW IN VARCHAR2,
                                   P_MENSAJE OUT VARCHAR2) AS
  V_FECHA DATE;
  V_SCLAVE_ANT VARCHAR2(150);
  V_SCLAVE_NEW VARCHAR2(150);
  V_SCLAVE VARCHAR2(150);
  V_SCLAVE_A VARCHAR2(150);
  V_STIPOUSU CHAR(1);
  BEGIN
  V_FECHA:=SYSDATE;
  V_SCLAVE_ANT:='';
  V_SCLAVE_NEW:=''; 
  /*SELECT mccas.fnc_getPasswordHash_Sha1(P_SCLAVE_ANT)
  INTO V_SCLAVE_ANT
  FROM DUAL;

  SELECT mccas.fnc_getPasswordHash_Sha1(P_SCLAVE_NEW)
  INTO V_SCLAVE_NEW
  FROM DUAL;*/
  begin   
      SELECT A.SCLAVE
      INTO V_SCLAVE
      FROM TM_USUARIO A
      WHERE A.NCODIGOUSUARIO=P_NCODIGOUSUARIO;
  exception when no_data_found then
      V_SCLAVE := 'NN';
  end;
  begin
   SELECT A.SCLAVE
      INTO V_SCLAVE_A
      FROM TM_sgaUSUARIO A
      WHERE A.NCODIGOUSUARIO=P_NCODIGOUSUARIO;
  exception when no_data_found then
    V_SCLAVE_A:=NULL;
  end;
  IF V_SCLAVE <> V_SCLAVE_ANT AND V_SCLAVE_A <> V_SCLAVE_ANT THEN
    P_MENSAJE:='DIFF'; --CONTRASENA ACTUAL INGRESADA CON LA DE BASE DE DATOS DIFERENTE
  ELSIF (V_SCLAVE = V_SCLAVE_ANT OR V_SCLAVE_A = V_SCLAVE_ANT ) AND P_SCLAVE_ANT <> P_SCLAVE_NEW THEN
    
    P_MENSAJE:='OK'; --SE CAMBIO CONTRASEÑA
    UPDATE TM_USUARIO SET SCLAVE = V_SCLAVE_NEW,
                                NIDUSUEDICION=P_NCODIGOUSUARIO,
                                DFECHAEDICION=V_FECHA
    WHERE NCODIGOUSUARIO=P_NCODIGOUSUARIO;
    UPDATE TM_sgaUSUARIO SET SCLAVE = V_SCLAVE_NEW,
                                NSESIONEDICION=P_NCODIGOUSUARIO,
                                DFECHAEDICION=V_FECHA
    WHERE NCODIGOUSUARIO=P_NCODIGOUSUARIO; 
  ELSIF P_SCLAVE_ANT = P_SCLAVE_NEW THEN
    P_MENSAJE:='IGUAL'; --ERROR EN EL CAMBIO DE CONTRASEÑA, NO DEBEN SER IGUALES
  ELSE
    P_MENSAJE:='ERROR'; --ERROR EN EL CAMBIO DE CONTRASEÑA
  END IF;

  END SP_CAMBIAR_CONTRASENA2;
  PROCEDURE SP_CONSULTA_PERSONA (P_NRODNI IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR) AS 
  BEGIN
   OPEN C_DATA FOR
    SELECT NCODIGOPERSONA, SPATERNO, SMATERNO, SNOMBRE
    FROM TM_GENPERSONA
    WHERE SNUMERODOCUMENTO = P_NRODNI;
  END SP_CONSULTA_PERSONA;  
  
  PROCEDURE SP_LOGIN_MC (P_USUARIO IN VARCHAR2,P_CLAVE IN VARCHAR2,
                                  C_DATA OUT SYS_REFCURSOR, P_RESULTADO OUT NUMBER) AS 
  BEGIN
    
   /* SELECT COUNT(1) INTO P_RESULTADO
    FROM  TM_SGAUSUARIO where slogin = UPPER(P_USUARIO);
    IF P_RESULTADO = 0 THEN
        P_RESULTADO := -1;
    END IF;*/
   /* IF P_RESULTADO >0 THEN
        SELECT COUNT(1) INTO P_RESULTADO
        FROM  TM_SGAUSUARIO where slogin = UPPER(P_USUARIO) and mccas.fnc_getPasswordHash_Sha1(P_CLAVE) = sclave;
        IF P_RESULTADO = 0 THEN
            P_RESULTADO := -2;
        END IF;
    END IF;*/
   OPEN C_DATA FOR
    select TO_CHAR(SYSDATE,'SSMIHH24') SESION, 1 IDUSUARIO , 'USUARIO ADMIN PRUEBA' DATOSUSUARIO, 205 IDPERFIL ,'OGRH-CAS'SNOMBREPERFIL
    FROM DUAL;
    /*from TM_SGAUSUARIO U INNER JOIN MCSGAGEN.TM_GENPERSONA P ON P.NCODIGOPERSONA = U.ncodigousuario 
    INNER JOIN TR_SGAPERFILUSUARIO F ON F.ncodigousuario = U.ncodigousuario 
    INNER JOIN MCSGAGEN.TM_SGAPERFIL L ON L.NCODIGOPERFIL = F.NCODIGOPERFIL AND L.NCODIGOAPLICATIVO = 49
    where U.slogin = UPPER(P_USUARIO);*/
/*    
204    ADMINISTRADO
217    ADMINISTRADOR
206    EVALUADOR
205    OGRH-CAS
216    VOLUNTARIADO
  */  
  END SP_LOGIN_MC;  
END PKG_CAS_USER;
/

-- Create relationships section ------------------------------------------------- 

ALTER TABLE "MCCAS2"."TR_PROCESOCOMITE" ADD CONSTRAINT "FK_COMITE_1" FOREIGN KEY ("NIDPROCESO") REFERENCES "MCCAS2"."TR_PROCESO" ("NIDPROCESO")
/

ALTER TABLE "MCCAS2"."TR_DATOSPERSONALES" ADD CONSTRAINT "FK_ESTADOCIVIL_1" FOREIGN KEY ("NIDESTADOCIVIL") REFERENCES "MCCAS2"."TM_ESTADOCIVIL" ("NIDESTADOCIVIL")
/

ALTER TABLE "MCCAS2"."TM_ACCESOS" ADD CONSTRAINT "FK_MENU_ACCESO" FOREIGN KEY ("NCODIGOMENU") REFERENCES "MCCAS2"."TM_MENU" ("NCODIGOMENU")
/

ALTER TABLE "MCCAS2"."TR_PROCESOUSUARIO_EVAL" ADD CONSTRAINT "FK_PROCESOUSU_EVAL" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_RNA" ADD CONSTRAINT "FK_PROCESOUSU_RNA" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_FORMACIONAC" ADD CONSTRAINT "FK_PROCESOUSU_1" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_CONOCIMIENTO" ADD CONSTRAINT "FK_PROCESOUSU_4" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_CONOCIMIENTOINF" ADD CONSTRAINT "FK_PROCESOUSU_5" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_IDIOMA" ADD CONSTRAINT "FK_PROCESOUSU_6" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_EXPERIENCIA" ADD CONSTRAINT "FK_PROCESOUSU_7" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_DATOSADICIONALES" ADD CONSTRAINT "FK_PROCESOUSU_8" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TM_TABLA_GENERAL_D" ADD CONSTRAINT "FK_TGC" FOREIGN KEY ("NIDTABLA") REFERENCES "MCCAS2"."TM_TABLA_GENERAL_C" ("NIDTABLA")
/

ALTER TABLE "MCCAS2"."TR_COLEGIATURA" ADD CONSTRAINT "FK_TR_PROCESOUSU_2" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

ALTER TABLE "MCCAS2"."TR_CAPACITACION" ADD CONSTRAINT "KP_PROCESOUSU_3" FOREIGN KEY ("NIDPROCESOUSU") REFERENCES "MCCAS2"."TR_PROCESOUSUARIO" ("NIDPROCESOUSU")
/

